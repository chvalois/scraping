[0m09:46:30.699169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00ea4b9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e96b3250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e9144af0>]}


============================== 09:46:30.704917 | 997d11ed-c0e4-49dd-a8dd-85898630a558 ==============================
[0m09:46:30.704917 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:46:30.705582 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/airflow/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt init', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:46:30.712059 [error] [MainThread]: Encountered an error:
[ConfigFolderDirectory]: Unable to parse dict {'dir': PosixPath('/home/airflow/.dbt')}
[0m09:46:30.713389 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 608, in _ConvertFieldValuePair
    _ConvertScalarFieldValue(value, field,
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 779, in _ConvertScalarFieldValue
    if _UNPAIRED_SURROGATE_PATTERN.search(value):
TypeError: expected string or bytes-like object

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt_common/events/base_types.py", line 67, in __init__
    self.pb_msg = ParseDict(kwargs, msg_cls())
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 446, in ParseDict
    parser.ConvertMessage(js_dict, message, '')
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 487, in ConvertMessage
    self._ConvertFieldValuePair(value, message, path)
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 622, in _ConvertFieldValuePair
    raise ParseError(
google.protobuf.json_format.ParseError: Failed to parse dir field: expected string or bytes-like object.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/main.py", line 470, in init
    results = task.run()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 301, in run
    self.create_profiles_dir(profiles_dir)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 69, in create_profiles_dir
    fire_event(ConfigFolderDirectory(dir=profiles_dir))
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt_common/events/base_types.py", line 76, in __init__
    raise Exception(error_msg)
Exception: [ConfigFolderDirectory]: Unable to parse dict {'dir': PosixPath('/home/airflow/.dbt')}

[0m09:46:30.714396 [debug] [MainThread]: Resource report: {"command_name": "init", "command_wall_clock_time": 0.06580117, "process_user_time": 1.431807, "process_kernel_time": 0.641706, "process_mem_max_rss": "124284", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m09:46:30.715174 [debug] [MainThread]: Command `dbt init` failed at 09:46:30.715038 after 0.07 seconds
[0m09:46:30.715677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00ea4b9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e8c34160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e8c34730>]}
[0m09:46:30.716145 [debug] [MainThread]: Flushing usage events
[0m09:46:45.055024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a2c285b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a39da3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a1394cd0>]}


============================== 09:46:45.060446 | adc123ad-5c3e-4edc-9763-e3e06c59841a ==============================
[0m09:46:45.060446 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:46:45.061072 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/profiles.yml', 'debug': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt init --profiles-dir /opt/airflow/dbt_profiles/profiles.yml --debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:46:45.069928 [info ] [MainThread]: Setting up your profile.
[0m09:47:29.023126 [error] [MainThread]: Encountered an error:
[Errno 20] Not a directory: '/opt/airflow/dbt_profiles/profiles.yml/profiles.yml'
[0m09:47:29.024439 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/main.py", line 470, in init
    results = task.run()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 321, in run
    self.setup_profile(profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 263, in setup_profile
    self.create_profile_from_target(adapter, profile_name=profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 180, in create_profile_from_target
    self.create_profile_from_profile_template(profile_template, profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 167, in create_profile_from_profile_template
    self.write_profile(profile, profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 157, in write_profile
    with open(profiles_filepath, "w") as f:
NotADirectoryError: [Errno 20] Not a directory: '/opt/airflow/dbt_profiles/profiles.yml/profiles.yml'

[0m09:47:29.025474 [debug] [MainThread]: Resource report: {"command_name": "init", "command_wall_clock_time": 44.02115, "process_user_time": 1.405183, "process_kernel_time": 0.685322, "process_mem_max_rss": "129996", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m09:47:29.026149 [debug] [MainThread]: Command `dbt init` failed at 09:47:29.026035 after 44.02 seconds
[0m09:47:29.026628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a2c285b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a12ba8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a12ba8e0>]}
[0m09:47:29.027142 [debug] [MainThread]: Flushing usage events
[0m09:47:37.754178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d88ef610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d70641f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d7064940>]}


============================== 09:47:37.759669 | dd0c9e22-0a3d-40ef-bb0f-2a642e2cf664 ==============================
[0m09:47:37.759669 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:47:37.760270 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/profiles.yml', 'debug': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt seed --profiles-dir /opt/airflow/dbt_profiles/profiles.yml --debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:47:37.762932 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'scraping_dbt'
[0m09:47:37.763891 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_wall_clock_time": 0.05947098, "process_user_time": 1.383783, "process_kernel_time": 0.661982, "process_mem_max_rss": "124060", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:47:37.764589 [debug] [MainThread]: Command `dbt seed` failed at 09:47:37.764475 after 0.06 seconds
[0m09:47:37.765069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d88ef610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d7247df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d70599a0>]}
[0m09:47:37.765549 [debug] [MainThread]: Flushing usage events
[0m09:47:48.023349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016c6d17c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016b35a8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016ae856d0>]}


============================== 09:47:48.028734 | b1ad627d-a704-4b65-993c-b9465e0a09ed ==============================
[0m09:47:48.028734 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:47:48.029334 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt seed --profiles-dir /opt/airflow/dbt_profiles --debug', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:47:48.190182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1ad627d-a704-4b65-993c-b9465e0a09ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016a1e3850>]}
[0m09:47:48.247072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1ad627d-a704-4b65-993c-b9465e0a09ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016ae53580>]}
[0m09:47:48.248171 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:47:48.254349 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m09:47:48.255729 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_wall_clock_time": 0.28298178, "process_user_time": 1.591407, "process_kernel_time": 0.659754, "process_mem_max_rss": "132456", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m09:47:48.256537 [debug] [MainThread]: Command `dbt seed` failed at 09:47:48.256416 after 0.28 seconds
[0m09:47:48.257124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016c6d17c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016a16dd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016a16d040>]}
[0m09:47:48.257680 [debug] [MainThread]: Flushing usage events
[0m09:47:58.419687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3de353610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dcac6ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dcac6a30>]}


============================== 09:47:58.424811 | a133aa06-2578-4949-9689-cf034e067419 ==============================
[0m09:47:58.424811 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:47:58.425390 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/airflow/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:47:58.549350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a133aa06-2578-4949-9689-cf034e067419', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dcb45df0>]}
[0m09:47:58.561115 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-8s_b0dcq'
[0m09:47:58.561692 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:47:58.637690 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:47:58.639170 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m09:47:58.696081 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m09:47:58.708665 [info ] [MainThread]: Updating lock file in file path: /opt/airflow/scraping_dbt/package-lock.yml
[0m09:47:58.710550 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-15j9w_54'
[0m09:47:58.714848 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m09:47:58.985281 [info ] [MainThread]: Installed from version 1.1.1
[0m09:47:58.985806 [info ] [MainThread]: Updated version available: 1.2.0
[0m09:47:58.986327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a133aa06-2578-4949-9689-cf034e067419', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3ddc55a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dc8b2d30>]}
[0m09:47:58.986763 [info ] [MainThread]: 
[0m09:47:58.987169 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m09:47:58.988252 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.6171804, "process_user_time": 1.668941, "process_kernel_time": 0.633321, "process_mem_max_rss": "130028", "process_out_blocks": "2232", "process_in_blocks": "0"}
[0m09:47:58.988834 [debug] [MainThread]: Command `dbt deps` succeeded at 09:47:58.988737 after 0.62 seconds
[0m09:47:58.989232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3de353610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dc89bd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dc89bcd0>]}
[0m09:47:58.989635 [debug] [MainThread]: Flushing usage events
[0m09:49:02.114988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f13ddc0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f12553af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f12553880>]}


============================== 09:49:02.120376 | bbbc4f88-1f55-4475-b510-791e96cf06fe ==============================
[0m09:49:02.120376 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:49:02.121008 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt seed --profiles-dir /opt/airflow/dbt_profiles --debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:49:02.281473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11bd7d30>]}
[0m09:49:02.337172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f1255d400>]}
[0m09:49:02.338086 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:49:02.357668 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:49:02.358647 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m09:49:02.359159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11b7e370>]}
[0m09:49:04.096824 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m09:49:04.097428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f12a10940>]}
[0m09:49:04.372020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f2851f430>]}
[0m09:49:04.535490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f28371ca0>]}
[0m09:49:04.536213 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:49:04.536663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11f01ee0>]}
[0m09:49:04.538241 [info ] [MainThread]: 
[0m09:49:04.538918 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:49:04.540048 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:49:04.573352 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:49:04.573914 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:49:04.574388 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:49:04.583792 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:49:04.585174 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:49:04.590309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:49:04.596702 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:04.597157 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:49:04.597555 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:04.606004 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m09:49:04.606556 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:04.607167 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:49:04.612435 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m09:49:04.613754 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:49:04.614366 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:49:04.615300 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:49:04.618328 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:04.618832 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:49:04.619334 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:04.626406 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.626911 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:04.627427 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:49:04.632444 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:49:04.633742 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:49:04.634373 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:49:04.640124 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.640641 [debug] [MainThread]: On master: BEGIN
[0m09:49:04.641087 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:49:04.648150 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.648601 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.649160 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:49:04.654479 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:49:04.655798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f113835e0>]}
[0m09:49:04.656388 [debug] [MainThread]: On master: ROLLBACK
[0m09:49:04.656963 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.657420 [debug] [MainThread]: On master: BEGIN
[0m09:49:04.658092 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:49:04.658562 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.658988 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.659521 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.660096 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:04.660532 [debug] [MainThread]: On master: Close
[0m09:49:04.661199 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:49:04.661648 [info ] [MainThread]: 
[0m09:49:04.668458 [debug] [Thread-1  ]: Began running node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.669172 [info ] [Thread-1  ]: 1 of 1 START seed file public.prix_m2_commune .................................. [RUN]
[0m09:49:04.669871 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now seed.scraping_dbt.prix_m2_commune)
[0m09:49:04.670402 [debug] [Thread-1  ]: Began compiling node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.670904 [debug] [Thread-1  ]: Began executing node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.703181 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.703757 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: BEGIN
[0m09:49:04.704245 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:49:04.711636 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.712204 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.712700 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "seed.scraping_dbt.prix_m2_commune"} */

    create table "scraping_db"."public"."prix_m2_commune" ("zipcode" integer,"city_name" text,"house_type" text,"prix_m2" float8)
  
[0m09:49:04.717390 [debug] [Thread-1  ]: SQL status: CREATE TABLE in 0.004 seconds
[0m09:49:04.809028 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.809840 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: 
          insert into "scraping_db"."public"."prix_m2_commune" ("zipcode", "city_name", "house_type", "prix_m2") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s...
[0m09:49:04.813064 [debug] [Thread-1  ]: SQL status: INSERT 0 246 in 0.003 seconds
[0m09:49:04.819290 [debug] [Thread-1  ]: Writing runtime SQL for node "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.837694 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: COMMIT
[0m09:49:04.838248 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.838777 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: COMMIT
[0m09:49:04.840245 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:49:04.843166 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: Close
[0m09:49:04.844911 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11370e50>]}
[0m09:49:04.845623 [info ] [Thread-1  ]: 1 of 1 OK loaded seed file public.prix_m2_commune .............................. [[32mINSERT 246[0m in 0.17s]
[0m09:49:04.846310 [debug] [Thread-1  ]: Finished running node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.847613 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.848091 [debug] [MainThread]: On master: BEGIN
[0m09:49:04.848517 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:49:04.855884 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.856366 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.856819 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.857244 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.857756 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:04.858177 [debug] [MainThread]: On master: Close
[0m09:49:04.858736 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:49:04.859188 [debug] [MainThread]: Connection 'seed.scraping_dbt.prix_m2_commune' was properly closed.
[0m09:49:04.859665 [info ] [MainThread]: 
[0m09:49:04.860134 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m09:49:04.860937 [debug] [MainThread]: Command end result
[0m09:49:04.894803 [info ] [MainThread]: 
[0m09:49:04.895425 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:49:04.895885 [info ] [MainThread]: 
[0m09:49:04.896366 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:49:04.897305 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 2.8314161, "process_user_time": 4.11064, "process_kernel_time": 0.659781, "process_mem_max_rss": "145692", "process_out_blocks": "3352", "process_in_blocks": "0"}
[0m09:49:04.897983 [debug] [MainThread]: Command `dbt seed` succeeded at 09:49:04.897878 after 2.83 seconds
[0m09:49:04.898514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f13ddc0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f2778a040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f10ee63d0>]}
[0m09:49:04.899035 [debug] [MainThread]: Flushing usage events
[0m09:49:16.644364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f33706007c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336ef59c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336edb4ee0>]}


============================== 09:49:16.649593 | 75c5ea38-51de-4b49-a27d-289652385b90 ==============================
[0m09:49:16.649593 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:49:16.650240 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles/profiles.yml', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/profiles.yml', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:49:16.653913 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'scraping_dbt'
[0m09:49:16.654940 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.059664976, "process_user_time": 1.3717, "process_kernel_time": 0.665912, "process_mem_max_rss": "126152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:49:16.655569 [debug] [MainThread]: Command `dbt run` failed at 09:49:16.655463 after 0.06 seconds
[0m09:49:16.655961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f33706007c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336ed80f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336ed14850>]}
[0m09:49:16.656357 [debug] [MainThread]: Flushing usage events
[0m09:49:22.170863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba6790d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8df0af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8df0880>]}


============================== 09:49:22.176665 | 55bd937b-b623-4844-966c-eb3cd5ad3daa ==============================
[0m09:49:22.176665 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:49:22.177385 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:49:22.337803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba4715b0>]}
[0m09:49:22.394715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8dff400>]}
[0m09:49:22.395598 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:49:22.414240 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:49:22.604128 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:49:22.604646 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:49:22.736039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dcebe7790>]}
[0m09:49:22.902028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dceb96a30>]}
[0m09:49:22.902674 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:49:22.903173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dceb45250>]}
[0m09:49:22.904834 [info ] [MainThread]: 
[0m09:49:22.905550 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:49:22.910113 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:49:22.945382 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:49:22.945823 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:49:22.946185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:49:22.955556 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:49:22.956862 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:49:22.958769 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:49:22.965172 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:22.965582 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:49:22.965925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:22.972990 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:49:22.973408 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:22.973774 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:49:22.978630 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:49:22.979766 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:49:22.980251 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:49:22.980840 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:49:22.983278 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:22.983658 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:49:22.983980 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:22.990734 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:49:22.991142 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:22.991541 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:49:22.996610 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m09:49:22.997798 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:49:22.998283 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:49:23.004314 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.004711 [debug] [MainThread]: On master: BEGIN
[0m09:49:23.005045 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:49:23.011992 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.012440 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.012925 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:49:23.018331 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:49:23.019582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dceb96ee0>]}
[0m09:49:23.020130 [debug] [MainThread]: On master: ROLLBACK
[0m09:49:23.020651 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.021043 [debug] [MainThread]: On master: BEGIN
[0m09:49:23.021591 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:49:23.021984 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.022379 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.022744 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.023214 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:23.023612 [debug] [MainThread]: On master: Close
[0m09:49:23.024151 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:49:23.024594 [info ] [MainThread]: 
[0m09:49:23.030914 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:49:23.031653 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:49:23.032265 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:49:23.032714 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:49:23.041546 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:49:23.042257 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:49:23.080777 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:49:23.081525 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:49:23.081958 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:49:23.082347 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:49:23.089782 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.090276 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:49:23.090724 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
    SPLIT_PART(ad_url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:49:23.091716 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_url" does not exist
LINE 24:     INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
                                ^
HINT:  Perhaps you meant to reference the column "raw_ads.url".

[0m09:49:23.092152 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m09:49:23.092728 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:49:23.094774 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_url" does not exist
  LINE 24:     INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
                                  ^
  HINT:  Perhaps you meant to reference the column "raw_ads.url".
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m09:49:23.096388 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dce699b80>]}
[0m09:49:23.097090 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m09:49:23.097883 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:49:23.098419 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:49:23.099397 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:49:23.100290 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:49:23.100729 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:49:23.104220 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:49:23.104760 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:49:23.109441 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:49:23.110069 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.110490 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:49:23.110851 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:49:23.118140 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.118543 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.118932 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:49:23.124768 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:49:23.130989 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.131506 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:49:23.132283 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:49:23.149763 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:49:23.150253 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.150673 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:49:23.151894 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:49:23.158190 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:49:23.162274 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.162734 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:49:23.163398 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:49:23.165700 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:49:23.166347 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dce788220>]}
[0m09:49:23.167035 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.07s]
[0m09:49:23.167827 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:49:23.168335 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:49:23.168892 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m09:49:23.169453 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:49:23.170112 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:49:23.170627 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m09:49:23.171391 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:49:23.172184 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:49:23.172712 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m09:49:23.173264 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:49:23.173748 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:49:23.174295 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m09:49:23.174915 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:49:23.175436 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:49:23.175878 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:49:23.176442 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:49:23.177626 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.178081 [debug] [MainThread]: On master: BEGIN
[0m09:49:23.178433 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:49:23.185555 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.185978 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.186535 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.186946 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.187460 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:23.187851 [debug] [MainThread]: On master: Close
[0m09:49:23.188339 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:49:23.188686 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m09:49:23.189118 [info ] [MainThread]: 
[0m09:49:23.189569 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m09:49:23.191408 [debug] [MainThread]: Command end result
[0m09:49:23.225649 [info ] [MainThread]: 
[0m09:49:23.226198 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:49:23.226606 [info ] [MainThread]: 
[0m09:49:23.227095 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_url" does not exist
  LINE 24:     INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
                                  ^
  HINT:  Perhaps you meant to reference the column "raw_ads.url".
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m09:49:23.227530 [info ] [MainThread]: 
[0m09:49:23.227966 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m09:49:23.228878 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1075735, "process_user_time": 2.380419, "process_kernel_time": 0.659008, "process_mem_max_rss": "135548", "process_out_blocks": "2304", "command_success": false, "process_in_blocks": "0"}
[0m09:49:23.229488 [debug] [MainThread]: Command `dbt run` failed at 09:49:23.229388 after 1.11 seconds
[0m09:49:23.229938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba6790d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8dff400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba367e80>]}
[0m09:49:23.230368 [debug] [MainThread]: Flushing usage events
[0m09:50:24.773488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6342757c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7c70>]}


============================== 09:50:24.779119 | 1123a1d0-3958-4eda-a9d2-36fe18732a7f ==============================
[0m09:50:24.779119 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:50:24.779741 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:50:24.949259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7670>]}
[0m09:50:25.005616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329e96d0>]}
[0m09:50:25.006478 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:50:25.025484 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:50:25.213168 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:50:25.213896 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m09:50:25.540089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647eda760>]}
[0m09:50:25.702745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647d89c40>]}
[0m09:50:25.703415 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:50:25.703880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647ec0e80>]}
[0m09:50:25.705534 [info ] [MainThread]: 
[0m09:50:25.706213 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:50:25.710701 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:50:25.744557 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:50:25.744975 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:50:25.745328 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:50:25.754562 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:50:25.755827 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:50:25.757664 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:50:25.763898 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:50:25.764304 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:50:25.764637 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:50:25.771788 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.772199 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:50:25.772602 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:50:25.777624 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:25.778804 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:50:25.779516 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:50:25.780224 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:50:25.782720 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:50:25.783115 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:50:25.783576 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:50:25.790883 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.791306 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:50:25.791704 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:50:25.796902 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.005 seconds
[0m09:50:25.798448 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:50:25.798971 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:50:25.804660 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.805053 [debug] [MainThread]: On master: BEGIN
[0m09:50:25.805390 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:50:25.812290 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.812669 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.813092 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:50:25.818758 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:25.819885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7160>]}
[0m09:50:25.820389 [debug] [MainThread]: On master: ROLLBACK
[0m09:50:25.820860 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.821204 [debug] [MainThread]: On master: BEGIN
[0m09:50:25.821717 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:50:25.822071 [debug] [MainThread]: On master: COMMIT
[0m09:50:25.822400 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.822708 [debug] [MainThread]: On master: COMMIT
[0m09:50:25.823109 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:50:25.823510 [debug] [MainThread]: On master: Close
[0m09:50:25.824004 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:50:25.824443 [info ] [MainThread]: 
[0m09:50:25.830898 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:50:25.831622 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:50:25.832218 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:50:25.832703 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:50:25.841912 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:50:25.842548 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:50:25.886952 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:50:25.887660 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.888106 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:50:25.888510 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:25.895734 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.896199 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.896670 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:50:25.902264 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:25.908588 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.909057 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:50:25.909788 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:25.926988 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:50:25.927500 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.927916 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:50:25.929174 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:25.935634 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:50:25.939823 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.940294 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:50:25.940919 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:50:25.943284 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:50:25.944898 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff631907a00>]}
[0m09:50:25.945611 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:50:25.946317 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:50:25.946822 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:50:25.947684 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:50:25.948330 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:50:25.948795 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:50:25.952859 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:50:25.953466 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:50:25.957153 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:50:25.957790 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.958255 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:50:25.958686 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:25.965855 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.966344 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.966768 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:50:25.971938 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:50:25.975272 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.975706 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:50:25.976441 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:25.979634 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.980068 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:50:25.980738 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:25.983979 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:50:25.984410 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.984778 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:50:25.985896 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:25.988609 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:50:25.989227 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.989628 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:50:25.992646 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:50:25.993886 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:50:25.994466 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff631c5e880>]}
[0m09:50:25.995106 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:50:25.995903 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:50:25.996574 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:50:25.997383 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:50:25.998113 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:50:25.998714 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:50:26.002351 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.002989 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:50:26.007424 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.008016 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.008420 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:50:26.008775 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.015820 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.016288 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.016702 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:50:26.022393 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:26.025584 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.026018 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:50:26.026710 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:26.028018 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:50:26.028432 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.028805 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:50:26.029922 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:26.032561 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:50:26.033168 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.033572 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:50:26.034136 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:50:26.035389 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:50:26.035967 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647272850>]}
[0m09:50:26.036600 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:50:26.037346 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:50:26.037807 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:50:26.038394 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:50:26.038980 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:50:26.039620 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:50:26.043660 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.044188 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:50:26.047785 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.048336 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.048735 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:50:26.049106 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.056154 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.056590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.057013 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:50:26.062595 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:26.065746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.066182 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:50:26.066867 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:26.068161 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:50:26.068578 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.068947 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:50:26.069962 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:26.073375 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:50:26.073974 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.074378 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:50:26.074919 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:50:26.076168 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:50:26.076740 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6318c18e0>]}
[0m09:50:26.077372 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:50:26.078035 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:50:26.078497 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.079091 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:50:26.079716 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:50:26.080326 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.084692 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.085242 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.088914 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.089503 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.089919 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:50:26.090283 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.097178 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.097595 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.098053 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

WITH latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:50:26.098716 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "WITH"
LINE 16: WITH latest_ads AS (
         ^

[0m09:50:26.099149 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:50:26.099918 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:50:26.101902 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "WITH"
  LINE 16: WITH latest_ads AS (
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:50:26.102384 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff631c49f10>]}
[0m09:50:26.103025 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:50:26.103739 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.104198 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.104931 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:50:26.105548 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:50:26.106164 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.115132 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.115733 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.144024 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.144611 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.145027 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:50:26.145405 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.152486 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.152974 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.153448 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
  
    

  create  table "scraping_db"."public"."src_ads_cleaned_backup_incremental"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE False
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT False           
    OR ad_id IS NULL */
  );
  
  
[0m09:50:26.158750 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:26.160149 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:50:26.160596 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.160980 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:50:26.162085 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:26.162859 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:50:26.163447 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6318c18e0>]}
[0m09:50:26.164083 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mSELECT 0[0m in 0.06s]
[0m09:50:26.164746 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.165225 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:50:26.165746 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:50:26.166248 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:50:26.167405 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:26.167787 [debug] [MainThread]: On master: BEGIN
[0m09:50:26.168118 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:50:26.175152 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.175609 [debug] [MainThread]: On master: COMMIT
[0m09:50:26.176029 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:26.176411 [debug] [MainThread]: On master: COMMIT
[0m09:50:26.176926 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:50:26.177426 [debug] [MainThread]: On master: Close
[0m09:50:26.177969 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:50:26.178375 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:50:26.178865 [info ] [MainThread]: 
[0m09:50:26.179386 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m09:50:26.180914 [debug] [MainThread]: Command end result
[0m09:50:26.219869 [info ] [MainThread]: 
[0m09:50:26.220464 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:50:26.220907 [info ] [MainThread]: 
[0m09:50:26.221422 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "WITH"
  LINE 16: WITH latest_ads AS (
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:50:26.221873 [info ] [MainThread]: 
[0m09:50:26.222338 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:50:26.223321 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4993196, "process_user_time": 2.703178, "process_kernel_time": 0.700823, "process_mem_max_rss": "142920", "process_out_blocks": "3512", "command_success": false, "process_in_blocks": "0"}
[0m09:50:26.223957 [debug] [MainThread]: Command `dbt run` failed at 09:50:26.223850 after 1.50 seconds
[0m09:50:26.224420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6342757c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6318e3dc0>]}
[0m09:50:26.224862 [debug] [MainThread]: Flushing usage events
[0m09:51:04.259400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1effba2fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff5daca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efe325880>]}


============================== 09:51:04.264708 | eb8060bc-4f70-4562-9aed-0bd362496480 ==============================
[0m09:51:04.264708 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:51:04.265321 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:51:04.426764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff9a9520>]}
[0m09:51:04.483281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efdcd3b50>]}
[0m09:51:04.484129 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:51:04.502616 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:51:04.691212 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:51:04.691939 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:51:05.087895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f13880b20>]}
[0m09:51:05.254919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f136c8f70>]}
[0m09:51:05.255557 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:51:05.255997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f138947c0>]}
[0m09:51:05.257612 [info ] [MainThread]: 
[0m09:51:05.258285 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:51:05.262699 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:51:05.295944 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:51:05.296374 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:51:05.296717 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:51:05.306169 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:51:05.307546 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:51:05.309379 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:51:05.315712 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:51:05.316112 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:51:05.316456 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:05.323570 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.323938 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:51:05.324289 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:51:05.329643 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:51:05.330955 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:51:05.331492 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:51:05.332133 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:51:05.335814 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:51:05.336217 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:51:05.336562 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:05.343333 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.343710 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:51:05.344058 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:51:05.349123 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.350235 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:51:05.350733 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:51:05.356335 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.356731 [debug] [MainThread]: On master: BEGIN
[0m09:51:05.357074 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:51:05.364103 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.364510 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.364925 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:51:05.370677 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.371814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efd53c040>]}
[0m09:51:05.372322 [debug] [MainThread]: On master: ROLLBACK
[0m09:51:05.372900 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.373344 [debug] [MainThread]: On master: BEGIN
[0m09:51:05.373918 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:51:05.374350 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.374696 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.375033 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.375455 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:51:05.375797 [debug] [MainThread]: On master: Close
[0m09:51:05.376330 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:51:05.376706 [info ] [MainThread]: 
[0m09:51:05.383385 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:51:05.384000 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:51:05.384600 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:51:05.385031 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:51:05.393531 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:51:05.394129 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:51:05.431819 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:51:05.432454 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.432862 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:51:05.433225 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.440355 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.440789 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.441230 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:51:05.446154 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m09:51:05.452544 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.452979 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:51:05.453710 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.456934 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.457368 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:51:05.458085 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.477703 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:51:05.478142 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.478530 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:51:05.479529 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.485696 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:51:05.489935 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.490378 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:51:05.493178 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:51:05.495483 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:51:05.497095 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efd53f040>]}
[0m09:51:05.497788 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:51:05.498595 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:51:05.499100 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:51:05.499918 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:51:05.500532 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:51:05.500961 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:51:05.504193 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:51:05.504814 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:51:05.508526 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:51:05.509112 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.509531 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:51:05.509906 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.517142 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.517555 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.517943 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:51:05.523216 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:51:05.526530 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.526958 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:51:05.527722 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.530954 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.531410 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:51:05.532098 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.533451 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:51:05.533883 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.534254 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:51:05.535416 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.538914 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:51:05.539556 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.539969 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:51:05.542748 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:51:05.544015 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:51:05.544608 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f141bca90>]}
[0m09:51:05.545237 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:51:05.545972 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:51:05.546477 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.547073 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:51:05.547684 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:51:05.548104 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.551167 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.551797 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.555590 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.556178 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.556598 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:51:05.556958 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.563956 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.564403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.564819 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:51:05.570200 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.573472 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.573904 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:51:05.574680 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.577783 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.578210 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:51:05.578929 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.580379 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:51:05.580792 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.581170 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:51:05.582267 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.584914 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:51:05.585600 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.586016 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:51:05.588972 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:51:05.590239 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:51:05.590812 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f1372a100>]}
[0m09:51:05.591503 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:51:05.592188 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.592640 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:51:05.593218 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:51:05.593777 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:51:05.594396 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:51:05.599592 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.600157 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:51:05.603891 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.604476 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.604880 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:51:05.605249 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.612265 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.612697 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.613117 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:51:05.618737 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.621898 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.622332 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:51:05.623082 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.626288 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.626714 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:51:05.627431 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.628777 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:51:05.629196 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.629592 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:51:05.630743 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.633384 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:51:05.633981 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.634385 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:51:05.637043 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:51:05.638252 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:51:05.638818 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f141b37f0>]}
[0m09:51:05.639485 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:51:05.640232 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:51:05.640697 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.641291 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:51:05.641857 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:51:05.642481 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.646930 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.647528 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.652057 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.652626 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.653032 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:51:05.653388 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.660332 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.660745 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.661151 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:51:05.661771 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE FROM src_ads
         ^

[0m09:51:05.662208 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:51:05.662748 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:51:05.664703 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:51:05.665200 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f141b37f0>]}
[0m09:51:05.665810 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:51:05.666480 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.666950 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.667615 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:51:05.668302 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:51:05.668858 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.725481 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.726203 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.754076 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.754575 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095105748359"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:51:05.755001 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.766126 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:51:05.780855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.781329 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:51:05.781926 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:51:05.782381 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.782769 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095105748359'
        
      order by ordinal_position

  
[0m09:51:05.796101 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m09:51:05.801625 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.802085 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:51:05.805655 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:51:05.814374 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.814822 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:51:05.818357 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:51:05.834704 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.835382 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.835829 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095105748359"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095105748359"
    )
  
[0m09:51:05.837592 [debug] [Thread-1  ]: Postgres adapter: Postgres error: cannot delete from table "src_ads_cleaned_backup_incremental" because it does not have a replica identity and publishes deletes
HINT:  To enable deleting from the table, set REPLICA IDENTITY using ALTER TABLE.

[0m09:51:05.838050 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: ROLLBACK
[0m09:51:05.838692 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:51:05.839788 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned_backup_incremental (models/src/src_ads_cleaned_backup_incremental.sql)
  cannot delete from table "src_ads_cleaned_backup_incremental" because it does not have a replica identity and publishes deletes
  HINT:  To enable deleting from the table, set REPLICA IDENTITY using ALTER TABLE.
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned_backup_incremental.sql
[0m09:51:05.840323 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efd04e850>]}
[0m09:51:05.840970 [error] [Thread-1  ]: 6 of 7 ERROR creating sql incremental model public.src_ads_cleaned_backup_incremental  [[31mERROR[0m in 0.17s]
[0m09:51:05.841732 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.842224 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:51:05.842776 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:51:05.843355 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:51:05.844504 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.844909 [debug] [MainThread]: On master: BEGIN
[0m09:51:05.845258 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:51:05.852678 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.853121 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.853459 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.853788 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.854243 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:51:05.854604 [debug] [MainThread]: On master: Close
[0m09:51:05.855077 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:51:05.855452 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:51:05.855863 [info ] [MainThread]: 
[0m09:51:05.856261 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:51:05.857920 [debug] [MainThread]: Command end result
[0m09:51:05.892181 [info ] [MainThread]: 
[0m09:51:05.892720 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m09:51:05.893129 [info ] [MainThread]: 
[0m09:51:05.893648 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:51:05.894059 [info ] [MainThread]: 
[0m09:51:05.894567 [error] [MainThread]:   Database Error in model src_ads_cleaned_backup_incremental (models/src/src_ads_cleaned_backup_incremental.sql)
  cannot delete from table "src_ads_cleaned_backup_incremental" because it does not have a replica identity and publishes deletes
  HINT:  To enable deleting from the table, set REPLICA IDENTITY using ALTER TABLE.
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned_backup_incremental.sql
[0m09:51:05.894989 [info ] [MainThread]: 
[0m09:51:05.895443 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=1 TOTAL=7
[0m09:51:05.896351 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6867139, "process_user_time": 2.841768, "process_kernel_time": 0.728555, "process_mem_max_rss": "142904", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:51:05.896942 [debug] [MainThread]: Command `dbt run` failed at 09:51:05.896844 after 1.69 seconds
[0m09:51:05.897373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1effba2fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff9a9520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff8ff7f0>]}
[0m09:51:05.897776 [debug] [MainThread]: Flushing usage events
[0m09:53:52.965477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa559eecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa54165910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa54165ac0>]}


============================== 09:53:52.970915 | 83369f66-9368-4b4f-8198-ab889c0075e6 ==============================
[0m09:53:52.970915 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:53:52.971520 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:53:53.130592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa552f16a0>]}
[0m09:53:53.186000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa53ad5610>]}
[0m09:53:53.186803 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:53:53.205596 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:53:53.396261 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:53:53.396730 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:53:53.524026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69ffc730>]}
[0m09:53:53.689760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69f979d0>]}
[0m09:53:53.690402 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:53:53.690853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69feafd0>]}
[0m09:53:53.692535 [info ] [MainThread]: 
[0m09:53:53.693207 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:53:53.697637 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:53:53.732647 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:53:53.733102 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:53:53.733460 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:53:53.742262 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:53:53.743570 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:53:53.745335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:53:53.751625 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:53:53.752021 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:53:53.752362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:53:53.759496 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.759932 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:53:53.760309 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:53:53.765421 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:53.766560 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:53:53.767077 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:53:53.767750 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:53:53.770221 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:53:53.770591 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:53:53.770912 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:53:53.777779 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.778162 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:53:53.778516 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:53:53.783491 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:53:53.784819 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:53:53.785303 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:53:53.791847 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.792249 [debug] [MainThread]: On master: BEGIN
[0m09:53:53.792609 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:53:53.799467 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.799850 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.800306 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:53:53.806276 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m09:53:53.807396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69f97d00>]}
[0m09:53:53.807893 [debug] [MainThread]: On master: ROLLBACK
[0m09:53:53.808366 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.808723 [debug] [MainThread]: On master: BEGIN
[0m09:53:53.809231 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:53:53.809600 [debug] [MainThread]: On master: COMMIT
[0m09:53:53.809960 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.810305 [debug] [MainThread]: On master: COMMIT
[0m09:53:53.810731 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:53:53.811084 [debug] [MainThread]: On master: Close
[0m09:53:53.811625 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:53:53.812051 [info ] [MainThread]: 
[0m09:53:53.818315 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:53:53.818903 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:53:53.819491 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:53:53.819899 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:53:53.828267 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:53:53.828854 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:53:53.866832 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:53:53.867475 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.867903 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:53:53.868294 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:53.875557 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.875964 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.876395 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:53:53.881911 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:53.888329 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.888759 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:53:53.889472 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.892768 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.893193 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:53:53.893864 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.913594 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:53:53.914026 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.914436 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:53:53.915630 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:53.922012 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:53:53.926268 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.926701 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:53:53.929544 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:53:53.931845 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:53:53.933417 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69b006a0>]}
[0m09:53:53.934080 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:53:53.934783 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:53:53.935290 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:53:53.935918 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:53:53.936633 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:53:53.937071 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:53:53.940276 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:53:53.940870 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:53:53.944655 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:53:53.945238 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.945636 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:53:53.945995 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:53.952837 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.953247 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.953629 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:53:53.958594 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:53:53.961901 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.962334 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:53:53.963046 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.966344 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.966769 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:53:53.967451 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.968804 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:53:53.969209 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.969578 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:53:53.970669 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:53.974202 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:53:53.974829 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.975265 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:53:53.978018 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:53:53.979274 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:53:53.979894 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69a733d0>]}
[0m09:53:53.980545 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:53:53.981303 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:53:53.981765 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:53:53.982352 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:53:53.982906 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:53:53.983357 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:53:53.986335 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.986890 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:53:53.990700 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.991308 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.991722 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:53:53.992085 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:53.998879 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.999342 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.999770 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:53:54.005659 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:54.009016 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.009471 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:53:54.010242 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.013469 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.013915 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:53:54.014643 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.016117 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:53:54.016562 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.016957 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:53:54.018283 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:54.021204 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:53:54.021918 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.022367 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:53:54.025312 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:53:54.026619 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:53:54.027254 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69c250a0>]}
[0m09:53:54.027906 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:53:54.028658 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:53:54.029127 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:53:54.029713 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:53:54.030280 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:53:54.030696 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:53:54.035172 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.035786 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:53:54.039522 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.040127 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.040559 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:53:54.040949 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:54.048247 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:54.048692 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.049133 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:53:54.055059 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:54.058307 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.058752 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:53:54.059515 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.062656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.063103 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:53:54.063938 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.065285 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:53:54.065716 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.066117 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:53:54.067159 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:54.069908 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:53:54.070540 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.070964 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:53:54.073718 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:53:54.074957 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:53:54.075614 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa537ca880>]}
[0m09:53:54.076288 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:53:54.077022 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:53:54.077492 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.078078 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:53:54.078649 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:53:54.079072 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.082308 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.082872 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.087501 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.088094 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.088522 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:53:54.088911 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:54.095884 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:54.096319 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.096746 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:53:54.097391 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE FROM src_ads
         ^

[0m09:53:54.097834 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:53:54.098397 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:53:54.100362 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:53:54.100859 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69a0aa60>]}
[0m09:53:54.101499 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:53:54.102192 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.102663 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.103178 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:53:54.103879 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:53:54.104404 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.113817 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.114382 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.142594 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.143146 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095354136993"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:53:54.143607 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:54.153951 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.010 seconds
[0m09:53:54.168022 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.168472 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:53:54.169030 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:53:54.169442 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.169841 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095354136993'
        
      order by ordinal_position

  
[0m09:53:54.182302 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:53:54.187743 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.188217 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:53:54.191783 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:53:54.200446 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.200900 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:53:54.204454 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:53:54.220607 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.221251 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.221714 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095354136993"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095354136993"
    )
  
[0m09:53:54.223048 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:53:54.224372 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:53:54.224817 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.225226 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:53:54.226262 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:54.227054 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:53:54.227701 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69a77d60>]}
[0m09:53:54.228364 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.12s]
[0m09:53:54.229096 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.229598 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:53:54.230060 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:53:54.230708 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:53:54.231884 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:54.232300 [debug] [MainThread]: On master: BEGIN
[0m09:53:54.232635 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:53:54.239981 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:53:54.240444 [debug] [MainThread]: On master: COMMIT
[0m09:53:54.240790 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:54.241112 [debug] [MainThread]: On master: COMMIT
[0m09:53:54.241535 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:53:54.241885 [debug] [MainThread]: On master: Close
[0m09:53:54.242399 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:53:54.242754 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:53:54.243276 [info ] [MainThread]: 
[0m09:53:54.243750 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.55 seconds (0.55s).
[0m09:53:54.245282 [debug] [MainThread]: Command end result
[0m09:53:54.281293 [info ] [MainThread]: 
[0m09:53:54.281884 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:53:54.282299 [info ] [MainThread]: 
[0m09:53:54.282893 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:53:54.283335 [info ] [MainThread]: 
[0m09:53:54.283878 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:53:54.285340 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3681413, "process_user_time": 2.524403, "process_kernel_time": 0.716114, "process_mem_max_rss": "136804", "process_out_blocks": "2432", "command_success": false, "process_in_blocks": "0"}
[0m09:53:54.286295 [debug] [MainThread]: Command `dbt run` failed at 09:53:54.286143 after 1.37 seconds
[0m09:53:54.286948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa559eecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa552f16a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa556eadf0>]}
[0m09:53:54.287456 [debug] [MainThread]: Flushing usage events
[0m09:54:18.765507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19adaf9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ad52bca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ac276880>]}


============================== 09:54:18.771060 | a44132dc-35d5-4a11-a6e6-ece49bcd9ce8 ==============================
[0m09:54:18.771060 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:54:18.771786 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:54:18.932891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ad9bd520>]}
[0m09:54:18.989434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab9b9b50>]}
[0m09:54:18.990336 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:54:19.009376 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:54:19.197932 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:54:19.198707 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:54:19.594353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c167ebb0>]}
[0m09:54:19.756831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c14c5f70>]}
[0m09:54:19.757489 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:54:19.757937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1693970>]}
[0m09:54:19.759631 [info ] [MainThread]: 
[0m09:54:19.760325 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:54:19.764712 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:54:19.797981 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:54:19.798406 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:54:19.798751 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:19.807985 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:54:19.809235 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:54:19.811046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:54:19.817163 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:19.817569 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:54:19.817903 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:19.824924 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.825347 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:19.825697 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:54:19.830453 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:54:19.831610 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:54:19.832103 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:54:19.832707 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:54:19.835132 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:19.835531 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:54:19.835925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:19.843254 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.843666 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:19.844027 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:54:19.849194 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:54:19.850660 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:54:19.851174 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:54:19.857804 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.858279 [debug] [MainThread]: On master: BEGIN
[0m09:54:19.858616 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:54:19.865450 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.865836 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.866263 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:54:19.872132 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:19.873211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1539700>]}
[0m09:54:19.873705 [debug] [MainThread]: On master: ROLLBACK
[0m09:54:19.874174 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.874535 [debug] [MainThread]: On master: BEGIN
[0m09:54:19.875038 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:54:19.875445 [debug] [MainThread]: On master: COMMIT
[0m09:54:19.875770 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.876077 [debug] [MainThread]: On master: COMMIT
[0m09:54:19.876472 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:19.876811 [debug] [MainThread]: On master: Close
[0m09:54:19.877323 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:54:19.877862 [info ] [MainThread]: 
[0m09:54:19.884819 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:54:19.885423 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:54:19.886001 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:54:19.886426 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:54:19.894764 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:54:19.895389 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:54:19.933203 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:54:19.933821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.934263 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:54:19.934634 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:19.941570 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.942031 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.942485 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:54:19.948369 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:19.954746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.955190 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:54:19.956002 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:19.959181 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.959664 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:54:19.960348 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:19.980311 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:19.980755 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.981135 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:19.982274 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:19.988750 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:54:19.993069 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.993515 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:54:19.996302 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:19.998729 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:54:20.000364 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab474100>]}
[0m09:54:20.001039 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:54:20.001766 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:54:20.002259 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:54:20.002886 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:54:20.003748 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:54:20.004205 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:54:20.007402 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:54:20.007999 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:54:20.011789 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:54:20.012379 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.012831 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:54:20.013191 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.020135 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.020566 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.020961 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:54:20.025871 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:54:20.029237 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.029672 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:54:20.030446 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.033719 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.034149 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:54:20.034853 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.036271 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:20.036687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.037054 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:20.038110 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.041654 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:54:20.042275 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.042683 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:54:20.045518 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:20.046772 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:54:20.047392 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c152d0d0>]}
[0m09:54:20.048043 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:54:20.048752 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:54:20.049437 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.050288 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:54:20.051008 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:54:20.051623 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.055048 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.055658 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.059428 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.060029 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.060444 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:54:20.060850 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.067866 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.068339 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.068745 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:54:20.073956 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:20.077434 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.077886 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:54:20.078600 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.081851 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.082290 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:54:20.082959 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.084427 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:20.084855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.085232 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:20.086252 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.088944 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:54:20.089672 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.090113 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:54:20.092727 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:20.094303 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:54:20.094887 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1fbce20>]}
[0m09:54:20.095545 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:20.096307 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.096781 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:54:20.097388 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:54:20.097920 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:54:20.098536 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:54:20.103737 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.104307 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:54:20.108113 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.108690 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.109129 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:54:20.109497 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.116450 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.116886 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.117319 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:54:20.122840 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:20.126071 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.126497 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:54:20.127235 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.130375 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.130798 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:54:20.131564 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.132911 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:20.133324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.133689 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:20.134697 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.137359 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:54:20.137975 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.138420 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:54:20.141140 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:20.142372 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:54:20.142948 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab0e9c10>]}
[0m09:54:20.143605 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:54:20.144324 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:54:20.144793 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.145378 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:54:20.145905 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:54:20.146327 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.149494 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.150076 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.154775 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.155384 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.155802 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:54:20.156165 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.163034 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.163488 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.163885 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE * FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:54:20.164510 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE * FROM src_ads
         ^

[0m09:54:20.164939 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:54:20.165494 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:54:20.167486 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:20.167971 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab0c5280>]}
[0m09:54:20.168594 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:54:20.169302 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.169764 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.170420 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:54:20.171097 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:54:20.171562 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.228990 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.229668 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.257925 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.258425 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095420252237"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:54:20.258841 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.269681 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:54:20.284071 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.284517 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:54:20.285071 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:54:20.285468 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.285848 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095420252237'
        
      order by ordinal_position

  
[0m09:54:20.298105 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:54:20.303620 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.304083 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:20.307598 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:20.316206 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.316660 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:20.320233 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:20.336547 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.337175 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.337635 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095420252237"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095420252237"
    )
  
[0m09:54:20.338955 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:54:20.340277 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:20.340698 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.341080 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:20.342186 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.343051 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:54:20.343687 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1539700>]}
[0m09:54:20.344344 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:54:20.345063 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.345566 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:54:20.346112 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:54:20.346651 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:54:20.347909 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:20.348332 [debug] [MainThread]: On master: BEGIN
[0m09:54:20.348663 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:54:20.355735 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.356152 [debug] [MainThread]: On master: COMMIT
[0m09:54:20.356526 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:20.356874 [debug] [MainThread]: On master: COMMIT
[0m09:54:20.357339 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:20.357717 [debug] [MainThread]: On master: Close
[0m09:54:20.358198 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:54:20.358543 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:54:20.358983 [info ] [MainThread]: 
[0m09:54:20.359453 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:54:20.360886 [debug] [MainThread]: Command end result
[0m09:54:20.396027 [info ] [MainThread]: 
[0m09:54:20.396534 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:54:20.396933 [info ] [MainThread]: 
[0m09:54:20.397438 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:20.397840 [info ] [MainThread]: 
[0m09:54:20.398265 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:54:20.399137 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6831464, "process_user_time": 2.809303, "process_kernel_time": 0.749414, "process_mem_max_rss": "142972", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:54:20.399757 [debug] [MainThread]: Command `dbt run` failed at 09:54:20.399659 after 1.68 seconds
[0m09:54:20.400176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19adaf9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ad9bd520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c14c5f70>]}
[0m09:54:20.400580 [debug] [MainThread]: Flushing usage events
[0m09:54:30.683674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb266a2e7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb265387c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb2651e5970>]}


============================== 09:54:30.689381 | b2f1640f-e4c5-4021-829c-d0d96d9ae4a6 ==============================
[0m09:54:30.689381 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:54:30.690036 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:54:30.850773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb26453cd30>]}
[0m09:54:30.907114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb26457c490>]}
[0m09:54:30.907961 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:54:30.926398 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:54:31.112691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:54:31.113459 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:54:31.511648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a682c40>]}
[0m09:54:31.675475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a4d40d0>]}
[0m09:54:31.676154 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:54:31.676644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a697d30>]}
[0m09:54:31.678321 [info ] [MainThread]: 
[0m09:54:31.679020 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:54:31.683569 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:54:31.716501 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:54:31.716943 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:54:31.717296 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:31.726453 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:54:31.727913 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:54:31.729815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:54:31.736286 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:31.736687 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:54:31.737022 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:31.744171 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.744560 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:31.744909 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:54:31.749724 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:54:31.751015 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:54:31.751525 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:54:31.752119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:54:31.755654 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:31.756043 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:54:31.756377 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:31.763145 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.763543 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:31.763894 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:54:31.768426 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:54:31.769512 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:54:31.770009 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:54:31.775794 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.776214 [debug] [MainThread]: On master: BEGIN
[0m09:54:31.776585 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:54:31.783556 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.783994 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.784486 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:54:31.790209 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:31.791415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263dff2e0>]}
[0m09:54:31.791951 [debug] [MainThread]: On master: ROLLBACK
[0m09:54:31.792451 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.792833 [debug] [MainThread]: On master: BEGIN
[0m09:54:31.793381 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:54:31.793774 [debug] [MainThread]: On master: COMMIT
[0m09:54:31.794149 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.794528 [debug] [MainThread]: On master: COMMIT
[0m09:54:31.794972 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:31.795420 [debug] [MainThread]: On master: Close
[0m09:54:31.795991 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:54:31.796435 [info ] [MainThread]: 
[0m09:54:31.803230 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:54:31.803856 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:54:31.804466 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:54:31.804928 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:54:31.813377 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:54:31.814000 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:54:31.851759 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:54:31.852426 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.852892 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:54:31.853325 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:31.860551 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.861052 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.861562 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:54:31.867335 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:31.873939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.874431 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:54:31.875230 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.878397 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.878872 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:54:31.879584 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.899213 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:31.899701 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.900134 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:31.901297 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:31.907544 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:54:31.911780 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.912211 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:54:31.914860 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:31.917131 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:54:31.918731 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb2641301c0>]}
[0m09:54:31.919427 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:54:31.920147 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:54:31.920650 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:54:31.921312 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:54:31.922071 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:54:31.922545 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:54:31.925971 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:54:31.926577 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:54:31.930300 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:54:31.930919 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.931388 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:54:31.931803 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:31.938834 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.939319 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.939782 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:54:31.944611 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:54:31.947937 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.948439 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:54:31.949173 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.952529 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.953020 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:54:31.953759 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.955162 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:31.955650 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.956075 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:31.957121 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:31.960630 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:54:31.961287 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.961742 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:54:31.964605 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:31.965868 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:54:31.966476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb265c17220>]}
[0m09:54:31.967131 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:54:31.967883 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:54:31.968376 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:54:31.968990 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:54:31.969569 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:54:31.970019 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:54:31.973149 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.973833 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:54:31.977555 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.978150 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.978560 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:54:31.978918 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:31.986001 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.986411 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.986796 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:54:31.991877 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:31.995125 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.995597 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:54:31.996329 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.999411 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.999840 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:54:32.000565 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:32.001989 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:32.002414 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:32.002784 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:32.003817 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:32.006616 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:54:32.007351 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:32.007771 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:54:32.010312 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:32.011637 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:54:32.012234 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263dff2e0>]}
[0m09:54:32.012878 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:32.013610 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:54:32.014112 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:54:32.014735 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:54:32.015348 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:54:32.015803 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:54:32.019763 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.020366 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:54:32.024188 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.024818 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.025278 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:54:32.025700 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:32.032663 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:32.033141 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.033636 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:54:32.039380 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:32.042628 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.043106 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:54:32.043880 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:32.046980 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.047488 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:54:32.048195 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:32.049564 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:32.050037 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.050474 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:32.051602 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:32.054287 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:54:32.054932 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.055429 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:54:32.057979 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:32.059271 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:54:32.059870 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263d56640>]}
[0m09:54:32.060535 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:32.061313 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:54:32.061806 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.062363 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:54:32.063032 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:54:32.063515 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.066688 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.067317 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.072082 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.072689 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.073133 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:54:32.073549 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:32.080405 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:32.080863 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.081321 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE * FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:54:32.081939 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "*"
LINE 40: DELETE * FROM src_ads
                ^

[0m09:54:32.082384 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:54:32.082960 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:54:32.084968 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:32.085485 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263d8d970>]}
[0m09:54:32.086145 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:54:32.086869 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.087370 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.088113 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:54:32.088710 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:54:32.089170 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.143491 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.144212 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.172420 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.172969 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095432166712"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:54:32.173457 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:32.184547 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:54:32.198893 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.199410 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:54:32.199999 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:54:32.200447 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.200887 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095432166712'
        
      order by ordinal_position

  
[0m09:54:32.212965 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:54:32.218521 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.219030 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:32.222716 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:32.231517 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.232023 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:32.235625 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:32.252014 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.252687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.253190 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095432166712"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095432166712"
    )
  
[0m09:54:32.254575 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:54:32.255925 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:32.256403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.256839 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:32.257876 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:32.258692 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:54:32.259355 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a6bdf70>]}
[0m09:54:32.260041 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:54:32.260810 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.261346 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:54:32.261894 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:54:32.262429 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:54:32.263780 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:32.264213 [debug] [MainThread]: On master: BEGIN
[0m09:54:32.264554 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:54:32.271796 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:32.272241 [debug] [MainThread]: On master: COMMIT
[0m09:54:32.272629 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:32.273001 [debug] [MainThread]: On master: COMMIT
[0m09:54:32.273472 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:32.273862 [debug] [MainThread]: On master: Close
[0m09:54:32.274396 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:54:32.274752 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:54:32.275256 [info ] [MainThread]: 
[0m09:54:32.275717 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:54:32.277195 [debug] [MainThread]: Command end result
[0m09:54:32.311853 [info ] [MainThread]: 
[0m09:54:32.312424 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:54:32.313072 [info ] [MainThread]: 
[0m09:54:32.313643 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:32.314127 [info ] [MainThread]: 
[0m09:54:32.314589 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:54:32.315586 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6805463, "process_user_time": 2.888993, "process_kernel_time": 0.67811, "process_mem_max_rss": "142904", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:54:32.316216 [debug] [MainThread]: Command `dbt run` failed at 09:54:32.316111 after 1.68 seconds
[0m09:54:32.316636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27af47340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb26457c490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb264088790>]}
[0m09:54:32.317053 [debug] [MainThread]: Flushing usage events
[0m09:54:39.207399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6605751cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603ec8910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603ec8ac0>]}


============================== 09:54:39.212777 | cacdbde0-0500-4ab4-87cd-7cef13e77152 ==============================
[0m09:54:39.212777 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:54:39.213416 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:54:39.376868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66050556a0>]}
[0m09:54:39.433146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66035b8610>]}
[0m09:54:39.433995 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:54:39.452906 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:54:39.642072 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:54:39.642838 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:54:40.041817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6619282c10>]}
[0m09:54:40.206423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66190d30a0>]}
[0m09:54:40.207051 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:54:40.207524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f661929ad00>]}
[0m09:54:40.209169 [info ] [MainThread]: 
[0m09:54:40.209848 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:54:40.214402 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:54:40.248919 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:54:40.249516 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:54:40.249889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:40.260233 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m09:54:40.261506 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:54:40.263370 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:54:40.269568 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:40.269978 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:54:40.270317 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:40.277161 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.277563 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:40.277977 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:54:40.282732 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:54:40.284061 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:54:40.284556 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:54:40.285203 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:54:40.289183 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:40.289568 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:54:40.289927 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:40.296834 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.297249 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:40.297646 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:54:40.302778 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.303929 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:54:40.304408 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:54:40.309958 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.310360 [debug] [MainThread]: On master: BEGIN
[0m09:54:40.310687 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:54:40.317502 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.317895 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.318361 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:54:40.324364 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m09:54:40.325466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66030be040>]}
[0m09:54:40.325950 [debug] [MainThread]: On master: ROLLBACK
[0m09:54:40.326445 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.326803 [debug] [MainThread]: On master: BEGIN
[0m09:54:40.327368 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:54:40.327754 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.328087 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.328401 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.328834 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:40.329190 [debug] [MainThread]: On master: Close
[0m09:54:40.329742 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:54:40.330404 [info ] [MainThread]: 
[0m09:54:40.337124 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:54:40.337771 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:54:40.338360 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:54:40.338788 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:54:40.347364 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:54:40.347972 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:54:40.385659 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:54:40.386289 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.386699 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:54:40.387065 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.394168 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.394634 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.395094 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:54:40.400747 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.407452 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.407897 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:54:40.408669 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.411986 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.412442 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:54:40.413209 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.432906 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:40.433378 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.433812 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:40.434888 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.441323 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:54:40.445566 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.446035 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:54:40.448890 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.451300 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:54:40.452916 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66030ba190>]}
[0m09:54:40.453637 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:54:40.454349 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:54:40.454845 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:54:40.455533 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:54:40.456252 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:54:40.456674 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:54:40.459844 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:54:40.460459 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:54:40.464235 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:54:40.464844 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.465298 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:54:40.465703 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.472843 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.473291 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.473710 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:54:40.478759 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:54:40.482155 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.482611 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:54:40.483459 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.486779 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.487270 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:54:40.488203 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.489685 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:40.490152 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.490564 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:40.491727 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.495351 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:54:40.496009 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.496452 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:54:40.499338 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.500625 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:54:40.501268 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6619bb58e0>]}
[0m09:54:40.501935 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:54:40.502688 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:54:40.503164 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.503815 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:54:40.504388 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:54:40.504826 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.507953 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.508550 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.512415 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.513038 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.513505 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:54:40.513910 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.521169 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.521645 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.522107 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:54:40.527533 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.530889 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.531382 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:54:40.532151 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.535319 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.535773 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:54:40.536503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.537971 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:40.538424 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.538829 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:40.539864 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.542569 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:54:40.543322 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.543765 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:54:40.546651 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.547978 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:54:40.548586 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6602cd5940>]}
[0m09:54:40.549269 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:40.549987 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.550468 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:54:40.551078 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:54:40.551688 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:54:40.552127 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:54:40.556121 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.556698 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:54:40.560467 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.561085 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.561546 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:54:40.561940 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.569254 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.569718 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.570201 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:54:40.575891 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.579302 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.579761 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:54:40.580499 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.583686 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.584145 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:54:40.584842 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.586216 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:40.586656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.587069 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:40.588144 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.590872 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:54:40.591534 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.591965 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:54:40.594626 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.595911 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:54:40.596527 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603079e20>]}
[0m09:54:40.597193 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:40.597882 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:54:40.598355 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.598870 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:54:40.599523 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:54:40.599933 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.603460 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.604064 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.608639 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.609239 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.609652 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:54:40.610034 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.617059 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.617481 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.617872 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:54:40.618499 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "FROM"
LINE 40: DELETE FROM src_ads
                ^

[0m09:54:40.618898 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:54:40.619462 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:54:40.621406 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:40.621915 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603079e20>]}
[0m09:54:40.622571 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:54:40.623306 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.623774 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.624425 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:54:40.625115 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:54:40.625538 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.682561 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.683271 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.711107 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.711651 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095440705411"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:54:40.712078 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.724300 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.012 seconds
[0m09:54:40.739441 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.739917 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:54:40.740628 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:54:40.741095 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.741516 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095440705411'
        
      order by ordinal_position

  
[0m09:54:40.754277 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:54:40.760021 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.760495 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:40.764170 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:40.773061 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.773531 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:40.777333 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:40.794141 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.794840 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.795355 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095440705411"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095440705411"
    )
  
[0m09:54:40.796810 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:54:40.798161 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:40.798642 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.799033 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:40.800045 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.800861 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:54:40.801507 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6619b97100>]}
[0m09:54:40.802224 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:54:40.803044 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.803784 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:54:40.804493 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:54:40.805065 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:54:40.806380 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.806761 [debug] [MainThread]: On master: BEGIN
[0m09:54:40.807092 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:54:40.814657 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m09:54:40.815101 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.815496 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.815823 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.816244 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:40.816596 [debug] [MainThread]: On master: Close
[0m09:54:40.817069 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:54:40.817420 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:54:40.817851 [info ] [MainThread]: 
[0m09:54:40.818252 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m09:54:40.819777 [debug] [MainThread]: Command end result
[0m09:54:40.854308 [info ] [MainThread]: 
[0m09:54:40.854855 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:54:40.855291 [info ] [MainThread]: 
[0m09:54:40.855769 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:40.856191 [info ] [MainThread]: 
[0m09:54:40.856606 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:54:40.857508 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6998187, "process_user_time": 2.86084, "process_kernel_time": 0.714207, "process_mem_max_rss": "142660", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:54:40.858100 [debug] [MainThread]: Command `dbt run` failed at 09:54:40.858005 after 1.70 seconds
[0m09:54:40.858522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6605751cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66035b8610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66190d3ac0>]}
[0m09:54:40.858920 [debug] [MainThread]: Flushing usage events
[0m09:56:45.375586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4d7f9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4bf76910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4bf76ac0>]}


============================== 09:56:45.381179 | 8eff6e81-532f-4b40-8d8f-26edf2660a75 ==============================
[0m09:56:45.381179 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:56:45.381864 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:56:45.544447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4d1036a0>]}
[0m09:56:45.600510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4b8e6610>]}
[0m09:56:45.601395 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:56:45.620687 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:56:45.815811 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:56:45.816603 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:56:46.215857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb6147db80>]}
[0m09:56:46.379499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb612d10a0>]}
[0m09:56:46.380129 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:56:46.380558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb6149bd00>]}
[0m09:56:46.382215 [info ] [MainThread]: 
[0m09:56:46.382877 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:56:46.387302 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:56:46.421133 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:56:46.421551 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:56:46.421888 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:56:46.430810 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:56:46.432077 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:56:46.433878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:56:46.440102 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:56:46.440506 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:56:46.440867 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:56:46.447932 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.448330 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:56:46.448686 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:56:46.453561 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:56:46.454705 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:56:46.455243 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:56:46.455856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:56:46.458274 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:56:46.458661 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:56:46.458989 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:56:46.465792 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.466193 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:56:46.466834 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:56:46.471732 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:56:46.473003 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:56:46.473475 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:56:46.479908 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.480312 [debug] [MainThread]: On master: BEGIN
[0m09:56:46.480643 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:56:46.487262 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.487649 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.488061 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:56:46.493700 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.494803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61302f70>]}
[0m09:56:46.495364 [debug] [MainThread]: On master: ROLLBACK
[0m09:56:46.495884 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.496272 [debug] [MainThread]: On master: BEGIN
[0m09:56:46.496823 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:56:46.497252 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.497630 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.497998 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.498446 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:56:46.498818 [debug] [MainThread]: On master: Close
[0m09:56:46.499372 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:56:46.499777 [info ] [MainThread]: 
[0m09:56:46.506164 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:56:46.506804 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:56:46.507416 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:56:46.507850 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:56:46.516190 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:56:46.516805 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:56:46.555246 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:56:46.555883 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.556302 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:56:46.556665 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.564207 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.564648 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.565098 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:56:46.570430 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.576832 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.577279 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:56:46.578150 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.581352 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.581787 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:56:46.582461 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.602274 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:56:46.602713 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.603096 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:56:46.604226 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.610493 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:56:46.614837 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.615313 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:56:46.618031 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.620339 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:56:46.621951 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4b1af250>]}
[0m09:56:46.622684 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:56:46.623377 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:56:46.623866 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:56:46.624521 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:56:46.625461 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:56:46.626096 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:56:46.629263 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:56:46.629858 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:56:46.633662 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:56:46.634275 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.634699 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:56:46.635089 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.642151 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.642594 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.643030 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:56:46.648017 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:56:46.651372 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.651817 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:56:46.652611 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.655851 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.656289 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:56:46.657060 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.658416 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:56:46.658832 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.659232 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:56:46.660413 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.663968 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:56:46.664580 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.664996 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:56:46.667850 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.669096 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:56:46.669767 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4bf76190>]}
[0m09:56:46.670775 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:56:46.671747 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:56:46.672300 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.672884 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:56:46.673434 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:56:46.673835 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.676797 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.677354 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.681067 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.681648 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.682062 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:56:46.682425 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.689457 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.689915 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.690410 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:56:46.695510 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.698794 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.699275 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:56:46.700036 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.703134 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.703623 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:56:46.704312 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.705756 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:56:46.706343 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.706790 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:56:46.707982 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.710699 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:56:46.711450 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.711894 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:56:46.714609 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.715922 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:56:46.716520 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61337a90>]}
[0m09:56:46.717200 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:56:46.718042 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.718550 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:56:46.719088 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:56:46.719798 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:56:46.720255 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:56:46.724250 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.724837 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:56:46.728615 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.729232 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.729658 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:56:46.730062 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.736925 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.737388 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.737837 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:56:46.743650 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.746854 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.747312 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:56:46.748073 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.751141 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.751577 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:56:46.752245 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.753560 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:56:46.753973 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.754334 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:56:46.755345 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.758007 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:56:46.758603 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.759001 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:56:46.761581 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.762799 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:56:46.763393 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4ad9a040>]}
[0m09:56:46.764032 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:56:46.764719 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:56:46.765225 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.765819 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:56:46.766363 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:56:46.766782 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.769927 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.770483 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.774979 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.775569 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.776018 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:56:46.776392 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.783140 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.783581 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.783983 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:56:46.784582 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "FROM"
LINE 40: DELETE FROM src_ads
                ^

[0m09:56:46.784985 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:56:46.785511 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:56:46.787460 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:56:46.787945 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61337a90>]}
[0m09:56:46.788577 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:56:46.789290 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.789737 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.790476 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:56:46.791057 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:56:46.791515 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.847010 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.847753 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.875820 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.876631 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095646869948"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:56:46.877124 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.888920 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.012 seconds
[0m09:56:46.903422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.903874 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:56:46.904450 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:56:46.904855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.905246 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095646869948'
        
      order by ordinal_position

  
[0m09:56:46.918673 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m09:56:46.924262 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.924718 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:56:46.928497 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:56:46.937321 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.937775 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:56:46.941491 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:56:46.957984 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.958623 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.959097 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095646869948"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095646869948"
    )
  
[0m09:56:46.960570 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:56:46.961855 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:56:46.962284 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.962655 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:56:46.963664 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.964458 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:56:46.965069 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4adcc370>]}
[0m09:56:46.965723 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:56:46.966477 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.966993 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:56:46.967587 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:56:46.968128 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:56:46.969386 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.969794 [debug] [MainThread]: On master: BEGIN
[0m09:56:46.970155 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:56:46.977679 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.978109 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.978479 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.978830 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.979357 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:56:46.979716 [debug] [MainThread]: On master: Close
[0m09:56:46.980222 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:56:46.980561 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:56:46.981007 [info ] [MainThread]: 
[0m09:56:46.981467 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:56:46.982963 [debug] [MainThread]: Command end result
[0m09:56:47.017195 [info ] [MainThread]: 
[0m09:56:47.017744 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:56:47.018165 [info ] [MainThread]: 
[0m09:56:47.018721 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:56:47.019149 [info ] [MainThread]: 
[0m09:56:47.019673 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:56:47.020843 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6971246, "process_user_time": 2.840771, "process_kernel_time": 0.721149, "process_mem_max_rss": "142956", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:56:47.021472 [debug] [MainThread]: Command `dbt run` failed at 09:56:47.021367 after 1.70 seconds
[0m09:56:47.021908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4d7f9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4b8e6610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61db8550>]}
[0m09:56:47.022343 [debug] [MainThread]: Flushing usage events
[0m09:57:01.443600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28cb19c7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c9af5c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c9953970>]}


============================== 09:57:01.448732 | d12946ad-0073-482a-b1c8-479784a7f052 ==============================
[0m09:57:01.448732 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:57:01.449324 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:57:01.607402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8fbcd30>]}
[0m09:57:01.662682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8ffc490>]}
[0m09:57:01.663519 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:57:01.682660 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:57:01.870410 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:57:01.871256 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:57:02.264004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28dee80bb0>]}
[0m09:57:02.425698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28decd20d0>]}
[0m09:57:02.426347 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:57:02.426832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28dee99d30>]}
[0m09:57:02.428625 [info ] [MainThread]: 
[0m09:57:02.429369 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:57:02.435173 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:57:02.469884 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:57:02.470311 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:57:02.470654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:02.479935 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:57:02.481181 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:57:02.483464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:57:02.490096 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:02.490506 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:57:02.490846 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:02.498025 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.498433 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:02.498801 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:57:02.503816 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:57:02.505141 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:57:02.505635 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:57:02.506247 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:57:02.509789 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:02.510332 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:57:02.510679 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:02.517579 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.517980 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:02.518336 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:57:02.523162 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:57:02.524284 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:57:02.524750 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:57:02.530261 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.530660 [debug] [MainThread]: On master: BEGIN
[0m09:57:02.531027 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:57:02.537908 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.538326 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.538786 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:57:02.544577 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.545721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c87be2e0>]}
[0m09:57:02.546233 [debug] [MainThread]: On master: ROLLBACK
[0m09:57:02.546707 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.547066 [debug] [MainThread]: On master: BEGIN
[0m09:57:02.547613 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:57:02.547965 [debug] [MainThread]: On master: COMMIT
[0m09:57:02.548316 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.548647 [debug] [MainThread]: On master: COMMIT
[0m09:57:02.549062 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:02.549440 [debug] [MainThread]: On master: Close
[0m09:57:02.549963 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:57:02.550390 [info ] [MainThread]: 
[0m09:57:02.557070 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:57:02.557723 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:57:02.558285 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:57:02.558704 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:57:02.567092 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:57:02.567717 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:57:02.605580 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:57:02.606207 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.606634 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:57:02.607014 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.614096 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.614513 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.614950 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:57:02.620339 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.626677 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.627134 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:57:02.627924 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.631057 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.631520 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:57:02.632253 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.651916 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:02.652358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.652738 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:02.653828 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.660064 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:57:02.664316 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.664747 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:57:02.667621 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.669867 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:57:02.671449 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8ad01c0>]}
[0m09:57:02.672118 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:57:02.672814 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:57:02.673293 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:57:02.673910 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:57:02.674643 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:57:02.675063 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:57:02.678174 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:57:02.678733 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:57:02.682391 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:57:02.682972 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.683399 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:57:02.683761 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.690667 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.691092 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.691500 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:57:02.696298 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:57:02.699598 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.700037 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:57:02.700763 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.704011 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.704438 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:57:02.705119 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.706494 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:02.706912 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.707299 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:02.708443 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.712008 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:57:02.712640 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.713041 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:57:02.715769 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.717049 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:57:02.717634 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ca385220>]}
[0m09:57:02.718279 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:57:02.718981 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:57:02.719517 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.720146 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:57:02.720711 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:57:02.721136 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.724132 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.724710 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.728475 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.729083 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.729513 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:57:02.729917 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.736863 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.737310 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.737734 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:57:02.742917 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.746335 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.746799 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:57:02.747609 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.750749 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.751215 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:57:02.751949 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.753412 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:02.753851 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.754262 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:02.755216 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.757861 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:57:02.758589 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.759029 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:57:02.761664 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.762932 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:57:02.763563 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c87be2e0>]}
[0m09:57:02.764213 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:02.764927 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.765414 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:57:02.765993 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:57:02.766548 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:57:02.766948 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:57:02.770818 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.771432 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:57:02.775155 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.775784 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.776203 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:57:02.776568 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.784279 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m09:57:02.784710 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.785148 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:57:02.790831 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.794073 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.794501 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:57:02.795283 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.798403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.798824 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:57:02.799526 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.800867 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:02.801290 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.801654 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:02.802740 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.805422 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:57:02.806038 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.806441 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:57:02.809124 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.810362 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:57:02.810938 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8715670>]}
[0m09:57:02.811592 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:02.812290 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:57:02.812751 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.813329 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:57:02.813890 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:57:02.814317 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.817496 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.818061 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.822618 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.823226 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.823645 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:57:02.824008 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.831011 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.831443 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.831840 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:57:02.832558 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "*"
LINE 40: DELETE * FROM src_ads
                ^

[0m09:57:02.832966 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:57:02.833517 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:57:02.835475 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:02.835975 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8745dc0>]}
[0m09:57:02.836598 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:57:02.837325 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.837785 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:02.838526 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:57:02.839087 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:57:02.839539 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:02.894899 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.895623 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:02.923464 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.923977 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095702917797"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:57:02.924397 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.935142 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:57:02.949308 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.949761 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:57:02.950359 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:57:02.950767 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.951167 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095702917797'
        
      order by ordinal_position

  
[0m09:57:02.963483 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:57:02.968870 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.969333 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:02.972968 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:02.981519 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.981986 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:02.985550 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:03.001871 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:03.002519 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:03.002976 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095702917797"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095702917797"
    )
  
[0m09:57:03.004426 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:57:03.005700 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:03.006184 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:03.006571 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:03.007612 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:03.008490 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:57:03.009138 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8752fd0>]}
[0m09:57:03.009845 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:57:03.010551 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:03.011086 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:57:03.011672 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:57:03.012198 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:57:03.013382 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:03.013750 [debug] [MainThread]: On master: BEGIN
[0m09:57:03.014073 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:57:03.021197 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:03.021624 [debug] [MainThread]: On master: COMMIT
[0m09:57:03.021981 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:03.022326 [debug] [MainThread]: On master: COMMIT
[0m09:57:03.022744 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:03.023127 [debug] [MainThread]: On master: Close
[0m09:57:03.023645 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:57:03.023987 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:57:03.024408 [info ] [MainThread]: 
[0m09:57:03.024834 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:57:03.026297 [debug] [MainThread]: Command end result
[0m09:57:03.060693 [info ] [MainThread]: 
[0m09:57:03.061238 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:57:03.061670 [info ] [MainThread]: 
[0m09:57:03.062152 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:03.062574 [info ] [MainThread]: 
[0m09:57:03.062999 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:57:03.063911 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.668959, "process_user_time": 2.815342, "process_kernel_time": 0.722804, "process_mem_max_rss": "142860", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:57:03.064521 [debug] [MainThread]: Command `dbt run` failed at 09:57:03.064424 after 1.67 seconds
[0m09:57:03.064943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28df74b340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8ffc490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8715130>]}
[0m09:57:03.065339 [debug] [MainThread]: Flushing usage events
[0m09:57:13.680397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ecb237c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96eb47cc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96eb2d9970>]}


============================== 09:57:13.686315 | 8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d ==============================
[0m09:57:13.686315 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:57:13.687242 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:57:13.850073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea93cd30>]}
[0m09:57:13.906282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea96d490>]}
[0m09:57:13.907190 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:57:13.927097 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:57:14.117413 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:57:14.118199 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:57:14.516334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9700681bb0>]}
[0m09:57:14.677360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97004d10d0>]}
[0m09:57:14.677980 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:57:14.678394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9700696d30>]}
[0m09:57:14.680041 [info ] [MainThread]: 
[0m09:57:14.680706 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:57:14.685148 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:57:14.719039 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:57:14.719526 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:57:14.719919 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:14.729326 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:57:14.730645 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:57:14.732565 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:57:14.738958 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:14.739395 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:57:14.739734 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:14.746982 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.747492 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:14.747860 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:57:14.752898 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:57:14.754208 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:57:14.754695 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:57:14.755353 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:57:14.758978 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:14.759384 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:57:14.759719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:14.766570 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.767001 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:14.767417 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:57:14.772370 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:14.773513 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:57:14.774000 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:57:14.779916 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.780336 [debug] [MainThread]: On master: BEGIN
[0m09:57:14.780714 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:57:14.788176 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.788577 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.789029 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:57:14.795008 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m09:57:14.796237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea13e2e0>]}
[0m09:57:14.796765 [debug] [MainThread]: On master: ROLLBACK
[0m09:57:14.797268 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.797624 [debug] [MainThread]: On master: BEGIN
[0m09:57:14.798152 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:57:14.798535 [debug] [MainThread]: On master: COMMIT
[0m09:57:14.798863 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.799178 [debug] [MainThread]: On master: COMMIT
[0m09:57:14.799633 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:14.799980 [debug] [MainThread]: On master: Close
[0m09:57:14.800475 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:57:14.800952 [info ] [MainThread]: 
[0m09:57:14.809021 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:57:14.809919 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:57:14.810674 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:57:14.811349 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:57:14.820052 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:57:14.820673 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:57:14.858781 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:57:14.859504 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.859942 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:57:14.860330 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:14.867629 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.868060 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.868500 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:57:14.874550 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m09:57:14.881194 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.881639 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:57:14.882404 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.885687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.886126 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:57:14.886845 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.906792 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:14.907291 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.907694 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:14.909429 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:14.915797 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:57:14.920088 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.920527 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:57:14.923526 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:57:14.925838 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:57:14.927490 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea4741c0>]}
[0m09:57:14.928191 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.12s]
[0m09:57:14.928907 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:57:14.929395 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:57:14.929919 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:57:14.930610 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:57:14.931232 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:57:14.934537 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:57:14.935155 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:57:14.938935 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:57:14.939590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.940053 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:57:14.940476 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:14.947660 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.948133 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.948637 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:57:14.955091 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m09:57:14.958799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.959308 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:57:14.960127 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.963539 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.964019 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:57:14.964800 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.966246 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:14.966727 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.967165 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:14.968441 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:14.972277 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:57:14.972963 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.973436 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:57:14.976188 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:14.977538 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:57:14.978213 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ebd0c220>]}
[0m09:57:14.978919 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:57:14.979709 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:57:14.980236 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:57:14.980873 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:57:14.981483 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:57:14.981954 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:57:14.985132 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.985765 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:57:14.989683 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.990358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.990842 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:57:14.991303 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:14.998612 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.999074 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.999506 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:57:15.004959 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:15.008429 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.008867 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:57:15.009632 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.012853 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.013288 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:57:15.013996 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.015505 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:15.015932 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.016318 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:15.017401 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:15.020180 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:57:15.020892 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.021326 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:57:15.024438 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:57:15.025728 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:57:15.026362 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea13e2e0>]}
[0m09:57:15.027030 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:15.027709 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:57:15.028251 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:57:15.028898 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:57:15.029480 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:57:15.029920 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:57:15.034287 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.034932 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:57:15.038785 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.039426 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.039860 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:57:15.040271 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:15.047753 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:15.048211 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.048663 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:57:15.054724 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m09:57:15.058250 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.058710 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:57:15.059512 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.062799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.063289 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:57:15.064028 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.065433 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:15.065866 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.066272 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:15.067343 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:15.070115 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:57:15.070762 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.071221 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:57:15.073979 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:15.075335 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:57:15.075981 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea095670>]}
[0m09:57:15.076664 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:57:15.077388 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:57:15.077903 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.078445 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:57:15.079017 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:57:15.079554 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.084014 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.084648 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.089367 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.089980 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.090390 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:57:15.090760 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:15.098191 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:15.098621 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.099021 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:57:15.099747 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "FROM"
LINE 40: DELETE FROM src_ads
                ^

[0m09:57:15.100168 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:57:15.100728 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:57:15.102777 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:15.103332 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ebd0c220>]}
[0m09:57:15.104001 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:57:15.104761 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.105257 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.105932 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:57:15.106629 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:57:15.107305 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.164840 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.165648 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.194562 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.195120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095715188415"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:57:15.195637 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:15.207797 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.012 seconds
[0m09:57:15.222642 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.223131 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:57:15.223825 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:57:15.224308 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.224727 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095715188415'
        
      order by ordinal_position

  
[0m09:57:15.236831 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:57:15.242907 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.243446 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:15.247337 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:15.256887 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.257438 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:15.261729 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m09:57:15.278549 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.279343 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.279846 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095715188415"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095715188415"
    )
  
[0m09:57:15.281466 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:57:15.282838 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:15.283304 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.283695 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:15.284876 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:15.285737 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:57:15.286361 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea1f9f10>]}
[0m09:57:15.287038 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:57:15.287814 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.288348 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:57:15.288836 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:57:15.289378 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:57:15.290968 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:15.291426 [debug] [MainThread]: On master: BEGIN
[0m09:57:15.291773 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:57:15.299063 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:15.299487 [debug] [MainThread]: On master: COMMIT
[0m09:57:15.299849 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:15.300209 [debug] [MainThread]: On master: COMMIT
[0m09:57:15.300695 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:15.301063 [debug] [MainThread]: On master: Close
[0m09:57:15.301557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:57:15.301894 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:57:15.302353 [info ] [MainThread]: 
[0m09:57:15.302750 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m09:57:15.304252 [debug] [MainThread]: Command end result
[0m09:57:15.338778 [info ] [MainThread]: 
[0m09:57:15.339326 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:57:15.339746 [info ] [MainThread]: 
[0m09:57:15.340274 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:15.340702 [info ] [MainThread]: 
[0m09:57:15.341118 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:57:15.342064 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.714028, "process_user_time": 2.893061, "process_kernel_time": 0.676506, "process_mem_max_rss": "145032", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:57:15.342687 [debug] [MainThread]: Command `dbt run` failed at 09:57:15.342583 after 1.71 seconds
[0m09:57:15.343129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96eb2e9880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea93cd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea4a4bb0>]}
[0m09:57:15.343600 [debug] [MainThread]: Flushing usage events
[0m09:57:52.794326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7d23c700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7b9b7970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7b9b7520>]}


============================== 09:57:52.799577 | e7860276-64e4-4ede-a055-2cc700ae1fd7 ==============================
[0m09:57:52.799577 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:57:52.800175 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:57:52.961965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7adf8bb0>]}
[0m09:57:53.017245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7b9ba460>]}
[0m09:57:53.018120 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:57:53.036819 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:57:53.223056 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:57:53.223858 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:57:53.621230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd90e80cd0>]}
[0m09:57:53.786734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd90cd1160>]}
[0m09:57:53.787395 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:57:53.787852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd90e8f3d0>]}
[0m09:57:53.789471 [info ] [MainThread]: 
[0m09:57:53.790136 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:57:53.794650 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:57:53.827841 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:57:53.828253 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:57:53.828589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:53.844540 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.016 seconds
[0m09:57:53.845800 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:57:53.847558 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:57:53.853741 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:53.854141 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:57:53.854469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:53.861410 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.861832 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:53.862206 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:57:53.867029 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:57:53.868385 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:57:53.868884 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:57:53.869497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:57:53.873211 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:53.873619 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:57:53.873958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:53.880818 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.881238 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:53.881591 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:57:53.886212 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:57:53.887324 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:57:53.887806 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:57:53.893297 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.893712 [debug] [MainThread]: On master: BEGIN
[0m09:57:53.894091 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:57:53.900920 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.901344 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.901814 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:57:53.907439 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:53.908564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a87e1c0>]}
[0m09:57:53.909091 [debug] [MainThread]: On master: ROLLBACK
[0m09:57:53.909644 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.910033 [debug] [MainThread]: On master: BEGIN
[0m09:57:53.910613 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:57:53.911007 [debug] [MainThread]: On master: COMMIT
[0m09:57:53.911411 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.911780 [debug] [MainThread]: On master: COMMIT
[0m09:57:53.912250 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:53.912621 [debug] [MainThread]: On master: Close
[0m09:57:53.913149 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:57:53.913557 [info ] [MainThread]: 
[0m09:57:53.920988 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:57:53.921605 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:57:53.922179 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:57:53.922606 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:57:53.931086 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:57:53.931724 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:57:53.969588 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:57:53.970228 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.970644 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:57:53.971014 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:53.978050 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.978496 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.978997 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:57:53.984612 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:53.991026 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.991529 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:57:53.992306 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:53.995503 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.995939 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:57:53.996633 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.016890 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:54.017352 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:54.017737 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:54.018861 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.025417 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:57:54.029662 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:54.030120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:57:54.033497 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:57:54.036013 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:57:54.037633 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a87c5b0>]}
[0m09:57:54.038327 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:57:54.039004 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:57:54.039513 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:57:54.040169 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:57:54.040901 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:57:54.041331 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:57:54.044529 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:57:54.045112 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:57:54.048765 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:57:54.049357 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.049755 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:57:54.050137 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.057276 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.057714 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.058124 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:57:54.063112 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:57:54.066461 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.066898 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:57:54.067655 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.070886 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.071351 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:57:54.072043 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.073425 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:54.073848 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.074226 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:54.075320 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.078821 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:57:54.079462 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.079867 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:57:54.082503 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:54.083775 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:57:54.084359 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9178d280>]}
[0m09:57:54.084995 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:57:54.085647 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:57:54.086115 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.086688 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:57:54.087225 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:57:54.087634 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.090545 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.091113 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.094819 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.095443 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.095856 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:57:54.096225 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.103058 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.103527 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.103929 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:57:54.109061 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:54.112410 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.112845 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:57:54.113580 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.116734 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.117171 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:57:54.117859 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.119318 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:54.119746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.120123 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:54.121049 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.123720 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:57:54.124402 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.124822 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:57:54.127484 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:54.128710 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:57:54.129301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a595730>]}
[0m09:57:54.129944 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:54.130753 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.131342 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:57:54.131941 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:57:54.132495 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:57:54.132921 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:57:54.136799 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.137388 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:57:54.141087 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.141668 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.142087 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:57:54.142453 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.149392 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.149834 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.150259 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:57:54.155781 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:54.158962 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.159435 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:57:54.160160 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.163277 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.163695 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:57:54.164468 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.165810 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:54.166221 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.166582 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:54.167531 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.170181 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:57:54.170782 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.171190 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:57:54.173794 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:54.175043 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:57:54.175648 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a87e3d0>]}
[0m09:57:54.176283 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:54.176942 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:57:54.177421 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.178011 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:57:54.178535 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:57:54.178941 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.182180 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.182733 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.187271 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.187850 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.188285 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:57:54.188649 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.195488 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.195900 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.196298 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:57:54.196873 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE FROM src_ads
         ^

[0m09:57:54.197275 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:57:54.197808 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:57:54.199779 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:54.200272 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a48e9a0>]}
[0m09:57:54.200901 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:57:54.201589 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.202048 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.202764 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:57:54.203409 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:57:54.203825 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.268129 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.268903 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.297258 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.297811 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095754291504"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:57:54.298244 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.309094 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:57:54.323687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.324167 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:57:54.324756 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:57:54.325180 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.325563 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095754291504'
        
      order by ordinal_position

  
[0m09:57:54.338056 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:57:54.343728 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.344190 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:54.347866 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:54.356770 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.357230 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:54.360793 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:54.377415 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.378134 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.378865 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095754291504"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095754291504"
    )
  
[0m09:57:54.380302 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:57:54.381709 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:54.382230 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.382623 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:54.383769 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.384601 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:57:54.385209 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a48e9a0>]}
[0m09:57:54.385876 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:57:54.386587 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.387085 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:57:54.387710 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:57:54.388278 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:57:54.389520 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:54.389940 [debug] [MainThread]: On master: BEGIN
[0m09:57:54.390370 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:57:54.397800 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.398199 [debug] [MainThread]: On master: COMMIT
[0m09:57:54.398541 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:54.398855 [debug] [MainThread]: On master: COMMIT
[0m09:57:54.399294 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:54.399661 [debug] [MainThread]: On master: Close
[0m09:57:54.400127 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:57:54.400461 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:57:54.400873 [info ] [MainThread]: 
[0m09:57:54.401395 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m09:57:54.403079 [debug] [MainThread]: Command end result
[0m09:57:54.442388 [info ] [MainThread]: 
[0m09:57:54.442952 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:57:54.443381 [info ] [MainThread]: 
[0m09:57:54.443879 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:54.444269 [info ] [MainThread]: 
[0m09:57:54.444682 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:57:54.445574 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7011199, "process_user_time": 2.898506, "process_kernel_time": 0.703637, "process_mem_max_rss": "144852", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:57:54.446206 [debug] [MainThread]: Command `dbt run` failed at 09:57:54.446102 after 1.70 seconds
[0m09:57:54.446664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7d23c700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd91745370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a5ddc40>]}
[0m09:57:54.447114 [debug] [MainThread]: Flushing usage events
[0m09:58:58.256891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcf6115b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcdf895e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabce29c9a0>]}


============================== 09:58:58.262895 | 3e302050-cf2a-477a-acba-622ec6aa95cb ==============================
[0m09:58:58.262895 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:58:58.263588 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:58:58.424703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcd736e20>]}
[0m09:58:58.480822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcd6f82b0>]}
[0m09:58:58.481621 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:58:58.500985 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:58:58.692666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:58:58.693397 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:58:59.096638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3282be0>]}
[0m09:58:59.259754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe30c8fa0>]}
[0m09:58:59.260408 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:58:59.260918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3297c40>]}
[0m09:58:59.262571 [info ] [MainThread]: 
[0m09:58:59.263280 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:58:59.267662 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:58:59.300518 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:58:59.300928 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:58:59.301273 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:58:59.317384 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.016 seconds
[0m09:58:59.318636 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:58:59.320437 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:58:59.326635 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:58:59.327041 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:58:59.327398 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:58:59.334489 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.334868 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:58:59.335246 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:58:59.340064 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:58:59.341347 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:58:59.341825 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:58:59.342422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:58:59.345990 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:58:59.346381 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:58:59.346706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:58:59.353412 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.353801 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:58:59.354181 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:58:59.358816 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:58:59.359916 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:58:59.360405 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:58:59.365969 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.366381 [debug] [MainThread]: On master: BEGIN
[0m09:58:59.366718 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:58:59.373488 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.373900 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.374326 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:58:59.379979 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.381062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabccf7f040>]}
[0m09:58:59.381558 [debug] [MainThread]: On master: ROLLBACK
[0m09:58:59.382037 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.382399 [debug] [MainThread]: On master: BEGIN
[0m09:58:59.382916 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:58:59.383333 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.383680 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.384002 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.384408 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:58:59.384747 [debug] [MainThread]: On master: Close
[0m09:58:59.385241 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:58:59.385693 [info ] [MainThread]: 
[0m09:58:59.392405 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:58:59.393095 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:58:59.393652 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:58:59.394090 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:58:59.402726 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:58:59.403348 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:58:59.440988 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:58:59.441613 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.442030 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:58:59.442398 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.449395 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.449826 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.450291 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:58:59.456135 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.462574 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.463021 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:58:59.463805 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.466939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.467401 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:58:59.468113 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.487796 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:58:59.488235 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.488706 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:58:59.489980 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.496285 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:58:59.500484 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.500920 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:58:59.503909 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:58:59.506212 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:58:59.507844 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabccf50190>]}
[0m09:58:59.508536 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:58:59.509238 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:58:59.509738 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:58:59.510542 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:58:59.511116 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:58:59.511555 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:58:59.514760 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:58:59.515369 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:58:59.519068 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:58:59.519692 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.520105 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:58:59.520464 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.527858 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.528281 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.528669 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:58:59.533522 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:58:59.536814 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.537255 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:58:59.537994 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.541230 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.541689 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:58:59.542419 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.543815 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:58:59.544275 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.544654 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:58:59.545817 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.549383 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:58:59.550017 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.550428 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:58:59.553275 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:58:59.554516 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:58:59.555109 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3bbdb20>]}
[0m09:58:59.555768 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:58:59.556434 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:58:59.556913 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.557529 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:58:59.558074 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:58:59.558486 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.561474 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.562050 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.565932 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.566533 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.566941 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:58:59.567331 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.574270 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.574700 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.575115 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:58:59.580471 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.583760 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.584201 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:58:59.584943 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.588055 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.588486 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:58:59.589232 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.590685 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:58:59.591112 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.591506 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:58:59.592630 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.595642 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:58:59.596343 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.596765 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:58:59.599957 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:58:59.601227 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:58:59.601819 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcd3fc220>]}
[0m09:58:59.602467 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:58:59.603223 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.603727 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:58:59.604341 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:58:59.604882 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:58:59.605295 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:58:59.609556 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.610155 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:58:59.613878 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.614475 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.614884 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:58:59.615269 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.622361 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.622802 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.623253 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:58:59.629059 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.632252 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.632686 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:58:59.633446 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.636563 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.636994 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:58:59.637710 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.639063 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:58:59.639495 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.639854 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:58:59.640817 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.643520 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:58:59.644143 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.644546 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:58:59.647144 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:58:59.648388 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:58:59.648956 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3bbda30>]}
[0m09:58:59.649614 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:58:59.650345 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:58:59.650825 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.651452 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:58:59.652029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:58:59.652455 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.655733 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.656300 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.661151 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.661727 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.662142 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:58:59.662500 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.669445 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.669878 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.670285 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:58:59.670963 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "SELECT"
LINE 40: SELECT * FROM src_ads
         ^

[0m09:58:59.671393 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:58:59.671993 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:58:59.673970 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "SELECT"
  LINE 40: SELECT * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:58:59.674498 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3bbda30>]}
[0m09:58:59.675139 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:58:59.675830 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.676314 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.677073 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:58:59.677632 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:58:59.678064 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.734819 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.735533 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.764015 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.764514 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095859758254"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:58:59.764942 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.776013 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:58:59.790219 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.790675 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:58:59.791293 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:58:59.791714 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.792140 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095859758254'
        
      order by ordinal_position

  
[0m09:58:59.804566 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:58:59.810104 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.810559 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:58:59.814256 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:58:59.823058 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.823560 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:58:59.827290 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:58:59.844025 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.844683 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.845144 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095859758254"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095859758254"
    )
  
[0m09:58:59.846530 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:58:59.847872 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:58:59.848326 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.848715 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:58:59.849804 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.850631 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:58:59.851261 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe30d4460>]}
[0m09:58:59.851920 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:58:59.852602 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.853108 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:58:59.853650 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:58:59.854204 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:58:59.855669 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.856098 [debug] [MainThread]: On master: BEGIN
[0m09:58:59.856452 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:58:59.863733 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.864148 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.864534 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.864899 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.865372 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:58:59.865738 [debug] [MainThread]: On master: Close
[0m09:58:59.866190 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:58:59.866547 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:58:59.866965 [info ] [MainThread]: 
[0m09:58:59.867431 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:58:59.868902 [debug] [MainThread]: Command end result
[0m09:58:59.907230 [info ] [MainThread]: 
[0m09:58:59.907996 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:58:59.908495 [info ] [MainThread]: 
[0m09:58:59.909222 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "SELECT"
  LINE 40: SELECT * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:58:59.909892 [info ] [MainThread]: 
[0m09:58:59.910562 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:58:59.911712 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7043417, "process_user_time": 2.838913, "process_kernel_time": 0.747501, "process_mem_max_rss": "142796", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:58:59.912357 [debug] [MainThread]: Command `dbt run` failed at 09:58:59.912229 after 1.71 seconds
[0m09:58:59.912926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcf6115b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcf362820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabccbec790>]}
[0m09:58:59.913365 [debug] [MainThread]: Flushing usage events
[0m09:59:07.836296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815f964610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815e0d92e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815e0d94f0>]}


============================== 09:59:07.841552 | 72a67bd6-bf35-41d8-af56-15a083b2c98b ==============================
[0m09:59:07.841552 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:59:07.842174 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:59:08.003136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d7a0250>]}
[0m09:59:08.059681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d7bc4f0>]}
[0m09:59:08.060589 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:59:08.080002 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:59:08.268483 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:59:08.269259 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:59:08.664730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8173482ca0>]}
[0m09:59:08.827697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f81732d3130>]}
[0m09:59:08.828318 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:59:08.828788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d3ae520>]}
[0m09:59:08.830448 [info ] [MainThread]: 
[0m09:59:08.831118 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:59:08.835632 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:59:08.869056 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:59:08.869491 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:59:08.869839 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:08.879066 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:59:08.880417 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:59:08.882193 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:59:08.888501 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:08.888937 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:59:08.889338 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:08.898022 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m09:59:08.898456 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:08.898882 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:59:08.903921 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:59:08.905287 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:59:08.905788 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:59:08.906434 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:59:08.909998 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:08.910423 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:59:08.910814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:08.917866 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:59:08.918295 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:08.918721 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:59:08.923612 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:59:08.924805 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:59:08.925310 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:59:08.931155 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.931614 [debug] [MainThread]: On master: BEGIN
[0m09:59:08.931959 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:59:08.938905 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:08.939350 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.939765 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:59:08.945572 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:08.946685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf7e190>]}
[0m09:59:08.947229 [debug] [MainThread]: On master: ROLLBACK
[0m09:59:08.947895 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.948268 [debug] [MainThread]: On master: BEGIN
[0m09:59:08.948819 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:59:08.949229 [debug] [MainThread]: On master: COMMIT
[0m09:59:08.949583 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.949932 [debug] [MainThread]: On master: COMMIT
[0m09:59:08.950359 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:08.950716 [debug] [MainThread]: On master: Close
[0m09:59:08.951257 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:59:08.951717 [info ] [MainThread]: 
[0m09:59:08.958235 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:59:08.958860 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:59:08.959509 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:59:08.959947 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:59:08.968578 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:59:08.969182 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:59:09.007186 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:59:09.007837 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.008272 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:59:09.008650 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.015933 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.016387 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.016828 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:59:09.022983 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m09:59:09.029414 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.029875 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:59:09.030642 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.033815 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.034249 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:59:09.035010 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.054860 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:09.055317 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.055700 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:09.056923 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.063152 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:59:09.067454 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.067893 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:59:09.070722 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:09.073059 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:59:09.074690 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf7f0a0>]}
[0m09:59:09.075390 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:59:09.076146 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:59:09.076695 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:59:09.077712 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:59:09.078495 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:59:09.079014 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:59:09.082192 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:59:09.082775 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:59:09.086449 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:59:09.087034 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.087473 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:59:09.087844 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.095165 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.095658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.096071 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:59:09.101102 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:59:09.104499 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.104933 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:59:09.105811 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.109056 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.109500 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:59:09.110228 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.111674 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:09.112094 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.112477 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:09.113621 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.117380 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:59:09.118027 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.118444 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:59:09.121389 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:59:09.122702 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:59:09.123356 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf7e3a0>]}
[0m09:59:09.124021 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:59:09.124716 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:59:09.125252 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.125881 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:59:09.126437 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:59:09.126858 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.130918 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.131562 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.135429 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.136040 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.136488 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:59:09.136869 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.144311 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.144749 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.145185 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:59:09.150832 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:09.154339 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.154779 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:59:09.155647 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.158863 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.159364 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:59:09.160178 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.161657 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:09.162080 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.162468 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:09.163537 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.166214 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:59:09.166926 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.167364 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:59:09.170306 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:59:09.171639 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:59:09.172245 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d37cd60>]}
[0m09:59:09.172921 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.05s]
[0m09:59:09.173604 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.174152 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:59:09.174764 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:59:09.175333 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:59:09.175764 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:59:09.179983 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.180572 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:59:09.184307 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.184908 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.185325 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:59:09.185690 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.192758 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.193189 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.193612 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:59:09.199461 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:09.202708 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.203141 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:59:09.203880 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.206996 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.207454 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:59:09.208144 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.209551 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:09.209982 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.210367 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:09.211401 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.214040 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:59:09.214663 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.215065 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:59:09.217900 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:09.219161 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:59:09.219800 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f817332f310>]}
[0m09:59:09.220462 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:59:09.221133 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:59:09.221619 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.222227 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:59:09.222839 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:59:09.223480 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.227757 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.228348 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.233108 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.233720 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.234125 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:59:09.234496 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.241829 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.242325 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.242751 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:59:09.243495 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 47: );
          ^

[0m09:59:09.243948 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:59:09.244572 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:59:09.246734 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near ";"
  LINE 47: );
            ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:09.247324 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d37cd60>]}
[0m09:59:09.248070 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:59:09.248827 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.249330 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.250062 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:59:09.250830 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:59:09.251296 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.314309 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.315061 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.343508 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.344046 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095909337783"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:59:09.344527 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.355284 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:59:09.369957 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.370443 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:59:09.371023 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:59:09.371507 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.371934 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095909337783'
        
      order by ordinal_position

  
[0m09:59:09.384079 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:59:09.389586 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.390091 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:09.393742 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:59:09.402358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.402839 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:09.406484 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:59:09.422945 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.423629 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.424113 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095909337783"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095909337783"
    )
  
[0m09:59:09.425484 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:59:09.426803 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:09.427283 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.427706 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:09.428814 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.429685 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:59:09.430329 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf13430>]}
[0m09:59:09.430993 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:59:09.431778 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.432488 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:59:09.433270 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:59:09.433930 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:59:09.435299 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:09.435723 [debug] [MainThread]: On master: BEGIN
[0m09:59:09.436066 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:59:09.443083 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.443517 [debug] [MainThread]: On master: COMMIT
[0m09:59:09.443850 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:09.444172 [debug] [MainThread]: On master: COMMIT
[0m09:59:09.444601 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:09.444951 [debug] [MainThread]: On master: Close
[0m09:59:09.445410 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:09.445739 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:59:09.446143 [info ] [MainThread]: 
[0m09:59:09.446556 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m09:59:09.448094 [debug] [MainThread]: Command end result
[0m09:59:09.482043 [info ] [MainThread]: 
[0m09:59:09.482575 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:59:09.482981 [info ] [MainThread]: 
[0m09:59:09.483458 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near ";"
  LINE 47: );
            ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:09.483866 [info ] [MainThread]: 
[0m09:59:09.484272 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:59:09.485173 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6980072, "process_user_time": 2.914906, "process_kernel_time": 0.651755, "process_mem_max_rss": "142816", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:59:09.485770 [debug] [MainThread]: Command `dbt run` failed at 09:59:09.485671 after 1.70 seconds
[0m09:59:09.486196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815f964610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d7bc4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815f650a00>]}
[0m09:59:09.486606 [debug] [MainThread]: Flushing usage events
[0m09:59:20.258129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e29d77c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e133bc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e1196970>]}


============================== 09:59:20.263418 | 8d9b0423-924a-4e0e-b55b-2b7e9d491f8e ==============================
[0m09:59:20.263418 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:59:20.264130 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:59:20.424180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e07fcd30>]}
[0m09:59:20.479917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e0ac9490>]}
[0m09:59:20.480708 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:59:20.499945 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:59:20.687536 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:59:20.688286 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:59:21.079419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6681bb0>]}
[0m09:59:21.241320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f64d20d0>]}
[0m09:59:21.241979 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:59:21.242451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6693d30>]}
[0m09:59:21.244177 [info ] [MainThread]: 
[0m09:59:21.244910 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:59:21.249608 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:59:21.283934 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:59:21.284447 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:59:21.284796 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:21.294565 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m09:59:21.295938 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:59:21.297836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:59:21.304283 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:21.304686 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:59:21.305015 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:21.312119 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.312522 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:21.312883 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:59:21.317733 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:59:21.318846 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:59:21.319360 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:59:21.319983 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:59:21.322485 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:21.322861 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:59:21.323182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:21.329983 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.330375 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:21.330720 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:59:21.335843 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:59:21.337103 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:59:21.337574 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:59:21.344460 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.344875 [debug] [MainThread]: On master: BEGIN
[0m09:59:21.345218 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:59:21.352068 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.352446 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.352841 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:59:21.358382 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.359520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e1159190>]}
[0m09:59:21.360025 [debug] [MainThread]: On master: ROLLBACK
[0m09:59:21.360506 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.360856 [debug] [MainThread]: On master: BEGIN
[0m09:59:21.361361 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:59:21.361716 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.362039 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.362351 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.362732 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:21.363079 [debug] [MainThread]: On master: Close
[0m09:59:21.363576 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:59:21.363975 [info ] [MainThread]: 
[0m09:59:21.371824 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:59:21.372427 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:59:21.372966 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:59:21.373394 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:59:21.381855 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:59:21.382454 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:59:21.420525 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:59:21.421160 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.421585 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:59:21.421948 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.428957 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.429403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.429851 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:59:21.435332 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.441656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.442099 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:59:21.442884 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.446036 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.446452 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:59:21.447217 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.466936 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:21.467412 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.467797 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:21.468840 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.475028 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:59:21.479290 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.479737 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:59:21.482521 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.484797 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:59:21.486388 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e033e1f0>]}
[0m09:59:21.487063 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:59:21.487821 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:59:21.488288 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:59:21.488891 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:59:21.489661 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:59:21.490297 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:59:21.494671 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:59:21.495280 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:59:21.498957 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:59:21.499604 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.500015 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:59:21.500370 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.507343 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.507758 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.508153 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:59:21.513102 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:59:21.516562 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.516992 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:59:21.517852 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.521065 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.521485 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:59:21.522186 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.523539 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:21.523953 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.524330 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:21.525393 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.528850 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:59:21.529491 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.530156 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:59:21.533256 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.534540 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:59:21.535174 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e0761670>]}
[0m09:59:21.535855 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:59:21.536623 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:59:21.537100 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.537682 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:59:21.538234 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:59:21.538650 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.542166 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.542720 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.546445 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.547029 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.547469 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:59:21.547854 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.554733 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.555152 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.555598 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:59:21.560768 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.564042 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.564474 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:59:21.565236 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.568355 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.568777 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:59:21.569483 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.570921 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:21.571370 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.571738 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:21.572723 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.575461 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:59:21.576163 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.576577 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:59:21.579419 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.580661 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:59:21.581239 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39dff557f0>]}
[0m09:59:21.581867 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:59:21.582576 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.583060 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:59:21.583679 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:59:21.584219 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:59:21.584619 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:59:21.588487 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.589042 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:59:21.592766 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.593352 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.593786 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:59:21.594156 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.601101 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.601521 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.601923 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:59:21.607703 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.610906 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.611373 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:59:21.612197 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.615282 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.615707 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:59:21.616439 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.617766 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:21.618183 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.618549 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:21.619554 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.622187 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:59:21.622783 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.623185 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:59:21.625900 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.627136 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:59:21.627743 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39dff9d0a0>]}
[0m09:59:21.628379 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:59:21.629086 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:59:21.629544 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.630138 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:59:21.630738 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:59:21.631374 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.635820 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.636393 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.641004 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.641590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.642030 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:59:21.642398 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.649225 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.649643 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.650055 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m09:59:21.651677 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m09:59:21.652133 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:59:21.652774 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:59:21.654777 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:21.655301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6fbee50>]}
[0m09:59:21.655944 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:59:21.656641 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.657101 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.657593 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:59:21.658441 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:59:21.658915 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.716378 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.717240 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.746080 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.746592 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095921740200"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:59:21.747023 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.758327 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:59:21.772854 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.773315 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:59:21.773874 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:59:21.774296 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.774680 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095921740200'
        
      order by ordinal_position

  
[0m09:59:21.787286 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:59:21.792856 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.793336 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:21.797177 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:59:21.806055 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.806515 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:21.810441 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m09:59:21.826847 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.827575 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.828036 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095921740200"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095921740200"
    )
  
[0m09:59:21.829399 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:59:21.830714 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:21.831167 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.831574 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:21.832831 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.833659 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:59:21.834336 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6fa5e20>]}
[0m09:59:21.834984 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:59:21.835667 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.836151 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:59:21.836720 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:59:21.837247 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:59:21.838501 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.838902 [debug] [MainThread]: On master: BEGIN
[0m09:59:21.839265 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:59:21.846423 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.846786 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.847103 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.847467 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.847867 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:21.848205 [debug] [MainThread]: On master: Close
[0m09:59:21.848656 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:21.848999 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:59:21.849409 [info ] [MainThread]: 
[0m09:59:21.849810 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:59:21.851235 [debug] [MainThread]: Command end result
[0m09:59:21.885253 [info ] [MainThread]: 
[0m09:59:21.885749 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:59:21.886133 [info ] [MainThread]: 
[0m09:59:21.886610 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:21.887021 [info ] [MainThread]: 
[0m09:59:21.887460 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:59:21.888358 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6799556, "process_user_time": 2.815097, "process_kernel_time": 0.746699, "process_mem_max_rss": "142884", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:59:21.888945 [debug] [MainThread]: Command `dbt run` failed at 09:59:21.888842 after 1.68 seconds
[0m09:59:21.889386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6f871c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e07fcd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e02e2af0>]}
[0m09:59:21.889803 [debug] [MainThread]: Flushing usage events
[0m10:06:47.205057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb96740d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7deaaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7dea880>]}


============================== 10:06:47.210558 | 1331e1f0-cfb9-4b34-8e94-67515bca4dca ==============================
[0m10:06:47.210558 [info ] [MainThread]: Running with dbt=1.8.3
[0m10:06:47.211110 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:06:47.382506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb946d610>]}
[0m10:06:47.438745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7df7400>]}
[0m10:06:47.439687 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m10:06:47.460766 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m10:06:47.651353 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:06:47.651849 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:06:47.782101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdbea790>]}
[0m10:06:47.949969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdb95a30>]}
[0m10:06:47.950659 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m10:06:47.951094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdb43220>]}
[0m10:06:47.952699 [info ] [MainThread]: 
[0m10:06:47.953338 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:06:47.957786 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m10:06:47.991912 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m10:06:47.992346 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m10:06:47.992703 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:06:48.001717 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m10:06:48.002967 [debug] [ThreadPool]: On list_scraping_db: Close
[0m10:06:48.004770 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m10:06:48.010968 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m10:06:48.011403 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m10:06:48.011748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:06:48.018826 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.019263 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m10:06:48.019647 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m10:06:48.024628 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m10:06:48.025766 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m10:06:48.026298 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m10:06:48.026910 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m10:06:48.029370 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m10:06:48.029763 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m10:06:48.030103 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:06:48.037104 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.037510 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m10:06:48.037868 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m10:06:48.043137 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m10:06:48.044437 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m10:06:48.044963 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m10:06:48.051821 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.052237 [debug] [MainThread]: On master: BEGIN
[0m10:06:48.052617 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:06:48.059730 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.060143 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.060610 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:06:48.066427 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m10:06:48.067609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdb95ee0>]}
[0m10:06:48.068134 [debug] [MainThread]: On master: ROLLBACK
[0m10:06:48.068642 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.069015 [debug] [MainThread]: On master: BEGIN
[0m10:06:48.069565 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m10:06:48.069944 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.070321 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.070665 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.071096 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:06:48.071501 [debug] [MainThread]: On master: Close
[0m10:06:48.072025 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:06:48.072420 [info ] [MainThread]: 
[0m10:06:48.079110 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m10:06:48.079746 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m10:06:48.080277 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m10:06:48.080697 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m10:06:48.089175 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m10:06:48.089768 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m10:06:48.127872 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m10:06:48.128486 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.128901 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m10:06:48.129283 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.136377 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.136828 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.137268 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m10:06:48.143864 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.006 seconds
[0m10:06:48.150398 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.150859 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m10:06:48.151711 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.154998 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.155481 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m10:06:48.156218 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.175845 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m10:06:48.176289 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.176685 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m10:06:48.178945 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m10:06:48.185366 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m10:06:48.189555 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.189997 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m10:06:48.192947 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m10:06:48.195267 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m10:06:48.196870 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd8362e0>]}
[0m10:06:48.197575 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 195[0m in 0.12s]
[0m10:06:48.198215 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m10:06:48.198697 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m10:06:48.199364 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m10:06:48.200066 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m10:06:48.200506 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m10:06:48.203669 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m10:06:48.204242 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m10:06:48.207922 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m10:06:48.208693 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.209112 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m10:06:48.209492 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.216776 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.217212 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.217707 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m10:06:48.223016 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m10:06:48.226330 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.226773 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m10:06:48.227559 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.230855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.231315 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m10:06:48.232022 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.233395 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m10:06:48.233822 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.234199 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m10:06:48.235360 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.238999 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m10:06:48.239674 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.240094 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m10:06:48.243315 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m10:06:48.244651 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m10:06:48.245292 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd672430>]}
[0m10:06:48.245964 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m10:06:48.246633 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m10:06:48.247122 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.247787 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m10:06:48.248308 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m10:06:48.248716 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.251997 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.252624 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.256563 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.257234 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.257681 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m10:06:48.258087 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.265424 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.265879 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.266328 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m10:06:48.275971 [debug] [Thread-1  ]: SQL status: SELECT 1950 in 0.009 seconds
[0m10:06:48.279570 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.280041 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m10:06:48.280824 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.284136 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.284616 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m10:06:48.285354 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.286827 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m10:06:48.287298 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.287722 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m10:06:48.289313 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.292097 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m10:06:48.292834 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.293288 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m10:06:48.295970 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m10:06:48.297298 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m10:06:48.297915 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd827280>]}
[0m10:06:48.298607 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 1950[0m in 0.05s]
[0m10:06:48.299286 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.299777 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m10:06:48.300388 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m10:06:48.300884 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m10:06:48.301302 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m10:06:48.305342 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.305920 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m10:06:48.309655 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.310268 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.310691 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m10:06:48.311067 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.318177 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.318613 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.319036 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m10:06:48.332070 [debug] [Thread-1  ]: SQL status: SELECT 1928 in 0.013 seconds
[0m10:06:48.335324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.335796 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m10:06:48.336598 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.339778 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.340248 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m10:06:48.340982 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.342366 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m10:06:48.342814 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.343253 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m10:06:48.344994 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.347711 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m10:06:48.348363 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.348799 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m10:06:48.351444 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m10:06:48.352717 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m10:06:48.353320 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd836280>]}
[0m10:06:48.353991 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 1928[0m in 0.05s]
[0m10:06:48.354641 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m10:06:48.355121 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.355762 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m10:06:48.356267 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m10:06:48.356676 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.359926 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.360498 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.365013 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.365610 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.366014 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m10:06:48.366382 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.373306 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.373731 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.374130 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m10:06:48.375807 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m10:06:48.376233 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m10:06:48.376822 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m10:06:48.379123 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m10:06:48.379880 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb885c250>]}
[0m10:06:48.380801 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m10:06:48.381463 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.381927 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.382767 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m10:06:48.383328 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m10:06:48.383760 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.393830 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.394422 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.422646 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.423127 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp100648417044"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m10:06:48.423600 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.435881 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.012 seconds
[0m10:06:48.453357 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.453836 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m10:06:48.454408 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m10:06:48.454830 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.455260 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp100648417044'
        
      order by ordinal_position

  
[0m10:06:48.468451 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m10:06:48.474055 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.474868 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m10:06:48.478732 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m10:06:48.487613 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.488088 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m10:06:48.491921 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m10:06:48.508054 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.508693 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.509155 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp100648417044"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp100648417044"
    )
  
[0m10:06:48.510904 [debug] [Thread-1  ]: SQL status: INSERT 0 195 in 0.001 seconds
[0m10:06:48.512195 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m10:06:48.512639 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.513026 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m10:06:48.514148 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.514967 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m10:06:48.515599 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd676490>]}
[0m10:06:48.516264 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 195[0m in 0.13s]
[0m10:06:48.516900 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.517376 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m10:06:48.517922 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m10:06:48.518407 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m10:06:48.519566 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.519940 [debug] [MainThread]: On master: BEGIN
[0m10:06:48.520262 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:06:48.527325 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.527786 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.528200 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.528602 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.529089 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:06:48.529493 [debug] [MainThread]: On master: Close
[0m10:06:48.530000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:06:48.530378 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m10:06:48.530876 [info ] [MainThread]: 
[0m10:06:48.531338 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m10:06:48.532865 [debug] [MainThread]: Command end result
[0m10:06:48.570412 [info ] [MainThread]: 
[0m10:06:48.570948 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:06:48.571391 [info ] [MainThread]: 
[0m10:06:48.571897 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m10:06:48.572305 [info ] [MainThread]: 
[0m10:06:48.572733 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m10:06:48.573618 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4192814, "process_user_time": 2.591219, "process_kernel_time": 0.694718, "process_mem_max_rss": "198000", "process_in_blocks": "1848", "process_out_blocks": "2432", "command_success": false}
[0m10:06:48.574326 [debug] [MainThread]: Command `dbt run` failed at 10:06:48.574216 after 1.42 seconds
[0m10:06:48.574796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb96740d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7df7400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb9365e80>]}
[0m10:06:48.575268 [debug] [MainThread]: Flushing usage events
[0m11:59:11.381393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd91a685b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd903e05e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd906f29a0>]}


============================== 11:59:11.389565 | 0d99b441-4216-4692-9e5f-de8a9b129dec ==============================
[0m11:59:11.389565 [info ] [MainThread]: Running with dbt=1.8.3
[0m11:59:11.390165 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:59:11.598880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f5faac0>]}
[0m11:59:11.656426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f5bb2b0>]}
[0m11:59:11.657878 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:59:11.679253 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m11:59:11.923797 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:59:11.924356 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:59:12.066681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5fd4700>]}
[0m11:59:12.257920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5f289a0>]}
[0m11:59:12.258701 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m11:59:12.259299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5fe5fa0>]}
[0m11:59:12.261108 [info ] [MainThread]: 
[0m11:59:12.261903 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:59:12.266490 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m11:59:12.307744 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m11:59:12.308313 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m11:59:12.308745 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:12.318361 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m11:59:12.319888 [debug] [ThreadPool]: On list_scraping_db: Close
[0m11:59:12.322096 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m11:59:12.329130 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m11:59:12.329629 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m11:59:12.330028 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:59:12.337477 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.337919 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m11:59:12.338291 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:59:12.344042 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m11:59:12.345560 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m11:59:12.346112 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m11:59:12.346808 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m11:59:12.350545 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m11:59:12.350965 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m11:59:12.351376 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:59:12.359298 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.359789 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m11:59:12.360199 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m11:59:12.365019 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m11:59:12.366341 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m11:59:12.366895 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m11:59:12.373018 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.373492 [debug] [MainThread]: On master: BEGIN
[0m11:59:12.373858 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:59:12.381438 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.381878 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.382297 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:59:12.390660 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:59:12.391941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5f28df0>]}
[0m11:59:12.392487 [debug] [MainThread]: On master: ROLLBACK
[0m11:59:12.393019 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.393425 [debug] [MainThread]: On master: BEGIN
[0m11:59:12.393983 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:59:12.394363 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.394697 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.395017 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.395429 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:59:12.395799 [debug] [MainThread]: On master: Close
[0m11:59:12.396358 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:59:12.396750 [info ] [MainThread]: 
[0m11:59:12.403140 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m11:59:12.403804 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m11:59:12.404398 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m11:59:12.404820 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m11:59:12.413662 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m11:59:12.414336 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m11:59:12.453133 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m11:59:12.453968 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.454453 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m11:59:12.454836 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.463748 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m11:59:12.464302 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.464774 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m11:59:12.478740 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.013 seconds
[0m11:59:12.486247 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.486770 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m11:59:12.487780 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:59:12.491428 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.491903 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m11:59:12.492737 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.513182 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m11:59:12.513792 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.514208 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m11:59:12.516902 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m11:59:12.523613 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m11:59:12.527944 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.528421 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m11:59:12.533918 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m11:59:12.536413 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m11:59:12.538404 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5c27730>]}
[0m11:59:12.539136 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 195[0m in 0.13s]
[0m11:59:12.539809 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m11:59:12.540293 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m11:59:12.540835 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m11:59:12.541535 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m11:59:12.541991 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m11:59:12.545715 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m11:59:12.546375 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m11:59:12.550270 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m11:59:12.550949 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.551422 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m11:59:12.551810 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.559664 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.560152 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.560605 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m11:59:12.567208 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m11:59:12.571174 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.571641 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m11:59:12.572588 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:59:12.576080 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.576546 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m11:59:12.577465 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.578979 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m11:59:12.579422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.579813 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m11:59:12.581197 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m11:59:12.585214 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m11:59:12.585930 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.586376 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m11:59:12.589547 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m11:59:12.590956 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m11:59:12.591609 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f49c7f0>]}
[0m11:59:12.592309 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m11:59:12.592962 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m11:59:12.593457 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.594129 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m11:59:12.594737 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m11:59:12.595194 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.598621 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.599295 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.603646 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.609393 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.609945 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m11:59:12.610420 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.618300 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.618878 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.619363 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m11:59:12.630861 [debug] [Thread-1  ]: SQL status: SELECT 1950 in 0.011 seconds
[0m11:59:12.634868 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.635376 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m11:59:12.636265 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.639799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.640267 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m11:59:12.641099 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.642707 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m11:59:12.643156 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.643541 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m11:59:12.645470 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m11:59:12.648647 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m11:59:12.649539 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.650004 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m11:59:12.653920 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m11:59:12.655921 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m11:59:12.656651 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5f851f0>]}
[0m11:59:12.657429 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 1950[0m in 0.06s]
[0m11:59:12.658169 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.658722 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m11:59:12.659407 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m11:59:12.659929 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m11:59:12.660351 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m11:59:12.664932 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.665641 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m11:59:12.669658 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.670315 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.670751 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m11:59:12.671140 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.678508 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.679009 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.679446 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m11:59:12.693804 [debug] [Thread-1  ]: SQL status: SELECT 1928 in 0.014 seconds
[0m11:59:12.697897 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.698431 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m11:59:12.699327 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.702965 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.703449 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m11:59:12.704336 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.705880 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m11:59:12.706324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.706702 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m11:59:12.708685 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m11:59:12.711855 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m11:59:12.712528 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.712946 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m11:59:12.716240 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m11:59:12.717732 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m11:59:12.718397 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5ab65b0>]}
[0m11:59:12.719110 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 1928[0m in 0.06s]
[0m11:59:12.719762 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m11:59:12.720245 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.720884 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m11:59:12.721433 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m11:59:12.721887 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.725572 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.726211 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.731270 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.731993 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.732438 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m11:59:12.732812 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.740265 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.740767 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.741192 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m11:59:12.743726 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m11:59:12.744197 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m11:59:12.744817 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m11:59:12.752682 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m11:59:12.753353 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5aa60a0>]}
[0m11:59:12.754155 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.03s]
[0m11:59:12.754833 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.755326 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.756160 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m11:59:12.756726 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m11:59:12.757156 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.767330 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.768077 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.797578 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.798217 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp115912791682"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m11:59:12.798718 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.811538 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.013 seconds
[0m11:59:12.826754 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.827344 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m11:59:12.828071 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m11:59:12.828559 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.828994 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp115912791682'
        
      order by ordinal_position

  
[0m11:59:12.848280 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.019 seconds
[0m11:59:12.854632 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.855214 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m11:59:12.859269 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m11:59:12.868844 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.869402 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m11:59:12.873363 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m11:59:12.890248 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.891098 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.891641 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp115912791682"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp115912791682"
    )
  
[0m11:59:12.896473 [debug] [Thread-1  ]: SQL status: INSERT 0 195 in 0.004 seconds
[0m11:59:12.897978 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m11:59:12.898458 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.898879 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m11:59:12.900585 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m11:59:12.901503 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m11:59:12.902180 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5a48df0>]}
[0m11:59:12.902914 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 195[0m in 0.15s]
[0m11:59:12.903606 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.904127 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m11:59:12.904605 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m11:59:12.905248 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m11:59:12.906493 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.906880 [debug] [MainThread]: On master: BEGIN
[0m11:59:12.907226 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:59:12.914555 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.915010 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.915381 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.915718 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.916204 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:59:12.916590 [debug] [MainThread]: On master: Close
[0m11:59:12.917170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:12.917777 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m11:59:12.918521 [info ] [MainThread]: 
[0m11:59:12.919155 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m11:59:12.920726 [debug] [MainThread]: Command end result
[0m11:59:12.955821 [info ] [MainThread]: 
[0m11:59:12.956421 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:59:12.956794 [info ] [MainThread]: 
[0m11:59:12.957238 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m11:59:12.957666 [info ] [MainThread]: 
[0m11:59:12.958038 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m11:59:12.958926 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6302475, "process_user_time": 2.787194, "process_kernel_time": 0.716937, "process_mem_max_rss": "197776", "process_in_blocks": "35944", "process_out_blocks": "2432", "command_success": false}
[0m11:59:12.959556 [debug] [MainThread]: Command `dbt run` failed at 11:59:12.959457 after 1.63 seconds
[0m11:59:12.959998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd91a685b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f5bb2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda59f1f10>]}
[0m11:59:12.960426 [debug] [MainThread]: Flushing usage events
[0m12:49:19.991118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f027a18d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0278ae5c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0278941970>]}


============================== 12:49:19.996988 | b8abe735-ae49-49fe-ba83-0509d0e4a1ee ==============================
[0m12:49:19.996988 [info ] [MainThread]: Running with dbt=1.8.3
[0m12:49:19.997795 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:49:20.182186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02782b0b20>]}
[0m12:49:20.240501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0277ffb490>]}
[0m12:49:20.241479 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:49:20.262586 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m12:49:20.454580 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:49:20.455128 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:49:20.602641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e7d5760>]}
[0m12:49:20.774497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e728a00>]}
[0m12:49:20.775241 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m12:49:20.775798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e7f1fd0>]}
[0m12:49:20.777633 [info ] [MainThread]: 
[0m12:49:20.778455 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:49:20.783127 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m12:49:20.819610 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m12:49:20.820182 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m12:49:20.820565 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:49:20.830756 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.010 seconds
[0m12:49:20.832259 [debug] [ThreadPool]: On list_scraping_db: Close
[0m12:49:20.834314 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m12:49:20.841074 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m12:49:20.841569 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m12:49:20.841926 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:49:20.849328 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m12:49:20.849964 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m12:49:20.850347 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m12:49:20.855422 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m12:49:20.856706 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m12:49:20.857238 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m12:49:20.857962 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m12:49:20.860767 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m12:49:20.861181 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m12:49:20.861546 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:49:20.868998 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m12:49:20.869499 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m12:49:20.869886 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:49:20.875508 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m12:49:20.877053 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m12:49:20.877633 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m12:49:20.885118 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.885670 [debug] [MainThread]: On master: BEGIN
[0m12:49:20.886058 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:49:20.893540 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:49:20.894029 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.894465 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:49:20.900627 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m12:49:20.901998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e728bb0>]}
[0m12:49:20.902553 [debug] [MainThread]: On master: ROLLBACK
[0m12:49:20.903083 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.903459 [debug] [MainThread]: On master: BEGIN
[0m12:49:20.903970 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:49:20.904338 [debug] [MainThread]: On master: COMMIT
[0m12:49:20.904667 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.905049 [debug] [MainThread]: On master: COMMIT
[0m12:49:20.905598 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:49:20.906063 [debug] [MainThread]: On master: Close
[0m12:49:20.906657 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:49:20.907175 [info ] [MainThread]: 
[0m12:49:20.914002 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m12:49:20.914667 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m12:49:20.915238 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m12:49:20.915682 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m12:49:20.925211 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m12:49:20.926014 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m12:49:20.966096 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m12:49:20.966941 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.967421 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m12:49:20.967806 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:20.976072 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:20.976601 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.977070 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m12:49:20.985478 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.008 seconds
[0m12:49:20.993038 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.993621 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m12:49:20.994597 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:20.998306 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.998767 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m12:49:20.999615 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.020566 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m12:49:21.021154 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:21.021618 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m12:49:21.023823 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:49:21.030824 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m12:49:21.035293 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:21.035783 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m12:49:21.039598 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m12:49:21.042224 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m12:49:21.043902 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e300c70>]}
[0m12:49:21.044647 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 195[0m in 0.13s]
[0m12:49:21.045308 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m12:49:21.045819 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m12:49:21.046529 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m12:49:21.047235 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m12:49:21.047711 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m12:49:21.051390 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m12:49:21.052093 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m12:49:21.056224 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m12:49:21.056958 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.057455 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m12:49:21.057926 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.065572 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:21.066087 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.066536 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m12:49:21.073003 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m12:49:21.077214 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.077786 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m12:49:21.078754 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:21.082571 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.083102 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m12:49:21.084027 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.085583 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m12:49:21.086024 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.086416 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m12:49:21.087787 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:49:21.091876 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m12:49:21.092558 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.092984 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m12:49:21.097167 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m12:49:21.098622 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m12:49:21.099302 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0277b868e0>]}
[0m12:49:21.100015 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m12:49:21.100655 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m12:49:21.101141 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.101801 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m12:49:21.102318 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m12:49:21.102723 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.106105 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.106763 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.110974 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.111661 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.112144 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m12:49:21.112543 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.120007 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:49:21.120476 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.120880 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m12:49:21.133262 [debug] [Thread-1  ]: SQL status: SELECT 1950 in 0.012 seconds
[0m12:49:21.137470 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.137986 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m12:49:21.139020 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:21.142683 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.143166 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m12:49:21.144339 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:21.146031 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m12:49:21.146491 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.147027 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m12:49:21.149280 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:49:21.152537 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m12:49:21.153327 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.153867 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m12:49:21.157881 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m12:49:21.159417 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m12:49:21.160103 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e425250>]}
[0m12:49:21.161002 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 1950[0m in 0.06s]
[0m12:49:21.161775 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.162311 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m12:49:21.163002 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m12:49:21.163579 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m12:49:21.164044 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m12:49:21.168737 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.169745 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m12:49:21.174535 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.175460 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.176314 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m12:49:21.176758 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.184777 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:21.185456 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.185938 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m12:49:21.199576 [debug] [Thread-1  ]: SQL status: SELECT 1928 in 0.013 seconds
[0m12:49:21.203640 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.204147 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m12:49:21.205055 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.208658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.209142 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m12:49:21.210068 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.211576 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m12:49:21.212035 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.212463 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m12:49:21.214526 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:49:21.217699 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m12:49:21.218395 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.218849 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m12:49:21.222234 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m12:49:21.223709 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m12:49:21.224385 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e300610>]}
[0m12:49:21.225125 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 1928[0m in 0.06s]
[0m12:49:21.225842 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m12:49:21.226353 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.227015 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m12:49:21.227561 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m12:49:21.228012 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.231762 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.232440 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.237539 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.238258 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.238710 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m12:49:21.239126 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.246779 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:21.247278 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.247739 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m12:49:21.249447 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m12:49:21.249934 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m12:49:21.250626 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m12:49:21.252889 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m12:49:21.253504 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e274400>]}
[0m12:49:21.254294 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.03s]
[0m12:49:21.254994 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.255511 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.256271 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m12:49:21.257036 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m12:49:21.257622 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.267852 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.268690 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.302384 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.302989 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp124921295062"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m12:49:21.303502 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.315066 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.011 seconds
[0m12:49:21.330746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.331347 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m12:49:21.332046 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m12:49:21.332529 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.332972 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp124921295062'
        
      order by ordinal_position

  
[0m12:49:21.345986 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m12:49:21.352375 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.352929 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m12:49:21.356817 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m12:49:21.366597 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.367160 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m12:49:21.371254 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m12:49:21.388321 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.389190 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.389758 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp124921295062"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp124921295062"
    )
  
[0m12:49:21.391754 [debug] [Thread-1  ]: SQL status: INSERT 0 195 in 0.002 seconds
[0m12:49:21.393226 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m12:49:21.393734 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.394149 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m12:49:21.395903 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:49:21.396778 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m12:49:21.397575 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e2798b0>]}
[0m12:49:21.398667 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 195[0m in 0.14s]
[0m12:49:21.399737 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.400392 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m12:49:21.401252 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m12:49:21.402073 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m12:49:21.403579 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:21.404013 [debug] [MainThread]: On master: BEGIN
[0m12:49:21.404371 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:49:21.411858 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:49:21.412344 [debug] [MainThread]: On master: COMMIT
[0m12:49:21.412703 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:21.413041 [debug] [MainThread]: On master: COMMIT
[0m12:49:21.413524 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:49:21.413903 [debug] [MainThread]: On master: Close
[0m12:49:21.414424 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:49:21.414774 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m12:49:21.415240 [info ] [MainThread]: 
[0m12:49:21.415651 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m12:49:21.417115 [debug] [MainThread]: Command end result
[0m12:49:21.452479 [info ] [MainThread]: 
[0m12:49:21.453050 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:49:21.453460 [info ] [MainThread]: 
[0m12:49:21.453908 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m12:49:21.454283 [info ] [MainThread]: 
[0m12:49:21.454650 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m12:49:21.456081 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.5148588, "process_user_time": 2.705952, "process_kernel_time": 0.701249, "process_mem_max_rss": "197772", "process_in_blocks": "11008", "process_out_blocks": "2424", "command_success": false}
[0m12:49:21.456796 [debug] [MainThread]: Command `dbt run` failed at 12:49:21.456678 after 1.52 seconds
[0m12:49:21.457342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f027a18d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0277ffb490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0279e8fe50>]}
[0m12:49:21.457824 [debug] [MainThread]: Flushing usage events
[0m13:36:47.426039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f46714ee0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466fc65af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466fc65880>]}


============================== 13:36:47.437618 | d5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d ==============================
[0m13:36:47.437618 [info ] [MainThread]: Running with dbt=1.8.3
[0m13:36:47.438946 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:36:49.100967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466f304d30>]}
[0m13:36:49.439416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466fc73400>]}
[0m13:36:49.441330 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m13:36:49.739854 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m13:36:51.011515 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:36:51.013277 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m13:36:52.282708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4685081be0>]}
[0m13:36:53.162211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4684ed3100>]}
[0m13:36:53.164599 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m13:36:53.165534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f46850974c0>]}
[0m13:36:53.194821 [info ] [MainThread]: 
[0m13:36:53.196684 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:36:53.227938 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m13:36:54.962038 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m13:36:55.109660 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m13:36:55.148991 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:36:55.508428 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.359 seconds
[0m13:36:55.524286 [debug] [ThreadPool]: On list_scraping_db: Close
[0m13:36:55.528164 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db_scraping_ads'
[0m13:36:55.556798 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m13:36:55.558538 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m13:36:55.559196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:36:55.626421 [debug] [ThreadPool]: SQL status: BEGIN in 0.067 seconds
[0m13:36:55.627326 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m13:36:55.628032 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m13:36:55.669573 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.041 seconds
[0m13:36:55.671427 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m13:36:55.672203 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m13:36:55.673067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m13:36:55.676551 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m13:36:55.677132 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m13:36:55.677668 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:36:55.693545 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m13:36:55.694543 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m13:36:55.695455 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m13:36:55.704614 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.008 seconds
[0m13:36:55.707260 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m13:36:55.708233 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m13:36:55.721846 [debug] [MainThread]: Using postgres connection "master"
[0m13:36:55.722635 [debug] [MainThread]: On master: BEGIN
[0m13:36:55.723272 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:36:55.745553 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m13:36:55.746435 [debug] [MainThread]: Using postgres connection "master"
[0m13:36:55.747207 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:36:55.835094 [debug] [MainThread]: SQL status: SELECT 0 in 0.087 seconds
[0m13:36:55.837172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4684ed30a0>]}
[0m13:36:55.838612 [debug] [MainThread]: On master: ROLLBACK
[0m13:36:55.839453 [debug] [MainThread]: Using postgres connection "master"
[0m13:36:55.839980 [debug] [MainThread]: On master: BEGIN
[0m13:36:55.840665 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m13:36:55.841200 [debug] [MainThread]: On master: COMMIT
[0m13:36:55.841714 [debug] [MainThread]: Using postgres connection "master"
[0m13:36:55.842211 [debug] [MainThread]: On master: COMMIT
[0m13:36:55.842838 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:36:55.843417 [debug] [MainThread]: On master: Close
[0m13:36:55.844995 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:36:55.845851 [info ] [MainThread]: 
[0m13:36:55.886359 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m13:36:55.887142 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m13:36:55.888076 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m13:36:55.888786 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m13:36:55.909168 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m13:36:55.914103 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m13:36:56.031277 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m13:36:56.053845 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m13:36:56.054754 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m13:36:56.055435 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:36:56.118073 [debug] [Thread-1  ]: SQL status: BEGIN in 0.063 seconds
[0m13:36:56.118969 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m13:36:56.119822 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m13:36:56.220995 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.100 seconds
[0m13:36:56.236286 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m13:36:56.237187 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m13:36:56.238776 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:36:56.244148 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m13:36:56.244687 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m13:36:56.261906 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.017 seconds
[0m13:36:56.317819 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m13:36:56.318592 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m13:36:56.319207 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m13:36:56.333495 [debug] [Thread-1  ]: SQL status: COMMIT in 0.014 seconds
[0m13:36:56.353108 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m13:36:56.373651 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m13:36:56.387117 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m13:36:56.402877 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.015 seconds
[0m13:36:56.405908 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m13:36:56.415294 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466ee48250>]}
[0m13:36:56.416326 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 195[0m in 0.52s]
[0m13:36:56.417483 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m13:36:56.418297 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m13:36:56.419085 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m13:36:56.419855 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m13:36:56.420436 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m13:36:56.454768 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m13:36:56.456508 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m13:36:56.462794 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m13:36:56.487926 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m13:36:56.488734 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m13:36:56.489304 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:36:56.675221 [debug] [Thread-1  ]: SQL status: BEGIN in 0.186 seconds
[0m13:36:56.676218 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m13:36:56.676938 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m13:36:56.718891 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.041 seconds
[0m13:36:56.725038 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m13:36:56.725780 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m13:36:56.727036 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:36:56.745262 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m13:36:56.746120 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m13:36:56.755756 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.009 seconds
[0m13:36:56.758265 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m13:36:56.758961 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m13:36:56.759522 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m13:36:56.761160 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:36:56.766560 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m13:36:56.767540 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m13:36:56.768147 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m13:36:56.773063 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m13:36:56.775331 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m13:36:56.776942 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f46859bdb20>]}
[0m13:36:56.778124 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.36s]
[0m13:36:56.779264 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m13:36:56.779877 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m13:36:56.780730 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m13:36:56.781497 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m13:36:56.782259 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m13:36:56.787545 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m13:36:56.789816 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m13:36:56.796152 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m13:36:56.797452 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m13:36:56.798251 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m13:36:56.798803 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:36:56.857319 [debug] [Thread-1  ]: SQL status: BEGIN in 0.058 seconds
[0m13:36:56.858172 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m13:36:56.858846 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m13:36:56.942486 [debug] [Thread-1  ]: SQL status: SELECT 1950 in 0.083 seconds
[0m13:36:56.953567 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m13:36:56.954376 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m13:36:56.958536 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:36:56.989821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m13:36:56.990625 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m13:36:56.991916 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:36:56.994313 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m13:36:56.994832 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m13:36:56.995236 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m13:36:57.008319 [debug] [Thread-1  ]: SQL status: COMMIT in 0.013 seconds
[0m13:36:57.013115 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m13:36:57.014010 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m13:36:57.014463 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m13:36:57.031525 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.016 seconds
[0m13:36:57.040119 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m13:36:57.041049 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466efa24f0>]}
[0m13:36:57.042086 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 1950[0m in 0.26s]
[0m13:36:57.043067 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m13:36:57.043805 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m13:36:57.044641 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m13:36:57.045431 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m13:36:57.046024 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m13:36:57.059317 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.060499 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m13:36:57.067126 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.068089 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.068606 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m13:36:57.069059 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:36:57.127364 [debug] [Thread-1  ]: SQL status: BEGIN in 0.058 seconds
[0m13:36:57.128105 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.128675 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m13:36:57.226448 [debug] [Thread-1  ]: SQL status: SELECT 1928 in 0.091 seconds
[0m13:36:57.232662 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.233461 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m13:36:57.236964 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.003 seconds
[0m13:36:57.242982 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.243635 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m13:36:57.244670 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m13:36:57.246405 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m13:36:57.246922 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.247519 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m13:36:57.254335 [debug] [Thread-1  ]: SQL status: COMMIT in 0.006 seconds
[0m13:36:57.259445 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m13:36:57.260497 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m13:36:57.261115 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m13:36:57.275369 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.014 seconds
[0m13:36:57.277778 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m13:36:57.278713 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466fc651c0>]}
[0m13:36:57.279690 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 1928[0m in 0.23s]
[0m13:36:57.280570 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m13:36:57.281248 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m13:36:57.282015 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m13:36:57.282842 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m13:36:57.283430 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m13:36:57.288903 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m13:36:57.290313 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m13:36:57.297256 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m13:36:57.298667 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m13:36:57.299374 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m13:36:57.299979 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:36:57.318795 [debug] [Thread-1  ]: SQL status: BEGIN in 0.019 seconds
[0m13:36:57.319610 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m13:36:57.320252 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m13:36:57.331476 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m13:36:57.450605 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m13:36:57.451426 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m13:36:57.458789 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.007 seconds
[0m13:36:57.461258 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m13:36:57.462090 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m13:36:57.462759 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m13:36:57.464161 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:36:57.470356 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m13:36:57.471364 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m13:36:57.471963 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m13:36:57.481310 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.009 seconds
[0m13:36:57.483742 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m13:36:57.484723 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466eb94c70>]}
[0m13:36:57.485767 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.20s]
[0m13:36:57.486713 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m13:36:57.487411 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m13:36:57.488343 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m13:36:57.489081 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m13:36:57.489818 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m13:36:57.505341 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.543163 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m13:36:57.587436 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.588283 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp133657578821"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m13:36:57.588935 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:36:57.704674 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.116 seconds
[0m13:36:57.731342 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.732245 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m13:36:57.733215 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m13:36:57.733821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.734395 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp133657578821'
        
      order by ordinal_position

  
[0m13:36:57.809894 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.075 seconds
[0m13:36:57.819565 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.820391 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m13:36:57.855013 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.034 seconds
[0m13:36:57.868539 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.869378 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m13:36:57.907649 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.023 seconds
[0m13:36:57.929811 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.930671 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.931299 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp133657578821"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp133657578821"
    )
  
[0m13:36:57.948499 [debug] [Thread-1  ]: SQL status: INSERT 0 195 in 0.016 seconds
[0m13:36:57.950777 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m13:36:57.951420 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m13:36:57.952120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m13:36:57.954008 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:36:57.955203 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m13:36:57.956138 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466eb94c70>]}
[0m13:36:57.957135 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 195[0m in 0.47s]
[0m13:36:57.958093 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m13:36:57.958772 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m13:36:57.959656 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m13:36:57.960480 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m13:36:57.960940 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m13:36:57.965506 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m13:36:57.967072 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m13:36:57.972340 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m13:36:57.973238 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m13:36:57.973930 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m13:36:57.974403 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m13:36:57.996367 [debug] [Thread-1  ]: SQL status: BEGIN in 0.022 seconds
[0m13:36:57.997078 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m13:36:57.997586 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m13:36:58.005929 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.008 seconds
[0m13:36:58.026416 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m13:36:58.027176 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m13:36:58.050367 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.022 seconds
[0m13:36:58.052741 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m13:36:58.053471 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m13:36:58.054083 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m13:36:58.055695 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m13:36:58.065140 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m13:36:58.066353 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m13:36:58.067103 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m13:36:58.076097 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.008 seconds
[0m13:36:58.078600 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m13:36:58.079434 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5dd0f09-4f0b-4b26-973b-ef5cd4c8ce7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466eb94c70>]}
[0m13:36:58.080513 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.12s]
[0m13:36:58.081573 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m13:36:58.083695 [debug] [MainThread]: Using postgres connection "master"
[0m13:36:58.084394 [debug] [MainThread]: On master: BEGIN
[0m13:36:58.084998 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:36:58.122304 [debug] [MainThread]: SQL status: BEGIN in 0.037 seconds
[0m13:36:58.123129 [debug] [MainThread]: On master: COMMIT
[0m13:36:58.123710 [debug] [MainThread]: Using postgres connection "master"
[0m13:36:58.124214 [debug] [MainThread]: On master: COMMIT
[0m13:36:58.124916 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m13:36:58.125470 [debug] [MainThread]: On master: Close
[0m13:36:58.126249 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:36:58.126781 [debug] [MainThread]: Connection 'list_scraping_db' was properly closed.
[0m13:36:58.127324 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m13:36:58.138357 [info ] [MainThread]: 
[0m13:36:58.139150 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 4.93 seconds (4.93s).
[0m13:36:58.141302 [debug] [MainThread]: Command end result
[0m13:36:58.233276 [info ] [MainThread]: 
[0m13:36:58.234110 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:36:58.234683 [info ] [MainThread]: 
[0m13:36:58.235817 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m13:36:58.295715 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.101972, "process_user_time": 4.714625, "process_kernel_time": 13.791455, "process_mem_max_rss": "116520", "process_in_blocks": "299664", "process_out_blocks": "3656"}
[0m13:36:58.310205 [debug] [MainThread]: Command `dbt run` succeeded at 13:36:58.309940 after 11.12 seconds
[0m13:36:58.310994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466fe06490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466eae5d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f467010e040>]}
[0m13:36:58.311646 [debug] [MainThread]: Flushing usage events
[0m14:43:31.257232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4331f2dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f433080efa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f433080e8b0>]}


============================== 14:43:31.278872 | 7f1fe63a-9778-41cc-b23f-52a7891ab0ad ==============================
[0m14:43:31.278872 [info ] [MainThread]: Running with dbt=1.8.3
[0m14:43:31.279495 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:43:31.481577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f433046dcd0>]}
[0m14:43:31.539087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f433040ed30>]}
[0m14:43:31.540398 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:43:31.561133 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m14:43:31.805802 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:43:31.806338 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:43:31.943052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43463986d0>]}
[0m14:43:32.133297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4346327940>]}
[0m14:43:32.133971 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m14:43:32.134407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43465b2d90>]}
[0m14:43:32.136092 [info ] [MainThread]: 
[0m14:43:32.136786 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:43:32.141545 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m14:43:32.181594 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m14:43:32.182142 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m14:43:32.182571 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:32.191879 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.009 seconds
[0m14:43:32.193264 [debug] [ThreadPool]: On list_scraping_db: Close
[0m14:43:32.195158 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m14:43:32.201660 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:43:32.202075 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m14:43:32.202424 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:43:32.209499 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.209900 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:43:32.210261 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:43:32.215390 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m14:43:32.216792 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m14:43:32.217336 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m14:43:32.217982 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m14:43:32.221955 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:43:32.222365 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m14:43:32.222711 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:43:32.229652 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.230074 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:43:32.230437 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m14:43:32.235570 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m14:43:32.236780 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m14:43:32.237283 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m14:43:32.243112 [debug] [MainThread]: Using postgres connection "master"
[0m14:43:32.243535 [debug] [MainThread]: On master: BEGIN
[0m14:43:32.243921 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:43:32.251040 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.251454 [debug] [MainThread]: Using postgres connection "master"
[0m14:43:32.251909 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:43:32.261040 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m14:43:32.262270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4346327d90>]}
[0m14:43:32.262812 [debug] [MainThread]: On master: ROLLBACK
[0m14:43:32.263310 [debug] [MainThread]: Using postgres connection "master"
[0m14:43:32.263697 [debug] [MainThread]: On master: BEGIN
[0m14:43:32.264234 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:43:32.264626 [debug] [MainThread]: On master: COMMIT
[0m14:43:32.265012 [debug] [MainThread]: Using postgres connection "master"
[0m14:43:32.265365 [debug] [MainThread]: On master: COMMIT
[0m14:43:32.265786 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:43:32.266153 [debug] [MainThread]: On master: Close
[0m14:43:32.266727 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:43:32.267128 [info ] [MainThread]: 
[0m14:43:32.273331 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m14:43:32.273974 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m14:43:32.274515 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m14:43:32.274946 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m14:43:32.283605 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m14:43:32.284226 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m14:43:32.323858 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m14:43:32.324694 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:43:32.325174 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m14:43:32.325574 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:32.333040 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.333547 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:43:32.334097 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m14:43:32.351791 [debug] [Thread-1  ]: SQL status: SELECT 345 in 0.017 seconds
[0m14:43:32.359136 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:43:32.359639 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m14:43:32.360507 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.363952 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:43:32.364411 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m14:43:32.365197 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.385304 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m14:43:32.385784 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:43:32.386193 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m14:43:32.389087 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m14:43:32.395564 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m14:43:32.399848 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:43:32.400297 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m14:43:32.405459 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m14:43:32.407846 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m14:43:32.409513 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43462e4190>]}
[0m14:43:32.410215 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 345[0m in 0.13s]
[0m14:43:32.410868 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m14:43:32.411334 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m14:43:32.411981 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m14:43:32.412639 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m14:43:32.413107 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m14:43:32.416390 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m14:43:32.417006 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m14:43:32.420866 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m14:43:32.421481 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:43:32.421896 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m14:43:32.422275 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:32.429583 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.430033 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:43:32.430454 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m14:43:32.437112 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m14:43:32.440633 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:43:32.441142 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m14:43:32.441932 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.445224 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:43:32.445697 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m14:43:32.446462 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.447891 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:43:32.448344 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:43:32.448789 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:43:32.450024 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:43:32.453711 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m14:43:32.454341 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:43:32.454766 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m14:43:32.457879 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:43:32.459230 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m14:43:32.459852 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43310e6040>]}
[0m14:43:32.460526 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m14:43:32.461213 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m14:43:32.461717 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m14:43:32.462329 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m14:43:32.462859 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m14:43:32.463279 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m14:43:32.466413 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.467035 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m14:43:32.470906 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.471548 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.471993 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m14:43:32.472397 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:32.479539 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.479980 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.480408 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m14:43:32.493687 [debug] [Thread-1  ]: SQL status: SELECT 3450 in 0.013 seconds
[0m14:43:32.497231 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.497724 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m14:43:32.498538 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.501785 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.502241 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m14:43:32.502987 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.504498 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m14:43:32.504987 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.505403 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m14:43:32.507473 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m14:43:32.510226 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m14:43:32.510964 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:43:32.511422 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m14:43:32.514860 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:43:32.516166 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m14:43:32.516842 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4345fb2370>]}
[0m14:43:32.517543 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 3450[0m in 0.05s]
[0m14:43:32.518217 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m14:43:32.518716 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m14:43:32.519328 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m14:43:32.519859 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m14:43:32.520287 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m14:43:32.524478 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.525156 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m14:43:32.528996 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.529635 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.530070 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m14:43:32.530470 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:32.537636 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.538114 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.538580 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m14:43:32.554828 [debug] [Thread-1  ]: SQL status: SELECT 2013 in 0.016 seconds
[0m14:43:32.558545 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.559016 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m14:43:32.559839 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.563137 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.563603 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m14:43:32.564330 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.565769 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m14:43:32.566210 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.566626 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m14:43:32.568341 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:43:32.571136 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m14:43:32.571803 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:43:32.572235 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m14:43:32.575711 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:43:32.577028 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m14:43:32.577674 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4345fbca00>]}
[0m14:43:32.578372 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 2013[0m in 0.06s]
[0m14:43:32.579039 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m14:43:32.579535 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m14:43:32.580151 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m14:43:32.580701 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m14:43:32.581156 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m14:43:32.584536 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.585195 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m14:43:32.589987 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.590626 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.591058 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m14:43:32.591461 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:32.598587 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.599057 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.599532 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m14:43:32.608654 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.009 seconds
[0m14:43:32.612034 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.612500 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m14:43:32.613265 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.616438 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.616925 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m14:43:32.617617 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.619026 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m14:43:32.619477 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.619900 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m14:43:32.621030 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:43:32.623961 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m14:43:32.624615 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:43:32.625070 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m14:43:32.627818 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:43:32.629121 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m14:43:32.629761 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4345d650a0>]}
[0m14:43:32.630443 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m14:43:32.631113 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m14:43:32.631609 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:43:32.632396 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m14:43:32.633129 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m14:43:32.633617 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:43:32.643134 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.643926 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:43:32.673763 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.674348 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp144332667063"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m14:43:32.674791 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:32.688491 [debug] [Thread-1  ]: SQL status: SELECT 631 in 0.014 seconds
[0m14:43:32.703568 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.704076 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m14:43:32.704702 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m14:43:32.705136 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.705537 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp144332667063'
        
      order by ordinal_position

  
[0m14:43:32.725213 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.019 seconds
[0m14:43:32.731325 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.731815 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m14:43:32.735634 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m14:43:32.743935 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.744414 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m14:43:32.748234 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m14:43:32.764583 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.765273 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.765736 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp144332667063"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp144332667063"
    )
  
[0m14:43:32.770973 [debug] [Thread-1  ]: SQL status: INSERT 0 631 in 0.005 seconds
[0m14:43:32.772292 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m14:43:32.772763 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:43:32.773158 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m14:43:32.775046 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:43:32.775879 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m14:43:32.776518 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4345dce6d0>]}
[0m14:43:32.777224 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 631[0m in 0.14s]
[0m14:43:32.777877 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:43:32.778382 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m14:43:32.779002 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m14:43:32.779514 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m14:43:32.779930 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m14:43:32.783103 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m14:43:32.783707 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m14:43:32.787675 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m14:43:32.788287 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:43:32.788737 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m14:43:32.789116 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:43:32.796197 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.796631 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:43:32.797050 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m14:43:32.802180 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m14:43:32.806618 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:43:32.807064 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m14:43:32.807811 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.810952 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:43:32.811399 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m14:43:32.812095 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:43:32.813621 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m14:43:32.814060 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:43:32.814449 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m14:43:32.815552 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:43:32.818228 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m14:43:32.818939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:43:32.819365 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m14:43:32.822081 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:43:32.823379 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m14:43:32.824008 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1fe63a-9778-41cc-b23f-52a7891ab0ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4345dce6d0>]}
[0m14:43:32.824698 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.04s]
[0m14:43:32.825348 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m14:43:32.826543 [debug] [MainThread]: Using postgres connection "master"
[0m14:43:32.826958 [debug] [MainThread]: On master: BEGIN
[0m14:43:32.827306 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:43:32.834335 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:43:32.834767 [debug] [MainThread]: On master: COMMIT
[0m14:43:32.835123 [debug] [MainThread]: Using postgres connection "master"
[0m14:43:32.835462 [debug] [MainThread]: On master: COMMIT
[0m14:43:32.835896 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:43:32.836257 [debug] [MainThread]: On master: Close
[0m14:43:32.836760 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:43:32.837106 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m14:43:32.837543 [info ] [MainThread]: 
[0m14:43:32.837928 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.70 seconds (0.70s).
[0m14:43:32.839471 [debug] [MainThread]: Command end result
[0m14:43:32.874444 [info ] [MainThread]: 
[0m14:43:32.875014 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:43:32.875394 [info ] [MainThread]: 
[0m14:43:32.875773 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m14:43:32.876630 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.6706032, "process_user_time": 2.894369, "process_kernel_time": 0.724587, "process_mem_max_rss": "195976", "process_in_blocks": "33936", "process_out_blocks": "4816"}
[0m14:43:32.877310 [debug] [MainThread]: Command `dbt run` succeeded at 14:43:32.877187 after 1.67 seconds
[0m14:43:32.877766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4331f2dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4331bcc820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43463447f0>]}
[0m14:43:32.878182 [debug] [MainThread]: Flushing usage events
[0m15:14:50.523241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44dea6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44d8d3ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44c61e880>]}


============================== 15:14:50.530576 | 6960275b-0450-48f8-8178-32cabdede329 ==============================
[0m15:14:50.530576 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:14:50.531227 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:14:50.804907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44dca4070>]}
[0m15:14:50.878347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44bd5bb50>]}
[0m15:14:50.879808 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:14:50.907038 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:14:51.152611 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:14:51.153235 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:14:51.302062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4623e9430>]}
[0m15:14:51.505817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd462391970>]}
[0m15:14:51.506649 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:14:51.507291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4623e4fa0>]}
[0m15:14:51.509147 [info ] [MainThread]: 
[0m15:14:51.509958 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:14:51.514784 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:14:51.580471 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:14:51.581092 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:14:51.581539 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:14:51.600495 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.019 seconds
[0m15:14:51.602328 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:14:51.604452 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:14:51.611760 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:14:51.612228 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:14:51.612631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:51.621046 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:14:51.621474 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:14:51.621851 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:14:51.632719 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.010 seconds
[0m15:14:51.634184 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:14:51.634727 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:14:51.635390 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:14:51.639488 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:14:51.639901 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:14:51.640246 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:51.647711 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:14:51.648127 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:14:51.648502 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:14:51.654981 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m15:14:51.656200 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:14:51.656794 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:14:51.663127 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:51.663566 [debug] [MainThread]: On master: BEGIN
[0m15:14:51.663963 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:14:51.671201 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:14:51.671652 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:51.672121 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:14:51.679675 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m15:14:51.680947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd462391dc0>]}
[0m15:14:51.681529 [debug] [MainThread]: On master: ROLLBACK
[0m15:14:51.682031 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:51.682411 [debug] [MainThread]: On master: BEGIN
[0m15:14:51.682968 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:14:51.683367 [debug] [MainThread]: On master: COMMIT
[0m15:14:51.683722 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:51.684064 [debug] [MainThread]: On master: COMMIT
[0m15:14:51.684494 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:14:51.684913 [debug] [MainThread]: On master: Close
[0m15:14:51.685480 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:14:51.685884 [info ] [MainThread]: 
[0m15:14:51.692884 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:14:51.693514 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:14:51.694037 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:14:51.694464 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:14:51.703104 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:14:51.704732 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:14:51.745296 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:14:51.746860 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:51.747355 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:14:51.747739 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:51.755314 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:14:51.755790 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:51.756257 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:14:51.770333 [debug] [Thread-1  ]: SQL status: SELECT 345 in 0.014 seconds
[0m15:14:51.777772 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:51.778297 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:14:51.779287 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:51.783091 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:51.783577 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:14:51.784477 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:51.807954 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:14:51.808523 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:51.809029 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:14:51.811670 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:14:51.819314 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:14:51.824799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:51.825391 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:14:51.831265 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m15:14:51.834592 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:14:51.836415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd462024730>]}
[0m15:14:51.837346 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 345[0m in 0.14s]
[0m15:14:51.838093 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:14:51.838684 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:14:51.839440 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:14:51.840297 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:14:51.840874 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:14:51.844722 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:14:51.845492 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:14:51.850414 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:14:51.851226 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:51.851742 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:14:51.852216 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:51.861002 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:14:51.861509 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:51.862031 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:14:51.867849 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:14:51.872317 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:51.872903 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:14:51.873890 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:51.877867 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:51.878437 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:14:51.879316 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:51.881087 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:14:51.881630 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:51.882320 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:14:51.883608 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:14:51.887960 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:14:51.888744 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:51.889354 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:14:51.892901 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:14:51.894317 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:14:51.895005 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44d08c1c0>]}
[0m15:14:51.895768 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m15:14:51.896483 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:14:51.897109 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:14:51.897701 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:14:51.898406 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:14:51.899013 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:14:51.902509 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.903867 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:14:51.908556 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.909560 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.910123 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:14:51.910637 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:51.919552 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:14:51.920139 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.920646 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:14:51.935016 [debug] [Thread-1  ]: SQL status: SELECT 3450 in 0.014 seconds
[0m15:14:51.940252 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.940959 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:14:51.941943 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:51.945854 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.946370 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:14:51.947586 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:14:51.949348 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:14:51.949838 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.950337 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:14:51.952220 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:14:51.955581 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:14:51.956443 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:14:51.957044 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:14:51.960729 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:14:51.962170 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:14:51.962909 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44b8c8a60>]}
[0m15:14:51.963732 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 3450[0m in 0.06s]
[0m15:14:51.964488 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:14:51.965174 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:14:51.965921 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:14:51.966561 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:14:51.967094 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:14:51.971915 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:14:51.972599 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:14:51.977102 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:14:51.977818 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:14:51.978380 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:14:51.978873 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:51.986592 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:14:51.987118 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:14:51.987675 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:14:52.003503 [debug] [Thread-1  ]: SQL status: SELECT 2013 in 0.015 seconds
[0m15:14:52.007591 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:14:52.008089 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:14:52.008995 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:52.012615 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:14:52.013162 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:14:52.014093 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:52.015770 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:14:52.016309 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:14:52.016832 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:14:52.018762 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:14:52.021826 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:14:52.022568 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:14:52.023119 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:14:52.026788 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:14:52.028304 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:14:52.029266 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd462024be0>]}
[0m15:14:52.030259 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 2013[0m in 0.06s]
[0m15:14:52.031157 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:14:52.031706 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:14:52.032504 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:14:52.033196 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:14:52.033787 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:14:52.038212 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.038948 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:14:52.045192 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.046028 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.046564 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:14:52.047084 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:52.055709 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:14:52.056355 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.057114 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:14:52.066162 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.008 seconds
[0m15:14:52.071052 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.071511 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:14:52.072473 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:14:52.077091 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.077799 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:14:52.078939 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:52.081012 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:14:52.081692 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.082354 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:14:52.083765 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:14:52.088074 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:14:52.089090 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:14:52.089767 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:14:52.093861 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:14:52.095965 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:14:52.096954 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd461ea1cd0>]}
[0m15:14:52.097987 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.06s]
[0m15:14:52.098995 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:14:52.099732 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:52.100550 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:14:52.101355 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:14:52.101797 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:52.114169 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.115008 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:52.146973 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.147780 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp151452139486"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:14:52.148295 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:52.163861 [debug] [Thread-1  ]: SQL status: SELECT 631 in 0.015 seconds
[0m15:14:52.178732 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.179337 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:14:52.180076 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:14:52.180734 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.181364 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp151452139486'
        
      order by ordinal_position

  
[0m15:14:52.194599 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m15:14:52.201170 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.201718 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:14:52.205428 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:14:52.214644 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.215215 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:14:52.219162 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:14:52.236724 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.237447 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.237942 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp151452139486"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp151452139486"
    )
  
[0m15:14:52.241492 [debug] [Thread-1  ]: SQL status: INSERT 0 631 in 0.003 seconds
[0m15:14:52.242922 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:14:52.243376 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:14:52.243776 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:14:52.245974 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:14:52.246882 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:14:52.247553 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44d08c1c0>]}
[0m15:14:52.248297 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 631[0m in 0.15s]
[0m15:14:52.249019 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:52.249600 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:14:52.250303 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:14:52.250888 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:14:52.251450 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:14:52.255026 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:14:52.256192 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:14:52.260369 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:14:52.261404 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:14:52.261894 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:14:52.262471 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:52.270015 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:14:52.270546 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:14:52.271144 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:14:52.276196 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m15:14:52.281207 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:14:52.281735 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:14:52.282587 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:52.286051 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:14:52.286548 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:14:52.287303 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:52.288932 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:14:52.289436 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:14:52.289936 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:14:52.291004 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:14:52.293886 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:14:52.294686 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:14:52.295187 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:14:52.298015 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:14:52.299552 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:14:52.300262 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6960275b-0450-48f8-8178-32cabdede329', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd461d2a7c0>]}
[0m15:14:52.301037 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:14:52.301824 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:14:52.303276 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:52.303687 [debug] [MainThread]: On master: BEGIN
[0m15:14:52.304087 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:14:52.311996 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:14:52.312595 [debug] [MainThread]: On master: COMMIT
[0m15:14:52.313177 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:52.313713 [debug] [MainThread]: On master: COMMIT
[0m15:14:52.314380 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:14:52.314956 [debug] [MainThread]: On master: Close
[0m15:14:52.315689 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:14:52.316243 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:14:52.316890 [info ] [MainThread]: 
[0m15:14:52.317375 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m15:14:52.319126 [debug] [MainThread]: Command end result
[0m15:14:52.361150 [info ] [MainThread]: 
[0m15:14:52.361827 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:14:52.362496 [info ] [MainThread]: 
[0m15:14:52.363123 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:14:52.365100 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.911238, "process_user_time": 2.943386, "process_kernel_time": 1.381589, "process_mem_max_rss": "195824", "process_in_blocks": "118728", "process_out_blocks": "2464"}
[0m15:14:52.366044 [debug] [MainThread]: Command `dbt run` succeeded at 15:14:52.365884 after 1.91 seconds
[0m15:14:52.366609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44dea6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44d0b9220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd44bd5bb50>]}
[0m15:14:52.367081 [debug] [MainThread]: Flushing usage events
[0m15:49:11.190044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb563e215b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb56267cac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb56267c460>]}


============================== 15:49:11.211792 | cb8c745a-db7f-4baf-a202-df2be075ae77 ==============================
[0m15:49:11.211792 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:49:11.212397 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:49:11.417355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb561c2a820>]}
[0m15:49:11.478255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5629b9eb0>]}
[0m15:49:11.479683 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:49:11.501578 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:49:11.766968 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:49:11.767502 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:49:11.921240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb578195490>]}
[0m15:49:12.109728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5781289d0>]}
[0m15:49:12.110512 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:49:12.110998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5783b2fd0>]}
[0m15:49:12.112988 [info ] [MainThread]: 
[0m15:49:12.113704 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:49:12.118372 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:49:12.157826 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:49:12.158347 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:49:12.158710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:49:12.167864 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.009 seconds
[0m15:49:12.169236 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:49:12.171154 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:49:12.177650 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:49:12.178067 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:49:12.178413 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:49:12.185426 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:49:12.185819 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:49:12.186181 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:49:12.191215 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:49:12.192592 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:49:12.193114 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:49:12.193753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:49:12.197749 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:49:12.198161 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:49:12.198501 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:49:12.205428 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:49:12.205841 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:49:12.206213 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:49:12.211267 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:49:12.212427 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:49:12.212916 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:49:12.218804 [debug] [MainThread]: Using postgres connection "master"
[0m15:49:12.219310 [debug] [MainThread]: On master: BEGIN
[0m15:49:12.219689 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:49:12.226770 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:49:12.227193 [debug] [MainThread]: Using postgres connection "master"
[0m15:49:12.227643 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:49:12.235753 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m15:49:12.236992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb578128e20>]}
[0m15:49:12.237545 [debug] [MainThread]: On master: ROLLBACK
[0m15:49:12.238059 [debug] [MainThread]: Using postgres connection "master"
[0m15:49:12.238440 [debug] [MainThread]: On master: BEGIN
[0m15:49:12.238999 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:49:12.239390 [debug] [MainThread]: On master: COMMIT
[0m15:49:12.239749 [debug] [MainThread]: Using postgres connection "master"
[0m15:49:12.240106 [debug] [MainThread]: On master: COMMIT
[0m15:49:12.240535 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:49:12.240911 [debug] [MainThread]: On master: Close
[0m15:49:12.241469 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:49:12.241886 [info ] [MainThread]: 
[0m15:49:12.248344 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:49:12.248971 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:49:12.249641 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:49:12.250103 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:49:12.258984 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:49:12.259631 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:49:12.298803 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:49:12.299695 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:49:12.300172 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:49:12.300562 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:49:12.308640 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:49:12.309196 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:49:12.309660 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:49:12.326681 [debug] [Thread-1  ]: Postgres adapter: Postgres error: invalid input syntax for type integer: "Exclusivité"

[0m15:49:12.327299 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:49:12.328015 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:49:12.334020 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "Exclusivité"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:49:12.335771 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb577c9b730>]}
[0m15:49:12.336528 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.09s]
[0m15:49:12.337400 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:49:12.337909 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:49:12.338653 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:49:12.339506 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:49:12.339948 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:49:12.343615 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:49:12.344220 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:49:12.349198 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:49:12.349836 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:49:12.350260 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:49:12.350638 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:49:12.358018 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:49:12.358465 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:49:12.358906 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:49:12.364956 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m15:49:12.371804 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:49:12.372269 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:49:12.373109 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:49:12.376535 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:49:12.376997 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:49:12.377794 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:49:12.397193 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:49:12.397694 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:49:12.398104 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:49:12.399548 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:49:12.406198 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:49:12.410785 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:49:12.411293 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:49:12.416169 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:49:12.418655 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:49:12.419353 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb8c745a-db7f-4baf-a202-df2be075ae77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb577cb6ac0>]}
[0m15:49:12.420054 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m15:49:12.420692 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:49:12.421200 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:49:12.421757 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:49:12.422252 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:49:12.422706 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:49:12.423277 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:49:12.423742 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:49:12.424201 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:49:12.424693 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:49:12.425177 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:49:12.425623 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:49:12.426144 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:49:12.426728 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:49:12.427239 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:49:12.427733 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:49:12.428191 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:49:12.429303 [debug] [MainThread]: Using postgres connection "master"
[0m15:49:12.429723 [debug] [MainThread]: On master: BEGIN
[0m15:49:12.430090 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:49:12.437493 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:49:12.437932 [debug] [MainThread]: On master: COMMIT
[0m15:49:12.438289 [debug] [MainThread]: Using postgres connection "master"
[0m15:49:12.438623 [debug] [MainThread]: On master: COMMIT
[0m15:49:12.439148 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:49:12.439514 [debug] [MainThread]: On master: Close
[0m15:49:12.440000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:49:12.440343 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:49:12.440775 [info ] [MainThread]: 
[0m15:49:12.441183 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.33 seconds (0.33s).
[0m15:49:12.442149 [debug] [MainThread]: Command end result
[0m15:49:12.477016 [info ] [MainThread]: 
[0m15:49:12.477606 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:49:12.477998 [info ] [MainThread]: 
[0m15:49:12.478437 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "Exclusivité"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:49:12.478801 [info ] [MainThread]: 
[0m15:49:12.479219 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:49:12.480118 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3410287, "process_user_time": 2.567958, "process_kernel_time": 0.801235, "process_mem_max_rss": "195964", "process_in_blocks": "34200", "process_out_blocks": "4672", "command_success": false}
[0m15:49:12.480747 [debug] [MainThread]: Command `dbt run` failed at 15:49:12.480648 after 1.34 seconds
[0m15:49:12.481197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb563e215b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5629b9eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb563a4e940>]}
[0m15:49:12.481616 [debug] [MainThread]: Flushing usage events
[0m14:01:46.148576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf658a7f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63f11850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63f11160>]}


============================== 14:01:46.180659 | f61d14d0-7b58-4a9a-93f1-692e024a38e7 ==============================
[0m14:01:46.180659 [info ] [MainThread]: Running with dbt=1.8.3
[0m14:01:46.181643 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:01:46.471443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf65486280>]}
[0m14:01:46.530574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf650f4400>]}
[0m14:01:46.532016 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:01:46.555378 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m14:01:46.841958 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:01:46.842508 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:01:46.982534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf79b95640>]}
[0m14:01:47.195703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf79b578e0>]}
[0m14:01:47.196374 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m14:01:47.196811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf79d85310>]}
[0m14:01:47.198444 [info ] [MainThread]: 
[0m14:01:47.199106 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:01:47.203707 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m14:01:47.244778 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m14:01:47.245302 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m14:01:47.245716 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:01:47.254829 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.009 seconds
[0m14:01:47.256255 [debug] [ThreadPool]: On list_scraping_db: Close
[0m14:01:47.258101 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m14:01:47.264769 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:01:47.265201 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m14:01:47.265578 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:01:47.275041 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m14:01:47.275695 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:01:47.276386 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:01:47.281653 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m14:01:47.283534 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m14:01:47.284425 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m14:01:47.285348 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m14:01:47.289924 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:01:47.290413 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m14:01:47.290772 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:01:47.297995 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.298413 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:01:47.298797 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m14:01:47.303665 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m14:01:47.304883 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m14:01:47.305397 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m14:01:47.311455 [debug] [MainThread]: Using postgres connection "master"
[0m14:01:47.311885 [debug] [MainThread]: On master: BEGIN
[0m14:01:47.312290 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:01:47.319450 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.319836 [debug] [MainThread]: Using postgres connection "master"
[0m14:01:47.320289 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:01:47.329253 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m14:01:47.330429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf79b57c40>]}
[0m14:01:47.330944 [debug] [MainThread]: On master: ROLLBACK
[0m14:01:47.331426 [debug] [MainThread]: Using postgres connection "master"
[0m14:01:47.331788 [debug] [MainThread]: On master: BEGIN
[0m14:01:47.332340 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:01:47.332731 [debug] [MainThread]: On master: COMMIT
[0m14:01:47.333077 [debug] [MainThread]: Using postgres connection "master"
[0m14:01:47.333398 [debug] [MainThread]: On master: COMMIT
[0m14:01:47.333847 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:01:47.334212 [debug] [MainThread]: On master: Close
[0m14:01:47.334749 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:01:47.335247 [info ] [MainThread]: 
[0m14:01:47.341821 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m14:01:47.342479 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m14:01:47.343035 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m14:01:47.343501 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m14:01:47.352293 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m14:01:47.352957 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m14:01:47.391950 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m14:01:47.392799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:01:47.393306 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m14:01:47.393728 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:01:47.401699 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:01:47.402196 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:01:47.402666 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m14:01:47.424551 [debug] [Thread-1  ]: SQL status: SELECT 255 in 0.021 seconds
[0m14:01:47.431771 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:01:47.432304 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m14:01:47.433222 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.436652 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:01:47.437107 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m14:01:47.437908 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.457939 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m14:01:47.458459 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:01:47.458883 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m14:01:47.460184 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:01:47.466728 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m14:01:47.471002 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:01:47.471465 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m14:01:47.478543 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.007 seconds
[0m14:01:47.481059 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m14:01:47.482714 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf7977d7c0>]}
[0m14:01:47.483446 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 255[0m in 0.14s]
[0m14:01:47.484338 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m14:01:47.484857 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m14:01:47.485531 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m14:01:47.486317 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m14:01:47.486790 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m14:01:47.490234 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m14:01:47.490855 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m14:01:47.494773 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m14:01:47.495409 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:01:47.495841 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m14:01:47.496240 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:01:47.503487 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.503923 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:01:47.504360 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m14:01:47.512126 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.007 seconds
[0m14:01:47.515814 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:01:47.516291 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m14:01:47.517082 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.520484 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:01:47.520922 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m14:01:47.521652 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.523046 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:01:47.523488 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:01:47.523879 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:01:47.525259 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:01:47.529143 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m14:01:47.529793 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:01:47.530228 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m14:01:47.533475 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:01:47.534822 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m14:01:47.535469 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf6487b160>]}
[0m14:01:47.536176 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m14:01:47.537021 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m14:01:47.537538 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m14:01:47.538169 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m14:01:47.538835 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m14:01:47.539286 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m14:01:47.542506 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.543127 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m14:01:47.547046 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.547685 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.548135 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m14:01:47.548520 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:01:47.555662 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.556122 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.556546 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m14:01:47.568210 [debug] [Thread-1  ]: SQL status: SELECT 2550 in 0.011 seconds
[0m14:01:47.572051 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.572536 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m14:01:47.573758 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:01:47.577134 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.577584 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m14:01:47.578415 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.580035 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m14:01:47.580542 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.580941 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m14:01:47.582874 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m14:01:47.585707 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m14:01:47.586450 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m14:01:47.586884 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m14:01:47.589904 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:01:47.591297 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m14:01:47.591960 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf636fd640>]}
[0m14:01:47.592718 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 2550[0m in 0.05s]
[0m14:01:47.593385 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m14:01:47.593867 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m14:01:47.594535 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m14:01:47.595080 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m14:01:47.595521 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m14:01:47.599801 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.600454 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m14:01:47.604354 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.604973 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.605428 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m14:01:47.605815 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:01:47.613102 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.613565 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.614018 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m14:01:47.630384 [debug] [Thread-1  ]: SQL status: SELECT 2913 in 0.016 seconds
[0m14:01:47.634093 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.634548 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m14:01:47.635386 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.638780 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.639229 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m14:01:47.639961 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.641399 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m14:01:47.641824 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.642222 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m14:01:47.644328 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m14:01:47.647131 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m14:01:47.647775 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m14:01:47.648240 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m14:01:47.651323 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:01:47.652645 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m14:01:47.653293 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf79631910>]}
[0m14:01:47.653982 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 2913[0m in 0.06s]
[0m14:01:47.654622 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m14:01:47.655112 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m14:01:47.655726 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m14:01:47.656261 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m14:01:47.656673 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m14:01:47.660070 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.660690 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m14:01:47.665513 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.666134 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.666586 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m14:01:47.666966 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:01:47.674118 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.674564 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.674987 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m14:01:47.683758 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.008 seconds
[0m14:01:47.687338 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.687779 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m14:01:47.688651 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.692258 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.692696 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m14:01:47.693410 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.694814 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m14:01:47.695247 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.695627 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m14:01:47.696793 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:01:47.699618 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m14:01:47.700293 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m14:01:47.700716 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m14:01:47.703549 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m14:01:47.704871 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m14:01:47.705492 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf7965c5e0>]}
[0m14:01:47.706172 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m14:01:47.706792 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m14:01:47.707280 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:01:47.707924 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m14:01:47.708638 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m14:01:47.709245 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:01:47.719129 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.719897 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:01:47.750778 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.751374 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp140147743721"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m14:01:47.751836 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:01:47.765067 [debug] [Thread-1  ]: SQL status: SELECT 255 in 0.013 seconds
[0m14:01:47.780324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.780975 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m14:01:47.781670 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m14:01:47.782212 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.782675 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp140147743721'
        
      order by ordinal_position

  
[0m14:01:47.803037 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.020 seconds
[0m14:01:47.809210 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.809706 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m14:01:47.813546 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m14:01:47.822542 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.823037 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m14:01:47.827082 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m14:01:47.843942 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.844688 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.845173 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp140147743721"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp140147743721"
    )
  
[0m14:01:47.850711 [debug] [Thread-1  ]: SQL status: INSERT 0 255 in 0.005 seconds
[0m14:01:47.852134 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m14:01:47.852591 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m14:01:47.852992 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m14:01:47.854377 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:01:47.855244 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m14:01:47.855894 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf7965c5e0>]}
[0m14:01:47.856622 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 255[0m in 0.15s]
[0m14:01:47.857269 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:01:47.857763 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m14:01:47.858406 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m14:01:47.858930 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m14:01:47.859341 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m14:01:47.862659 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m14:01:47.863263 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m14:01:47.867241 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m14:01:47.867872 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:01:47.868310 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m14:01:47.868684 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:01:47.875811 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.876259 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:01:47.876654 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m14:01:47.881581 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m14:01:47.886184 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:01:47.886635 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m14:01:47.887425 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.890676 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:01:47.891124 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m14:01:47.891831 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:01:47.893412 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m14:01:47.893864 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:01:47.894256 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m14:01:47.895418 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:01:47.898521 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m14:01:47.899481 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m14:01:47.899990 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m14:01:47.903048 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:01:47.904424 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m14:01:47.905064 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61d14d0-7b58-4a9a-93f1-692e024a38e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf79557880>]}
[0m14:01:47.905758 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m14:01:47.906406 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m14:01:47.907590 [debug] [MainThread]: Using postgres connection "master"
[0m14:01:47.908030 [debug] [MainThread]: On master: BEGIN
[0m14:01:47.908447 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:01:47.915622 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:01:47.916073 [debug] [MainThread]: On master: COMMIT
[0m14:01:47.916526 [debug] [MainThread]: Using postgres connection "master"
[0m14:01:47.916919 [debug] [MainThread]: On master: COMMIT
[0m14:01:47.917393 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:01:47.917794 [debug] [MainThread]: On master: Close
[0m14:01:47.918311 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:01:47.918674 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m14:01:47.919186 [info ] [MainThread]: 
[0m14:01:47.919623 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m14:01:47.921356 [debug] [MainThread]: Command end result
[0m14:01:47.957673 [info ] [MainThread]: 
[0m14:01:47.958291 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:01:47.958696 [info ] [MainThread]: 
[0m14:01:47.959109 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m14:01:47.960071 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8889233, "process_user_time": 3.136338, "process_kernel_time": 0.806711, "process_mem_max_rss": "195372", "process_in_blocks": "33872", "process_out_blocks": "4816"}
[0m14:01:47.960797 [debug] [MainThread]: Command `dbt run` succeeded at 14:01:47.960685 after 1.89 seconds
[0m14:01:47.961274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf658a7f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf648a91c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf650f4400>]}
[0m14:01:47.961739 [debug] [MainThread]: Flushing usage events
[0m14:20:20.829018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938f83bcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938dfb0910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938dfb0ac0>]}


============================== 14:20:20.834584 | 20d0e5af-1737-4bbf-90e6-810ce02d8edf ==============================
[0m14:20:20.834584 [info ] [MainThread]: Running with dbt=1.8.3
[0m14:20:20.835158 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m14:20:20.998951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938d3faaf0>]}
[0m14:20:21.056819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938d3bb610>]}
[0m14:20:21.057750 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:20:21.077805 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m14:20:21.267809 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:20:21.268373 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:20:21.407196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f93a3dff730>]}
[0m14:20:21.576475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f93a3d979d0>]}
[0m14:20:21.577145 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m14:20:21.577601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f93a3ddef70>]}
[0m14:20:21.579280 [info ] [MainThread]: 
[0m14:20:21.579947 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:20:21.584599 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m14:20:21.619348 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m14:20:21.619854 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m14:20:21.620245 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:21.629220 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.009 seconds
[0m14:20:21.630576 [debug] [ThreadPool]: On list_scraping_db: Close
[0m14:20:21.632609 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m14:20:21.639159 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:20:21.639585 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m14:20:21.639933 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:21.647244 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:20:21.647660 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:20:21.648032 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m14:20:21.653146 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m14:20:21.654429 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m14:20:21.655038 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m14:20:21.655739 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m14:20:21.658467 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:20:21.658873 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m14:20:21.659210 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:20:21.666226 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:20:21.666636 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:20:21.667015 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:20:21.671880 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m14:20:21.673277 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m14:20:21.673799 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m14:20:21.681251 [debug] [MainThread]: Using postgres connection "master"
[0m14:20:21.681674 [debug] [MainThread]: On master: BEGIN
[0m14:20:21.682024 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:20:21.689279 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:20:21.689722 [debug] [MainThread]: Using postgres connection "master"
[0m14:20:21.690157 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:20:21.696403 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m14:20:21.697694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f93a3d97d00>]}
[0m14:20:21.698264 [debug] [MainThread]: On master: ROLLBACK
[0m14:20:21.698814 [debug] [MainThread]: Using postgres connection "master"
[0m14:20:21.699204 [debug] [MainThread]: On master: BEGIN
[0m14:20:21.699872 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:20:21.700370 [debug] [MainThread]: On master: COMMIT
[0m14:20:21.700793 [debug] [MainThread]: Using postgres connection "master"
[0m14:20:21.701182 [debug] [MainThread]: On master: COMMIT
[0m14:20:21.701794 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:20:21.702268 [debug] [MainThread]: On master: Close
[0m14:20:21.702898 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:20:21.703335 [info ] [MainThread]: 
[0m14:20:21.710062 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m14:20:21.710746 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m14:20:21.711301 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m14:20:21.711737 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m14:20:21.720482 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m14:20:21.721121 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m14:20:21.760395 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m14:20:21.761221 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:20:21.761723 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m14:20:21.762133 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:20:21.769609 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:20:21.770142 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:20:21.770694 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m14:20:21.780973 [debug] [Thread-1  ]: Postgres adapter: Postgres error: invalid input syntax for type integer: "Exclusivité"

[0m14:20:21.781512 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m14:20:21.782245 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m14:20:21.790675 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "Exclusivité"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:20:21.792598 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f93a375c730>]}
[0m14:20:21.793417 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.08s]
[0m14:20:21.794159 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m14:20:21.794694 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m14:20:21.795506 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m14:20:21.796333 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m14:20:21.796859 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m14:20:21.800961 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m14:20:21.801682 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m14:20:21.807312 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m14:20:21.808046 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:20:21.808590 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m14:20:21.809013 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:20:21.816687 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:20:21.817187 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:20:21.817684 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m14:20:21.823049 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m14:20:21.830160 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:20:21.830663 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m14:20:21.831637 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m14:20:21.835307 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:20:21.835803 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m14:20:21.836762 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:20:21.856779 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:20:21.857366 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:20:21.857846 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:20:21.859469 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:20:21.866400 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m14:20:21.870853 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:20:21.871335 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m14:20:21.874846 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:20:21.877425 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m14:20:21.878133 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20d0e5af-1737-4bbf-90e6-810ce02d8edf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f93a3776610>]}
[0m14:20:21.878883 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m14:20:21.879571 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m14:20:21.880143 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m14:20:21.880721 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m14:20:21.881198 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m14:20:21.881662 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m14:20:21.882146 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m14:20:21.882635 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m14:20:21.883099 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m14:20:21.883553 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m14:20:21.884003 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m14:20:21.884489 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:20:21.884986 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m14:20:21.885616 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:20:21.886134 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m14:20:21.886584 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m14:20:21.887073 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m14:20:21.888190 [debug] [MainThread]: Using postgres connection "master"
[0m14:20:21.888648 [debug] [MainThread]: On master: BEGIN
[0m14:20:21.889023 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:20:21.896510 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:20:21.896990 [debug] [MainThread]: On master: COMMIT
[0m14:20:21.897408 [debug] [MainThread]: Using postgres connection "master"
[0m14:20:21.897808 [debug] [MainThread]: On master: COMMIT
[0m14:20:21.898367 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:20:21.898792 [debug] [MainThread]: On master: Close
[0m14:20:21.899331 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:20:21.899720 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m14:20:21.900267 [info ] [MainThread]: 
[0m14:20:21.900709 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m14:20:21.901894 [debug] [MainThread]: Command end result
[0m14:20:21.940997 [info ] [MainThread]: 
[0m14:20:21.941609 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:20:21.942127 [info ] [MainThread]: 
[0m14:20:21.942749 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "Exclusivité"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:20:21.943174 [info ] [MainThread]: 
[0m14:20:21.943736 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m14:20:21.944807 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1652925, "process_user_time": 2.441551, "process_kernel_time": 0.676429, "process_mem_max_rss": "195440", "process_in_blocks": "304", "process_out_blocks": "2312", "command_success": false}
[0m14:20:21.945472 [debug] [MainThread]: Command `dbt run` failed at 14:20:21.945360 after 1.17 seconds
[0m14:20:21.945966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938f83bcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938d3bb610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f938f51cdf0>]}
[0m14:20:21.946446 [debug] [MainThread]: Flushing usage events
[0m14:41:09.808342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1310f6a7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f130f8c2c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f130f71d970>]}


============================== 14:41:09.813971 | f5447d98-6317-4de4-a64b-4845e25fa17e ==============================
[0m14:41:09.813971 [info ] [MainThread]: Running with dbt=1.8.3
[0m14:41:09.814609 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:41:09.981805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f130f08eb20>]}
[0m14:41:10.038971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f130edff460>]}
[0m14:41:10.039950 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:41:10.059942 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m14:41:10.249569 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:41:10.250110 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:41:10.386650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1325397760>]}
[0m14:41:10.557406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13253d7a00>]}
[0m14:41:10.558129 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m14:41:10.558603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13253b1fd0>]}
[0m14:41:10.560408 [info ] [MainThread]: 
[0m14:41:10.561138 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:41:10.565691 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m14:41:10.600289 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m14:41:10.600782 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m14:41:10.601151 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:10.610083 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.009 seconds
[0m14:41:10.611420 [debug] [ThreadPool]: On list_scraping_db: Close
[0m14:41:10.613424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m14:41:10.619951 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:41:10.620421 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m14:41:10.620882 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:10.627937 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:41:10.628401 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:41:10.628853 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:41:10.633767 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m14:41:10.635236 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m14:41:10.635837 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m14:41:10.636619 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m14:41:10.640753 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:41:10.641189 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m14:41:10.641597 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:10.648574 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:41:10.648998 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:41:10.649424 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m14:41:10.654170 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m14:41:10.655398 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m14:41:10.655908 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m14:41:10.661891 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:10.662361 [debug] [MainThread]: On master: BEGIN
[0m14:41:10.662739 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:41:10.669726 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:41:10.670125 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:10.670584 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:41:10.676719 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m14:41:10.677915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13253c7760>]}
[0m14:41:10.678464 [debug] [MainThread]: On master: ROLLBACK
[0m14:41:10.678964 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:10.679356 [debug] [MainThread]: On master: BEGIN
[0m14:41:10.679884 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:41:10.680290 [debug] [MainThread]: On master: COMMIT
[0m14:41:10.680666 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:10.681014 [debug] [MainThread]: On master: COMMIT
[0m14:41:10.681441 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:41:10.681816 [debug] [MainThread]: On master: Close
[0m14:41:10.682373 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:41:10.682791 [info ] [MainThread]: 
[0m14:41:10.689119 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m14:41:10.689759 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m14:41:10.690288 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m14:41:10.690712 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m14:41:10.699435 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m14:41:10.700059 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m14:41:10.738869 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m14:41:10.739670 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:41:10.740158 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m14:41:10.740567 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:10.747900 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:41:10.748439 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:41:10.748899 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m14:41:10.757879 [debug] [Thread-1  ]: Postgres adapter: Postgres error: invalid input syntax for type integer: "Exclusivité"

[0m14:41:10.758417 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m14:41:10.759111 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m14:41:10.761393 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "Exclusivité"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:41:10.763068 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1324d5b760>]}
[0m14:41:10.763830 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.07s]
[0m14:41:10.764577 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m14:41:10.765113 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m14:41:10.765852 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m14:41:10.766621 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m14:41:10.767103 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m14:41:10.770838 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m14:41:10.771493 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m14:41:10.776579 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m14:41:10.777250 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:10.777709 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m14:41:10.778131 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:10.785373 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:41:10.785831 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:10.786276 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m14:41:10.791467 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m14:41:10.798341 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:10.798823 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m14:41:10.799654 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:41:10.803092 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:10.803567 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m14:41:10.804355 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:41:10.823764 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:41:10.824315 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:10.824799 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:41:10.828069 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m14:41:10.837137 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m14:41:10.841369 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:10.841827 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m14:41:10.844838 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:41:10.847261 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m14:41:10.847950 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5447d98-6317-4de4-a64b-4845e25fa17e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1324d76af0>]}
[0m14:41:10.848731 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m14:41:10.849409 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m14:41:10.849938 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m14:41:10.850485 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m14:41:10.850969 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m14:41:10.851422 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m14:41:10.851885 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m14:41:10.852381 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m14:41:10.852819 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m14:41:10.853267 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m14:41:10.853720 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m14:41:10.854152 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:41:10.854639 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m14:41:10.855303 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:41:10.855877 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m14:41:10.856423 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m14:41:10.856920 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m14:41:10.858129 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:10.858559 [debug] [MainThread]: On master: BEGIN
[0m14:41:10.858921 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:41:10.866042 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:41:10.866494 [debug] [MainThread]: On master: COMMIT
[0m14:41:10.866854 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:10.867200 [debug] [MainThread]: On master: COMMIT
[0m14:41:10.867641 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:41:10.868020 [debug] [MainThread]: On master: Close
[0m14:41:10.868558 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:10.868913 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m14:41:10.869349 [info ] [MainThread]: 
[0m14:41:10.869857 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m14:41:10.870996 [debug] [MainThread]: Command end result
[0m14:41:10.905622 [info ] [MainThread]: 
[0m14:41:10.906336 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:41:10.906875 [info ] [MainThread]: 
[0m14:41:10.907522 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "Exclusivité"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:41:10.908040 [info ] [MainThread]: 
[0m14:41:10.908715 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m14:41:10.909739 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1507779, "process_user_time": 2.393591, "process_kernel_time": 0.716476, "process_mem_max_rss": "195420", "process_out_blocks": "2320", "command_success": false, "process_in_blocks": "0"}
[0m14:41:10.910364 [debug] [MainThread]: Command `dbt run` failed at 14:41:10.910260 after 1.15 seconds
[0m14:41:10.910815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1310f6a7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f130edff460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1324d47bb0>]}
[0m14:41:10.911248 [debug] [MainThread]: Flushing usage events
[0m14:41:40.903334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d9ad3a0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d994b0af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d994b0880>]}


============================== 14:41:40.908927 | 145a0ef0-49cf-4974-b465-d0807b8b2b7b ==============================
[0m14:41:40.908927 [info ] [MainThread]: Running with dbt=1.8.3
[0m14:41:40.909499 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m14:41:41.070735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d98b53d30>]}
[0m14:41:41.127414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d994bf400>]}
[0m14:41:41.128355 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:41:41.148321 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m14:41:41.335507 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:41:41.336027 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:41:41.471983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1daf1d6790>]}
[0m14:41:41.640225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1daf191a30>]}
[0m14:41:41.640893 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m14:41:41.641337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1daf142220>]}
[0m14:41:41.642993 [info ] [MainThread]: 
[0m14:41:41.643656 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:41:41.648177 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m14:41:41.683379 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m14:41:41.683885 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m14:41:41.684298 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:41.693321 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.009 seconds
[0m14:41:41.694634 [debug] [ThreadPool]: On list_scraping_db: Close
[0m14:41:41.696521 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m14:41:41.703624 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:41:41.704060 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m14:41:41.704457 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:41.711558 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:41:41.711966 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:41:41.712393 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m14:41:41.717242 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m14:41:41.718435 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m14:41:41.718944 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m14:41:41.719587 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m14:41:41.722189 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:41:41.722587 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m14:41:41.722915 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:41.729953 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:41:41.730403 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:41:41.730777 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:41:41.735679 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m14:41:41.737133 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m14:41:41.737652 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m14:41:41.745483 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:41.745892 [debug] [MainThread]: On master: BEGIN
[0m14:41:41.746244 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:41:41.753230 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:41:41.753664 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:41.754082 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:41:41.760101 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m14:41:41.761256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1daf191ee0>]}
[0m14:41:41.761782 [debug] [MainThread]: On master: ROLLBACK
[0m14:41:41.762266 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:41.762640 [debug] [MainThread]: On master: BEGIN
[0m14:41:41.763158 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:41:41.763552 [debug] [MainThread]: On master: COMMIT
[0m14:41:41.763883 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:41.764224 [debug] [MainThread]: On master: COMMIT
[0m14:41:41.764645 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:41:41.764995 [debug] [MainThread]: On master: Close
[0m14:41:41.765500 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:41:41.765978 [info ] [MainThread]: 
[0m14:41:41.772652 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m14:41:41.773291 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m14:41:41.773815 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m14:41:41.774251 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m14:41:41.782900 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m14:41:41.783543 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m14:41:41.821998 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m14:41:41.822742 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:41:41.823205 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m14:41:41.823600 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:41.830845 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:41:41.831339 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:41:41.831813 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m14:41:41.839687 [debug] [Thread-1  ]: Postgres adapter: Postgres error: invalid input syntax for type integer: "2954.0"

[0m14:41:41.840163 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m14:41:41.840809 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m14:41:41.842891 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "2954.0"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:41:41.844820 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1daeb59790>]}
[0m14:41:41.845554 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.07s]
[0m14:41:41.846416 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m14:41:41.846917 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m14:41:41.847681 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m14:41:41.848518 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m14:41:41.849004 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m14:41:41.852624 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m14:41:41.853247 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m14:41:41.858146 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m14:41:41.858772 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:41.859188 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m14:41:41.859566 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:41:41.866781 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:41:41.867233 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:41.867656 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m14:41:41.873059 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m14:41:41.879693 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:41.880211 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m14:41:41.881055 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:41:41.884459 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:41.884901 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m14:41:41.885667 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:41:41.913498 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:41:41.914246 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:41.914695 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:41:41.915936 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:41:41.922693 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m14:41:41.927291 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:41:41.927754 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m14:41:41.930842 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:41:41.933274 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m14:41:41.933947 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '145a0ef0-49cf-4974-b465-d0807b8b2b7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1daede1fd0>]}
[0m14:41:41.934658 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.09s]
[0m14:41:41.935312 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m14:41:41.935798 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m14:41:41.936248 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m14:41:41.936893 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m14:41:41.937414 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m14:41:41.937941 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m14:41:41.938489 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m14:41:41.938981 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m14:41:41.939468 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m14:41:41.939996 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m14:41:41.940532 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:41:41.941159 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m14:41:41.941716 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:41:41.942202 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m14:41:41.942685 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m14:41:41.943223 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m14:41:41.944369 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:41.944808 [debug] [MainThread]: On master: BEGIN
[0m14:41:41.945166 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:41:41.952183 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:41:41.952597 [debug] [MainThread]: On master: COMMIT
[0m14:41:41.952943 [debug] [MainThread]: Using postgres connection "master"
[0m14:41:41.953288 [debug] [MainThread]: On master: COMMIT
[0m14:41:41.953725 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:41:41.954099 [debug] [MainThread]: On master: Close
[0m14:41:41.954562 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:41.954895 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m14:41:41.955320 [info ] [MainThread]: 
[0m14:41:41.955810 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m14:41:41.956947 [debug] [MainThread]: Command end result
[0m14:41:41.991338 [info ] [MainThread]: 
[0m14:41:41.991904 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:41:41.992296 [info ] [MainThread]: 
[0m14:41:41.992723 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "2954.0"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:41:41.993081 [info ] [MainThread]: 
[0m14:41:41.993437 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m14:41:41.994296 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1406105, "process_user_time": 2.372562, "process_kernel_time": 0.71775, "process_mem_max_rss": "195428", "process_out_blocks": "2312", "command_success": false, "process_in_blocks": "0"}
[0m14:41:41.994921 [debug] [MainThread]: Command `dbt run` failed at 14:41:41.994820 after 1.14 seconds
[0m14:41:41.995369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d9ad3a0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d994bf400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d9aa15e80>]}
[0m14:41:41.995784 [debug] [MainThread]: Flushing usage events
[0m14:58:03.898092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b432af0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b41a25af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b41a25880>]}


============================== 14:58:03.903606 | c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87 ==============================
[0m14:58:03.903606 [info ] [MainThread]: Running with dbt=1.8.3
[0m14:58:03.904365 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:58:03.905068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b38f0c7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b37864c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b376c1970>]}


============================== 14:58:03.910483 | 8512a217-7497-4286-a0f4-c09eb1dba879 ==============================
[0m14:58:03.910483 [info ] [MainThread]: Running with dbt=1.8.3
[0m14:58:03.911057 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:58:04.069299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b40dd1d30>]}
[0m14:58:04.072537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b36dbab20>]}
[0m14:58:04.128235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b41a23400>]}
[0m14:58:04.129247 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:58:04.130203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b36d7b460>]}
[0m14:58:04.131178 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m14:58:04.149774 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m14:58:04.151121 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m14:58:04.339452 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:58:04.339966 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:58:04.340608 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:58:04.341117 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:58:04.481511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b577fd790>]}
[0m14:58:04.483543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b4d3d5760>]}
[0m14:58:04.651765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b57798a30>]}
[0m14:58:04.652491 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m14:58:04.653108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b57744220>]}
[0m14:58:04.655151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b4d328a00>]}
[0m14:58:04.655267 [info ] [MainThread]: 
[0m14:58:04.655822 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m14:58:04.655930 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:58:04.656337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b4d3e4fd0>]}
[0m14:58:04.658094 [info ] [MainThread]: 
[0m14:58:04.658772 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:58:04.660591 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m14:58:04.663379 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m14:58:04.696192 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m14:58:04.696715 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m14:58:04.697090 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:58:04.699576 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m14:58:04.700120 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m14:58:04.700502 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:58:04.706344 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.009 seconds
[0m14:58:04.707799 [debug] [ThreadPool]: On list_scraping_db: Close
[0m14:58:04.709783 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.009 seconds
[0m14:58:04.710482 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m14:58:04.711336 [debug] [ThreadPool]: On list_scraping_db: Close
[0m14:58:04.713431 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m14:58:04.717166 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:58:04.717584 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m14:58:04.717950 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:04.721454 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:58:04.721872 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m14:58:04.722228 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:04.725091 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:58:04.725503 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:58:04.725865 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:58:04.729173 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:58:04.729608 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m14:58:04.729987 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m14:58:04.730953 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m14:58:04.732472 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m14:58:04.733022 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m14:58:04.733815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m14:58:04.735072 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m14:58:04.737048 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m14:58:04.737598 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m14:58:04.738258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m14:58:04.738690 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:58:04.739102 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m14:58:04.739467 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:04.742792 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:58:04.743217 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m14:58:04.743588 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:58:04.746441 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:58:04.746852 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:58:04.747245 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m14:58:04.750713 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m14:58:04.751161 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m14:58:04.751573 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m14:58:04.752272 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m14:58:04.753540 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m14:58:04.754068 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m14:58:04.756402 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m14:58:04.757669 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m14:58:04.758215 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m14:58:04.760369 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.760806 [debug] [MainThread]: On master: BEGIN
[0m14:58:04.761207 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:58:04.764287 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.764730 [debug] [MainThread]: On master: BEGIN
[0m14:58:04.765125 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:58:04.768736 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:58:04.769171 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.769635 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:58:04.773612 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m14:58:04.774270 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.775032 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:58:04.777161 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m14:58:04.778350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b57798ee0>]}
[0m14:58:04.778868 [debug] [MainThread]: On master: ROLLBACK
[0m14:58:04.779373 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.779738 [debug] [MainThread]: On master: BEGIN
[0m14:58:04.780299 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:58:04.780672 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.781019 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.781344 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.781540 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m14:58:04.781750 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:58:04.782115 [debug] [MainThread]: On master: Close
[0m14:58:04.782633 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:58:04.782755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b4d328bb0>]}
[0m14:58:04.783039 [info ] [MainThread]: 
[0m14:58:04.783473 [debug] [MainThread]: On master: ROLLBACK
[0m14:58:04.784052 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.784501 [debug] [MainThread]: On master: BEGIN
[0m14:58:04.785085 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m14:58:04.785526 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.785894 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.786235 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.786694 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:58:04.787086 [debug] [MainThread]: On master: Close
[0m14:58:04.787641 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:58:04.788063 [info ] [MainThread]: 
[0m14:58:04.789598 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m14:58:04.790261 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m14:58:04.790821 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m14:58:04.791284 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m14:58:04.794307 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m14:58:04.794937 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m14:58:04.795463 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m14:58:04.795892 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m14:58:04.800277 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m14:58:04.800926 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m14:58:04.804744 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m14:58:04.805369 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m14:58:04.839683 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m14:58:04.840514 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:58:04.840983 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m14:58:04.841365 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:04.844336 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m14:58:04.845086 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:58:04.845564 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m14:58:04.845961 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:04.849034 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:58:04.849518 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:58:04.849987 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m14:58:04.853956 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m14:58:04.854458 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m14:58:04.854930 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m14:58:04.857377 [debug] [Thread-1  ]: Postgres adapter: Postgres error: invalid input syntax for type integer: "3281.0"

[0m14:58:04.857908 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m14:58:04.858648 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m14:58:04.860945 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "3281.0"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:58:04.862124 [debug] [Thread-1  ]: Postgres adapter: Postgres error: invalid input syntax for type integer: "3281.0"

[0m14:58:04.862919 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m14:58:04.863264 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b571597c0>]}
[0m14:58:04.863976 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m14:58:04.864447 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.07s]
[0m14:58:04.865586 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m14:58:04.866434 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m14:58:04.867326 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "3281.0"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:58:04.867546 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m14:58:04.868675 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m14:58:04.869468 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m14:58:04.869971 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b4cd5a760>]}
[0m14:58:04.871092 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.07s]
[0m14:58:04.872203 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m14:58:04.873017 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m14:58:04.874112 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m14:58:04.875135 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m14:58:04.875588 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m14:58:04.875920 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m14:58:04.876566 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m14:58:04.882113 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m14:58:04.883063 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m14:58:04.884995 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m14:58:04.885981 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.886714 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m14:58:04.887412 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:04.891058 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m14:58:04.892023 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.892548 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m14:58:04.892953 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m14:58:04.896272 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m14:58:04.896739 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.897178 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m14:58:04.900040 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m14:58:04.900522 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.901457 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m14:58:04.902511 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m14:58:04.909288 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.909741 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m14:58:04.910585 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:58:04.914002 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.914492 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m14:58:04.915269 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m14:58:04.934675 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:58:04.935180 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.935575 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m14:58:04.937180 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m14:58:04.940955 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.039 seconds
[0m14:58:04.943943 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m14:58:04.948159 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.948254 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m14:58:04.948652 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m14:58:04.948714 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m14:58:04.950570 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_prix_m2__dbt_backup" already exists

[0m14:58:04.951033 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: ROLLBACK
[0m14:58:04.951656 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m14:58:04.952046 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m14:58:04.952101 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m14:58:04.952521 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m14:58:04.954379 [debug] [Thread-1  ]: Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m14:58:04.954480 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m14:58:04.954916 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8512a217-7497-4286-a0f4-c09eb1dba879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b4cd75af0>]}
[0m14:58:04.955152 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c065a6-2c9c-46a9-8ba4-7ed82fd3aa87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b57175580>]}
[0m14:58:04.955601 [error] [Thread-1  ]: 2 of 7 ERROR creating sql table model public.src_prix_m2 ....................... [[31mERROR[0m in 0.08s]
[0m14:58:04.955855 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.09s]
[0m14:58:04.956351 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m14:58:04.956545 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m14:58:04.957030 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m14:58:04.957089 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m14:58:04.957639 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m14:58:04.957658 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m14:58:04.958175 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m14:58:04.958179 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m14:58:04.958636 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m14:58:04.958824 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m14:58:04.959181 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m14:58:04.959411 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m14:58:04.959682 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m14:58:04.960112 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m14:58:04.960209 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m14:58:04.960660 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m14:58:04.960736 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m14:58:04.961231 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m14:58:04.961240 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m14:58:04.961704 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:58:04.961856 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m14:58:04.962371 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m14:58:04.962421 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:58:04.962886 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:58:04.963072 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m14:58:04.963373 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m14:58:04.963673 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m14:58:04.963789 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m14:58:04.964224 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m14:58:04.964315 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m14:58:04.964765 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m14:58:04.965305 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m14:58:04.965402 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.965878 [debug] [MainThread]: On master: BEGIN
[0m14:58:04.966382 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:58:04.966754 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.967301 [debug] [MainThread]: On master: BEGIN
[0m14:58:04.967671 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:58:04.973892 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:58:04.974563 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.975142 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.975149 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m14:58:04.975517 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.975549 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.975898 [debug] [MainThread]: Using postgres connection "master"
[0m14:58:04.976012 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:58:04.976281 [debug] [MainThread]: On master: COMMIT
[0m14:58:04.976443 [debug] [MainThread]: On master: Close
[0m14:58:04.976759 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m14:58:04.977128 [debug] [MainThread]: On master: Close
[0m14:58:04.977053 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:58:04.977625 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:58:04.977661 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m14:58:04.977976 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m14:58:04.978412 [info ] [MainThread]: 
[0m14:58:04.978504 [info ] [MainThread]: 
[0m14:58:04.978809 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m14:58:04.979195 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m14:58:04.979900 [debug] [MainThread]: Command end result
[0m14:58:04.980242 [debug] [MainThread]: Command end result
[0m14:58:05.018885 [info ] [MainThread]: 
[0m14:58:05.019801 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:58:05.019850 [info ] [MainThread]: 
[0m14:58:05.020495 [info ] [MainThread]: 
[0m14:58:05.020791 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m14:58:05.021282 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "3281.0"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:58:05.021473 [info ] [MainThread]: 
[0m14:58:05.021956 [info ] [MainThread]: 
[0m14:58:05.022256 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  invalid input syntax for type integer: "3281.0"
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m14:58:05.022626 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m14:58:05.022899 [info ] [MainThread]: 
[0m14:58:05.023648 [error] [MainThread]:   Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m14:58:05.024026 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1755806, "process_user_time": 2.37701, "process_kernel_time": 0.434769, "process_mem_max_rss": "195368", "process_out_blocks": "1864", "command_success": false, "process_in_blocks": "0"}
[0m14:58:05.024316 [info ] [MainThread]: 
[0m14:58:05.024969 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=5 TOTAL=7
[0m14:58:05.025062 [debug] [MainThread]: Command `dbt run` failed at 14:58:05.024898 after 1.18 seconds
[0m14:58:05.025826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b432af0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b41a23400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b42fc6e80>]}
[0m14:58:05.026360 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1703207, "process_user_time": 2.329999, "process_kernel_time": 0.448534, "process_mem_max_rss": "195416", "process_in_blocks": "24", "process_out_blocks": "1080", "command_success": false}
[0m14:58:05.026580 [debug] [MainThread]: Flushing usage events
[0m14:58:05.027328 [debug] [MainThread]: Command `dbt run` failed at 14:58:05.027173 after 1.17 seconds
[0m14:58:05.028041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b38f0c7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b36d7b460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9b4d328a00>]}
[0m14:58:05.028769 [debug] [MainThread]: Flushing usage events
[0m15:00:41.900529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf8c5e610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf73d32e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf73d34f0>]}


============================== 15:00:41.905941 | 01afde9f-b0b0-4bf4-a150-dbf8342a01f0 ==============================
[0m15:00:41.905941 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:00:41.906488 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:00:42.069467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf67c3b20>]}
[0m15:00:42.126532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf67bf4c0>]}
[0m15:00:42.127439 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:00:42.147204 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:00:42.337061 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:00:42.337874 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:00:42.676302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad0c899820>]}
[0m15:00:42.850262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad0c78ed00>]}
[0m15:00:42.850924 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:00:42.851349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad0c8b4760>]}
[0m15:00:42.853295 [info ] [MainThread]: 
[0m15:00:42.854273 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:00:42.859045 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:00:42.893292 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:00:42.893794 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:00:42.894223 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:00:42.909841 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.016 seconds
[0m15:00:42.911314 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:00:42.913348 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:00:42.920144 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:00:42.920569 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:00:42.920960 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:42.928746 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:00:42.929180 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:00:42.929597 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:00:42.934756 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:00:42.936004 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:00:42.936563 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:00:42.937243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:00:42.939927 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:00:42.940369 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:00:42.940734 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:00:42.947659 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:00:42.948067 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:00:42.948489 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:00:42.953322 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m15:00:42.954769 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:00:42.955284 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:00:42.961973 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:42.962383 [debug] [MainThread]: On master: BEGIN
[0m15:00:42.962731 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:00:42.969658 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:00:42.970047 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:42.970448 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:00:42.976360 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m15:00:42.977502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad0c7b3c10>]}
[0m15:00:42.978027 [debug] [MainThread]: On master: ROLLBACK
[0m15:00:42.978500 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:42.978863 [debug] [MainThread]: On master: BEGIN
[0m15:00:42.979361 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:00:42.979723 [debug] [MainThread]: On master: COMMIT
[0m15:00:42.980057 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:42.980393 [debug] [MainThread]: On master: COMMIT
[0m15:00:42.980785 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:00:42.981148 [debug] [MainThread]: On master: Close
[0m15:00:42.981653 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:00:42.982049 [info ] [MainThread]: 
[0m15:00:42.989024 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:00:42.989682 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:00:42.990229 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:00:42.990666 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:00:43.000226 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:00:43.000908 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:00:43.040474 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:00:43.041300 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:00:43.041803 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:00:43.042216 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:00:43.049751 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:00:43.050265 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:00:43.050748 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(REPLACE(prix_m2, ' ', '')) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:00:43.052250 [debug] [Thread-1  ]: Postgres adapter: Postgres error: function round(text) does not exist
LINE 31:     CAST(ROUND(REPLACE(prix_m2, ' ', '')) AS INTEGER) AS ad_...
                  ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:00:43.052713 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:00:43.053355 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:00:43.055431 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  function round(text) does not exist
  LINE 31:     CAST(ROUND(REPLACE(prix_m2, ' ', '')) AS INTEGER) AS ad_...
                    ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:00:43.057117 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf7e451c0>]}
[0m15:00:43.057881 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.07s]
[0m15:00:43.058584 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:00:43.059073 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:00:43.059789 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:00:43.060536 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:00:43.061015 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:00:43.064698 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:00:43.065316 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:00:43.069315 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:00:43.069952 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:00:43.070410 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:00:43.070799 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:00:43.078004 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:00:43.078494 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:00:43.078961 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:00:43.084855 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:00:43.091543 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:00:43.091994 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:00:43.092846 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:00:43.097184 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:00:43.097631 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:00:43.098445 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:00:43.118126 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:00:43.118728 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:00:43.119145 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:00:43.120724 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:00:43.127691 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:00:43.132023 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:00:43.132554 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:00:43.135853 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:00:43.138484 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:00:43.139204 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01afde9f-b0b0-4bf4-a150-dbf8342a01f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf63a3e20>]}
[0m15:00:43.139925 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m15:00:43.140638 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:00:43.141140 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:00:43.141696 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:00:43.142182 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:00:43.142625 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:00:43.143051 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:00:43.143624 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:00:43.144066 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:00:43.144603 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:00:43.145051 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:00:43.145486 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:00:43.145957 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:00:43.146636 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:00:43.147219 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:00:43.147767 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:00:43.148296 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:00:43.149558 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:43.150008 [debug] [MainThread]: On master: BEGIN
[0m15:00:43.150411 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:00:43.158393 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:00:43.158859 [debug] [MainThread]: On master: COMMIT
[0m15:00:43.159271 [debug] [MainThread]: Using postgres connection "master"
[0m15:00:43.159654 [debug] [MainThread]: On master: COMMIT
[0m15:00:43.160147 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:00:43.160554 [debug] [MainThread]: On master: Close
[0m15:00:43.161104 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:00:43.161481 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:00:43.161987 [info ] [MainThread]: 
[0m15:00:43.162434 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m15:00:43.163605 [debug] [MainThread]: Command end result
[0m15:00:43.201428 [info ] [MainThread]: 
[0m15:00:43.201997 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:00:43.202497 [info ] [MainThread]: 
[0m15:00:43.203110 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  function round(text) does not exist
  LINE 31:     CAST(ROUND(REPLACE(prix_m2, ' ', '')) AS INTEGER) AS ad_...
                    ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:00:43.203548 [info ] [MainThread]: 
[0m15:00:43.204172 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:00:43.205179 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3548449, "process_user_time": 2.55731, "process_kernel_time": 0.785315, "process_mem_max_rss": "195372", "process_in_blocks": "480", "process_out_blocks": "3424", "command_success": false}
[0m15:00:43.205827 [debug] [MainThread]: Command `dbt run` failed at 15:00:43.205720 after 1.36 seconds
[0m15:00:43.206310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf8c5e610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fad0c78ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facf63c51f0>]}
[0m15:00:43.206774 [debug] [MainThread]: Flushing usage events
[0m15:06:00.417542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573ecb27c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573d612c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573d46d970>]}


============================== 15:06:00.424670 | 6e0145cc-47ff-4631-bd6f-f93475d9df71 ==============================
[0m15:06:00.424670 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:06:00.425612 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:06:00.429954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d2ae450d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d295bb130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d295bb160>]}


============================== 15:06:00.435504 | 0bd1b3a6-0829-47a8-8e9a-dbce763d17cd ==============================
[0m15:06:00.435504 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:06:00.436108 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:06:00.600938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d289fab20>]}
[0m15:06:00.606930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573cb7ab20>]}
[0m15:06:00.657283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d29aca6a0>]}
[0m15:06:00.658213 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:06:00.664058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573c7c0460>]}
[0m15:06:00.664991 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:06:00.677885 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:06:00.684392 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:06:00.865637 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:06:00.866425 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:06:00.878108 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:06:00.878869 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:06:01.199928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d3eada790>]}
[0m15:06:01.213720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f57528dc7c0>]}
[0m15:06:01.362404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d3ea5ec70>]}
[0m15:06:01.363040 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:06:01.363461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d3eac7670>]}
[0m15:06:01.365084 [info ] [MainThread]: 
[0m15:06:01.365718 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:06:01.370181 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:06:01.376971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f575278fc70>]}
[0m15:06:01.377639 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:06:01.378103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f57528c2670>]}
[0m15:06:01.379774 [info ] [MainThread]: 
[0m15:06:01.380488 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:06:01.384993 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:06:01.404338 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:06:01.404826 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:06:01.405212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:01.414367 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.009 seconds
[0m15:06:01.415738 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:06:01.417687 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:06:01.419368 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:06:01.419872 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:06:01.420315 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:01.424327 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:06:01.424742 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:06:01.425090 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:01.429401 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.009 seconds
[0m15:06:01.430800 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:06:01.431904 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:06:01.432594 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:06:01.433253 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:06:01.433378 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:06:01.438097 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m15:06:01.439341 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:06:01.439908 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:06:01.439912 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:06:01.440396 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:06:01.440577 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:06:01.440788 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:01.444009 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:06:01.444687 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:06:01.445260 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:01.450412 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m15:06:01.451082 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:06:01.451719 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:06:01.454188 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m15:06:01.454615 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:06:01.455016 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:06:01.457063 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:06:01.458657 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:06:01.459203 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:06:01.459895 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:06:01.460107 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:06:01.461700 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:06:01.462317 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:06:01.464794 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:06:01.465211 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:06:01.465560 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:01.469368 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.469802 [debug] [MainThread]: On master: BEGIN
[0m15:06:01.470176 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:06:01.472728 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:06:01.473405 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:06:01.474056 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:06:01.478318 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:06:01.478748 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.479329 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:06:01.479219 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:06:01.480879 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:06:01.481413 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:06:01.485688 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:06:01.486915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d3e9b4a30>]}
[0m15:06:01.487446 [debug] [MainThread]: On master: ROLLBACK
[0m15:06:01.487664 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.487952 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.488168 [debug] [MainThread]: On master: BEGIN
[0m15:06:01.488364 [debug] [MainThread]: On master: BEGIN
[0m15:06:01.488611 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:06:01.488941 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:06:01.489323 [debug] [MainThread]: On master: COMMIT
[0m15:06:01.489816 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.490222 [debug] [MainThread]: On master: COMMIT
[0m15:06:01.490704 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:06:01.491097 [debug] [MainThread]: On master: Close
[0m15:06:01.491673 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:06:01.492192 [info ] [MainThread]: 
[0m15:06:01.496226 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:06:01.496658 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.497124 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:06:01.499194 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:06:01.499822 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:06:01.500512 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:06:01.500955 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:06:01.503259 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:06:01.504489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f575245ed00>]}
[0m15:06:01.505057 [debug] [MainThread]: On master: ROLLBACK
[0m15:06:01.505550 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.505930 [debug] [MainThread]: On master: BEGIN
[0m15:06:01.506455 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:06:01.506830 [debug] [MainThread]: On master: COMMIT
[0m15:06:01.507195 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.507538 [debug] [MainThread]: On master: COMMIT
[0m15:06:01.507962 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:06:01.508389 [debug] [MainThread]: On master: Close
[0m15:06:01.508939 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:06:01.509350 [info ] [MainThread]: 
[0m15:06:01.510557 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:06:01.511250 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:06:01.516299 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:06:01.516976 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:06:01.517549 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:06:01.517994 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:06:01.527520 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:06:01.528214 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:06:01.550483 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:06:01.551333 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.551851 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:06:01.552574 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.560458 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:06:01.560995 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.561494 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:06:01.566708 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:06:01.567778 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.568273 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:06:01.568661 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.570712 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.009 seconds
[0m15:06:01.575918 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:06:01.576409 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.576887 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:06:01.577955 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.578451 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:06:01.579320 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.582788 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.583269 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:06:01.584031 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.603681 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:06:01.604233 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.604688 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:06:01.608061 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m15:06:01.613920 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.036 seconds
[0m15:06:01.615885 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:06:01.620155 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.620664 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:06:01.621213 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:06:01.621698 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:06:01.622790 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_ads__dbt_backup" already exists

[0m15:06:01.623249 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:06:01.623881 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:06:01.624336 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:06:01.624759 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:06:01.625626 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m15:06:01.626988 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:06:01.628165 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:06:01.628658 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573dea2220>]}
[0m15:06:01.629402 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.11s]
[0m15:06:01.629827 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d28110490>]}
[0m15:06:01.630194 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:06:01.630594 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.13s]
[0m15:06:01.630762 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:06:01.631447 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:06:01.631580 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:06:01.631962 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:06:01.632409 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:06:01.632661 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:06:01.632897 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:06:01.633419 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:06:01.633866 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:06:01.636649 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:06:01.637276 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:06:01.637335 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:06:01.637982 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:06:01.641333 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:06:01.641972 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.642031 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:06:01.642409 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:06:01.642678 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.642785 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.643144 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:06:01.643662 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.650517 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:06:01.651194 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.651390 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:06:01.651685 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:06:01.651884 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.652413 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:06:01.657786 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:06:01.662734 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.663190 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:06:01.664000 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.667337 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.667783 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:06:01.668556 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.688417 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:06:01.688931 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.689344 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:06:01.690988 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:06:01.695342 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.042 seconds
[0m15:06:01.698737 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:06:01.699606 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.700130 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:06:01.701435 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_prix_m2__dbt_backup" already exists

[0m15:06:01.701901 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: ROLLBACK
[0m15:06:01.702590 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:06:01.703010 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:06:01.703292 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:06:01.703448 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:06:01.703760 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:06:01.706738 [debug] [Thread-1  ]: Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:06:01.707363 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d28100d00>]}
[0m15:06:01.708259 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:06:01.708279 [error] [Thread-1  ]: 2 of 7 ERROR creating sql table model public.src_prix_m2 ....................... [[31mERROR[0m in 0.07s]
[0m15:06:01.708960 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:06:01.709454 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:06:01.709994 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:06:01.710694 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:06:01.711024 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:06:01.711176 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:06:01.711709 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e0145cc-47ff-4631-bd6f-f93475d9df71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573c6a4340>]}
[0m15:06:01.712443 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m15:06:01.713210 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:06:01.713751 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:06:01.714343 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:06:01.714898 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:06:01.715429 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:06:01.715886 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.715949 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:06:01.716550 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:06:01.716555 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:06:01.717185 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:06:01.717693 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:06:01.718251 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:06:01.718757 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:06:01.719416 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:06:01.719997 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:06:01.720528 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:06:01.720713 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.720989 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:06:01.721358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.721712 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:06:01.721789 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:06:01.722172 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.722922 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.723359 [debug] [MainThread]: On master: BEGIN
[0m15:06:01.723756 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:06:01.729526 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:06:01.729980 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.730408 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:06:01.730959 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:06:01.731421 [debug] [MainThread]: On master: COMMIT
[0m15:06:01.731819 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:01.732239 [debug] [MainThread]: On master: COMMIT
[0m15:06:01.732716 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:06:01.733130 [debug] [MainThread]: On master: Close
[0m15:06:01.733671 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:06:01.734057 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:06:01.734555 [info ] [MainThread]: 
[0m15:06:01.735492 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.35 seconds (0.35s).
[0m15:06:01.736656 [debug] [MainThread]: Command end result
[0m15:06:01.744038 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.013 seconds
[0m15:06:01.749040 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.749512 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:06:01.750381 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.753715 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.754172 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:06:01.755026 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.756451 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:06:01.756890 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.757281 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:06:01.759952 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:06:01.762715 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:06:01.763356 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:06:01.763776 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:06:01.766918 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:06:01.768235 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:06:01.768872 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d2849d880>]}
[0m15:06:01.769577 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.06s]
[0m15:06:01.770235 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:06:01.770750 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:06:01.770868 [info ] [MainThread]: 
[0m15:06:01.771420 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:06:01.771404 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:06:01.771796 [info ] [MainThread]: 
[0m15:06:01.772025 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:06:01.772278 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:06:01.772651 [info ] [MainThread]: 
[0m15:06:01.772682 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:06:01.773012 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:06:01.773862 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4062232, "process_user_time": 2.592631, "process_kernel_time": 0.541448, "process_mem_max_rss": "195360", "process_out_blocks": "3432", "command_success": false, "process_in_blocks": "0"}
[0m15:06:01.774489 [debug] [MainThread]: Command `dbt run` failed at 15:06:01.774387 after 1.41 seconds
[0m15:06:01.774926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573ecb27c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573c7c0460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f573e9b2e50>]}
[0m15:06:01.775348 [debug] [MainThread]: Flushing usage events
[0m15:06:01.776532 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.777220 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:06:01.781154 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.781851 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.782313 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:06:01.782731 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.789783 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:06:01.790264 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.790738 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:06:01.817693 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.026 seconds
[0m15:06:01.822017 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.822545 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:06:01.823521 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:06:01.827888 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.828407 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:06:01.829243 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.830694 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:06:01.831168 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.831600 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:06:01.834412 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:06:01.837298 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:06:01.837990 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:06:01.838466 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:06:01.841790 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:06:01.843188 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:06:01.843840 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d2849d880>]}
[0m15:06:01.844587 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.07s]
[0m15:06:01.845311 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:06:01.845897 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:06:01.846547 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:06:01.847097 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:06:01.847603 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:06:01.850972 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.851677 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:06:01.855690 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.856409 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.856864 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:06:01.857299 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.864572 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:06:01.865092 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.865582 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:06:01.872998 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.007 seconds
[0m15:06:01.876895 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.877384 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:06:01.878359 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:06:01.881774 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.882227 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:06:01.883139 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:01.884593 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:06:01.885037 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.885420 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:06:01.886647 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:06:01.890411 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:06:01.891058 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:06:01.891478 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:06:01.895396 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:06:01.897069 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:06:01.897959 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d280d0760>]}
[0m15:06:01.898649 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:06:01.899291 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:06:01.899761 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:06:01.900575 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:06:01.901115 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:06:01.901564 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:06:01.911185 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:01.911809 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:06:01.940500 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:01.941040 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp150601934726"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:06:01.941473 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:01.954255 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.013 seconds
[0m15:06:01.968754 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:01.969247 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:06:01.969824 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:06:01.970266 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:01.970674 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp150601934726'
        
      order by ordinal_position

  
[0m15:06:01.983150 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m15:06:01.988821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:01.989299 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:06:01.992993 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:06:02.001970 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:02.002461 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:06:02.006285 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:06:02.071728 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:02.072517 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:02.073004 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp150601934726"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp150601934726"
    )
  
[0m15:06:02.075496 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m15:06:02.076899 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:06:02.077363 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:06:02.077783 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:06:02.079989 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:06:02.080809 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:06:02.081420 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d28154430>]}
[0m15:06:02.082091 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.18s]
[0m15:06:02.082743 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:06:02.083238 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:06:02.083864 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:06:02.084392 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:06:02.084796 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:06:02.088280 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:06:02.088884 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:06:02.092845 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:06:02.093472 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:06:02.093895 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:06:02.094275 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:06:02.101774 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:06:02.102229 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:06:02.102631 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:06:02.107549 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m15:06:02.111196 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:06:02.111648 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:06:02.112424 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:02.115789 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:06:02.116250 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:06:02.116950 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:06:02.118395 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:06:02.118821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:06:02.119211 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:06:02.120423 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:06:02.123374 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:06:02.124014 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:06:02.124473 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:06:02.127434 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:06:02.128747 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:06:02.129368 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bd1b3a6-0829-47a8-8e9a-dbce763d17cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d42871f40>]}
[0m15:06:02.130047 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.04s]
[0m15:06:02.130680 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:06:02.131898 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:02.132353 [debug] [MainThread]: On master: BEGIN
[0m15:06:02.132713 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:06:02.140126 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:06:02.140565 [debug] [MainThread]: On master: COMMIT
[0m15:06:02.140951 [debug] [MainThread]: Using postgres connection "master"
[0m15:06:02.141316 [debug] [MainThread]: On master: COMMIT
[0m15:06:02.141760 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:06:02.142176 [debug] [MainThread]: On master: Close
[0m15:06:02.142666 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:06:02.143038 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:06:02.143486 [info ] [MainThread]: 
[0m15:06:02.143897 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.78 seconds (0.78s).
[0m15:06:02.145414 [debug] [MainThread]: Command end result
[0m15:06:02.191019 [info ] [MainThread]: 
[0m15:06:02.191606 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:06:02.192209 [info ] [MainThread]: 
[0m15:06:02.192737 [error] [MainThread]:   Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:06:02.193155 [info ] [MainThread]: 
[0m15:06:02.193539 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m15:06:02.194436 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.8151242, "process_user_time": 2.914762, "process_kernel_time": 0.342202, "process_mem_max_rss": "195424", "process_out_blocks": "3552", "command_success": false, "process_in_blocks": "0"}
[0m15:06:02.195076 [debug] [MainThread]: Command `dbt run` failed at 15:06:02.194969 after 1.82 seconds
[0m15:06:02.195526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d3f38d910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d288e6f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d288e6d60>]}
[0m15:06:02.195957 [debug] [MainThread]: Flushing usage events
[0m15:08:35.263122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43b07867c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43af0dec40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43aef39ee0>]}


============================== 15:08:35.268543 | 8ced2cab-7226-4b12-8e52-7d6413cacea6 ==============================
[0m15:08:35.268543 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:08:35.269313 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:08:35.274348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c91f8fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c83ee1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c796f790>]}


============================== 15:08:35.279780 | 113e47e9-837f-466e-85d3-acd6e4be99e1 ==============================
[0m15:08:35.279780 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:08:35.280379 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:08:35.430646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43ae8aaaf0>]}
[0m15:08:35.442182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c731da60>]}
[0m15:08:35.487751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43aef07760>]}
[0m15:08:35.488692 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:08:35.499453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c72efaf0>]}
[0m15:08:35.500379 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:08:35.508736 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:08:35.519645 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:08:35.701457 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:08:35.701959 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:08:35.711209 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:08:35.711719 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:08:35.836538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c4dd7730>]}
[0m15:08:35.849296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd7d4400>]}
[0m15:08:36.001294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c4d289d0>]}
[0m15:08:36.001970 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:08:36.002397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c4de6f70>]}
[0m15:08:36.003998 [info ] [MainThread]: 
[0m15:08:36.004647 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:08:36.009087 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:08:36.020267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd796940>]}
[0m15:08:36.020951 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:08:36.021396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd7f0fa0>]}
[0m15:08:36.023062 [info ] [MainThread]: 
[0m15:08:36.023747 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:08:36.028443 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:08:36.043405 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:08:36.043880 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:08:36.044299 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:36.053483 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.009 seconds
[0m15:08:36.054824 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:08:36.057367 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:08:36.063526 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:08:36.063787 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:08:36.064099 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:08:36.064240 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:08:36.064485 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:36.064629 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:36.072058 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.072514 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:08:36.072884 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:08:36.073815 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.009 seconds
[0m15:08:36.075251 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:08:36.077181 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:08:36.078024 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:08:36.080336 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:08:36.081130 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:08:36.082169 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:08:36.086085 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:08:36.086741 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:08:36.087333 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:36.088689 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:08:36.089137 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:08:36.089509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:36.097292 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m15:08:36.097738 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:08:36.098137 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:08:36.098775 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m15:08:36.099422 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:08:36.100069 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:08:36.103710 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:08:36.104926 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:08:36.105197 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m15:08:36.105466 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:08:36.106097 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:08:36.106871 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:08:36.107602 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:08:36.108685 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:08:36.109109 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:08:36.109453 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:36.113677 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.114100 [debug] [MainThread]: On master: BEGIN
[0m15:08:36.114448 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:08:36.116467 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.116880 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:08:36.117283 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:08:36.121302 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.121708 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.122137 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:08:36.122374 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:08:36.124525 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:08:36.125280 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:08:36.129337 [debug] [MainThread]: SQL status: SELECT 0 in 0.007 seconds
[0m15:08:36.130494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c4d28e20>]}
[0m15:08:36.131011 [debug] [MainThread]: On master: ROLLBACK
[0m15:08:36.131524 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.131894 [debug] [MainThread]: On master: BEGIN
[0m15:08:36.132432 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:08:36.132796 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.132797 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.133134 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.133215 [debug] [MainThread]: On master: BEGIN
[0m15:08:36.133451 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.133558 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:08:36.133851 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:08:36.134224 [debug] [MainThread]: On master: Close
[0m15:08:36.134901 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:36.135332 [info ] [MainThread]: 
[0m15:08:36.140509 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.140921 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.141364 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:08:36.141753 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:08:36.142406 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:08:36.142945 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:08:36.143382 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:08:36.147432 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:08:36.148681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd785d00>]}
[0m15:08:36.149241 [debug] [MainThread]: On master: ROLLBACK
[0m15:08:36.149722 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.150083 [debug] [MainThread]: On master: BEGIN
[0m15:08:36.150614 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:08:36.150984 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.151331 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.151716 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.152189 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:08:36.152236 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:08:36.152665 [debug] [MainThread]: On master: Close
[0m15:08:36.152824 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:08:36.153221 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:36.153640 [info ] [MainThread]: 
[0m15:08:36.159737 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:08:36.160400 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:08:36.161063 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:08:36.161515 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:08:36.170089 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:08:36.170716 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:08:36.192478 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:08:36.193265 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.193752 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:08:36.194200 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.203273 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:08:36.204130 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.204995 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:08:36.216624 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.011 seconds
[0m15:08:36.221766 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:08:36.222929 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.223716 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:08:36.224438 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.227518 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.228189 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:08:36.229268 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:08:36.234076 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.234760 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:08:36.235937 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:08:36.236017 [debug] [Thread-1  ]: SQL status: BEGIN in 0.012 seconds
[0m15:08:36.236766 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.237617 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:08:36.263058 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:08:36.263593 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.264000 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:08:36.266951 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:08:36.274821 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:08:36.274748 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.036 seconds
[0m15:08:36.279740 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.280336 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:08:36.285121 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.285693 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:08:36.286340 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m15:08:36.286891 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:08:36.290172 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:08:36.290446 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.291187 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:08:36.292394 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c4a28100>]}
[0m15:08:36.292415 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:08:36.293177 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.15s]
[0m15:08:36.293908 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:08:36.294444 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:08:36.295210 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:08:36.296171 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:08:36.296640 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:08:36.300144 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:08:36.300745 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:08:36.304750 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:08:36.305398 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.305866 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:08:36.306253 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.313536 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.314044 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.314083 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:08:36.314466 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:08:36.314620 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.315072 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:08:36.316171 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.319870 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:08:36.322734 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:08:36.323472 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.323919 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:08:36.324884 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.327046 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:08:36.327500 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:08:36.328231 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.328688 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:08:36.329512 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.330952 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:08:36.331252 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:08:36.331408 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.331894 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:08:36.332936 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.334931 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:08:36.337220 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd35aeb0>]}
[0m15:08:36.337406 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:08:36.338307 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.338729 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:08:36.338412 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.17s]
[0m15:08:36.339554 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:08:36.340378 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:08:36.341377 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:08:36.341711 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:08:36.342368 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:08:36.342905 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:08:36.343426 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:08:36.344201 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43af96e220>]}
[0m15:08:36.344982 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m15:08:36.345863 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:08:36.346674 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.347017 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:08:36.347254 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:08:36.347656 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:08:36.347924 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:08:36.348422 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.352435 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.353158 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:08:36.353318 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.354147 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.354743 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:08:36.355170 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.359704 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.360737 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.361527 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:08:36.362179 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.363399 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:08:36.363969 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.364527 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:08:36.369999 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:08:36.370164 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:08:36.370496 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.370967 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:08:36.374027 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.374520 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:08:36.375341 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.378764 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.379249 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:08:36.380199 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.381644 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:08:36.382103 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.382552 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:08:36.384237 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.013 seconds
[0m15:08:36.384941 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:08:36.388245 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.388719 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:08:36.389137 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:08:36.389538 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.389783 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:08:36.390205 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:08:36.392970 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.393313 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:08:36.393417 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:08:36.394188 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.394639 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:08:36.395278 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c83dc040>]}
[0m15:08:36.395712 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:08:36.395950 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m15:08:36.396201 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.396605 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:08:36.396650 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:08:36.397191 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.397688 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.397822 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:08:36.398341 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:08:36.398754 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.400537 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:08:36.401339 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.401770 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:08:36.401985 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.402641 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.405104 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:08:36.406716 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:08:36.406764 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.407388 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.407476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c48787c0>]}
[0m15:08:36.407806 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:08:36.408312 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.408560 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.06s]
[0m15:08:36.409452 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.410014 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:08:36.410610 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:08:36.411342 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:08:36.411841 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:08:36.416636 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.417063 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:08:36.417283 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:08:36.417797 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.418494 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:08:36.421381 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.422022 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.422484 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:08:36.422868 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.430534 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:08:36.431002 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.431446 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:08:36.433291 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.014 seconds
[0m15:08:36.437939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.438425 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:08:36.439365 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:08:36.442703 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.443157 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:08:36.444025 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.445566 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:08:36.446009 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.446407 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:08:36.448839 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:08:36.451618 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:08:36.452379 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:08:36.452813 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:08:36.456713 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.025 seconds
[0m15:08:36.457597 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:08:36.459272 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:08:36.460037 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd3ab1f0>]}
[0m15:08:36.460660 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.461123 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:08:36.461140 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.06s]
[0m15:08:36.462048 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.462103 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:08:36.462695 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:08:36.463352 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:08:36.463875 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:08:36.464342 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:08:36.465547 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.466085 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:08:36.466894 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.468416 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:08:36.468727 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.468875 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.469286 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:08:36.469355 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:08:36.470570 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.473394 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.473531 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:08:36.474018 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.474243 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.474446 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:08:36.474702 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:08:36.474825 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.478589 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:08:36.480168 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:08:36.481144 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43af96e220>]}
[0m15:08:36.482077 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.07s]
[0m15:08:36.482928 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:08:36.483511 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.483981 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:08:36.484391 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:08:36.484764 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.485249 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:08:36.485630 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:08:36.485972 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.490135 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.491694 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.496785 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.497564 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.498053 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:08:36.498475 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.505578 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.506066 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.506537 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:08:36.512396 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.026 seconds
[0m15:08:36.513194 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m15:08:36.518516 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.519034 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.519308 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:08:36.519784 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:08:36.520450 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.520742 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.526116 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.526373 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.526881 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:08:36.527125 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:08:36.527939 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.528116 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.530354 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:08:36.530494 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:08:36.531116 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.531233 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.531838 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:08:36.531948 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:08:36.534864 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:08:36.535294 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m15:08:36.539658 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:08:36.540168 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:08:36.540740 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:08:36.541250 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.541499 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:08:36.541997 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:08:36.544658 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:08:36.545035 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:08:36.546747 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:08:36.547207 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:08:36.547769 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd2a3f70>]}
[0m15:08:36.548184 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43af96e220>]}
[0m15:08:36.548889 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.08s]
[0m15:08:36.549270 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.06s]
[0m15:08:36.550013 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:08:36.550373 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.550872 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.551202 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.551878 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:08:36.552228 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:08:36.552469 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:08:36.552914 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.552994 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:08:36.553439 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.556330 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.556942 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.561879 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.562506 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.563120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:08:36.563269 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.563589 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.563917 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.570825 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.571296 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.571711 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:08:36.578371 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m15:08:36.582361 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.582916 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:08:36.583766 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.587714 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.588367 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:08:36.589154 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.590830 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:08:36.591350 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.591765 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:08:36.593123 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.594897 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.595474 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp150836587853"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:08:36.595972 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.595998 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:08:36.596722 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:08:36.597309 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:08:36.600673 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:08:36.602046 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:08:36.602693 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd27f580>]}
[0m15:08:36.603402 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:08:36.604072 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:08:36.604658 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.605316 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:08:36.606031 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:08:36.606592 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.608942 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.013 seconds
[0m15:08:36.616168 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.616799 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.623388 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.623856 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:08:36.624519 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:08:36.625032 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.625511 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp150836587853'
        
      order by ordinal_position

  
[0m15:08:36.637892 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m15:08:36.643691 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.644229 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:08:36.646084 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.646610 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp150836639372"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:08:36.647047 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.648262 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m15:08:36.659635 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.660137 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:08:36.663037 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.016 seconds
[0m15:08:36.663938 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:08:36.677987 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.678488 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:08:36.679103 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:08:36.679541 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.679941 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp150836639372'
        
      order by ordinal_position

  
[0m15:08:36.680403 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.681091 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.681562 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp150836587853"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp150836587853"
    )
  
[0m15:08:36.684063 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m15:08:36.685472 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:08:36.685906 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.686299 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:08:36.688317 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:08:36.689146 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:08:36.689896 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c475a700>]}
[0m15:08:36.690982 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.14s]
[0m15:08:36.692054 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.692720 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m15:08:36.692661 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:08:36.693672 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:08:36.694486 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:08:36.695132 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:08:36.698746 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:08:36.698819 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.699342 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:08:36.699420 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:08:36.703311 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:08:36.703306 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:08:36.703912 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.704369 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:08:36.704744 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.711652 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.711983 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.712194 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:08:36.712436 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.712826 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:08:36.715969 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:08:36.717728 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m15:08:36.722297 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.722740 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:08:36.723513 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.726731 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.727175 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:08:36.727874 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.729365 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:08:36.729800 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.730187 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:08:36.731361 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.733552 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.734174 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:08:36.734328 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.734878 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp150836639372"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp150836639372"
    )
  
[0m15:08:36.734929 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.735366 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:08:36.737493 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m15:08:36.738869 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:08:36.739142 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:08:36.739356 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:08:36.739839 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:08:36.740550 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:08:36.740888 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.741337 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ced2cab-7226-4b12-8e52-7d6413cacea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c47ab820>]}
[0m15:08:36.741774 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:08:36.742466 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd1d64c0>]}
[0m15:08:36.742403 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:08:36.743270 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.14s]
[0m15:08:36.743382 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:08:36.744069 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:08:36.744715 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:08:36.744741 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.745156 [debug] [MainThread]: On master: BEGIN
[0m15:08:36.745308 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:08:36.745504 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:08:36.746003 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:08:36.746587 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:08:36.749881 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:08:36.750566 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:08:36.752824 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.753247 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.753596 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.753925 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.754360 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:08:36.754728 [debug] [MainThread]: On master: Close
[0m15:08:36.754864 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:08:36.755198 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:36.755533 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:08:36.755630 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.755956 [info ] [MainThread]: 
[0m15:08:36.756150 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:08:36.756589 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:08:36.756499 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.75 seconds (0.75s).
[0m15:08:36.758399 [debug] [MainThread]: Command end result
[0m15:08:36.767045 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m15:08:36.767504 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.767921 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:08:36.772584 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m15:08:36.777453 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.777925 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:08:36.778709 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.781906 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.782339 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:08:36.783054 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:08:36.784574 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:08:36.785027 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.785413 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:08:36.786506 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:08:36.789200 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:08:36.789923 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:08:36.790392 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:08:36.793306 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:08:36.794610 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:08:36.795228 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '113e47e9-837f-466e-85d3-acd6e4be99e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd257130>]}
[0m15:08:36.795654 [info ] [MainThread]: 
[0m15:08:36.795911 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:08:36.796334 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:08:36.796648 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:08:36.796875 [info ] [MainThread]: 
[0m15:08:36.797432 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:08:36.797898 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.798319 [debug] [MainThread]: On master: BEGIN
[0m15:08:36.798484 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5840065, "process_user_time": 2.688621, "process_kernel_time": 0.45815, "process_mem_max_rss": "195440", "process_out_blocks": "2440", "process_in_blocks": "0"}
[0m15:08:36.798658 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:08:36.799102 [debug] [MainThread]: Command `dbt run` succeeded at 15:08:36.798997 after 1.58 seconds
[0m15:08:36.799547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43b07867c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43c4600f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f43aef07760>]}
[0m15:08:36.799963 [debug] [MainThread]: Flushing usage events
[0m15:08:36.805702 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:08:36.806119 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.806468 [debug] [MainThread]: Using postgres connection "master"
[0m15:08:36.806803 [debug] [MainThread]: On master: COMMIT
[0m15:08:36.807248 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:08:36.807613 [debug] [MainThread]: On master: Close
[0m15:08:36.808107 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:36.808462 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:08:36.808891 [info ] [MainThread]: 
[0m15:08:36.809268 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m15:08:36.810742 [debug] [MainThread]: Command end result
[0m15:08:36.844829 [info ] [MainThread]: 
[0m15:08:36.845348 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:08:36.845724 [info ] [MainThread]: 
[0m15:08:36.846105 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:08:36.846940 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.6217877, "process_user_time": 2.669562, "process_kernel_time": 0.512299, "process_mem_max_rss": "195384", "process_out_blocks": "2480", "process_in_blocks": "0"}
[0m15:08:36.847542 [debug] [MainThread]: Command `dbt run` succeeded at 15:08:36.847445 after 1.62 seconds
[0m15:08:36.847973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c91f8fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8c8f06d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe8dd7852e0>]}
[0m15:08:36.848439 [debug] [MainThread]: Flushing usage events
[0m15:14:41.721864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a8b05cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a727b910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a727bac0>]}


============================== 15:14:41.727329 | aa70243a-781b-4f8f-abc8-c01677dae183 ==============================
[0m15:14:41.727329 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:14:41.727916 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:14:41.738890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40e7f0610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40cf52280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40cf52f70>]}


============================== 15:14:41.744333 | 9ad0fc23-59c3-46da-b330-12bd95ffd2a8 ==============================
[0m15:14:41.744333 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:14:41.744873 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:14:41.887371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a69baaf0>]}
[0m15:14:41.903786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40c913b20>]}
[0m15:14:41.943633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a697c610>]}
[0m15:14:41.944539 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:14:41.960147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40c8d4460>]}
[0m15:14:41.961020 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:14:41.964010 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:14:41.980354 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:14:42.151751 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:14:42.152530 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:14:42.167737 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:14:42.168515 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:14:42.483566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5bc696790>]}
[0m15:14:42.497446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe42249c790>]}
[0m15:14:42.646840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5bc661c40>]}
[0m15:14:42.647469 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:14:42.647886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5bc685e80>]}
[0m15:14:42.649529 [info ] [MainThread]: 
[0m15:14:42.650162 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:14:42.655604 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:14:42.668242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe42234fc70>]}
[0m15:14:42.668906 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:14:42.669332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe422489670>]}
[0m15:14:42.670970 [info ] [MainThread]: 
[0m15:14:42.671680 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:14:42.676203 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:14:42.693740 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:14:42.694274 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:14:42.694677 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:14:42.704287 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.010 seconds
[0m15:14:42.706423 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:14:42.709206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:14:42.715791 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:14:42.716240 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:14:42.716591 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:42.719604 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:14:42.720096 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:14:42.720499 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:14:42.723719 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.724141 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:14:42.724518 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:14:42.729169 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m15:14:42.729586 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:14:42.730494 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:14:42.730919 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:14:42.731596 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:14:42.732641 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:14:42.733042 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:14:42.737530 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:14:42.737952 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:14:42.738288 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:42.740636 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:14:42.741049 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:14:42.741399 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:42.745375 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.745788 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:14:42.746172 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:14:42.748301 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.748675 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:14:42.749025 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:14:42.751234 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:14:42.752445 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:14:42.752956 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:14:42.753946 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:14:42.755195 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:14:42.755723 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:14:42.756501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:14:42.758222 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.758666 [debug] [MainThread]: On master: BEGIN
[0m15:14:42.759025 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:14:42.759872 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:14:42.760306 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:14:42.760651 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:42.766092 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.766476 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.766881 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:14:42.767564 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.767971 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:14:42.768426 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:14:42.772961 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:14:42.773246 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m15:14:42.774083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5bba5dcd0>]}
[0m15:14:42.774594 [debug] [MainThread]: On master: ROLLBACK
[0m15:14:42.774623 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:14:42.775089 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.775144 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:14:42.775452 [debug] [MainThread]: On master: BEGIN
[0m15:14:42.776010 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:14:42.776460 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.776808 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.777142 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.777600 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:14:42.778023 [debug] [MainThread]: On master: Close
[0m15:14:42.778621 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:14:42.779263 [info ] [MainThread]: 
[0m15:14:42.782371 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.782787 [debug] [MainThread]: On master: BEGIN
[0m15:14:42.783134 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:14:42.786646 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:14:42.787437 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:14:42.787960 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:14:42.788422 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:14:42.789921 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.790296 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.790698 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:14:42.796556 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m15:14:42.797650 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:14:42.797733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe422374a60>]}
[0m15:14:42.798249 [debug] [MainThread]: On master: ROLLBACK
[0m15:14:42.798304 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:14:42.798729 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.799142 [debug] [MainThread]: On master: BEGIN
[0m15:14:42.799832 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:14:42.800252 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.800593 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.800925 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.801335 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:14:42.801687 [debug] [MainThread]: On master: Close
[0m15:14:42.802195 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:14:42.802663 [info ] [MainThread]: 
[0m15:14:42.809534 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:14:42.810192 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:14:42.810741 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:14:42.811201 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:14:42.820574 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:14:42.821198 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:14:42.836726 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:14:42.837430 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:42.837878 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:14:42.838273 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:42.845436 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.845878 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:42.846345 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:14:42.847480 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_zipcode" does not exist
LINE 30:     SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
                       ^

[0m15:14:42.847896 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:14:42.848531 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:14:42.850504 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" does not exist
  LINE 30:     SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
                         ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:14:42.852125 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a7ce91c0>]}
[0m15:14:42.852837 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m15:14:42.853501 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:14:42.853964 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:14:42.854692 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:14:42.855402 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:14:42.855837 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:14:42.859326 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:14:42.859913 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:14:42.860116 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:14:42.860795 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:42.861235 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:14:42.861617 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:42.864011 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:14:42.864699 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.865139 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:14:42.865518 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:42.868814 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.869265 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:14:42.869712 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:14:42.870898 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_zipcode" does not exist
LINE 30:     SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
                       ^

[0m15:14:42.871334 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:14:42.871990 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:14:42.872521 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.872944 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.873339 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:14:42.874084 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" does not exist
  LINE 30:     SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
                         ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:14:42.875675 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40d9d21c0>]}
[0m15:14:42.876427 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m15:14:42.877147 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:14:42.877907 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:14:42.878655 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:14:42.878850 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:14:42.879384 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:14:42.879825 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:14:42.883431 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:14:42.884052 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:14:42.885433 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.885892 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:14:42.886894 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:14:42.888239 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:14:42.888843 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.889268 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:14:42.889647 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:14:42.891162 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.891617 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:14:42.892537 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:14:42.896695 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.897157 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.897570 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:14:42.911558 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:14:42.912024 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.912472 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:14:42.914138 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:14:42.917509 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.019 seconds
[0m15:14:42.920603 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:14:42.924257 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.924708 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:14:42.924745 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:14:42.925197 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:14:42.925768 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_prix_m2__dbt_backup" already exists

[0m15:14:42.926459 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: ROLLBACK
[0m15:14:42.927452 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:14:42.928147 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:14:42.928630 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:14:42.929097 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:14:42.930040 [debug] [Thread-1  ]: Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:14:42.930560 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ad0fc23-59c3-46da-b330-12bd95ffd2a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40bcf3b50>]}
[0m15:14:42.931259 [error] [Thread-1  ]: 2 of 7 ERROR creating sql table model public.src_prix_m2 ....................... [[31mERROR[0m in 0.05s]
[0m15:14:42.931424 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:14:42.932072 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa70243a-781b-4f8f-abc8-c01677dae183', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a7ce91c0>]}
[0m15:14:42.931931 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:14:42.932812 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m15:14:42.932726 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:14:42.933534 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:14:42.933593 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:14:42.934050 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:14:42.934305 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:14:42.934595 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:14:42.934774 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:14:42.935111 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:14:42.935195 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:14:42.935624 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:14:42.935725 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:14:42.936205 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:14:42.936194 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:14:42.936693 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:14:42.936700 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:14:42.937152 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:14:42.937174 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:14:42.937581 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:42.937667 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:14:42.938236 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:14:42.938384 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:14:42.939049 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:42.939313 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:42.939997 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:14:42.940065 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:14:42.940561 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:14:42.940619 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:14:42.941081 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:14:42.941108 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:14:42.941744 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:14:42.942267 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.942356 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:14:42.942722 [debug] [MainThread]: On master: BEGIN
[0m15:14:42.943081 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:14:42.943640 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.944148 [debug] [MainThread]: On master: BEGIN
[0m15:14:42.944508 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:14:42.950155 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.950577 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.950932 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.951312 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.951351 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:14:42.951773 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.951783 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:14:42.952163 [debug] [MainThread]: Using postgres connection "master"
[0m15:14:42.952192 [debug] [MainThread]: On master: Close
[0m15:14:42.952511 [debug] [MainThread]: On master: COMMIT
[0m15:14:42.952672 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:14:42.952973 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:14:42.953021 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:14:42.953355 [debug] [MainThread]: On master: Close
[0m15:14:42.953446 [info ] [MainThread]: 
[0m15:14:42.953832 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m15:14:42.953887 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:14:42.954483 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:14:42.954784 [debug] [MainThread]: Command end result
[0m15:14:42.955195 [info ] [MainThread]: 
[0m15:14:42.955812 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m15:14:42.956852 [debug] [MainThread]: Command end result
[0m15:14:42.990537 [info ] [MainThread]: 
[0m15:14:42.991046 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:14:42.991422 [info ] [MainThread]: 
[0m15:14:42.991852 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" does not exist
  LINE 30:     SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
                         ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:14:42.992271 [info ] [MainThread]: 
[0m15:14:42.992645 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:14:42.993482 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3206309, "process_user_time": 2.46282, "process_kernel_time": 0.462276, "process_mem_max_rss": "195440", "process_out_blocks": "2960", "command_success": false, "process_in_blocks": "0"}
[0m15:14:42.994093 [debug] [MainThread]: Command `dbt run` failed at 15:14:42.993994 after 1.32 seconds
[0m15:14:42.994540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a8b05cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a697c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd5a5de3910>]}
[0m15:14:42.994958 [debug] [MainThread]: Flushing usage events
[0m15:14:42.995982 [info ] [MainThread]: 
[0m15:14:42.996575 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m15:14:42.996970 [info ] [MainThread]: 
[0m15:14:42.997590 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" does not exist
  LINE 30:     SUBSTRING(ad_zipcode, 1, 2) AS ad_zipcode,
                         ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:14:42.998055 [info ] [MainThread]: 
[0m15:14:42.998730 [error] [MainThread]:   Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:14:42.999168 [info ] [MainThread]: 
[0m15:14:42.999699 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=5 TOTAL=7
[0m15:14:43.000679 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3114424, "process_user_time": 2.613356, "process_kernel_time": 0.455724, "process_mem_max_rss": "195368", "process_out_blocks": "3080", "command_success": false, "process_in_blocks": "0"}
[0m15:14:43.001351 [debug] [MainThread]: Command `dbt run` failed at 15:14:43.001242 after 1.31 seconds
[0m15:14:43.001825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40e7f0610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40c913b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe40e505a00>]}
[0m15:14:43.002298 [debug] [MainThread]: Flushing usage events
[0m15:15:17.435244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d5834cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d3fb0910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d3fb0ac0>]}


============================== 15:15:17.441523 | d54dd8e4-6766-4aa7-aa8b-859f4b3202b4 ==============================
[0m15:15:17.441523 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:15:17.442087 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:15:17.479759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2eb9f5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2d5175e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2d8299a0>]}


============================== 15:15:17.485387 | 743838d1-9ae2-4d89-8746-9c7bbb3a1384 ==============================
[0m15:15:17.485387 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:15:17.485962 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:15:17.604376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d33faaf0>]}
[0m15:15:17.647096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2ccc3ac0>]}
[0m15:15:17.661427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d33bb610>]}
[0m15:15:17.662328 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:15:17.681702 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:15:17.704226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2c9fb2e0>]}
[0m15:15:17.705117 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:15:17.724217 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:15:17.882233 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:15:17.882990 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:15:17.910650 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:15:17.911430 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:15:18.215095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e94da790>]}
[0m15:15:18.238378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf42898760>]}
[0m15:15:18.378233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e9462c40>]}
[0m15:15:18.378883 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:15:18.379307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e94bfe80>]}
[0m15:15:18.380943 [info ] [MainThread]: 
[0m15:15:18.381586 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:15:18.386063 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:15:18.401419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf42820c10>]}
[0m15:15:18.402219 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:15:18.402661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf42888ee0>]}
[0m15:15:18.404341 [info ] [MainThread]: 
[0m15:15:18.404981 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:15:18.409468 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:15:18.419762 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:15:18.420246 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:15:18.420613 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:15:18.429798 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m15:15:18.431171 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:15:18.433222 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:15:18.439646 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:18.440069 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:15:18.440463 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:18.443250 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:15:18.443746 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:15:18.444179 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:15:18.447873 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.448335 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:18.448714 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:15:18.453099 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m15:15:18.453651 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:15:18.454488 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:15:18.454800 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:15:18.455346 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:15:18.455958 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:15:18.456648 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:15:18.458637 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:18.459037 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:15:18.459408 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:18.463023 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:18.463425 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:15:18.463769 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:18.466600 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.467022 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:18.467429 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:15:18.470920 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.471311 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:18.471668 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:15:18.472790 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:15:18.474166 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:15:18.474685 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:15:18.476884 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:15:18.478057 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:15:18.478577 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:15:18.479195 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:15:18.481732 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:18.482140 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:15:18.482472 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:18.482913 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.483364 [debug] [MainThread]: On master: BEGIN
[0m15:15:18.483719 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:15:18.489646 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.490033 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:18.490390 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:15:18.491490 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:15:18.492163 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.492904 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:15:18.496229 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:15:18.497557 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:15:18.498063 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:15:18.499290 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:15:18.500498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e93b5f10>]}
[0m15:15:18.501073 [debug] [MainThread]: On master: ROLLBACK
[0m15:15:18.501583 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.501962 [debug] [MainThread]: On master: BEGIN
[0m15:15:18.502547 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:15:18.502935 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.503276 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.503598 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.504023 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:18.504540 [debug] [MainThread]: On master: Close
[0m15:15:18.505065 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:15:18.505460 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.505475 [info ] [MainThread]: 
[0m15:15:18.505900 [debug] [MainThread]: On master: BEGIN
[0m15:15:18.506306 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:15:18.512194 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:15:18.512825 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:15:18.513301 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.513385 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:15:18.513747 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.513818 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:15:18.514185 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:15:18.520256 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:15:18.521380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf42820640>]}
[0m15:15:18.521897 [debug] [MainThread]: On master: ROLLBACK
[0m15:15:18.522369 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.522724 [debug] [MainThread]: On master: BEGIN
[0m15:15:18.523037 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:15:18.523224 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:15:18.523569 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.523700 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:15:18.523898 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.524287 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.524713 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:18.525073 [debug] [MainThread]: On master: Close
[0m15:15:18.525608 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:15:18.525996 [info ] [MainThread]: 
[0m15:15:18.532447 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:15:18.533091 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:15:18.533632 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:15:18.534104 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:15:18.543471 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:15:18.544203 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:15:18.562222 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:15:18.562979 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:18.563431 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:15:18.563810 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:18.571060 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.571525 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:18.571988 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:15:18.573362 [debug] [Thread-1  ]: Postgres adapter: Postgres error: function substring(text) does not exist
LINE 30:     SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:15:18.573809 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:15:18.574440 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:15:18.576453 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  function substring(text) does not exist
  LINE 30:     SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:18.578085 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d4a1e1c0>]}
[0m15:15:18.578801 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m15:15:18.579478 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:15:18.579962 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:15:18.580752 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:15:18.581500 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:15:18.581952 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:15:18.583049 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:15:18.583784 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:18.584278 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:15:18.584779 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:18.585450 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:15:18.586046 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:15:18.589960 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:15:18.590572 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.590998 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:15:18.591366 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:18.591970 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.592618 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:18.593119 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:15:18.594461 [debug] [Thread-1  ]: Postgres adapter: Postgres error: function substring(text) does not exist
LINE 30:     SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m15:15:18.594932 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:15:18.595575 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:15:18.597632 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  function substring(text) does not exist
  LINE 30:     SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:18.598646 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.599101 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.599407 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2dd83190>]}
[0m15:15:18.599509 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:15:18.600192 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m15:15:18.600895 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:15:18.601415 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:15:18.602193 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:15:18.602902 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:15:18.603353 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:15:18.605835 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m15:15:18.608029 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:15:18.608702 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:15:18.612550 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.612765 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:15:18.613018 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:15:18.613413 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.614030 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:15:18.614061 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:15:18.614462 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:18.618466 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.618922 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:15:18.619851 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:15:18.621852 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.622312 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.622731 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:15:18.638890 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:15:18.639353 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.639756 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:15:18.641001 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:15:18.644413 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.021 seconds
[0m15:15:18.647406 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:15:18.651019 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.651482 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:15:18.651586 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:18.652046 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:15:18.652601 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_prix_m2__dbt_backup" already exists

[0m15:15:18.653289 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: ROLLBACK
[0m15:15:18.654281 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:15:18.654938 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:15:18.655467 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:15:18.655793 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:15:18.656879 [debug] [Thread-1  ]: Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:15:18.657403 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '743838d1-9ae2-4d89-8746-9c7bbb3a1384', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2dd83190>]}
[0m15:15:18.658087 [error] [Thread-1  ]: 2 of 7 ERROR creating sql table model public.src_prix_m2 ....................... [[31mERROR[0m in 0.05s]
[0m15:15:18.658197 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:15:18.658857 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd54dd8e4-6766-4aa7-aa8b-859f4b3202b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d2b23d60>]}
[0m15:15:18.658803 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:15:18.659562 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m15:15:18.659570 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:15:18.660243 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:15:18.660418 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:15:18.660736 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:15:18.661121 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:15:18.661275 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:15:18.661591 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:15:18.661745 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:15:18.662076 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:15:18.662199 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:15:18.662530 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:15:18.662697 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:15:18.662950 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:15:18.663165 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:15:18.663419 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:15:18.663596 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:15:18.663856 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:15:18.664065 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:15:18.664317 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:18.664526 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:15:18.664915 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:15:18.664970 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:18.665378 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:18.665472 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:15:18.665819 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:15:18.666058 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:18.666369 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:15:18.666521 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:15:18.666837 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:15:18.666946 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:15:18.667451 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:15:18.667959 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.668388 [debug] [MainThread]: On master: BEGIN
[0m15:15:18.668730 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:15:18.668676 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.669104 [debug] [MainThread]: On master: BEGIN
[0m15:15:18.669597 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:15:18.675633 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.676052 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.676459 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.676692 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:15:18.676821 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.677216 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.677288 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:18.677629 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:18.677658 [debug] [MainThread]: On master: Close
[0m15:15:18.677987 [debug] [MainThread]: On master: COMMIT
[0m15:15:18.678153 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:15:18.678460 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:18.678502 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:15:18.678836 [debug] [MainThread]: On master: Close
[0m15:15:18.678919 [info ] [MainThread]: 
[0m15:15:18.679302 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m15:15:18.679382 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:15:18.679999 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:15:18.680350 [debug] [MainThread]: Command end result
[0m15:15:18.680739 [info ] [MainThread]: 
[0m15:15:18.681367 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m15:15:18.682359 [debug] [MainThread]: Command end result
[0m15:15:18.731454 [info ] [MainThread]: 
[0m15:15:18.732409 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m15:15:18.733084 [info ] [MainThread]: 
[0m15:15:18.733904 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  function substring(text) does not exist
  LINE 30:     SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:18.734577 [info ] [MainThread]: 
[0m15:15:18.734412 [info ] [MainThread]: 
[0m15:15:18.735313 [error] [MainThread]:   Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:15:18.735306 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:15:18.736122 [info ] [MainThread]: 
[0m15:15:18.736180 [info ] [MainThread]: 
[0m15:15:18.736586 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=5 TOTAL=7
[0m15:15:18.736740 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  function substring(text) does not exist
  LINE 30:     SUBSTRING(SPLIT_PART(url, '-', -2)) AS ad_zipcode,
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:18.737144 [info ] [MainThread]: 
[0m15:15:18.737481 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3126712, "process_user_time": 2.628136, "process_kernel_time": 0.436687, "process_mem_max_rss": "195376", "process_out_blocks": "3424", "command_success": false, "process_in_blocks": "0"}
[0m15:15:18.737520 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:15:18.738099 [debug] [MainThread]: Command `dbt run` failed at 15:15:18.737999 after 1.31 seconds
[0m15:15:18.738375 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3558987, "process_user_time": 2.592475, "process_kernel_time": 0.459375, "process_mem_max_rss": "195448", "process_out_blocks": "2560", "command_success": false, "process_in_blocks": "0"}
[0m15:15:18.738533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2eb9f5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2c9fb2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2e8ed820>]}
[0m15:15:18.738953 [debug] [MainThread]: Flushing usage events
[0m15:15:18.738972 [debug] [MainThread]: Command `dbt run` failed at 15:15:18.738871 after 1.36 seconds
[0m15:15:18.739423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d5834cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55e9462dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f55d2e65880>]}
[0m15:15:18.739851 [debug] [MainThread]: Flushing usage events
[0m15:15:44.919815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcd312cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcba89910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcba89ac0>]}


============================== 15:15:44.925189 | 6c0b7d7a-cef7-4640-8426-82eb3afbe474 ==============================
[0m15:15:44.925189 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:15:44.925817 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m15:15:44.939119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd886d6dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8854f0910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8854f0ac0>]}


============================== 15:15:44.944662 | 66b8d96e-ebfb-447d-b032-321f779c7a46 ==============================
[0m15:15:44.944662 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:15:44.945281 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m15:15:45.086147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcb1baaf0>]}
[0m15:15:45.106323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd884e9eaf0>]}
[0m15:15:45.142142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcb17b610>]}
[0m15:15:45.143005 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:15:45.162299 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:15:45.162784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd884bfb610>]}
[0m15:15:45.163717 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:15:45.182768 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:15:45.350835 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:15:45.351592 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:15:45.371434 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:15:45.372356 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:15:45.689504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8de0ed8790>]}
[0m15:15:45.704508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd89aad4760>]}
[0m15:15:45.856729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8de0e62c40>]}
[0m15:15:45.857382 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:15:45.857866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8de0ee6e80>]}
[0m15:15:45.859497 [info ] [MainThread]: 
[0m15:15:45.860164 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:15:45.864615 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:15:45.874785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd89aa64c40>]}
[0m15:15:45.875477 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:15:45.875950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd89aabde80>]}
[0m15:15:45.877744 [info ] [MainThread]: 
[0m15:15:45.878468 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:15:45.882994 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:15:45.897626 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:15:45.898086 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:15:45.898444 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:15:45.913970 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.015 seconds
[0m15:15:45.915321 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:15:45.916431 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:15:45.916887 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:15:45.917259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:15:45.917191 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:15:45.924278 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:45.924687 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:15:45.925059 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:45.926159 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m15:15:45.927939 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:15:45.930104 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m15:15:45.933035 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:15:45.933453 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:45.933828 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:15:45.936563 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:45.936976 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:15:45.937357 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:45.938848 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:15:45.940033 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:15:45.940586 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:15:45.941216 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:15:45.943699 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:45.944122 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:15:45.944208 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:15:45.944511 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:45.944577 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:15:45.944931 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:15:45.949770 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m15:15:45.950937 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:15:45.951350 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:15:45.951454 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:15:45.951803 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:45.952107 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m15:15:45.952467 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:15:45.954634 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:45.955033 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:15:45.955372 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:15:45.957817 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:15:45.959201 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:15:45.959707 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:15:45.962390 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:15:45.963054 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:15:45.963713 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:15:45.967316 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:45.967718 [debug] [MainThread]: On master: BEGIN
[0m15:15:45.968064 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:15:45.968960 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:15:45.970836 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:15:45.971581 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:15:45.976838 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m15:15:45.977292 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:45.977759 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:15:45.979716 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:45.980409 [debug] [MainThread]: On master: BEGIN
[0m15:15:45.981014 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:15:45.987040 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m15:15:45.988226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8de0db4fa0>]}
[0m15:15:45.988764 [debug] [MainThread]: On master: ROLLBACK
[0m15:15:45.989251 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:45.989625 [debug] [MainThread]: On master: BEGIN
[0m15:15:45.990039 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m15:15:45.990178 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:15:45.990496 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:45.990584 [debug] [MainThread]: On master: COMMIT
[0m15:15:45.990961 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:45.990921 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:15:45.991307 [debug] [MainThread]: On master: COMMIT
[0m15:15:45.991768 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:45.992181 [debug] [MainThread]: On master: Close
[0m15:15:45.992719 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:15:45.993203 [info ] [MainThread]: 
[0m15:15:45.997501 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:15:45.998636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd89a9b7fa0>]}
[0m15:15:45.999142 [debug] [MainThread]: On master: ROLLBACK
[0m15:15:45.999658 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:46.000016 [debug] [MainThread]: On master: BEGIN
[0m15:15:46.000371 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:15:46.000618 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:15:46.001091 [debug] [MainThread]: On master: COMMIT
[0m15:15:46.001041 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:15:46.001490 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:46.001612 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:15:46.001949 [debug] [MainThread]: On master: COMMIT
[0m15:15:46.002086 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:15:46.002442 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:46.002845 [debug] [MainThread]: On master: Close
[0m15:15:46.003396 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:15:46.003809 [info ] [MainThread]: 
[0m15:15:46.010368 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:15:46.011054 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:15:46.011717 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m15:15:46.012207 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:15:46.012641 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:15:46.013560 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:15:46.022417 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:15:46.023352 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:15:46.063075 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:15:46.063795 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:46.063925 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:15:46.064298 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:15:46.064691 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:46.064676 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:46.065120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:15:46.065524 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:46.072298 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:15:46.072946 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:46.073066 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:15:46.073436 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_zipcode,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:15:46.073548 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:15:46.074120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_zipcode,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:15:46.076527 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_zipcode" specified more than once

[0m15:15:46.077225 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:15:46.077279 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_zipcode" specified more than once

[0m15:15:46.077779 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:15:46.077923 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:15:46.078512 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:15:46.080480 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" specified more than once
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:46.081207 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" specified more than once
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:46.082513 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd885f5e1c0>]}
[0m15:15:46.082837 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcc4f51c0>]}
[0m15:15:46.083283 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.07s]
[0m15:15:46.083569 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.08s]
[0m15:15:46.083952 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:15:46.084487 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:15:46.084554 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:15:46.085075 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:15:46.085228 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:15:46.085619 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:15:46.085920 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:15:46.086466 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:15:46.086541 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:15:46.087155 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:15:46.090042 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:15:46.090645 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:15:46.090721 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:15:46.091328 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:15:46.094632 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:15:46.095245 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.095326 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:15:46.095676 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:15:46.095958 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.096054 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:46.096420 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:15:46.096954 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:15:46.104124 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:15:46.104856 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.105541 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:15:46.105632 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m15:15:46.106120 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.106579 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:15:46.111490 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:15:46.118565 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.119036 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:15:46.119919 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:15:46.124668 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.125130 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:15:46.125928 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:15:46.150333 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:15:46.150888 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.151310 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:15:46.152671 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:15:46.155946 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.049 seconds
[0m15:15:46.159726 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:15:46.163376 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.163945 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:15:46.163995 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:15:46.164546 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:15:46.165252 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_prix_m2__dbt_backup" already exists

[0m15:15:46.165798 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: ROLLBACK
[0m15:15:46.166548 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:15:46.166994 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:15:46.167451 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:15:46.168100 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:15:46.168805 [debug] [Thread-1  ]: Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:15:46.169373 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c0b7d7a-cef7-4640-8426-82eb3afbe474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dca5e9e80>]}
[0m15:15:46.170306 [error] [Thread-1  ]: 2 of 7 ERROR creating sql table model public.src_prix_m2 ....................... [[31mERROR[0m in 0.08s]
[0m15:15:46.170733 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:15:46.171183 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:15:46.171559 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66b8d96e-ebfb-447d-b032-321f779c7a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8842a3d00>]}
[0m15:15:46.171973 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:15:46.172347 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.09s]
[0m15:15:46.172888 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:15:46.173134 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:15:46.173641 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:15:46.173863 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:15:46.174188 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:15:46.174455 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:15:46.174696 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:15:46.175013 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:15:46.175170 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:15:46.175612 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:15:46.175592 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:15:46.176094 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:15:46.176133 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:15:46.176614 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:15:46.176750 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:15:46.177051 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:46.177235 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:15:46.177543 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:15:46.177748 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:15:46.178136 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:46.178363 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:15:46.178732 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:15:46.178829 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:46.179254 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:15:46.179363 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:15:46.179727 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:15:46.180075 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:15:46.180625 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:15:46.180965 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:46.181145 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:15:46.181403 [debug] [MainThread]: On master: BEGIN
[0m15:15:46.181620 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:15:46.181752 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:15:46.182832 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:46.183268 [debug] [MainThread]: On master: BEGIN
[0m15:15:46.183616 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:15:46.188887 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:15:46.189314 [debug] [MainThread]: On master: COMMIT
[0m15:15:46.189698 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:46.190067 [debug] [MainThread]: On master: COMMIT
[0m15:15:46.190583 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:46.190902 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:15:46.191210 [debug] [MainThread]: On master: Close
[0m15:15:46.191530 [debug] [MainThread]: On master: COMMIT
[0m15:15:46.191746 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:15:46.192129 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:15:46.192092 [debug] [MainThread]: Using postgres connection "master"
[0m15:15:46.192576 [info ] [MainThread]: 
[0m15:15:46.192664 [debug] [MainThread]: On master: COMMIT
[0m15:15:46.193057 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.33 seconds (0.33s).
[0m15:15:46.193360 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:15:46.193943 [debug] [MainThread]: On master: Close
[0m15:15:46.194444 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:15:46.194794 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:15:46.194624 [debug] [MainThread]: Command end result
[0m15:15:46.195226 [info ] [MainThread]: 
[0m15:15:46.195636 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m15:15:46.196871 [debug] [MainThread]: Command end result
[0m15:15:46.243591 [info ] [MainThread]: 
[0m15:15:46.244287 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m15:15:46.244845 [info ] [MainThread]: 
[0m15:15:46.245506 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" specified more than once
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:46.245938 [info ] [MainThread]: 
[0m15:15:46.246598 [error] [MainThread]:   Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:15:46.247047 [info ] [MainThread]: 
[0m15:15:46.247638 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=5 TOTAL=7
[0m15:15:46.247867 [info ] [MainThread]: 
[0m15:15:46.248609 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:15:46.248780 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3787876, "process_user_time": 2.524027, "process_kernel_time": 0.487233, "process_mem_max_rss": "195372", "process_out_blocks": "3432", "command_success": false, "process_in_blocks": "0"}
[0m15:15:46.249102 [info ] [MainThread]: 
[0m15:15:46.249600 [debug] [MainThread]: Command `dbt run` failed at 15:15:46.249479 after 1.38 seconds
[0m15:15:46.249727 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_zipcode" specified more than once
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:15:46.250165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcd312cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcc524280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8dcb1baaf0>]}
[0m15:15:46.250311 [info ] [MainThread]: 
[0m15:15:46.250828 [debug] [MainThread]: Flushing usage events
[0m15:15:46.250929 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:15:46.252157 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.363546, "process_user_time": 2.507657, "process_kernel_time": 0.467936, "process_mem_max_rss": "195444", "process_out_blocks": "2536", "command_success": false, "process_in_blocks": "0"}
[0m15:15:46.253038 [debug] [MainThread]: Command `dbt run` failed at 15:15:46.252886 after 1.36 seconds
[0m15:15:46.253705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd886d6dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd89aa64c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd89aa6e310>]}
[0m15:15:46.254363 [debug] [MainThread]: Flushing usage events
[0m15:16:16.489746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f10821987c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1080af0c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1080a0c970>]}


============================== 15:16:16.495100 | 36c793bb-62b6-455c-bbdb-fa714f871780 ==============================
[0m15:16:16.495100 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:16:16.495649 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m15:16:16.503443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f092efcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f07a65910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f07a65ac0>]}


============================== 15:16:16.508837 | d1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185 ==============================
[0m15:16:16.508837 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:16:16.509396 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:16:16.658144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f10802bcb20>]}
[0m15:16:16.672095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f071baaf0>]}
[0m15:16:16.714826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f107fffb490>]}
[0m15:16:16.715716 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:16:16.729519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f0717b610>]}
[0m15:16:16.730399 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:16:16.735288 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:16:16.749691 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:16:16.923913 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:16:16.924701 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:16:16.940757 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:16:16.941521 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m15:16:17.256359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1095ed8790>]}
[0m15:16:17.279762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f1ced9760>]}
[0m15:16:17.421791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1095e60c70>]}
[0m15:16:17.422797 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:16:17.423678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1095ec1670>]}
[0m15:16:17.426351 [info ] [MainThread]: 
[0m15:16:17.427203 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:16:17.434672 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:16:17.446274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f1ce61c40>]}
[0m15:16:17.446963 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:16:17.447446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f1cec1e80>]}
[0m15:16:17.449251 [info ] [MainThread]: 
[0m15:16:17.449957 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:16:17.454676 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:16:17.469360 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:16:17.469891 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:16:17.470306 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:16:17.482777 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.012 seconds
[0m15:16:17.485072 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:16:17.487289 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:16:17.490133 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:16:17.490630 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:16:17.491015 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:16:17.494037 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:16:17.494451 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:16:17.494826 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:16:17.502028 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:16:17.502460 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:16:17.502864 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:16:17.503355 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.012 seconds
[0m15:16:17.504836 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:16:17.506744 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:16:17.508844 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m15:16:17.511234 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:16:17.512012 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:16:17.513119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:16:17.515425 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:16:17.516094 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:16:17.516700 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:16:17.518773 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:16:17.519255 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:16:17.519839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:16:17.526690 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m15:16:17.527370 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:16:17.527786 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:16:17.529338 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m15:16:17.529774 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:16:17.530170 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:16:17.534544 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m15:16:17.536103 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:16:17.536179 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.006 seconds
[0m15:16:17.536888 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:16:17.537956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:16:17.538223 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:16:17.538913 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:16:17.543208 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:16:17.543613 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:16:17.543954 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:16:17.544993 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.545409 [debug] [MainThread]: On master: BEGIN
[0m15:16:17.545750 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:16:17.551162 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:16:17.551631 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:16:17.552054 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:16:17.555958 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m15:16:17.556699 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.557483 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:16:17.557494 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:16:17.558759 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:16:17.559280 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:16:17.566623 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m15:16:17.567525 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.567945 [debug] [MainThread]: On master: BEGIN
[0m15:16:17.568426 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:16:17.568681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1095a5cd00>]}
[0m15:16:17.569549 [debug] [MainThread]: On master: ROLLBACK
[0m15:16:17.570324 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.570979 [debug] [MainThread]: On master: BEGIN
[0m15:16:17.571772 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:16:17.572410 [debug] [MainThread]: On master: COMMIT
[0m15:16:17.572989 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.573571 [debug] [MainThread]: On master: COMMIT
[0m15:16:17.574249 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:16:17.574854 [debug] [MainThread]: On master: Close
[0m15:16:17.575683 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:16:17.576345 [info ] [MainThread]: 
[0m15:16:17.578809 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m15:16:17.579469 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.580254 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:16:17.584127 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:16:17.584774 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:16:17.585322 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:16:17.585744 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:16:17.586647 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:16:17.588699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f1c25dcd0>]}
[0m15:16:17.589535 [debug] [MainThread]: On master: ROLLBACK
[0m15:16:17.590310 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.590938 [debug] [MainThread]: On master: BEGIN
[0m15:16:17.591759 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:16:17.592486 [debug] [MainThread]: On master: COMMIT
[0m15:16:17.593114 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.593730 [debug] [MainThread]: On master: COMMIT
[0m15:16:17.594437 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:16:17.595065 [debug] [MainThread]: On master: Close
[0m15:16:17.595960 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:16:17.596675 [info ] [MainThread]: 
[0m15:16:17.601510 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:16:17.602514 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:16:17.606969 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:16:17.608001 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:16:17.608917 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:16:17.609674 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:16:17.626002 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:16:17.626999 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:16:17.670401 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:16:17.671599 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.672413 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:16:17.673146 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:17.684372 [debug] [Thread-1  ]: SQL status: BEGIN in 0.011 seconds
[0m15:16:17.685146 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.685993 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:16:17.690185 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:16:17.691886 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.692423 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:16:17.692879 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:17.695194 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.008 seconds
[0m15:16:17.701030 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:16:17.701502 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.701958 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:16:17.703296 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.704026 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:16:17.705311 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:16:17.708803 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.709253 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:16:17.709996 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.729280 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:16:17.729740 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.730137 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:16:17.732905 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:16:17.740760 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.038 seconds
[0m15:16:17.742658 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:16:17.746779 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.747237 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:16:17.747986 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:16:17.748940 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:16:17.750323 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_ads__dbt_backup" already exists

[0m15:16:17.750753 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:16:17.751371 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:16:17.751778 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:16:17.752328 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:16:17.752712 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m15:16:17.754687 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:16:17.755112 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:16:17.756799 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f107f68d490>]}
[0m15:16:17.756802 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f084d31c0>]}
[0m15:16:17.757519 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.17s]
[0m15:16:17.757868 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.15s]
[0m15:16:17.758223 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:16:17.758763 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:16:17.758834 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:16:17.759359 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:16:17.759425 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:16:17.760070 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:16:17.760212 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:16:17.760827 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:16:17.760944 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:16:17.761404 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:16:17.764222 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:16:17.764811 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:16:17.764946 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:16:17.765536 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:16:17.768747 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:16:17.769461 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.769859 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:16:17.769906 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:16:17.770309 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:17.770478 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.771040 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:16:17.771659 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:17.777983 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:16:17.778473 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.778947 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:16:17.781887 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m15:16:17.782645 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.783395 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:16:17.785270 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m15:16:17.789108 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.789579 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:16:17.790400 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.793752 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.794217 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:16:17.794960 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.796406 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:16:17.796866 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.797487 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:16:17.798990 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:16:17.801890 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:16:17.802182 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.018 seconds
[0m15:16:17.802556 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.803016 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:16:17.806121 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:16:17.807417 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.807474 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:16:17.807921 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:16:17.808138 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f10967f1ac0>]}
[0m15:16:17.809027 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m15:16:17.809032 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:16:17.809719 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:16:17.810283 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:16:17.810891 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:16:17.811404 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:16:17.811826 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:16:17.814601 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.815292 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:16:17.816158 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.816401 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.816756 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:16:17.820872 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.821533 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.822116 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:16:17.822576 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:17.831105 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:16:17.831760 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.832459 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:16:17.846779 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:16:17.847620 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.848337 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:16:17.850694 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:16:17.852064 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.019 seconds
[0m15:16:17.855790 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.856271 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:16:17.857235 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:16:17.858051 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:16:17.860597 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.861057 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:16:17.861975 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:16:17.862524 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:16:17.862997 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:16:17.863362 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:16:17.863795 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.864211 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:16:17.865741 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:16:17.866400 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:16:17.868548 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:16:17.868889 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:16:17.869188 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:16:17.869556 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b3f0f0-68d7-4b9d-9c5c-b3fef6ace185', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f06ce2310>]}
[0m15:16:17.869604 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:16:17.870420 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.11s]
[0m15:16:17.871498 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:16:17.872322 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:16:17.873103 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:16:17.873616 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:16:17.873779 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:16:17.874250 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:16:17.874745 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:16:17.874914 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:16:17.875235 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:16:17.875661 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1081371220>]}
[0m15:16:17.875951 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:16:17.876392 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.06s]
[0m15:16:17.876744 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:16:17.877052 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:16:17.877537 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:16:17.877481 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:16:17.878103 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:16:17.878165 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:16:17.878666 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:16:17.878666 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:16:17.879096 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:16:17.879331 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:16:17.879843 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:16:17.880381 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:16:17.880849 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:16:17.881999 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.882329 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.882413 [debug] [MainThread]: On master: BEGIN
[0m15:16:17.882762 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:16:17.882919 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:16:17.887734 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.888405 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.888850 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:16:17.889261 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:17.889889 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:16:17.890466 [debug] [MainThread]: On master: COMMIT
[0m15:16:17.890832 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:17.891178 [debug] [MainThread]: On master: COMMIT
[0m15:16:17.891646 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:16:17.892057 [debug] [MainThread]: On master: Close
[0m15:16:17.892613 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:16:17.892988 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:16:17.893474 [info ] [MainThread]: 
[0m15:16:17.893908 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.44 seconds (0.44s).
[0m15:16:17.895052 [debug] [MainThread]: Command end result
[0m15:16:17.896367 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:16:17.896846 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.897338 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:16:17.921326 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.023 seconds
[0m15:16:17.925285 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.925747 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:16:17.926598 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.929920 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.930368 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:16:17.931210 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.932724 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:16:17.933166 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.933548 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:16:17.934643 [info ] [MainThread]: 
[0m15:16:17.935247 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:16:17.935743 [info ] [MainThread]: 
[0m15:16:17.936411 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:16:17.936409 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:16:17.936819 [info ] [MainThread]: 
[0m15:16:17.937377 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:16:17.938725 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4844561, "process_user_time": 2.751271, "process_kernel_time": 0.27188, "process_mem_max_rss": "195416", "process_out_blocks": "3416", "command_success": false, "process_in_blocks": "0"}
[0m15:16:17.939471 [debug] [MainThread]: Command `dbt run` failed at 15:16:17.939362 after 1.49 seconds
[0m15:16:17.939531 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:16:17.939920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f092efcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f071baaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9f09005df0>]}
[0m15:16:17.940390 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:16:17.940432 [debug] [MainThread]: Flushing usage events
[0m15:16:17.940887 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:16:17.943981 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:16:17.945379 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:16:17.946041 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1081371220>]}
[0m15:16:17.946762 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.07s]
[0m15:16:17.947607 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:16:17.948153 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:16:17.948792 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:16:17.949446 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:16:17.949877 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:16:17.953186 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.953766 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:16:17.957768 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.958377 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.958824 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:16:17.959210 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:17.966216 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:16:17.966658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.967111 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:16:17.975940 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.008 seconds
[0m15:16:17.980360 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.980855 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:16:17.981640 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.984801 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.985245 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:16:17.985941 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:17.987378 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:16:17.987827 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.988261 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:16:17.989355 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:16:17.991973 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:16:17.992638 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:16:17.993057 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:16:17.995694 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:16:17.997091 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:16:17.997733 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1095aa7580>]}
[0m15:16:17.998395 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:16:17.999190 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:16:17.999693 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:16:18.000367 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:16:18.001004 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:16:18.001458 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:16:18.010811 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.011422 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:16:18.039340 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.039835 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp151618033729"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:16:18.040304 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:18.052798 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.012 seconds
[0m15:16:18.067922 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.068418 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:16:18.069080 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:16:18.069548 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.069970 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp151618033729'
        
      order by ordinal_position

  
[0m15:16:18.082336 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m15:16:18.133920 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.134456 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:16:18.138440 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m15:16:18.146559 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.147045 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:16:18.150847 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:16:18.167379 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.168075 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.168558 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp151618033729"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp151618033729"
    )
  
[0m15:16:18.170976 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m15:16:18.172315 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:16:18.172754 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:16:18.173150 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:16:18.175238 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:16:18.176045 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:16:18.176683 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f107f6b13d0>]}
[0m15:16:18.177365 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.18s]
[0m15:16:18.178040 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:16:18.178535 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:16:18.179082 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:16:18.179689 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:16:18.180146 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:16:18.183283 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:16:18.183882 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:16:18.187810 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:16:18.188442 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:16:18.188857 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:16:18.189231 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:16:18.196209 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:16:18.196650 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:16:18.197069 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:16:18.201859 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m15:16:18.205337 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:16:18.205779 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:16:18.206542 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:18.210592 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:16:18.211041 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:16:18.211760 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:16:18.213251 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:16:18.213679 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:16:18.214065 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:16:18.215051 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:16:18.217653 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:16:18.218384 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:16:18.218808 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:16:18.221601 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:16:18.222863 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:16:18.223467 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36c793bb-62b6-455c-bbdb-fa714f871780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f107f718fa0>]}
[0m15:16:18.224138 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.04s]
[0m15:16:18.224773 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:16:18.226001 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:18.226392 [debug] [MainThread]: On master: BEGIN
[0m15:16:18.226727 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:16:18.233751 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:16:18.234173 [debug] [MainThread]: On master: COMMIT
[0m15:16:18.234523 [debug] [MainThread]: Using postgres connection "master"
[0m15:16:18.234851 [debug] [MainThread]: On master: COMMIT
[0m15:16:18.235318 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:16:18.235690 [debug] [MainThread]: On master: Close
[0m15:16:18.236241 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:16:18.236821 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:16:18.237542 [info ] [MainThread]: 
[0m15:16:18.238181 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m15:16:18.239701 [debug] [MainThread]: Command end result
[0m15:16:18.274258 [info ] [MainThread]: 
[0m15:16:18.274773 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:16:18.275155 [info ] [MainThread]: 
[0m15:16:18.275533 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:16:18.276393 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.835666, "process_user_time": 2.921519, "process_kernel_time": 0.509981, "process_mem_max_rss": "195368", "process_out_blocks": "3552", "process_in_blocks": "0"}
[0m15:16:18.277001 [debug] [MainThread]: Command `dbt run` succeeded at 15:16:18.276904 after 1.84 seconds
[0m15:16:18.277441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f107fffb490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1081e72e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f107f6a8f40>]}
[0m15:16:18.277863 [debug] [MainThread]: Flushing usage events
[0m15:17:03.441787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd42d0c0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd41481af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd41481880>]}


============================== 15:17:03.447173 | d652e769-a9c1-4509-a389-8a147a941761 ==============================
[0m15:17:03.447173 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:17:03.443051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4ce8d5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4b7c55e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4bb179a0>]}
[0m15:17:03.447898 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}


============================== 15:17:03.448411 | c8f0038c-6b81-423d-ad9f-91a27879015c ==============================
[0m15:17:03.448411 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:17:03.448986 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:17:03.610711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4ad5aac0>]}
[0m15:17:03.610713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd40b17d30>]}
[0m15:17:03.666928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4a9fb2b0>]}
[0m15:17:03.667297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd4148f400>]}
[0m15:17:03.667838 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:17:03.668208 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:17:03.687437 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:17:03.687571 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:17:03.884905 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:17:03.885408 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:17:03.889026 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:17:03.889524 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:17:04.037463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd571aa790>]}
[0m15:17:04.039791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda61397700>]}
[0m15:17:04.229657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd571d8a30>]}
[0m15:17:04.230362 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:17:04.230830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd57145220>]}
[0m15:17:04.232620 [info ] [MainThread]: 
[0m15:17:04.233344 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:17:04.237016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda613289a0>]}
[0m15:17:04.237683 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:17:04.238146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda613a6fa0>]}
[0m15:17:04.238236 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:17:04.239821 [info ] [MainThread]: 
[0m15:17:04.240525 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:17:04.245040 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:17:04.272771 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:17:04.273246 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:17:04.273638 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:04.279652 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:17:04.280117 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:17:04.280515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:04.282548 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m15:17:04.283845 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:17:04.285715 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:17:04.291280 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.011 seconds
[0m15:17:04.292649 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:17:04.293706 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:17:04.294345 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:17:04.294495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:17:04.294917 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:04.300895 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:17:04.301315 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:17:04.301692 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:04.301914 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.302300 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:17:04.302659 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:17:04.307717 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:17:04.308705 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.309102 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:17:04.309185 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:17:04.309609 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:17:04.309656 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:17:04.310222 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:17:04.314569 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:17:04.314668 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:17:04.314969 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:17:04.315311 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:04.316282 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:17:04.316817 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:17:04.317494 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:17:04.321288 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:17:04.321684 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:17:04.322054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:04.322073 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.322464 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:17:04.322870 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:17:04.327844 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:17:04.328947 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.329006 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:17:04.329363 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:17:04.329498 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:17:04.329793 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:17:04.334832 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:17:04.335072 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.335488 [debug] [MainThread]: On master: BEGIN
[0m15:17:04.335832 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:17:04.336115 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:17:04.336783 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:17:04.342510 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.342869 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.342924 [debug] [MainThread]: On master: BEGIN
[0m15:17:04.343267 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:17:04.343287 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.343714 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:17:04.352201 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m15:17:04.352858 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m15:17:04.353300 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.353425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd571d8ee0>]}
[0m15:17:04.353725 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:17:04.353982 [debug] [MainThread]: On master: ROLLBACK
[0m15:17:04.354521 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.354913 [debug] [MainThread]: On master: BEGIN
[0m15:17:04.355460 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:17:04.355858 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.356275 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.356648 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.357091 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:17:04.357472 [debug] [MainThread]: On master: Close
[0m15:17:04.358031 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:17:04.358449 [info ] [MainThread]: 
[0m15:17:04.359937 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:17:04.361147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda61328df0>]}
[0m15:17:04.361657 [debug] [MainThread]: On master: ROLLBACK
[0m15:17:04.362174 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.362548 [debug] [MainThread]: On master: BEGIN
[0m15:17:04.363105 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:17:04.363518 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.363863 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.364239 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.364651 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:17:04.364705 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:17:04.365071 [debug] [MainThread]: On master: Close
[0m15:17:04.365292 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:17:04.365846 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:17:04.365668 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:17:04.366332 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:17:04.366333 [info ] [MainThread]: 
[0m15:17:04.372856 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:17:04.373486 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:17:04.373998 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:17:04.374439 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:17:04.375022 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:17:04.375682 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:17:04.383314 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:17:04.383925 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:17:04.414600 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:17:04.415388 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.415898 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:17:04.416357 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.422932 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:17:04.423586 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.423678 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.424063 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.424176 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:17:04.424579 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.424563 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:17:04.431751 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.432250 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.432725 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:17:04.434056 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.009 seconds
[0m15:17:04.441572 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.442034 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:17:04.442823 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.446211 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.446657 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:17:04.447409 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.467311 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:17:04.467773 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.468196 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:17:04.471251 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m15:17:04.477563 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.044 seconds
[0m15:17:04.478568 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:17:04.482831 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.483296 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:17:04.484518 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:17:04.484990 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:17:04.486048 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_ads__dbt_backup" already exists

[0m15:17:04.486484 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:17:04.487109 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:17:04.487519 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:17:04.487936 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:17:04.487922 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:17:04.490288 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:17:04.490307 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:17:04.491896 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4c071190>]}
[0m15:17:04.491944 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd56e27190>]}
[0m15:17:04.492616 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.12s]
[0m15:17:04.492719 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.13s]
[0m15:17:04.493329 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:17:04.493428 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:17:04.493854 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:17:04.493975 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:17:04.494585 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:17:04.494652 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:17:04.495407 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:17:04.495498 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:17:04.495909 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:17:04.496223 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:17:04.500374 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:17:04.501067 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:17:04.501393 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:17:04.502277 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:17:04.505110 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:17:04.505821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.506289 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:17:04.506716 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.508525 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:17:04.509429 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.510191 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:17:04.510920 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.514457 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:17:04.514939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.515418 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:17:04.520749 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:17:04.520913 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m15:17:04.521410 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.521842 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:17:04.524559 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.525058 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:17:04.525930 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.529236 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.529714 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:17:04.530503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.550144 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:17:04.550640 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.551085 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:17:04.552345 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:17:04.555577 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.033 seconds
[0m15:17:04.558803 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:17:04.559541 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.560008 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:17:04.561098 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_prix_m2__dbt_backup" already exists

[0m15:17:04.561552 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: ROLLBACK
[0m15:17:04.562174 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:17:04.562581 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:17:04.562988 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:17:04.563304 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:17:04.563808 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:17:04.566126 [debug] [Thread-1  ]: Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:17:04.566960 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd56b5a760>]}
[0m15:17:04.567845 [error] [Thread-1  ]: 2 of 7 ERROR creating sql table model public.src_prix_m2 ....................... [[31mERROR[0m in 0.07s]
[0m15:17:04.567961 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:17:04.568579 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:17:04.569066 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:17:04.569741 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:17:04.570278 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:17:04.570688 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:17:04.570774 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:17:04.571447 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8f0038c-6b81-423d-ad9f-91a27879015c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda60d78d00>]}
[0m15:17:04.572175 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m15:17:04.572844 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:17:04.573386 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:17:04.573864 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:17:04.574495 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:17:04.574997 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:17:04.575205 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.575498 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:17:04.575814 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:17:04.576213 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:17:04.576711 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:17:04.577208 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:17:04.577752 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:17:04.578257 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:17:04.578768 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:17:04.579396 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:17:04.579890 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:17:04.580406 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:17:04.580927 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:17:04.580988 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.581683 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.582231 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.582402 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:17:04.582911 [debug] [MainThread]: On master: BEGIN
[0m15:17:04.583110 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.583562 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:17:04.590704 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:17:04.590928 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.591224 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.591431 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.591794 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.591808 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:17:04.592201 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.592922 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:17:04.593548 [debug] [MainThread]: On master: Close
[0m15:17:04.594358 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:17:04.594949 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:17:04.595684 [info ] [MainThread]: 
[0m15:17:04.596389 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.36 seconds (0.36s).
[0m15:17:04.597871 [debug] [MainThread]: Command end result
[0m15:17:04.612227 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.020 seconds
[0m15:17:04.616176 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.616653 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:17:04.617659 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:17:04.620916 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.621367 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:17:04.622390 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m15:17:04.623910 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:17:04.624444 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.624844 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:17:04.627258 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:17:04.630034 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:17:04.630660 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:17:04.631084 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:17:04.635092 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m15:17:04.636411 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:17:04.637045 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd56c790a0>]}
[0m15:17:04.637732 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.07s]
[0m15:17:04.638565 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:17:04.639063 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:17:04.639698 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:17:04.640371 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:17:04.640800 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:17:04.641999 [info ] [MainThread]: 
[0m15:17:04.642572 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:17:04.642966 [info ] [MainThread]: 
[0m15:17:04.643402 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:17:04.643762 [info ] [MainThread]: 
[0m15:17:04.644121 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.644182 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:17:04.644755 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:17:04.645091 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2514231, "process_user_time": 2.393083, "process_kernel_time": 0.512515, "process_mem_max_rss": "195360", "process_out_blocks": "2320", "command_success": false, "process_in_blocks": "0"}
[0m15:17:04.645725 [debug] [MainThread]: Command `dbt run` failed at 15:17:04.645623 after 1.25 seconds
[0m15:17:04.646181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4ce8d5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4a9fb2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fda4cb6fa00>]}
[0m15:17:04.646601 [debug] [MainThread]: Flushing usage events
[0m15:17:04.648773 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.649459 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.649898 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:17:04.650301 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.657632 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.658095 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.658519 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:17:04.682302 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.023 seconds
[0m15:17:04.686996 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.687465 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:17:04.688333 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.691570 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.692013 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:17:04.692773 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.694263 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:17:04.694711 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.695135 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:17:04.697944 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:17:04.700655 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:17:04.701366 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:17:04.701787 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:17:04.704738 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:17:04.706031 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:17:04.706643 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd56b5a760>]}
[0m15:17:04.707333 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.07s]
[0m15:17:04.708187 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:17:04.708674 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:17:04.709303 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:17:04.709957 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:17:04.710395 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:17:04.713621 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.714225 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:17:04.718144 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.718742 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.719162 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:17:04.719532 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.726536 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.726985 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.727396 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:17:04.734570 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.007 seconds
[0m15:17:04.738018 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.738464 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:17:04.739350 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.743290 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.743736 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:17:04.744523 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.745929 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:17:04.746364 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.746746 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:17:04.747884 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:17:04.750666 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:17:04.751290 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:17:04.751699 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:17:04.754510 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:17:04.755770 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:17:04.756402 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd56c790a0>]}
[0m15:17:04.757074 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:17:04.757907 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:17:04.758397 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:17:04.759140 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:17:04.759797 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:17:04.760317 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:17:04.769623 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.770258 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:17:04.798212 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.798706 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp151704792623"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:17:04.799142 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.811552 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.012 seconds
[0m15:17:04.826181 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.826670 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:17:04.827308 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:17:04.827777 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.828221 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp151704792623'
        
      order by ordinal_position

  
[0m15:17:04.840478 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m15:17:04.846868 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.847346 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:17:04.851169 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:17:04.859039 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.859502 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:17:04.863145 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:17:04.879333 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.879985 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.880489 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp151704792623"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp151704792623"
    )
  
[0m15:17:04.882912 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m15:17:04.884245 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:17:04.884689 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:17:04.885097 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:17:04.886954 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:17:04.887766 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:17:04.888517 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd56c790a0>]}
[0m15:17:04.889585 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.13s]
[0m15:17:04.890573 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:17:04.891234 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:17:04.892218 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:17:04.893004 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:17:04.893631 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:17:04.896785 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:17:04.897376 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:17:04.901208 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:17:04.901803 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:17:04.902222 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:17:04.902602 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:17:04.909673 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.910106 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:17:04.910503 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:17:04.915033 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m15:17:04.918429 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:17:04.918877 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:17:04.919631 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.923034 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:17:04.923480 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:17:04.924196 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:17:04.926515 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:17:04.926961 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:17:04.927354 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:17:04.928417 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:17:04.931012 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:17:04.931699 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:17:04.932158 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:17:04.934996 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:17:04.936266 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:17:04.936857 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd652e769-a9c1-4509-a389-8a147a941761', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd56c0cd60>]}
[0m15:17:04.937514 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.04s]
[0m15:17:04.938161 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:17:04.939307 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.939712 [debug] [MainThread]: On master: BEGIN
[0m15:17:04.940112 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:17:04.947143 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:17:04.947548 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.947905 [debug] [MainThread]: Using postgres connection "master"
[0m15:17:04.948281 [debug] [MainThread]: On master: COMMIT
[0m15:17:04.948717 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:17:04.949096 [debug] [MainThread]: On master: Close
[0m15:17:04.949559 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:17:04.949922 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:17:04.950347 [info ] [MainThread]: 
[0m15:17:04.950726 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m15:17:04.952253 [debug] [MainThread]: Command end result
[0m15:17:05.030255 [info ] [MainThread]: 
[0m15:17:05.030861 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:17:05.031257 [info ] [MainThread]: 
[0m15:17:05.031697 [error] [MainThread]:   Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m15:17:05.032070 [info ] [MainThread]: 
[0m15:17:05.032484 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m15:17:05.033359 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6406502, "process_user_time": 2.651268, "process_kernel_time": 0.427237, "process_mem_max_rss": "195428", "process_out_blocks": "2464", "command_success": false, "process_in_blocks": "0"}
[0m15:17:05.033988 [debug] [MainThread]: Command `dbt run` failed at 15:17:05.033885 after 1.64 seconds
[0m15:17:05.034436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd429fde80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd407e2ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd571450d0>]}
[0m15:17:05.034851 [debug] [MainThread]: Flushing usage events
[0m15:19:43.486034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c68dc55b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c6773d5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c67a4f9a0>]}


============================== 15:19:43.491367 | d8757d10-5f8d-43b0-9ef3-1c5e58c9856f ==============================
[0m15:19:43.491367 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:19:43.492097 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:19:43.492378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b341220d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b3289aaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b3289a880>]}


============================== 15:19:43.497600 | dddc938d-6ae7-4107-9dd9-de53fa626dea ==============================
[0m15:19:43.497600 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:19:43.498166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:19:43.654540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c66ee7ac0>]}
[0m15:19:43.659919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b31f0ed30>]}
[0m15:19:43.711994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c66ea22e0>]}
[0m15:19:43.712928 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:19:43.716901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b3289d400>]}
[0m15:19:43.717790 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:19:43.733142 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:19:43.737261 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:19:43.922710 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:19:43.923226 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:19:43.926690 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:19:43.927264 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:19:44.060610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c7d3d5700>]}
[0m15:19:44.064454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b485d7790>]}
[0m15:19:44.227277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c7d3979a0>]}
[0m15:19:44.227928 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:19:44.228381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c7d3f1fa0>]}
[0m15:19:44.230047 [info ] [MainThread]: 
[0m15:19:44.230698 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:19:44.231115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b48596a30>]}
[0m15:19:44.231782 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:19:44.232236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b48545220>]}
[0m15:19:44.233824 [info ] [MainThread]: 
[0m15:19:44.234475 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:19:44.235150 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:19:44.238880 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:19:44.269663 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:19:44.270156 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:19:44.270522 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:19:44.273826 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:19:44.274312 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:19:44.274710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:19:44.279616 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m15:19:44.281115 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:19:44.283464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:19:44.283620 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m15:19:44.285078 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:19:44.287410 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:19:44.289930 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:19:44.290345 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:19:44.290686 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:44.294317 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:19:44.294728 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:19:44.295122 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:44.297701 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.298140 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:19:44.298525 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:19:44.302041 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.302467 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:19:44.302847 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:19:44.303634 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:19:44.305029 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:19:44.305547 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:19:44.306172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:19:44.307849 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:19:44.309303 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:19:44.309811 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:19:44.310496 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:19:44.310540 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:19:44.310982 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:19:44.311379 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:44.314446 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:19:44.314842 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:19:44.315225 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:44.318366 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.318994 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:19:44.319622 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:19:44.323247 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m15:19:44.323654 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:19:44.324030 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:19:44.325096 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m15:19:44.326279 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:19:44.326780 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:19:44.328760 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m15:19:44.329952 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:19:44.330461 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:19:44.332541 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.332952 [debug] [MainThread]: On master: BEGIN
[0m15:19:44.333299 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:19:44.337110 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.337787 [debug] [MainThread]: On master: BEGIN
[0m15:19:44.338369 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:19:44.342592 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m15:19:44.343249 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.343995 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:19:44.346617 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m15:19:44.347022 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.347451 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:19:44.350220 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m15:19:44.351429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c7d397df0>]}
[0m15:19:44.351984 [debug] [MainThread]: On master: ROLLBACK
[0m15:19:44.352519 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.352921 [debug] [MainThread]: On master: BEGIN
[0m15:19:44.353369 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m15:19:44.353470 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:19:44.353933 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.354339 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.354541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b48596ee0>]}
[0m15:19:44.354704 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.355059 [debug] [MainThread]: On master: ROLLBACK
[0m15:19:44.355190 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:19:44.355618 [debug] [MainThread]: On master: Close
[0m15:19:44.355585 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.356008 [debug] [MainThread]: On master: BEGIN
[0m15:19:44.356204 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:19:44.356670 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:19:44.356741 [info ] [MainThread]: 
[0m15:19:44.357360 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.357996 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.358614 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.359344 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:19:44.359972 [debug] [MainThread]: On master: Close
[0m15:19:44.360859 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:19:44.361561 [info ] [MainThread]: 
[0m15:19:44.365915 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:19:44.366553 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:19:44.367157 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:19:44.367657 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:19:44.369145 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:19:44.369758 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:19:44.370282 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:19:44.370705 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:19:44.377456 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:19:44.378230 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:19:44.379285 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:19:44.379878 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:19:44.417265 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:19:44.418093 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.418168 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:19:44.418606 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:19:44.418866 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.419166 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.419317 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:19:44.419703 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.426591 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.426628 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.427095 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.427112 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.427568 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:19:44.427636 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:19:44.436742 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.009 seconds
[0m15:19:44.443938 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.444463 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:19:44.445370 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.448780 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.449235 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:19:44.450045 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.470147 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:19:44.470796 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.471219 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:19:44.474714 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m15:19:44.480519 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.052 seconds
[0m15:19:44.481267 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:19:44.485555 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.486008 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:19:44.487770 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:19:44.488315 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:19:44.489405 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_ads__dbt_backup" already exists

[0m15:19:44.489849 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m15:19:44.490480 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m15:19:44.491002 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m15:19:44.491122 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m15:19:44.491452 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:19:44.493579 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:19:44.493807 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:19:44.495473 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c67fa9190>]}
[0m15:19:44.495902 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b4822a190>]}
[0m15:19:44.496228 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.13s]
[0m15:19:44.496958 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:19:44.496874 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.12s]
[0m15:19:44.497496 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:19:44.497767 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:19:44.498286 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:19:44.498258 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:19:44.498826 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:19:44.499006 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:19:44.499553 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:19:44.499586 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:19:44.500235 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:19:44.503611 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:19:44.503933 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:19:44.504248 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:19:44.504712 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:19:44.508209 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:19:44.508548 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:19:44.508844 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.509297 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:19:44.509295 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.509707 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.509709 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:19:44.510081 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.517040 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.517163 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.517514 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.517622 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.517950 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:19:44.518095 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:19:44.523490 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:19:44.527949 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.528512 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:19:44.529378 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.532943 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.533487 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:19:44.534340 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.535837 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:19:44.536322 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.536710 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:19:44.538156 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:19:44.541406 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.023 seconds
[0m15:19:44.542004 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:19:44.542649 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.543074 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:19:44.545230 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.545707 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:19:44.546285 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:19:44.546558 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.547766 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:19:44.548563 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b31b818b0>]}
[0m15:19:44.549558 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m15:19:44.550080 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.550596 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:19:44.550794 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:19:44.551296 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:19:44.551946 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.552271 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:19:44.552987 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:19:44.553477 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:19:44.557424 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.558062 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:19:44.562753 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.563561 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.564060 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:19:44.564598 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.571854 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.572388 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.572850 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:19:44.575245 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:19:44.575756 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.576192 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:19:44.577387 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:19:44.584349 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:19:44.586113 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.013 seconds
[0m15:19:44.588766 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:19:44.589318 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:19:44.591408 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.591914 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:19:44.592806 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.593097 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:19:44.595531 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:19:44.596212 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.596320 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8757d10-5f8d-43b0-9ef3-1c5e58c9856f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c7cd77d00>]}
[0m15:19:44.596667 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:19:44.597422 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.597385 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.10s]
[0m15:19:44.598366 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:19:44.598964 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:19:44.599032 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:19:44.599511 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.599524 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m15:19:44.599924 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:19:44.600000 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:19:44.600485 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:19:44.600941 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m15:19:44.600980 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:19:44.601465 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:19:44.601914 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:19:44.602360 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m15:19:44.602800 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:19:44.603227 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:19:44.603704 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m15:19:44.603817 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:19:44.604334 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:19:44.604616 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:19:44.604807 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:19:44.605087 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:19:44.605269 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m15:19:44.605716 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:19:44.606846 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.607245 [debug] [MainThread]: On master: BEGIN
[0m15:19:44.607585 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:19:44.608312 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:19:44.610016 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:19:44.610964 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b480738b0>]}
[0m15:19:44.612020 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.06s]
[0m15:19:44.613073 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:19:44.613836 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:19:44.614789 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:19:44.615591 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:19:44.616288 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:19:44.618539 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m15:19:44.619220 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.619865 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.620535 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.621094 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:19:44.621489 [debug] [MainThread]: On master: Close
[0m15:19:44.621837 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.622091 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:19:44.622696 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m15:19:44.622759 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:19:44.623432 [info ] [MainThread]: 
[0m15:19:44.624338 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.39 seconds (0.39s).
[0m15:19:44.625708 [debug] [MainThread]: Command end result
[0m15:19:44.628185 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.628824 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.629274 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:19:44.629660 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.636919 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.637365 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.637802 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:19:44.663631 [info ] [MainThread]: 
[0m15:19:44.664241 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.026 seconds
[0m15:19:44.664323 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:19:44.664891 [info ] [MainThread]: 
[0m15:19:44.665535 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m15:19:44.666062 [info ] [MainThread]: 
[0m15:19:44.666716 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m15:19:44.667737 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2304996, "process_user_time": 2.33338, "process_kernel_time": 0.503978, "process_mem_max_rss": "195356", "process_out_blocks": "2352", "command_success": false, "process_in_blocks": "0"}
[0m15:19:44.667933 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.668394 [debug] [MainThread]: Command `dbt run` failed at 15:19:44.668284 after 1.23 seconds
[0m15:19:44.668447 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:19:44.668845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c68dc55b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c66ea22e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c68adda00>]}
[0m15:19:44.669284 [debug] [MainThread]: Flushing usage events
[0m15:19:44.669309 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.672920 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.673391 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:19:44.674207 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.675666 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:19:44.676245 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.676895 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:19:44.679988 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:19:44.683432 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:19:44.684314 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:19:44.684912 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:19:44.688615 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:19:44.690110 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:19:44.690770 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b48226640>]}
[0m15:19:44.691493 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.08s]
[0m15:19:44.692258 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:19:44.692932 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:19:44.693549 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:19:44.694362 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:19:44.694794 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:19:44.698256 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.698869 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:19:44.703703 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.704358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.704786 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:19:44.705166 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.713145 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m15:19:44.713605 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.714022 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:19:44.721312 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.007 seconds
[0m15:19:44.724828 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.725280 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:19:44.726075 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.729322 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.729763 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:19:44.730599 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.731994 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:19:44.732462 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.732848 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:19:44.733970 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:19:44.736699 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:19:44.737335 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:19:44.737756 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:19:44.741219 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:19:44.742984 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:19:44.743933 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b480ab340>]}
[0m15:19:44.744683 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:19:44.745586 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:19:44.746157 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:19:44.746940 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:19:44.747950 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:19:44.748493 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:19:44.759190 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.759962 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:19:44.789191 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.789738 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp151944782628"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:19:44.790227 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.802799 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.013 seconds
[0m15:19:44.818658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.819182 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:19:44.819790 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:19:44.820286 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.820738 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp151944782628'
        
      order by ordinal_position

  
[0m15:19:44.833111 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m15:19:44.838837 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.839355 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:19:44.843062 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:19:44.851031 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.851540 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:19:44.855175 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:19:44.871370 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.872147 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.872669 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp151944782628"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp151944782628"
    )
  
[0m15:19:44.875071 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m15:19:44.876412 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:19:44.876889 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:19:44.877345 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:19:44.879516 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:19:44.880377 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:19:44.881017 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b4807b250>]}
[0m15:19:44.881724 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.13s]
[0m15:19:44.882583 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:19:44.883107 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:19:44.883731 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:19:44.884399 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:19:44.884867 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:19:44.887964 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:19:44.888583 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:19:44.892477 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:19:44.893094 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:19:44.893522 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:19:44.893889 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:19:44.900939 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.901367 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:19:44.901769 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:19:44.906381 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m15:19:44.910686 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:19:44.911139 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:19:44.911910 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.915013 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:19:44.915447 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:19:44.916152 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:19:44.917586 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:19:44.918041 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:19:44.918424 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:19:44.919429 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:19:44.922063 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:19:44.922777 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:19:44.923235 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:19:44.926225 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:19:44.927507 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:19:44.928131 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dddc938d-6ae7-4107-9dd9-de53fa626dea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b47fac880>]}
[0m15:19:44.928797 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.04s]
[0m15:19:44.929634 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:19:44.930801 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.931206 [debug] [MainThread]: On master: BEGIN
[0m15:19:44.931542 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:19:44.938359 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:19:44.938761 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.939111 [debug] [MainThread]: Using postgres connection "master"
[0m15:19:44.939445 [debug] [MainThread]: On master: COMMIT
[0m15:19:44.939872 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:19:44.940287 [debug] [MainThread]: On master: Close
[0m15:19:44.940753 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:19:44.941101 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:19:44.941519 [info ] [MainThread]: 
[0m15:19:44.942017 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m15:19:44.943731 [debug] [MainThread]: Command end result
[0m15:19:44.977590 [info ] [MainThread]: 
[0m15:19:44.978114 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:19:44.978505 [info ] [MainThread]: 
[0m15:19:44.978887 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:19:44.979734 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5361829, "process_user_time": 2.591071, "process_kernel_time": 0.433182, "process_mem_max_rss": "195432", "process_out_blocks": "1936", "process_in_blocks": "0"}
[0m15:19:44.980373 [debug] [MainThread]: Command `dbt run` succeeded at 15:19:44.980267 after 1.54 seconds
[0m15:19:44.980800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b341220d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b33e19e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7b48596bb0>]}
[0m15:19:44.981221 [debug] [MainThread]: Flushing usage events
[0m15:21:43.020825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35e77f0610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35e5f652e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35e5f654f0>]}


============================== 15:21:43.026341 | 648c419e-0ad3-485d-863b-ad80c3228c98 ==============================
[0m15:21:43.026341 [info ] [MainThread]: Running with dbt=1.8.3
[0m15:21:43.026915 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:21:43.189360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35e58dcb20>]}
[0m15:21:43.246455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35e58d04f0>]}
[0m15:21:43.247386 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m15:21:43.270797 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m15:21:43.462999 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:21:43.463543 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:21:43.598963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fbdaa7c0>]}
[0m15:21:43.767095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fbce8a60>]}
[0m15:21:43.767752 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m15:21:43.768216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fbd061c0>]}
[0m15:21:43.769872 [info ] [MainThread]: 
[0m15:21:43.770529 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m15:21:43.774961 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m15:21:43.809424 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m15:21:43.809909 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m15:21:43.810287 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:21:43.825662 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.015 seconds
[0m15:21:43.827053 [debug] [ThreadPool]: On list_scraping_db: Close
[0m15:21:43.829019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m15:21:43.835533 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:21:43.835957 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m15:21:43.836365 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:43.843388 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:21:43.843801 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m15:21:43.844218 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m15:21:43.849455 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m15:21:43.850839 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m15:21:43.851358 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m15:21:43.851987 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m15:21:43.855865 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:21:43.856315 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m15:21:43.856661 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:43.863476 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m15:21:43.863876 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m15:21:43.864297 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m15:21:43.868938 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m15:21:43.870069 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m15:21:43.870553 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m15:21:43.876205 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:43.876620 [debug] [MainThread]: On master: BEGIN
[0m15:21:43.876998 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:21:43.883827 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:21:43.884259 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:43.884711 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m15:21:43.890630 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m15:21:43.891769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fbce8f10>]}
[0m15:21:43.892325 [debug] [MainThread]: On master: ROLLBACK
[0m15:21:43.892825 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:43.893208 [debug] [MainThread]: On master: BEGIN
[0m15:21:43.893733 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m15:21:43.894133 [debug] [MainThread]: On master: COMMIT
[0m15:21:43.894493 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:43.894837 [debug] [MainThread]: On master: COMMIT
[0m15:21:43.895319 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:21:43.895694 [debug] [MainThread]: On master: Close
[0m15:21:43.896257 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:21:43.896657 [info ] [MainThread]: 
[0m15:21:43.902795 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m15:21:43.903435 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m15:21:43.903956 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m15:21:43.904423 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m15:21:43.913064 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m15:21:43.913702 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m15:21:43.952196 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m15:21:43.952950 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:21:43.953417 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m15:21:43.953803 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:43.961065 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:21:43.961554 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:21:43.962044 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m15:21:43.970646 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.008 seconds
[0m15:21:43.977366 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:21:43.977862 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m15:21:43.978688 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:43.982072 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:21:43.982550 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m15:21:43.983366 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.003198 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:21:44.003684 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:21:44.004145 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m15:21:44.006989 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:21:44.013504 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m15:21:44.017802 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m15:21:44.018288 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m15:21:44.021522 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:21:44.023978 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m15:21:44.025670 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb9e81c0>]}
[0m15:21:44.026414 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.12s]
[0m15:21:44.027096 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m15:21:44.027625 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m15:21:44.028329 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m15:21:44.029041 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m15:21:44.029502 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m15:21:44.033128 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m15:21:44.033773 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m15:21:44.037698 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m15:21:44.038405 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:21:44.038906 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m15:21:44.039331 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:44.046769 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:21:44.047242 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:21:44.047685 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m15:21:44.053348 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m15:21:44.057039 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:21:44.057512 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m15:21:44.058404 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.061872 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:21:44.062344 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m15:21:44.063229 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.064694 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:21:44.065153 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:21:44.065579 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m15:21:44.066719 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:21:44.070553 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m15:21:44.071229 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m15:21:44.071676 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m15:21:44.074513 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:21:44.075851 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m15:21:44.076538 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb71a790>]}
[0m15:21:44.077241 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m15:21:44.077974 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m15:21:44.078496 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m15:21:44.079151 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m15:21:44.079673 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m15:21:44.080143 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m15:21:44.083316 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.083962 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m15:21:44.088096 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.088764 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.089222 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m15:21:44.089637 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:44.096812 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:21:44.097258 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.097700 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m15:21:44.110819 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.013 seconds
[0m15:21:44.114404 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.114878 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m15:21:44.115674 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.119004 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.119477 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m15:21:44.120244 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.121745 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:21:44.122212 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.122634 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m15:21:44.125068 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m15:21:44.127907 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m15:21:44.128715 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m15:21:44.129200 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m15:21:44.132198 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:21:44.133534 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m15:21:44.134201 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb838850>]}
[0m15:21:44.134912 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.05s]
[0m15:21:44.135654 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m15:21:44.136230 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m15:21:44.136894 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m15:21:44.137481 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m15:21:44.137980 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m15:21:44.142147 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.142863 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m15:21:44.146731 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.147445 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.147912 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m15:21:44.148401 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:44.155464 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:21:44.155939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.156470 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m15:21:44.180062 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.023 seconds
[0m15:21:44.183610 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.184142 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m15:21:44.184975 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.188260 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.188741 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m15:21:44.189503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.190935 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:21:44.191415 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.191850 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m15:21:44.194993 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m15:21:44.197806 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m15:21:44.198497 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m15:21:44.198966 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m15:21:44.201990 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m15:21:44.203328 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m15:21:44.203987 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb71a790>]}
[0m15:21:44.204742 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.07s]
[0m15:21:44.205500 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m15:21:44.206044 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m15:21:44.206679 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m15:21:44.207275 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m15:21:44.207748 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m15:21:44.211194 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.211893 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m15:21:44.216697 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.217411 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.217854 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m15:21:44.218247 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:44.225295 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:21:44.225789 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.226227 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m15:21:44.233048 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m15:21:44.236385 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.236836 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m15:21:44.237601 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.240776 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.241227 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m15:21:44.241932 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.243291 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:21:44.243714 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.244130 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m15:21:44.245192 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:21:44.247813 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m15:21:44.248486 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m15:21:44.248935 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m15:21:44.251630 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:21:44.252947 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m15:21:44.253557 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb71a7c0>]}
[0m15:21:44.254222 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m15:21:44.254845 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m15:21:44.255321 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:21:44.255958 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m15:21:44.256603 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m15:21:44.257051 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:21:44.266465 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.267135 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:21:44.296102 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.296626 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp152144289612"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m15:21:44.297088 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:44.309540 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.012 seconds
[0m15:21:44.323827 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.324341 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m15:21:44.324918 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m15:21:44.325355 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.325785 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp152144289612'
        
      order by ordinal_position

  
[0m15:21:44.337839 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m15:21:44.343520 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.344031 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:21:44.347824 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:21:44.355724 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.356237 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m15:21:44.359814 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m15:21:44.375807 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.376509 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.376994 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp152144289612"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp152144289612"
    )
  
[0m15:21:44.379373 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m15:21:44.380690 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:21:44.381171 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m15:21:44.381597 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m15:21:44.383388 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:21:44.384250 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m15:21:44.384890 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb96a250>]}
[0m15:21:44.385607 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.13s]
[0m15:21:44.386285 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m15:21:44.386805 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m15:21:44.387439 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m15:21:44.387973 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m15:21:44.388479 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m15:21:44.391637 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m15:21:44.392292 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m15:21:44.396221 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m15:21:44.396876 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:21:44.397333 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m15:21:44.397746 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m15:21:44.404794 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m15:21:44.405258 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:21:44.405695 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m15:21:44.410429 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m15:21:44.414848 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:21:44.415335 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m15:21:44.416132 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.419265 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:21:44.419747 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m15:21:44.420503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m15:21:44.421966 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:21:44.422422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:21:44.422845 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m15:21:44.423976 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m15:21:44.426632 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m15:21:44.427364 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m15:21:44.427811 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m15:21:44.430485 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m15:21:44.431765 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m15:21:44.432414 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '648c419e-0ad3-485d-863b-ad80c3228c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb76b8b0>]}
[0m15:21:44.433119 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.04s]
[0m15:21:44.433779 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m15:21:44.435018 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:44.435446 [debug] [MainThread]: On master: BEGIN
[0m15:21:44.435792 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:21:44.442719 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m15:21:44.443136 [debug] [MainThread]: On master: COMMIT
[0m15:21:44.443488 [debug] [MainThread]: Using postgres connection "master"
[0m15:21:44.443816 [debug] [MainThread]: On master: COMMIT
[0m15:21:44.444313 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m15:21:44.444684 [debug] [MainThread]: On master: Close
[0m15:21:44.445144 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:21:44.445493 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m15:21:44.445917 [info ] [MainThread]: 
[0m15:21:44.446299 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.68 seconds (0.68s).
[0m15:21:44.447766 [debug] [MainThread]: Command end result
[0m15:21:44.482138 [info ] [MainThread]: 
[0m15:21:44.482695 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:21:44.483076 [info ] [MainThread]: 
[0m15:21:44.483463 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:21:44.484352 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5134674, "process_user_time": 2.71113, "process_kernel_time": 0.657964, "process_mem_max_rss": "195376", "process_out_blocks": "2464", "process_in_blocks": "0"}
[0m15:21:44.484979 [debug] [MainThread]: Command `dbt run` succeeded at 15:21:44.484879 after 1.51 seconds
[0m15:21:44.485421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35e77f0610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35e58d04f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35fb7b2e20>]}
[0m15:21:44.485834 [debug] [MainThread]: Flushing usage events
[0m16:30:30.288191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d9d39cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d87b0f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d83df760>]}


============================== 16:30:30.309019 | be5f4c24-5d72-40f4-8160-9d32eb06c848 ==============================
[0m16:30:30.309019 [info ] [MainThread]: Running with dbt=1.8.3
[0m16:30:30.309650 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:30:30.290056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186ecdb5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186d4b6a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186d547460>]}


============================== 16:30:30.311106 | 88957d11-14e5-472c-a9fb-8788cb9b046b ==============================
[0m16:30:30.311106 [info ] [MainThread]: Running with dbt=1.8.3
[0m16:30:30.311673 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:30:30.472847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d811e700>]}
[0m16:30:30.473073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186d207eb0>]}
[0m16:30:30.529362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186e982df0>]}
[0m16:30:30.529549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d83710d0>]}
[0m16:30:30.530298 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:30:30.530533 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:30:30.549625 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m16:30:30.549900 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m16:30:30.741220 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:30:30.741991 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m16:30:30.746287 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:30:30.747054 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m16:30:31.079706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ed6d2790>]}
[0m16:30:31.082722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f18828d6760>]}
[0m16:30:31.249670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ed590c70>]}
[0m16:30:31.250315 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m16:30:31.250735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ed6f0670>]}
[0m16:30:31.251554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f188278fc10>]}
[0m16:30:31.252241 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m16:30:31.252409 [info ] [MainThread]: 
[0m16:30:31.252695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f18828c0e50>]}
[0m16:30:31.253072 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:30:31.254521 [info ] [MainThread]: 
[0m16:30:31.255181 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:30:31.257578 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m16:30:31.259698 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m16:30:31.291463 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m16:30:31.291971 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m16:30:31.292394 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:31.294377 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m16:30:31.294917 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m16:30:31.295352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:31.301521 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m16:30:31.302899 [debug] [ThreadPool]: On list_scraping_db: Close
[0m16:30:31.304211 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.009 seconds
[0m16:30:31.305316 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m16:30:31.305645 [debug] [ThreadPool]: On list_scraping_db: Close
[0m16:30:31.307554 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m16:30:31.311865 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:30:31.312297 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m16:30:31.312642 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:31.314780 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:30:31.315253 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m16:30:31.315659 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:31.319686 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.320098 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:30:31.320467 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:30:31.323270 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m16:30:31.323717 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:30:31.324204 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:30:31.326830 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m16:30:31.328241 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m16:30:31.328770 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m16:30:31.329403 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m16:30:31.330014 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m16:30:31.331494 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m16:30:31.332025 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m16:30:31.332744 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m16:30:31.333407 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:30:31.333820 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m16:30:31.334185 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:31.336849 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:30:31.337282 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m16:30:31.337681 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:31.341211 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.341613 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:30:31.342015 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m16:30:31.344882 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.345323 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:30:31.345754 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m16:30:31.346844 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m16:30:31.348038 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m16:30:31.348553 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m16:30:31.350480 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m16:30:31.351710 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m16:30:31.352243 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m16:30:31.354691 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.355116 [debug] [MainThread]: On master: BEGIN
[0m16:30:31.355460 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:30:31.358527 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.358958 [debug] [MainThread]: On master: BEGIN
[0m16:30:31.359313 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:30:31.362331 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.362709 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.363116 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:30:31.366171 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.366606 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.367026 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:30:31.369223 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m16:30:31.370411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29eca5bd00>]}
[0m16:30:31.370935 [debug] [MainThread]: On master: ROLLBACK
[0m16:30:31.371424 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.371794 [debug] [MainThread]: On master: BEGIN
[0m16:30:31.372330 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m16:30:31.372707 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.373040 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.373017 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m16:30:31.373370 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.373775 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:30:31.374144 [debug] [MainThread]: On master: Close
[0m16:30:31.374225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f188245dca0>]}
[0m16:30:31.374752 [debug] [MainThread]: On master: ROLLBACK
[0m16:30:31.374670 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:30:31.375272 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.375150 [info ] [MainThread]: 
[0m16:30:31.375654 [debug] [MainThread]: On master: BEGIN
[0m16:30:31.376398 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m16:30:31.377094 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.377732 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.378352 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.379083 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:30:31.379741 [debug] [MainThread]: On master: Close
[0m16:30:31.380564 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:30:31.381105 [info ] [MainThread]: 
[0m16:30:31.383432 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m16:30:31.384073 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m16:30:31.384785 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m16:30:31.385241 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m16:30:31.387654 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m16:30:31.388407 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m16:30:31.388961 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m16:30:31.389388 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m16:30:31.394635 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m16:30:31.395288 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m16:30:31.398713 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m16:30:31.399333 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m16:30:31.433755 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m16:30:31.434563 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:30:31.435065 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m16:30:31.435472 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:30:31.437381 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m16:30:31.438161 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:30:31.438637 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m16:30:31.439031 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:30:31.442806 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.443259 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:30:31.443711 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(ad_location, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(ad_location, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m16:30:31.444826 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_location" does not exist
LINE 24:     SPLIT_PART(ad_location, '(', 1) AS ad_city,
                        ^

[0m16:30:31.445275 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m16:30:31.445931 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m16:30:31.446020 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.446495 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:30:31.446950 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(ad_location, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(ad_location, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m16:30:31.447912 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_location" does not exist
LINE 24:     SPLIT_PART(ad_location, '(', 1) AS ad_city,
                        ^

[0m16:30:31.448391 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m16:30:31.448743 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_location" does not exist
  LINE 24:     SPLIT_PART(ad_location, '(', 1) AS ad_city,
                          ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m16:30:31.449033 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m16:30:31.450393 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d790b850>]}
[0m16:30:31.451090 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_location" does not exist
  LINE 24:     SPLIT_PART(ad_location, '(', 1) AS ad_city,
                          ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m16:30:31.451164 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m16:30:31.452030 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m16:30:31.452580 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m16:30:31.452793 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186dde51c0>]}
[0m16:30:31.453299 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m16:30:31.453579 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m16:30:31.454201 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m16:30:31.454374 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m16:30:31.454726 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m16:30:31.454865 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m16:30:31.455587 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m16:30:31.456317 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m16:30:31.456787 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m16:30:31.458525 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m16:30:31.459158 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m16:30:31.460347 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m16:30:31.460943 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m16:30:31.463190 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m16:30:31.463816 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.464316 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m16:30:31.464703 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:30:31.464901 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m16:30:31.465576 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.466003 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m16:30:31.466404 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:30:31.472171 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.472930 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.473655 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m16:30:31.473885 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.474314 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.474722 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m16:30:31.480156 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m16:30:31.487009 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.487470 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m16:30:31.488454 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:30:31.492964 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.493410 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m16:30:31.494255 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:30:31.513706 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m16:30:31.514217 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.514617 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m16:30:31.516657 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m16:30:31.519990 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.045 seconds
[0m16:30:31.523370 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m16:30:31.527214 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.527607 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:30:31.527699 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m16:30:31.528075 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m16:30:31.528840 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_prix_m2__dbt_backup" already exists

[0m16:30:31.529271 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: ROLLBACK
[0m16:30:31.529884 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m16:30:31.530292 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m16:30:31.530711 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m16:30:31.531440 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:30:31.531983 [debug] [Thread-1  ]: Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m16:30:31.532546 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88957d11-14e5-472c-a9fb-8788cb9b046b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186c9e88e0>]}
[0m16:30:31.533243 [error] [Thread-1  ]: 2 of 7 ERROR creating sql table model public.src_prix_m2 ....................... [[31mERROR[0m in 0.08s]
[0m16:30:31.533868 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m16:30:31.534026 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m16:30:31.534350 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m16:30:31.534825 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m16:30:31.534849 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be5f4c24-5d72-40f4-8160-9d32eb06c848', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d8d0f220>]}
[0m16:30:31.535443 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m16:30:31.535923 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m16:30:31.535935 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.08s]
[0m16:30:31.536469 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m16:30:31.536931 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m16:30:31.536940 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m16:30:31.537380 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m16:30:31.537531 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m16:30:31.537885 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m16:30:31.538114 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m16:30:31.538354 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m16:30:31.538637 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m16:30:31.538803 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:30:31.539113 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m16:30:31.539448 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m16:30:31.539644 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m16:30:31.539913 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:30:31.540191 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m16:30:31.540402 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m16:30:31.540853 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m16:30:31.540894 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m16:30:31.541355 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m16:30:31.541463 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m16:30:31.542074 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m16:30:31.542498 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.542591 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:30:31.542924 [debug] [MainThread]: On master: BEGIN
[0m16:30:31.543082 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m16:30:31.543296 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:30:31.543770 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:30:31.544489 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m16:30:31.545018 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m16:30:31.545486 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m16:30:31.546608 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.547032 [debug] [MainThread]: On master: BEGIN
[0m16:30:31.547381 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:30:31.550712 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m16:30:31.551385 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.551984 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.552651 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.553359 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:30:31.553971 [debug] [MainThread]: On master: Close
[0m16:30:31.554710 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:30:31.555073 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m16:30:31.555506 [info ] [MainThread]: 
[0m16:30:31.555931 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m16:30:31.556297 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m16:30:31.556872 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.557063 [debug] [MainThread]: Command end result
[0m16:30:31.557279 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:31.557728 [debug] [MainThread]: On master: COMMIT
[0m16:30:31.558215 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:30:31.558629 [debug] [MainThread]: On master: Close
[0m16:30:31.559176 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:30:31.559548 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m16:30:31.560051 [info ] [MainThread]: 
[0m16:30:31.560514 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m16:30:31.561685 [debug] [MainThread]: Command end result
[0m16:30:31.591932 [info ] [MainThread]: 
[0m16:30:31.592533 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m16:30:31.592938 [info ] [MainThread]: 
[0m16:30:31.593389 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_location" does not exist
  LINE 24:     SPLIT_PART(ad_location, '(', 1) AS ad_city,
                          ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m16:30:31.593787 [info ] [MainThread]: 
[0m16:30:31.594197 [error] [MainThread]:   Database Error in model src_prix_m2 (models/src/src_prix_m2.sql)
  relation "src_prix_m2__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_prix_m2.sql
[0m16:30:31.594540 [info ] [MainThread]: 
[0m16:30:31.594907 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=5 TOTAL=7
[0m16:30:31.595760 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3549026, "process_user_time": 2.619965, "process_kernel_time": 0.572867, "process_mem_max_rss": "195432", "process_out_blocks": "4688", "command_success": false, "process_in_blocks": "0"}
[0m16:30:31.596412 [debug] [MainThread]: Command `dbt run` failed at 16:30:31.596311 after 1.36 seconds
[0m16:30:31.596877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186ecdb5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186de0e280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f186d207eb0>]}
[0m16:30:31.597306 [debug] [MainThread]: Flushing usage events
[0m16:30:31.604624 [info ] [MainThread]: 
[0m16:30:31.605246 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:30:31.605759 [info ] [MainThread]: 
[0m16:30:31.606369 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_location" does not exist
  LINE 24:     SPLIT_PART(ad_location, '(', 1) AS ad_city,
                          ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m16:30:31.606802 [info ] [MainThread]: 
[0m16:30:31.607414 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m16:30:31.608446 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3694664, "process_user_time": 2.659677, "process_kernel_time": 0.516056, "process_mem_max_rss": "195516", "process_out_blocks": "5280", "command_success": false, "process_in_blocks": "0"}
[0m16:30:31.609125 [debug] [MainThread]: Command `dbt run` failed at 16:30:31.609011 after 1.37 seconds
[0m16:30:31.609611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d9d39cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29ed590df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29d811e700>]}
[0m16:30:31.610092 [debug] [MainThread]: Flushing usage events
[0m16:31:28.420981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b39cb5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b23445e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b26579a0>]}


============================== 16:31:28.426426 | 4521ae25-ae82-4e99-9f4a-a2de30e30af9 ==============================
[0m16:31:28.426426 [info ] [MainThread]: Running with dbt=1.8.3
[0m16:31:28.427053 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m16:31:28.591669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b1af1ac0>]}
[0m16:31:28.649606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b1ab22b0>]}
[0m16:31:28.650564 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:31:28.669715 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m16:31:28.880526 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:31:28.881305 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m16:31:29.217109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8c7699760>]}
[0m16:31:29.390976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8c765dc10>]}
[0m16:31:29.391659 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m16:31:29.392127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8c7684ee0>]}
[0m16:31:29.393802 [info ] [MainThread]: 
[0m16:31:29.394473 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:31:29.398997 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m16:31:29.432433 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m16:31:29.432920 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m16:31:29.433287 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:31:29.447906 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.015 seconds
[0m16:31:29.449522 [debug] [ThreadPool]: On list_scraping_db: Close
[0m16:31:29.451439 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m16:31:29.457989 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:31:29.458424 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m16:31:29.458818 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:31:29.466022 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.466456 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:31:29.466954 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m16:31:29.471815 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m16:31:29.473024 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m16:31:29.473521 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m16:31:29.474174 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m16:31:29.476826 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:31:29.477301 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m16:31:29.477691 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:31:29.484814 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.485283 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:31:29.485720 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:31:29.490462 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m16:31:29.491918 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m16:31:29.492479 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m16:31:29.499319 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:29.499734 [debug] [MainThread]: On master: BEGIN
[0m16:31:29.500139 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:31:29.507060 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.507458 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:29.507887 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:31:29.513853 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m16:31:29.515040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8c765d790>]}
[0m16:31:29.515545 [debug] [MainThread]: On master: ROLLBACK
[0m16:31:29.516052 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:29.516467 [debug] [MainThread]: On master: BEGIN
[0m16:31:29.516973 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m16:31:29.517343 [debug] [MainThread]: On master: COMMIT
[0m16:31:29.517699 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:29.518033 [debug] [MainThread]: On master: COMMIT
[0m16:31:29.518429 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:31:29.518779 [debug] [MainThread]: On master: Close
[0m16:31:29.519292 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:31:29.519766 [info ] [MainThread]: 
[0m16:31:29.526560 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m16:31:29.527243 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m16:31:29.527776 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m16:31:29.528246 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m16:31:29.537861 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m16:31:29.538503 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m16:31:29.577099 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m16:31:29.577902 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:31:29.578375 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m16:31:29.578776 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:31:29.585974 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.586479 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:31:29.586994 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m16:31:29.596146 [debug] [Thread-1  ]: SQL status: SELECT 465 in 0.009 seconds
[0m16:31:29.602941 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:31:29.603425 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m16:31:29.604360 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.607640 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:31:29.608125 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m16:31:29.608858 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.628062 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m16:31:29.628555 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:31:29.628977 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m16:31:29.631701 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m16:31:29.638878 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m16:31:29.643037 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:31:29.643510 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m16:31:29.646878 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:31:29.649253 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m16:31:29.650878 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b0ed1430>]}
[0m16:31:29.651625 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 465[0m in 0.12s]
[0m16:31:29.652473 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m16:31:29.652978 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m16:31:29.653623 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m16:31:29.654286 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m16:31:29.654900 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m16:31:29.658174 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m16:31:29.658804 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m16:31:29.662608 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m16:31:29.663256 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:31:29.663709 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m16:31:29.664146 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:31:29.671385 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.671834 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:31:29.672310 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m16:31:29.677666 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m16:31:29.681145 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:31:29.681637 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m16:31:29.682460 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.685753 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:31:29.686207 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m16:31:29.686956 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.688372 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m16:31:29.688806 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:31:29.689207 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m16:31:29.690318 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m16:31:29.693113 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m16:31:29.693759 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:31:29.694183 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m16:31:29.696873 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m16:31:29.698199 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m16:31:29.698824 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8c7ff28b0>]}
[0m16:31:29.699502 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m16:31:29.700146 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m16:31:29.700638 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m16:31:29.701265 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m16:31:29.701788 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m16:31:29.702206 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m16:31:29.706243 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.706854 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m16:31:29.710622 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.711254 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.711673 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m16:31:29.712049 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:31:29.719126 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.719573 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.719982 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m16:31:29.733121 [debug] [Thread-1  ]: SQL status: SELECT 4650 in 0.013 seconds
[0m16:31:29.736565 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.737022 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m16:31:29.737948 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:31:29.741208 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.741645 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m16:31:29.742387 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.743765 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m16:31:29.744217 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.744601 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m16:31:29.747080 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m16:31:29.749846 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m16:31:29.750509 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:31:29.750958 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m16:31:29.753951 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:31:29.755248 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m16:31:29.755872 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8c7ff28b0>]}
[0m16:31:29.756579 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 4650[0m in 0.05s]
[0m16:31:29.757218 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m16:31:29.757716 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m16:31:29.758341 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m16:31:29.758866 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m16:31:29.759287 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m16:31:29.762509 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.763131 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m16:31:29.767931 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.768578 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.768995 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m16:31:29.769376 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:31:29.776448 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.776897 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.777331 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m16:31:29.800671 [debug] [Thread-1  ]: SQL status: SELECT 4818 in 0.023 seconds
[0m16:31:29.804309 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.804767 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m16:31:29.805622 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.808900 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.809368 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m16:31:29.810137 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.811624 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m16:31:29.812060 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.812466 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m16:31:29.815068 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m16:31:29.817749 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m16:31:29.818483 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:31:29.818914 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m16:31:29.822012 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:31:29.823309 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m16:31:29.823939 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b2bb5190>]}
[0m16:31:29.824639 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4818[0m in 0.07s]
[0m16:31:29.825279 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m16:31:29.825800 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m16:31:29.826601 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m16:31:29.827169 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m16:31:29.827584 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m16:31:29.830868 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.831484 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m16:31:29.835415 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.836050 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.836488 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m16:31:29.836870 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:31:29.844040 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:31:29.844519 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.844953 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m16:31:29.852018 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.007 seconds
[0m16:31:29.856681 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.857194 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m16:31:29.858152 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.861391 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.861852 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m16:31:29.862564 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:29.864052 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m16:31:29.864545 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.864980 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m16:31:29.866092 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m16:31:29.868849 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m16:31:29.869504 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:31:29.869959 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m16:31:29.872602 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m16:31:29.873999 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m16:31:29.874654 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8c7f8da90>]}
[0m16:31:29.875374 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m16:31:29.876246 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m16:31:29.876835 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:31:29.877623 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m16:31:29.878300 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m16:31:29.878724 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:31:29.888304 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:29.888936 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:31:29.917092 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:29.917627 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp163129911393"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m16:31:29.918070 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:31:29.930848 [debug] [Thread-1  ]: SQL status: SELECT 467 in 0.013 seconds
[0m16:31:29.946153 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:29.946641 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m16:31:29.947298 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m16:31:29.947753 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:29.948203 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp163129911393'
        
      order by ordinal_position

  
[0m16:31:29.960880 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m16:31:30.018704 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:30.019309 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m16:31:30.023411 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m16:31:30.031757 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:30.032342 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m16:31:30.036163 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m16:31:30.052844 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:30.053559 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:30.054056 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp163129911393"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp163129911393"
    )
  
[0m16:31:30.056817 [debug] [Thread-1  ]: SQL status: INSERT 0 467 in 0.002 seconds
[0m16:31:30.058222 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m16:31:30.058686 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:31:30.059120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m16:31:30.061326 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m16:31:30.062165 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m16:31:30.062824 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b1396370>]}
[0m16:31:30.063526 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 467[0m in 0.18s]
[0m16:31:30.064386 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:31:30.064904 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m16:31:30.065538 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m16:31:30.066204 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m16:31:30.066650 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m16:31:30.069889 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m16:31:30.070485 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m16:31:30.074429 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m16:31:30.075045 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:31:30.075465 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m16:31:30.075851 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:31:30.083069 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:31:30.083503 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:31:30.083917 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m16:31:30.088663 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m16:31:30.092208 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:31:30.092659 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m16:31:30.093508 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:30.097644 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:31:30.098105 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m16:31:30.099146 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:31:30.100679 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m16:31:30.101124 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:31:30.101509 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m16:31:30.102590 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m16:31:30.105248 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m16:31:30.106008 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:31:30.106476 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m16:31:30.109545 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:31:30.110861 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m16:31:30.111500 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4521ae25-ae82-4e99-9f4a-a2de30e30af9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b2bb5190>]}
[0m16:31:30.112221 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m16:31:30.113042 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m16:31:30.114354 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:30.114805 [debug] [MainThread]: On master: BEGIN
[0m16:31:30.115207 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:31:30.123978 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m16:31:30.124454 [debug] [MainThread]: On master: COMMIT
[0m16:31:30.124869 [debug] [MainThread]: Using postgres connection "master"
[0m16:31:30.125266 [debug] [MainThread]: On master: COMMIT
[0m16:31:30.125766 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:31:30.126173 [debug] [MainThread]: On master: Close
[0m16:31:30.126706 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:31:30.127126 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m16:31:30.127654 [info ] [MainThread]: 
[0m16:31:30.128117 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.73 seconds (0.73s).
[0m16:31:30.129847 [debug] [MainThread]: Command end result
[0m16:31:30.168948 [info ] [MainThread]: 
[0m16:31:30.169576 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:31:30.170116 [info ] [MainThread]: 
[0m16:31:30.170644 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:31:30.171695 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8005277, "process_user_time": 2.9319, "process_kernel_time": 0.722005, "process_mem_max_rss": "195444", "process_out_blocks": "3560", "process_in_blocks": "0"}
[0m16:31:30.172373 [debug] [MainThread]: Command `dbt run` succeeded at 16:31:30.172261 after 1.80 seconds
[0m16:31:30.172848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b1af1ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b36d0a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8b0ef2f70>]}
[0m16:31:30.173314 [debug] [MainThread]: Flushing usage events
[0m16:57:16.330207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6737b1dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6736292910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6736292ac0>]}


============================== 16:57:16.335858 | 5d606251-6788-4205-9a75-fbfc0b9f6174 ==============================
[0m16:57:16.335858 [info ] [MainThread]: Running with dbt=1.8.3
[0m16:57:16.336490 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:57:16.501017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67359baaf0>]}
[0m16:57:16.557819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f673597b610>]}
[0m16:57:16.558804 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m16:57:16.579250 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m16:57:16.770450 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:57:16.771227 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m16:57:17.107850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f674b6d9790>]}
[0m16:57:17.273063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f674b661c40>]}
[0m16:57:17.273732 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m16:57:17.274173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f674b6bfe80>]}
[0m16:57:17.275841 [info ] [MainThread]: 
[0m16:57:17.276542 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:57:17.281181 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m16:57:17.315262 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m16:57:17.315774 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m16:57:17.316213 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:17.325345 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m16:57:17.326773 [debug] [ThreadPool]: On list_scraping_db: Close
[0m16:57:17.328988 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m16:57:17.336280 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:57:17.336745 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m16:57:17.337199 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:57:17.344696 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m16:57:17.345247 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m16:57:17.345708 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m16:57:17.350807 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m16:57:17.352377 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m16:57:17.352910 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m16:57:17.353627 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m16:57:17.357816 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:57:17.358259 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m16:57:17.358665 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:57:17.368229 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m16:57:17.368922 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m16:57:17.369576 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m16:57:17.375440 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m16:57:17.376850 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m16:57:17.377421 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m16:57:17.383908 [debug] [MainThread]: Using postgres connection "master"
[0m16:57:17.384394 [debug] [MainThread]: On master: BEGIN
[0m16:57:17.384742 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:57:17.392144 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m16:57:17.392643 [debug] [MainThread]: Using postgres connection "master"
[0m16:57:17.393136 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:57:17.399421 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m16:57:17.400743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f674b25ecd0>]}
[0m16:57:17.401374 [debug] [MainThread]: On master: ROLLBACK
[0m16:57:17.401927 [debug] [MainThread]: Using postgres connection "master"
[0m16:57:17.402438 [debug] [MainThread]: On master: BEGIN
[0m16:57:17.403024 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m16:57:17.403417 [debug] [MainThread]: On master: COMMIT
[0m16:57:17.403776 [debug] [MainThread]: Using postgres connection "master"
[0m16:57:17.404166 [debug] [MainThread]: On master: COMMIT
[0m16:57:17.404619 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:57:17.405004 [debug] [MainThread]: On master: Close
[0m16:57:17.405591 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:57:17.406091 [info ] [MainThread]: 
[0m16:57:17.412897 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m16:57:17.413595 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m16:57:17.414206 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m16:57:17.414700 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m16:57:17.424558 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m16:57:17.425387 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m16:57:17.470503 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m16:57:17.471424 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:57:17.471962 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m16:57:17.472501 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:57:17.479909 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:57:17.480424 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:57:17.480906 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m16:57:17.491505 [debug] [Thread-1  ]: SQL status: SELECT 675 in 0.010 seconds
[0m16:57:17.498800 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:57:17.499289 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m16:57:17.500241 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:57:17.504140 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:57:17.504612 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m16:57:17.505550 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.527253 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m16:57:17.527817 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:57:17.528313 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m16:57:17.531595 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m16:57:17.539433 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m16:57:17.543660 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m16:57:17.544170 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m16:57:17.547847 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:57:17.550372 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m16:57:17.552055 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6734dcd460>]}
[0m16:57:17.552850 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 675[0m in 0.14s]
[0m16:57:17.553560 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m16:57:17.554093 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m16:57:17.554795 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m16:57:17.555494 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m16:57:17.555977 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m16:57:17.559559 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m16:57:17.560257 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m16:57:17.564337 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m16:57:17.565018 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:57:17.565469 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m16:57:17.565879 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:57:17.573413 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m16:57:17.573880 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:57:17.574317 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m16:57:17.579478 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m16:57:17.583277 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:57:17.583775 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m16:57:17.584908 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m16:57:17.589511 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:57:17.590085 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m16:57:17.590992 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.592538 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m16:57:17.593000 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:57:17.593414 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m16:57:17.594782 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m16:57:17.598296 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m16:57:17.599010 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m16:57:17.599474 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m16:57:17.602575 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:57:17.603990 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m16:57:17.604689 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6734dcd040>]}
[0m16:57:17.605409 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m16:57:17.606086 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m16:57:17.606633 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m16:57:17.607296 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m16:57:17.607838 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m16:57:17.608323 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m16:57:17.612638 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.613318 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m16:57:17.617455 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.618155 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.618590 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m16:57:17.618992 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:57:17.626618 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m16:57:17.627147 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.627610 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m16:57:17.643455 [debug] [Thread-1  ]: SQL status: SELECT 6750 in 0.015 seconds
[0m16:57:17.647418 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.647934 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m16:57:17.648921 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.652525 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.652991 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m16:57:17.653869 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.655728 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m16:57:17.656219 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.656639 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m16:57:17.659159 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m16:57:17.663867 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m16:57:17.664983 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m16:57:17.665705 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m16:57:17.669017 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:57:17.670465 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m16:57:17.671132 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f674bffa730>]}
[0m16:57:17.671848 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 6750[0m in 0.06s]
[0m16:57:17.672552 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m16:57:17.673078 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m16:57:17.673713 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m16:57:17.674235 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m16:57:17.674652 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m16:57:17.678117 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.678728 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m16:57:17.683746 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.684425 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.684856 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m16:57:17.685236 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:57:17.692563 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:57:17.693022 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.693443 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m16:57:17.720052 [debug] [Thread-1  ]: SQL status: SELECT 4847 in 0.026 seconds
[0m16:57:17.724171 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.724665 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m16:57:17.725566 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.728888 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.729345 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m16:57:17.730097 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.731643 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m16:57:17.732134 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.732559 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m16:57:17.735687 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m16:57:17.738548 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m16:57:17.739315 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m16:57:17.739766 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m16:57:17.743035 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m16:57:17.744445 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m16:57:17.745095 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f674b2a8940>]}
[0m16:57:17.745775 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4847[0m in 0.07s]
[0m16:57:17.746423 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m16:57:17.746904 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m16:57:17.747565 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m16:57:17.748109 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m16:57:17.748554 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m16:57:17.751857 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.752526 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m16:57:17.756829 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.757549 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.758113 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m16:57:17.758511 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:57:17.766047 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:57:17.766502 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.766918 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m16:57:17.774292 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.007 seconds
[0m16:57:17.779143 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.779638 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m16:57:17.780476 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.783834 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.784319 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m16:57:17.785048 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:17.786575 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m16:57:17.787011 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.787404 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m16:57:17.788634 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m16:57:17.791407 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m16:57:17.792050 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m16:57:17.792529 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m16:57:17.795362 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m16:57:17.796851 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m16:57:17.797506 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f673515d760>]}
[0m16:57:17.798231 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m16:57:17.798879 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m16:57:17.799361 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:57:17.800001 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m16:57:17.800690 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m16:57:17.801144 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:57:17.810755 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.811412 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:57:17.840036 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.840645 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp165717834266"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m16:57:17.841094 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:57:17.854697 [debug] [Thread-1  ]: SQL status: SELECT 1091 in 0.014 seconds
[0m16:57:17.870437 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.870955 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m16:57:17.871573 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m16:57:17.871995 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.872449 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp165717834266'
        
      order by ordinal_position

  
[0m16:57:17.885078 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m16:57:17.950584 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.951480 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m16:57:17.956834 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.005 seconds
[0m16:57:17.969329 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.969871 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m16:57:17.975499 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.005 seconds
[0m16:57:17.993692 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.994472 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:17.995101 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp165717834266"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp165717834266"
    )
  
[0m16:57:17.998505 [debug] [Thread-1  ]: SQL status: INSERT 0 1091 in 0.003 seconds
[0m16:57:17.999993 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m16:57:18.000482 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m16:57:18.001028 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m16:57:18.003930 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m16:57:18.005102 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m16:57:18.005785 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67350ed490>]}
[0m16:57:18.006533 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 1091[0m in 0.21s]
[0m16:57:18.007230 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m16:57:18.007752 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m16:57:18.008436 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m16:57:18.008990 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m16:57:18.009438 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m16:57:18.013162 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m16:57:18.013797 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m16:57:18.017940 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m16:57:18.018603 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:57:18.019051 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m16:57:18.019463 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m16:57:18.026806 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m16:57:18.027298 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:57:18.027711 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m16:57:18.032686 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m16:57:18.036515 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:57:18.036981 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m16:57:18.037767 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:18.042221 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:57:18.042684 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m16:57:18.043442 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m16:57:18.045026 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m16:57:18.045474 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:57:18.045859 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m16:57:18.046987 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m16:57:18.049860 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m16:57:18.050627 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m16:57:18.051064 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m16:57:18.053939 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m16:57:18.055319 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m16:57:18.055962 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d606251-6788-4205-9a75-fbfc0b9f6174', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6736d011c0>]}
[0m16:57:18.056703 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m16:57:18.057575 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m16:57:18.058956 [debug] [MainThread]: Using postgres connection "master"
[0m16:57:18.059381 [debug] [MainThread]: On master: BEGIN
[0m16:57:18.059726 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:57:18.067003 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m16:57:18.067444 [debug] [MainThread]: On master: COMMIT
[0m16:57:18.067800 [debug] [MainThread]: Using postgres connection "master"
[0m16:57:18.068175 [debug] [MainThread]: On master: COMMIT
[0m16:57:18.068631 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m16:57:18.069008 [debug] [MainThread]: On master: Close
[0m16:57:18.069488 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:57:18.069838 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m16:57:18.070276 [info ] [MainThread]: 
[0m16:57:18.070661 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m16:57:18.072178 [debug] [MainThread]: Command end result
[0m16:57:18.107038 [info ] [MainThread]: 
[0m16:57:18.107623 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:57:18.108029 [info ] [MainThread]: 
[0m16:57:18.108431 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m16:57:18.109315 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8287596, "process_user_time": 2.952135, "process_kernel_time": 0.759916, "process_mem_max_rss": "195448", "process_out_blocks": "3560", "process_in_blocks": "0"}
[0m16:57:18.109944 [debug] [MainThread]: Command `dbt run` succeeded at 16:57:18.109841 after 1.83 seconds
[0m16:57:18.110380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f674b66e280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67359baaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f673597b610>]}
[0m16:57:18.110802 [debug] [MainThread]: Flushing usage events
[0m17:02:23.149332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22e66d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22cf88c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22ce25970>]}


============================== 17:02:23.154945 | cd086060-a9ab-4c33-8500-a28e1c351a9a ==============================
[0m17:02:23.154945 [info ] [MainThread]: Running with dbt=1.8.3
[0m17:02:23.155508 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:02:23.316517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22c1fab20>]}
[0m17:02:23.373337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22c1bf460>]}
[0m17:02:23.374260 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m17:02:23.394035 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m17:02:23.584991 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:02:23.585786 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m17:02:23.951786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2422db790>]}
[0m17:02:24.116274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc242267c70>]}
[0m17:02:24.116964 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m17:02:24.117414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2422c7670>]}
[0m17:02:24.119159 [info ] [MainThread]: 
[0m17:02:24.119844 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:02:24.124539 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m17:02:24.159273 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m17:02:24.159794 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m17:02:24.160225 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:02:24.175923 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.016 seconds
[0m17:02:24.177451 [debug] [ThreadPool]: On list_scraping_db: Close
[0m17:02:24.179427 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m17:02:24.186182 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m17:02:24.186605 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m17:02:24.186961 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:02:24.194221 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.194636 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m17:02:24.195011 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m17:02:24.200070 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m17:02:24.201344 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m17:02:24.201865 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m17:02:24.202542 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m17:02:24.205311 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m17:02:24.205721 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m17:02:24.206066 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:02:24.213194 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.213643 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m17:02:24.214037 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m17:02:24.219020 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m17:02:24.220491 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m17:02:24.221006 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m17:02:24.227788 [debug] [MainThread]: Using postgres connection "master"
[0m17:02:24.228258 [debug] [MainThread]: On master: BEGIN
[0m17:02:24.228635 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:02:24.235845 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.236348 [debug] [MainThread]: Using postgres connection "master"
[0m17:02:24.236805 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:02:24.242820 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m17:02:24.244053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc2421b5a30>]}
[0m17:02:24.244651 [debug] [MainThread]: On master: ROLLBACK
[0m17:02:24.245150 [debug] [MainThread]: Using postgres connection "master"
[0m17:02:24.245529 [debug] [MainThread]: On master: BEGIN
[0m17:02:24.246064 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m17:02:24.246469 [debug] [MainThread]: On master: COMMIT
[0m17:02:24.246826 [debug] [MainThread]: Using postgres connection "master"
[0m17:02:24.247178 [debug] [MainThread]: On master: COMMIT
[0m17:02:24.247598 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:02:24.247983 [debug] [MainThread]: On master: Close
[0m17:02:24.248614 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:02:24.249017 [info ] [MainThread]: 
[0m17:02:24.255696 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m17:02:24.256444 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m17:02:24.257000 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m17:02:24.257439 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m17:02:24.266914 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m17:02:24.267590 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m17:02:24.306468 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m17:02:24.307306 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:02:24.307797 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m17:02:24.308227 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:02:24.315607 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.316159 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:02:24.316634 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m17:02:24.326924 [debug] [Thread-1  ]: SQL status: SELECT 675 in 0.010 seconds
[0m17:02:24.334056 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:02:24.334536 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m17:02:24.335417 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.338795 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:02:24.339257 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m17:02:24.340052 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.359444 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m17:02:24.359953 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:02:24.360389 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m17:02:24.364604 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m17:02:24.372061 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m17:02:24.376226 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:02:24.376685 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m17:02:24.380370 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:02:24.382829 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m17:02:24.384503 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22b90f490>]}
[0m17:02:24.385261 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 675[0m in 0.13s]
[0m17:02:24.385958 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m17:02:24.386435 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m17:02:24.387259 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m17:02:24.387809 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m17:02:24.388260 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m17:02:24.391635 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m17:02:24.392295 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m17:02:24.396279 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m17:02:24.396944 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:02:24.397375 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m17:02:24.397771 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:02:24.405195 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.405645 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:02:24.406063 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m17:02:24.411872 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m17:02:24.415672 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:02:24.416154 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m17:02:24.417101 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:02:24.420644 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:02:24.421104 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m17:02:24.421882 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.423365 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m17:02:24.423843 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:02:24.424251 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m17:02:24.425693 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:02:24.428832 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m17:02:24.429507 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:02:24.429934 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m17:02:24.433061 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:02:24.434485 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m17:02:24.435144 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22d857220>]}
[0m17:02:24.435875 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m17:02:24.436556 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m17:02:24.437044 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m17:02:24.437700 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m17:02:24.438256 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m17:02:24.438666 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m17:02:24.443049 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.443680 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m17:02:24.447665 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.448323 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.448753 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m17:02:24.449147 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:02:24.456506 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.456976 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.457389 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m17:02:24.473546 [debug] [Thread-1  ]: SQL status: SELECT 6750 in 0.016 seconds
[0m17:02:24.477577 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.478079 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m17:02:24.479004 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m17:02:24.482390 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.482841 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m17:02:24.483717 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.485154 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m17:02:24.485594 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.485983 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m17:02:24.489229 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m17:02:24.492140 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m17:02:24.492793 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:02:24.493222 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m17:02:24.496449 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:02:24.497809 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m17:02:24.498450 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22b90f490>]}
[0m17:02:24.499158 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 6750[0m in 0.06s]
[0m17:02:24.499809 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m17:02:24.500299 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m17:02:24.500934 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m17:02:24.501461 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m17:02:24.501883 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m17:02:24.505244 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.505875 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m17:02:24.510847 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.511481 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.511906 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m17:02:24.512306 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:02:24.519505 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.519937 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.520368 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m17:02:24.547778 [debug] [Thread-1  ]: SQL status: SELECT 4847 in 0.027 seconds
[0m17:02:24.551845 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.552347 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m17:02:24.553265 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.556656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.557103 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m17:02:24.557941 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.559484 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m17:02:24.559930 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.560336 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m17:02:24.563321 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m17:02:24.566071 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m17:02:24.566792 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:02:24.567234 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m17:02:24.570592 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:02:24.571954 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m17:02:24.572615 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22b90f490>]}
[0m17:02:24.573326 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 4847[0m in 0.07s]
[0m17:02:24.573979 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m17:02:24.574452 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m17:02:24.575078 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m17:02:24.575588 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m17:02:24.576022 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m17:02:24.579454 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.580109 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m17:02:24.584177 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.584844 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.585270 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m17:02:24.585652 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:02:24.593036 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.593484 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.593906 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m17:02:24.601326 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.007 seconds
[0m17:02:24.606179 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.606684 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m17:02:24.607512 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.610821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.611265 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m17:02:24.611998 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.613493 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m17:02:24.613947 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.614339 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m17:02:24.615522 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:02:24.618265 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m17:02:24.618906 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:02:24.619323 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m17:02:24.622341 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:02:24.623751 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m17:02:24.624422 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22c1ba820>]}
[0m17:02:24.625108 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m17:02:24.625741 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m17:02:24.626221 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:02:24.626888 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m17:02:24.627560 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m17:02:24.628004 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:02:24.637486 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.638135 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:02:24.666424 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.666983 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp170224660692"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m17:02:24.667416 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:02:24.681106 [debug] [Thread-1  ]: SQL status: SELECT 1091 in 0.014 seconds
[0m17:02:24.697068 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.697598 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m17:02:24.698310 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m17:02:24.698837 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.699274 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp170224660692'
        
      order by ordinal_position

  
[0m17:02:24.712308 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m17:02:24.774131 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.774724 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m17:02:24.778899 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m17:02:24.787361 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.787873 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m17:02:24.791731 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m17:02:24.808517 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.809256 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.809752 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp170224660692"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp170224660692"
    )
  
[0m17:02:24.813541 [debug] [Thread-1  ]: SQL status: INSERT 0 1091 in 0.003 seconds
[0m17:02:24.814927 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m17:02:24.815377 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:02:24.815774 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m17:02:24.818912 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m17:02:24.819761 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m17:02:24.820440 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22b90f100>]}
[0m17:02:24.821139 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 1091[0m in 0.19s]
[0m17:02:24.821777 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:02:24.822267 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m17:02:24.822903 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m17:02:24.823553 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m17:02:24.824009 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m17:02:24.827423 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m17:02:24.828031 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m17:02:24.832156 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m17:02:24.832792 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:02:24.833246 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m17:02:24.833634 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:02:24.841047 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.841479 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:02:24.841892 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m17:02:24.846571 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m17:02:24.850333 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:02:24.850790 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m17:02:24.851593 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.855840 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:02:24.856312 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m17:02:24.857020 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:02:24.858506 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m17:02:24.858946 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:02:24.859328 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m17:02:24.860458 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:02:24.863096 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m17:02:24.863813 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:02:24.864259 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m17:02:24.867073 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m17:02:24.868382 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m17:02:24.869010 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd086060-a9ab-4c33-8500-a28e1c351a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22bca1eb0>]}
[0m17:02:24.869686 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m17:02:24.870507 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m17:02:24.871765 [debug] [MainThread]: Using postgres connection "master"
[0m17:02:24.872233 [debug] [MainThread]: On master: BEGIN
[0m17:02:24.872636 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:02:24.879805 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m17:02:24.880265 [debug] [MainThread]: On master: COMMIT
[0m17:02:24.880624 [debug] [MainThread]: Using postgres connection "master"
[0m17:02:24.880963 [debug] [MainThread]: On master: COMMIT
[0m17:02:24.881416 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:02:24.881783 [debug] [MainThread]: On master: Close
[0m17:02:24.882266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:02:24.882635 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m17:02:24.883085 [info ] [MainThread]: 
[0m17:02:24.883472 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.76 seconds (0.76s).
[0m17:02:24.884994 [debug] [MainThread]: Command end result
[0m17:02:24.920039 [info ] [MainThread]: 
[0m17:02:24.920639 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:02:24.921033 [info ] [MainThread]: 
[0m17:02:24.921411 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:02:24.922320 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8226206, "process_user_time": 2.997973, "process_kernel_time": 0.652945, "process_mem_max_rss": "195452", "process_out_blocks": "3560", "process_in_blocks": "0"}
[0m17:02:24.922954 [debug] [MainThread]: Command `dbt run` succeeded at 17:02:24.922852 after 1.82 seconds
[0m17:02:24.923392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22e37fe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22bcd8d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc22bdcee50>]}
[0m17:02:24.923819 [debug] [MainThread]: Flushing usage events
[0m17:10:54.779022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9db1057c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9d9a5dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9d98b7970>]}


============================== 17:10:54.784567 | 320bbe9a-e90f-4b43-8bb1-db711635c55e ==============================
[0m17:10:54.784567 [info ] [MainThread]: Running with dbt=1.8.3
[0m17:10:54.785159 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:10:54.945656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9d8fbab20>]}
[0m17:10:55.002604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9d8f7b460>]}
[0m17:10:55.003567 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m17:10:55.023319 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m17:10:55.213147 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:10:55.213666 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:10:55.347726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef5d5760>]}
[0m17:10:55.518767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef528a00>]}
[0m17:10:55.519467 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m17:10:55.519937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef5f1fd0>]}
[0m17:10:55.521667 [info ] [MainThread]: 
[0m17:10:55.522383 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m17:10:55.527071 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m17:10:55.562292 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m17:10:55.562822 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m17:10:55.563198 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:10:55.572686 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m17:10:55.574145 [debug] [ThreadPool]: On list_scraping_db: Close
[0m17:10:55.576383 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m17:10:55.583412 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m17:10:55.583884 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m17:10:55.584343 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:10:55.591685 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m17:10:55.592153 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m17:10:55.592590 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m17:10:55.597363 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m17:10:55.598615 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m17:10:55.599141 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m17:10:55.599839 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m17:10:55.602588 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m17:10:55.603013 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m17:10:55.603403 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:10:55.610501 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m17:10:55.610918 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m17:10:55.611352 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m17:10:55.616365 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m17:10:55.617882 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m17:10:55.618450 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m17:10:55.625718 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:55.626142 [debug] [MainThread]: On master: BEGIN
[0m17:10:55.626520 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:10:55.639997 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m17:10:55.640452 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:55.640923 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m17:10:55.647071 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m17:10:55.648308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef528bb0>]}
[0m17:10:55.648846 [debug] [MainThread]: On master: ROLLBACK
[0m17:10:55.649343 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:55.649721 [debug] [MainThread]: On master: BEGIN
[0m17:10:55.650244 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m17:10:55.650613 [debug] [MainThread]: On master: COMMIT
[0m17:10:55.650977 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:55.651324 [debug] [MainThread]: On master: COMMIT
[0m17:10:55.651762 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:10:55.652179 [debug] [MainThread]: On master: Close
[0m17:10:55.652735 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:10:55.653135 [info ] [MainThread]: 
[0m17:10:55.659375 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m17:10:55.660011 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m17:10:55.660579 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m17:10:55.661011 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m17:10:55.669666 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m17:10:55.670305 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m17:10:55.709264 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m17:10:55.710065 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:10:55.710551 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m17:10:55.710934 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:10:55.718276 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:10:55.718782 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:10:55.719283 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m17:10:55.729828 [debug] [Thread-1  ]: SQL status: SELECT 735 in 0.010 seconds
[0m17:10:55.740327 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:10:55.741134 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m17:10:55.742271 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.747808 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:10:55.748471 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m17:10:55.749662 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.772063 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m17:10:55.772638 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:10:55.773062 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m17:10:55.776427 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m17:10:55.783215 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m17:10:55.787579 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m17:10:55.788052 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m17:10:55.791745 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:10:55.794233 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m17:10:55.795906 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef1bd880>]}
[0m17:10:55.796666 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 735[0m in 0.13s]
[0m17:10:55.797372 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m17:10:55.797911 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m17:10:55.798649 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m17:10:55.799417 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m17:10:55.799906 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m17:10:55.803411 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m17:10:55.804070 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m17:10:55.808022 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m17:10:55.808722 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:10:55.809199 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m17:10:55.809611 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:10:55.817169 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:10:55.817642 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:10:55.818097 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m17:10:55.823853 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m17:10:55.827590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:10:55.828050 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m17:10:55.828953 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.832383 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:10:55.832832 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m17:10:55.833587 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.835065 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m17:10:55.835502 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:10:55.835890 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m17:10:55.837120 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:10:55.840895 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m17:10:55.841525 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m17:10:55.841943 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m17:10:55.844939 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:10:55.846264 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m17:10:55.846899 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9da2ec220>]}
[0m17:10:55.847578 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m17:10:55.848262 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m17:10:55.848748 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m17:10:55.849382 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m17:10:55.849886 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m17:10:55.850307 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m17:10:55.853522 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.854137 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m17:10:55.858101 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.858743 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.859176 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m17:10:55.859553 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:10:55.866837 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:10:55.867281 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.867694 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m17:10:55.884475 [debug] [Thread-1  ]: SQL status: SELECT 7350 in 0.016 seconds
[0m17:10:55.888366 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.888832 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m17:10:55.889667 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.892989 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.893434 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m17:10:55.894181 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.895670 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m17:10:55.896156 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.896565 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m17:10:55.899669 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m17:10:55.902467 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m17:10:55.903187 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m17:10:55.903612 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m17:10:55.906860 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:10:55.908255 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m17:10:55.908908 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9d8bdeb20>]}
[0m17:10:55.909602 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 7350[0m in 0.06s]
[0m17:10:55.910248 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m17:10:55.910714 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m17:10:55.911346 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m17:10:55.911850 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m17:10:55.912300 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m17:10:55.916538 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.917148 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m17:10:55.921038 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.921661 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.922105 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m17:10:55.922492 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:10:55.929681 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:10:55.930136 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.930560 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m17:10:55.959454 [debug] [Thread-1  ]: SQL status: SELECT 5430 in 0.028 seconds
[0m17:10:55.963363 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.963831 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m17:10:55.964742 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.968020 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.968473 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m17:10:55.969237 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:55.970641 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m17:10:55.971074 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.971452 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m17:10:55.974466 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m17:10:55.977509 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m17:10:55.978170 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m17:10:55.978592 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m17:10:55.981676 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:10:55.983013 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m17:10:55.983644 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef075730>]}
[0m17:10:55.984344 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 5430[0m in 0.07s]
[0m17:10:55.985001 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m17:10:55.985476 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m17:10:55.986111 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m17:10:55.986607 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m17:10:55.987018 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m17:10:55.990453 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m17:10:55.991071 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m17:10:55.995903 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m17:10:55.996553 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:10:55.996976 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m17:10:55.997347 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:10:56.004573 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:10:56.005048 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:10:56.005469 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m17:10:56.012856 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.007 seconds
[0m17:10:56.016671 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:10:56.017127 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m17:10:56.017926 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:56.021411 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:10:56.021888 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m17:10:56.022665 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:56.024193 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m17:10:56.024637 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:10:56.025030 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m17:10:56.026009 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:10:56.028911 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m17:10:56.029554 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m17:10:56.029980 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m17:10:56.032826 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m17:10:56.034178 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m17:10:56.034843 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef047d90>]}
[0m17:10:56.035550 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 0[0m in 0.05s]
[0m17:10:56.036238 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m17:10:56.036766 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:10:56.037562 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m17:10:56.038140 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m17:10:56.038595 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:10:56.048327 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.049033 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:10:56.079065 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.079683 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp171056072114"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m17:10:56.080182 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:10:56.094404 [debug] [Thread-1  ]: SQL status: SELECT 1151 in 0.014 seconds
[0m17:10:56.109720 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.110294 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m17:10:56.110930 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m17:10:56.111380 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.111812 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp171056072114'
        
      order by ordinal_position

  
[0m17:10:56.124461 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m17:10:56.130824 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.131329 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m17:10:56.135230 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m17:10:56.143885 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.144414 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m17:10:56.148298 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m17:10:56.164940 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.165688 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.166192 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp171056072114"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp171056072114"
    )
  
[0m17:10:56.169970 [debug] [Thread-1  ]: SQL status: INSERT 0 1151 in 0.003 seconds
[0m17:10:56.171369 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m17:10:56.171834 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m17:10:56.172300 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m17:10:56.175409 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m17:10:56.176279 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m17:10:56.176931 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef04c8b0>]}
[0m17:10:56.177669 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 1151[0m in 0.14s]
[0m17:10:56.178339 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m17:10:56.178865 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m17:10:56.179514 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m17:10:56.180070 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m17:10:56.180547 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m17:10:56.183892 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m17:10:56.184531 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m17:10:56.188866 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m17:10:56.189515 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:10:56.189980 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m17:10:56.190408 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m17:10:56.197807 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m17:10:56.198284 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:10:56.198737 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m17:10:56.203427 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m17:10:56.208128 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:10:56.208610 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m17:10:56.209412 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:56.212674 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:10:56.213142 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m17:10:56.213875 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m17:10:56.215365 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m17:10:56.215830 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:10:56.216311 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m17:10:56.217449 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m17:10:56.220302 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m17:10:56.221063 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m17:10:56.221511 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m17:10:56.224524 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m17:10:56.225873 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m17:10:56.226517 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320bbe9a-e90f-4b43-8bb1-db711635c55e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9eefae7f0>]}
[0m17:10:56.227231 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 0[0m in 0.05s]
[0m17:10:56.227920 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m17:10:56.229211 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:56.229640 [debug] [MainThread]: On master: BEGIN
[0m17:10:56.229994 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:10:56.237232 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m17:10:56.237669 [debug] [MainThread]: On master: COMMIT
[0m17:10:56.238055 [debug] [MainThread]: Using postgres connection "master"
[0m17:10:56.238412 [debug] [MainThread]: On master: COMMIT
[0m17:10:56.238854 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m17:10:56.239234 [debug] [MainThread]: On master: Close
[0m17:10:56.239728 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:10:56.240118 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m17:10:56.240596 [info ] [MainThread]: 
[0m17:10:56.241007 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m17:10:56.242542 [debug] [MainThread]: Command end result
[0m17:10:56.278702 [info ] [MainThread]: 
[0m17:10:56.279315 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:10:56.279745 [info ] [MainThread]: 
[0m17:10:56.280197 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m17:10:56.281159 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5516753, "process_user_time": 2.677298, "process_kernel_time": 0.722509, "process_mem_max_rss": "195536", "process_out_blocks": "2464", "process_in_blocks": "0"}
[0m17:10:56.281825 [debug] [MainThread]: Command `dbt run` succeeded at 17:10:56.281711 after 1.55 seconds
[0m17:10:56.282302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9db1057c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9dae1de50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef4e42e0>]}
[0m17:10:56.282758 [debug] [MainThread]: Flushing usage events
[0m06:34:26.755066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f57441527c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5742aaac40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5742906970>]}


============================== 06:34:26.760914 | 7791e398-759a-4108-a06c-fe8e74109245 ==============================
[0m06:34:26.760914 [info ] [MainThread]: Running with dbt=1.8.3
[0m06:34:26.761547 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:34:26.929360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5741ffab20>]}
[0m06:34:26.988332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5741fbc490>]}
[0m06:34:26.989339 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m06:34:27.010270 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m06:34:27.202390 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m06:34:27.203251 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m06:34:27.550771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5757c997c0>]}
[0m06:34:27.718911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5757b8ec70>]}
[0m06:34:27.719610 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m06:34:27.720075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5757c7f670>]}
[0m06:34:27.721823 [info ] [MainThread]: 
[0m06:34:27.722510 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m06:34:27.727203 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m06:34:27.762202 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m06:34:27.762720 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m06:34:27.763098 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:34:27.772390 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m06:34:27.773828 [debug] [ThreadPool]: On list_scraping_db: Close
[0m06:34:27.775766 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m06:34:27.782364 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m06:34:27.782804 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m06:34:27.783158 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:34:27.790471 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m06:34:27.790918 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m06:34:27.791298 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m06:34:27.796523 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m06:34:27.797781 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m06:34:27.798297 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m06:34:27.798972 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m06:34:27.801753 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m06:34:27.802161 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m06:34:27.802495 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:34:27.809641 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m06:34:27.810050 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m06:34:27.810414 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m06:34:27.815589 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m06:34:27.817033 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m06:34:27.817592 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m06:34:27.824393 [debug] [MainThread]: Using postgres connection "master"
[0m06:34:27.824819 [debug] [MainThread]: On master: BEGIN
[0m06:34:27.825174 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:34:27.832379 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m06:34:27.832778 [debug] [MainThread]: Using postgres connection "master"
[0m06:34:27.833188 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m06:34:27.839375 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m06:34:27.840590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5757bb3a60>]}
[0m06:34:27.841119 [debug] [MainThread]: On master: ROLLBACK
[0m06:34:27.841612 [debug] [MainThread]: Using postgres connection "master"
[0m06:34:27.841979 [debug] [MainThread]: On master: BEGIN
[0m06:34:27.842503 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m06:34:27.842868 [debug] [MainThread]: On master: COMMIT
[0m06:34:27.843209 [debug] [MainThread]: Using postgres connection "master"
[0m06:34:27.843532 [debug] [MainThread]: On master: COMMIT
[0m06:34:27.843934 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m06:34:27.844339 [debug] [MainThread]: On master: Close
[0m06:34:27.844871 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:34:27.845262 [info ] [MainThread]: 
[0m06:34:27.852225 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m06:34:27.852891 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m06:34:27.853461 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m06:34:27.853915 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m06:34:27.863335 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m06:34:27.864024 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m06:34:27.902703 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m06:34:27.903551 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:34:27.904055 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m06:34:27.904522 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:34:27.911992 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:34:27.912495 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:34:27.912953 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m06:34:27.924724 [debug] [Thread-1  ]: SQL status: SELECT 795 in 0.011 seconds
[0m06:34:27.935966 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:34:27.936764 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m06:34:27.938074 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:34:27.943699 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:34:27.944440 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m06:34:27.945659 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:34:27.976188 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m06:34:27.977028 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:34:27.977724 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m06:34:27.982992 [debug] [Thread-1  ]: SQL status: COMMIT in 0.005 seconds
[0m06:34:27.994939 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m06:34:28.001301 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:34:28.001876 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m06:34:28.005905 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m06:34:28.008507 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m06:34:28.010212 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5741650490>]}
[0m06:34:28.010963 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 795[0m in 0.16s]
[0m06:34:28.011685 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m06:34:28.012230 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m06:34:28.012923 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m06:34:28.013662 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m06:34:28.014141 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m06:34:28.017692 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m06:34:28.018374 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m06:34:28.022798 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m06:34:28.023566 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:34:28.024051 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m06:34:28.024522 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:34:28.032676 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m06:34:28.033246 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:34:28.033711 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m06:34:28.039487 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m06:34:28.043591 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:34:28.044116 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m06:34:28.045098 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:34:28.048799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:34:28.049288 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m06:34:28.050259 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:34:28.051811 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m06:34:28.052324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:34:28.052749 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m06:34:28.054164 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m06:34:28.057291 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m06:34:28.058003 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:34:28.058453 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m06:34:28.061870 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:34:28.063308 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m06:34:28.063995 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f57585fdac0>]}
[0m06:34:28.064745 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m06:34:28.065422 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m06:34:28.065936 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m06:34:28.066599 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m06:34:28.067153 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m06:34:28.067606 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m06:34:28.072038 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.072732 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m06:34:28.076770 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.077471 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.077939 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m06:34:28.078344 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:34:28.085775 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:34:28.086282 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.086707 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m06:34:28.105027 [debug] [Thread-1  ]: SQL status: SELECT 7950 in 0.018 seconds
[0m06:34:28.109197 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.109727 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m06:34:28.110691 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:34:28.114376 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.114852 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m06:34:28.115702 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:34:28.117273 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m06:34:28.117745 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.118150 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m06:34:28.121763 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m06:34:28.124979 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m06:34:28.125668 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:34:28.126103 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m06:34:28.129574 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:34:28.131070 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m06:34:28.131751 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5743339220>]}
[0m06:34:28.132547 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 7950[0m in 0.06s]
[0m06:34:28.133415 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m06:34:28.133951 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m06:34:28.134612 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m06:34:28.135316 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m06:34:28.135763 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m06:34:28.139439 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.140126 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m06:34:28.145695 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.146396 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.146832 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m06:34:28.147223 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:34:28.155194 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m06:34:28.155710 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.156194 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m06:34:28.186937 [debug] [Thread-1  ]: SQL status: SELECT 5798 in 0.030 seconds
[0m06:34:28.191045 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.191539 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m06:34:28.192590 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:34:28.195972 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.196478 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m06:34:28.197276 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:34:28.198823 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m06:34:28.199282 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.199682 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m06:34:28.202957 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m06:34:28.205816 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m06:34:28.206570 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:34:28.207002 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m06:34:28.210312 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:34:28.211677 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m06:34:28.212366 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5743339220>]}
[0m06:34:28.213090 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 5798[0m in 0.08s]
[0m06:34:28.213937 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m06:34:28.214458 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m06:34:28.215104 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m06:34:28.215779 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m06:34:28.216442 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m06:34:28.220527 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.221168 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m06:34:28.225271 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.225915 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.226335 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m06:34:28.226713 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:34:28.234041 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:34:28.234496 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.234916 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m06:34:28.243312 [debug] [Thread-1  ]: SQL status: SELECT 234 in 0.008 seconds
[0m06:34:28.248369 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.248882 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m06:34:28.249864 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:34:28.254399 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.254927 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m06:34:28.255746 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:34:28.257365 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m06:34:28.257822 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.258220 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m06:34:28.260375 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m06:34:28.263225 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m06:34:28.263891 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:34:28.264355 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m06:34:28.267292 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:34:28.268807 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m06:34:28.269467 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5743339220>]}
[0m06:34:28.270179 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 234[0m in 0.05s]
[0m06:34:28.271030 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m06:34:28.271570 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:34:28.272392 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m06:34:28.273081 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m06:34:28.273533 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:34:28.283329 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.284017 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:34:28.313046 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.313642 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp063428307191"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m06:34:28.314104 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:34:28.328602 [debug] [Thread-1  ]: SQL status: SELECT 1265 in 0.014 seconds
[0m06:34:28.345015 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.345575 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m06:34:28.346249 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m06:34:28.346699 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.347109 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp063428307191'
        
      order by ordinal_position

  
[0m06:34:28.360517 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m06:34:28.431409 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.432010 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m06:34:28.436337 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m06:34:28.445988 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.446566 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m06:34:28.450824 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m06:34:28.471356 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.472543 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.473332 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp063428307191"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp063428307191"
    )
  
[0m06:34:28.480371 [debug] [Thread-1  ]: SQL status: INSERT 0 1265 in 0.006 seconds
[0m06:34:28.482263 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m06:34:28.482828 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:34:28.483397 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m06:34:28.487002 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m06:34:28.488521 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m06:34:28.489507 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5741679790>]}
[0m06:34:28.490660 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 1265[0m in 0.22s]
[0m06:34:28.491757 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:34:28.492564 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m06:34:28.493302 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m06:34:28.493848 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m06:34:28.494277 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m06:34:28.497975 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m06:34:28.498613 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m06:34:28.503010 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m06:34:28.503679 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:34:28.504144 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m06:34:28.504543 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:34:28.512165 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:34:28.512670 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:34:28.513091 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m06:34:28.518935 [debug] [Thread-1  ]: SQL status: SELECT 234 in 0.005 seconds
[0m06:34:28.523037 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:34:28.523531 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m06:34:28.524429 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:34:28.529088 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:34:28.529549 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m06:34:28.530400 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:34:28.532005 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m06:34:28.532492 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:34:28.532896 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m06:34:28.534283 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m06:34:28.537285 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m06:34:28.538074 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:34:28.538511 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m06:34:28.541764 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:34:28.543195 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m06:34:28.543868 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7791e398-759a-4108-a06c-fe8e74109245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f57416d9e80>]}
[0m06:34:28.544629 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 234[0m in 0.05s]
[0m06:34:28.545318 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m06:34:28.546959 [debug] [MainThread]: Using postgres connection "master"
[0m06:34:28.547661 [debug] [MainThread]: On master: BEGIN
[0m06:34:28.548322 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m06:34:28.558898 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m06:34:28.559629 [debug] [MainThread]: On master: COMMIT
[0m06:34:28.560288 [debug] [MainThread]: Using postgres connection "master"
[0m06:34:28.560891 [debug] [MainThread]: On master: COMMIT
[0m06:34:28.561652 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m06:34:28.562296 [debug] [MainThread]: On master: Close
[0m06:34:28.563131 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:34:28.563766 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m06:34:28.564601 [info ] [MainThread]: 
[0m06:34:28.565316 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.84 seconds (0.84s).
[0m06:34:28.568182 [debug] [MainThread]: Command end result
[0m06:34:28.618017 [info ] [MainThread]: 
[0m06:34:28.618814 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:34:28.619470 [info ] [MainThread]: 
[0m06:34:28.620064 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m06:34:28.621126 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9179578, "process_user_time": 3.112737, "process_kernel_time": 0.599222, "process_mem_max_rss": "195480", "process_out_blocks": "3560", "process_in_blocks": "0"}
[0m06:34:28.621759 [debug] [MainThread]: Command `dbt run` succeeded at 06:34:28.621650 after 1.92 seconds
[0m06:34:28.622211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5741fbc490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5743e6ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f57578b1f40>]}
[0m06:34:28.622629 [debug] [MainThread]: Flushing usage events
[0m06:58:11.640027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ca7fa0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8f76af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8f76880>]}


============================== 06:58:11.648921 | f4322ab0-61ff-4954-9357-d698f1735ad4 ==============================
[0m06:58:11.648921 [info ] [MainThread]: Running with dbt=1.8.3
[0m06:58:11.650480 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:58:11.846365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c887fd30>]}
[0m06:58:11.910773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8f83400>]}
[0m06:58:11.911760 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m06:58:11.933962 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m06:58:12.147568 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:58:12.148221 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:58:12.296656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28dedd6790>]}
[0m06:58:12.499566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ded26a30>]}
[0m06:58:12.500331 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m06:58:12.500804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ded43220>]}
[0m06:58:12.502583 [info ] [MainThread]: 
[0m06:58:12.503287 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m06:58:12.508152 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m06:58:12.544809 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m06:58:12.545384 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m06:58:12.545826 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:58:12.555162 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m06:58:12.556773 [debug] [ThreadPool]: On list_scraping_db: Close
[0m06:58:12.558872 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m06:58:12.565996 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m06:58:12.566498 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m06:58:12.566909 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:58:12.574468 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m06:58:12.574949 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m06:58:12.575340 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m06:58:12.580581 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m06:58:12.582118 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m06:58:12.582679 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m06:58:12.583380 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m06:58:12.587831 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m06:58:12.588316 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m06:58:12.588696 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:58:12.596239 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m06:58:12.596713 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m06:58:12.597096 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m06:58:12.602269 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m06:58:12.603638 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m06:58:12.604244 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m06:58:12.610557 [debug] [MainThread]: Using postgres connection "master"
[0m06:58:12.611019 [debug] [MainThread]: On master: BEGIN
[0m06:58:12.611370 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:58:12.618755 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m06:58:12.619239 [debug] [MainThread]: Using postgres connection "master"
[0m06:58:12.619658 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m06:58:12.626065 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m06:58:12.627360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ded26ee0>]}
[0m06:58:12.627938 [debug] [MainThread]: On master: ROLLBACK
[0m06:58:12.628507 [debug] [MainThread]: Using postgres connection "master"
[0m06:58:12.628890 [debug] [MainThread]: On master: BEGIN
[0m06:58:12.629409 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m06:58:12.629781 [debug] [MainThread]: On master: COMMIT
[0m06:58:12.630136 [debug] [MainThread]: Using postgres connection "master"
[0m06:58:12.630480 [debug] [MainThread]: On master: COMMIT
[0m06:58:12.630889 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m06:58:12.631247 [debug] [MainThread]: On master: Close
[0m06:58:12.631803 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:58:12.632241 [info ] [MainThread]: 
[0m06:58:12.638801 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m06:58:12.639473 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m06:58:12.640042 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m06:58:12.640505 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m06:58:12.649415 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m06:58:12.650142 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m06:58:12.689604 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m06:58:12.690450 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:58:12.690942 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m06:58:12.691332 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:58:12.698861 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:58:12.699393 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:58:12.699861 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m06:58:12.712729 [debug] [Thread-1  ]: SQL status: SELECT 1080 in 0.012 seconds
[0m06:58:12.720522 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:58:12.721092 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m06:58:12.722059 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:58:12.725837 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:58:12.726299 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m06:58:12.727127 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:58:12.747773 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m06:58:12.748530 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:58:12.749204 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m06:58:12.754200 [debug] [Thread-1  ]: SQL status: COMMIT in 0.005 seconds
[0m06:58:12.761255 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m06:58:12.765699 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m06:58:12.766208 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m06:58:12.770237 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m06:58:12.772899 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m06:58:12.774617 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28dea23190>]}
[0m06:58:12.775390 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 1080[0m in 0.13s]
[0m06:58:12.776058 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m06:58:12.776585 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m06:58:12.777366 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m06:58:12.778201 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m06:58:12.778687 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m06:58:12.782460 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m06:58:12.783144 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m06:58:12.787288 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m06:58:12.788030 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:58:12.788547 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m06:58:12.788998 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:58:12.796578 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:58:12.797131 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:58:12.797575 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m06:58:12.803462 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m06:58:12.807521 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:58:12.808012 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m06:58:12.809004 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:58:12.812676 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:58:12.813140 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m06:58:12.813993 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:58:12.815520 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m06:58:12.815973 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:58:12.816384 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m06:58:12.817788 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m06:58:12.821780 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m06:58:12.822463 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m06:58:12.822913 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m06:58:12.826488 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:58:12.827946 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m06:58:12.828633 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28de759760>]}
[0m06:58:12.829346 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m06:58:12.829993 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m06:58:12.830475 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m06:58:12.831148 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m06:58:12.831684 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m06:58:12.832124 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m06:58:12.835598 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.836285 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m06:58:12.840537 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.841242 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.841692 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m06:58:12.842098 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:58:12.849630 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:58:12.850144 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.850555 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m06:58:12.872406 [debug] [Thread-1  ]: SQL status: SELECT 10800 in 0.021 seconds
[0m06:58:12.876555 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.877072 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m06:58:12.878062 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:58:12.881660 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.882149 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m06:58:12.883099 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:58:12.884744 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m06:58:12.885207 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.885594 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m06:58:12.889064 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m06:58:12.892161 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m06:58:12.892934 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m06:58:12.893373 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m06:58:12.896805 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:58:12.898284 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m06:58:12.898959 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28de9bd640>]}
[0m06:58:12.899667 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 10800[0m in 0.07s]
[0m06:58:12.900345 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m06:58:12.900851 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m06:58:12.901485 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m06:58:12.902018 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m06:58:12.902428 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m06:58:12.906940 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.907593 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m06:58:12.911803 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.912574 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.913045 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m06:58:12.913444 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:58:12.920914 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:58:12.921432 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.921870 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m06:58:12.959607 [debug] [Thread-1  ]: SQL status: SELECT 6899 in 0.037 seconds
[0m06:58:12.963681 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.964235 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m06:58:12.965208 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:58:12.968822 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.969287 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m06:58:12.970121 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:58:12.971636 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m06:58:12.972095 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.972487 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m06:58:12.976253 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m06:58:12.979423 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m06:58:12.980123 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m06:58:12.980547 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m06:58:12.983996 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:58:12.985508 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m06:58:12.986194 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28de8a0280>]}
[0m06:58:12.986914 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 6899[0m in 0.08s]
[0m06:58:12.987580 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m06:58:12.988074 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m06:58:12.988762 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m06:58:12.989367 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m06:58:12.989804 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m06:58:12.993804 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m06:58:12.994481 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m06:58:12.999839 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m06:58:13.000632 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:58:13.001110 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m06:58:13.001522 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:58:13.009181 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m06:58:13.009688 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:58:13.010109 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m06:58:13.019169 [debug] [Thread-1  ]: SQL status: SELECT 361 in 0.009 seconds
[0m06:58:13.023219 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:58:13.023714 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m06:58:13.024671 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m06:58:13.028465 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:58:13.028947 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m06:58:13.029815 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:58:13.031339 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m06:58:13.031810 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:58:13.032224 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m06:58:13.033275 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m06:58:13.036366 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m06:58:13.037040 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m06:58:13.037457 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m06:58:13.041116 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:58:13.042578 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m06:58:13.043253 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c855d8b0>]}
[0m06:58:13.043970 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 361[0m in 0.05s]
[0m06:58:13.044640 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m06:58:13.045124 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:58:13.045907 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m06:58:13.046437 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m06:58:13.046870 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:58:13.056848 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.057651 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:58:13.087823 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.088458 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp065813080926"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m06:58:13.088904 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:58:13.104908 [debug] [Thread-1  ]: SQL status: SELECT 2226 in 0.016 seconds
[0m06:58:13.120899 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.121494 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m06:58:13.122196 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m06:58:13.122679 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.123098 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp065813080926'
        
      order by ordinal_position

  
[0m06:58:13.136182 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m06:58:13.142840 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.143478 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m06:58:13.147705 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m06:58:13.156716 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.157302 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m06:58:13.161474 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m06:58:13.179006 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.179878 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.180442 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp065813080926"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp065813080926"
    )
  
[0m06:58:13.186527 [debug] [Thread-1  ]: SQL status: INSERT 0 2226 in 0.006 seconds
[0m06:58:13.188155 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m06:58:13.188653 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m06:58:13.189078 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m06:58:13.191637 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m06:58:13.192582 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m06:58:13.193393 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28de7d29d0>]}
[0m06:58:13.194532 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 2226[0m in 0.15s]
[0m06:58:13.195538 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m06:58:13.196214 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m06:58:13.197239 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m06:58:13.198091 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m06:58:13.198715 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m06:58:13.202566 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m06:58:13.203221 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m06:58:13.207453 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m06:58:13.208188 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:58:13.208624 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m06:58:13.209013 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m06:58:13.216506 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m06:58:13.217037 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:58:13.217489 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m06:58:13.223079 [debug] [Thread-1  ]: SQL status: SELECT 361 in 0.005 seconds
[0m06:58:13.228231 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:58:13.228740 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m06:58:13.229678 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:58:13.233254 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:58:13.233724 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m06:58:13.234533 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m06:58:13.236267 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m06:58:13.236738 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:58:13.237177 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m06:58:13.238267 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m06:58:13.241273 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m06:58:13.242073 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m06:58:13.242528 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m06:58:13.245804 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m06:58:13.247295 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m06:58:13.247988 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4322ab0-61ff-4954-9357-d698f1735ad4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28de9b31f0>]}
[0m06:58:13.248749 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 361[0m in 0.05s]
[0m06:58:13.249425 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m06:58:13.250730 [debug] [MainThread]: Using postgres connection "master"
[0m06:58:13.251163 [debug] [MainThread]: On master: BEGIN
[0m06:58:13.251510 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m06:58:13.258859 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m06:58:13.259393 [debug] [MainThread]: On master: COMMIT
[0m06:58:13.259757 [debug] [MainThread]: Using postgres connection "master"
[0m06:58:13.260170 [debug] [MainThread]: On master: COMMIT
[0m06:58:13.260699 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m06:58:13.261090 [debug] [MainThread]: On master: Close
[0m06:58:13.261614 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:58:13.261969 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m06:58:13.262420 [info ] [MainThread]: 
[0m06:58:13.262813 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.76 seconds (0.76s).
[0m06:58:13.264391 [debug] [MainThread]: Command end result
[0m06:58:13.300115 [info ] [MainThread]: 
[0m06:58:13.300769 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:58:13.301183 [info ] [MainThread]: 
[0m06:58:13.301567 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m06:58:13.302509 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.7415155, "process_user_time": 3.155284, "process_kernel_time": 0.669545, "process_mem_max_rss": "195492", "process_out_blocks": "2464", "process_in_blocks": "0"}
[0m06:58:13.303164 [debug] [MainThread]: Command `dbt run` succeeded at 06:58:13.303058 after 1.74 seconds
[0m06:58:13.303617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ca7fa0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c99af9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ded430d0>]}
[0m06:58:13.304059 [debug] [MainThread]: Flushing usage events
[0m07:00:27.129758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98012b45b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97ffc315e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97fff449a0>]}


============================== 07:00:27.135638 | f7a52577-9bf7-438b-885e-221fd9c4cb06 ==============================
[0m07:00:27.135638 [info ] [MainThread]: Running with dbt=1.8.3
[0m07:00:27.136368 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:00:27.303398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97ff17aac0>]}
[0m07:00:27.361803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97ff13b2b0>]}
[0m07:00:27.362821 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m07:00:27.383698 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m07:00:27.575844 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:00:27.576430 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:00:27.716793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98157d5700>]}
[0m07:00:27.890596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98157279a0>]}
[0m07:00:27.891317 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m07:00:27.891810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98157f1fa0>]}
[0m07:00:27.893658 [info ] [MainThread]: 
[0m07:00:27.894406 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m07:00:27.899086 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m07:00:27.948204 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m07:00:27.948990 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m07:00:27.949613 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:00:27.959142 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m07:00:27.960627 [debug] [ThreadPool]: On list_scraping_db: Close
[0m07:00:27.963180 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m07:00:27.973187 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:00:27.973856 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m07:00:27.974448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:00:27.985867 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m07:00:27.986363 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:00:27.986796 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m07:00:27.991789 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m07:00:27.993112 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m07:00:27.993635 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m07:00:27.994349 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m07:00:27.997119 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:00:27.997517 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m07:00:27.997881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:00:28.005457 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m07:00:28.005903 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:00:28.006481 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m07:00:28.011630 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m07:00:28.013938 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m07:00:28.014697 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m07:00:28.022656 [debug] [MainThread]: Using postgres connection "master"
[0m07:00:28.023122 [debug] [MainThread]: On master: BEGIN
[0m07:00:28.023471 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:00:28.030999 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.031453 [debug] [MainThread]: Using postgres connection "master"
[0m07:00:28.031892 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:00:28.038073 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m07:00:28.039318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9815735be0>]}
[0m07:00:28.039867 [debug] [MainThread]: On master: ROLLBACK
[0m07:00:28.040385 [debug] [MainThread]: Using postgres connection "master"
[0m07:00:28.040748 [debug] [MainThread]: On master: BEGIN
[0m07:00:28.041398 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m07:00:28.041793 [debug] [MainThread]: On master: COMMIT
[0m07:00:28.042147 [debug] [MainThread]: Using postgres connection "master"
[0m07:00:28.042475 [debug] [MainThread]: On master: COMMIT
[0m07:00:28.042902 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:00:28.043279 [debug] [MainThread]: On master: Close
[0m07:00:28.043822 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:00:28.044345 [info ] [MainThread]: 
[0m07:00:28.051014 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m07:00:28.051656 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m07:00:28.052275 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m07:00:28.052723 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m07:00:28.061541 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m07:00:28.062204 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m07:00:28.101516 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m07:00:28.102346 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:00:28.102820 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m07:00:28.103213 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:00:28.110635 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.111167 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:00:28.111624 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m07:00:28.125797 [debug] [Thread-1  ]: SQL status: SELECT 1410 in 0.014 seconds
[0m07:00:28.133359 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:00:28.133884 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m07:00:28.134959 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:00:28.138530 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:00:28.138989 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m07:00:28.139842 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.160363 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:00:28.160917 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:00:28.161332 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:00:28.163406 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m07:00:28.169992 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m07:00:28.174331 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:00:28.174796 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m07:00:28.178119 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:00:28.180657 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m07:00:28.182309 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9815438ee0>]}
[0m07:00:28.183045 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 1410[0m in 0.13s]
[0m07:00:28.183736 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m07:00:28.184258 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m07:00:28.184963 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m07:00:28.185719 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m07:00:28.186166 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m07:00:28.189626 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m07:00:28.190257 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m07:00:28.194302 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m07:00:28.194960 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:00:28.195391 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m07:00:28.195765 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:00:28.203060 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.203523 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:00:28.203935 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m07:00:28.209364 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m07:00:28.213138 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:00:28.213597 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m07:00:28.214459 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.217922 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:00:28.218378 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m07:00:28.219186 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.220673 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:00:28.221116 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:00:28.221507 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:00:28.222686 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:00:28.226443 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m07:00:28.227101 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:00:28.227520 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m07:00:28.230330 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m07:00:28.231670 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m07:00:28.232341 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9800497190>]}
[0m07:00:28.233041 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m07:00:28.233688 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m07:00:28.234181 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m07:00:28.234808 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m07:00:28.235327 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m07:00:28.235746 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m07:00:28.239001 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.239633 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m07:00:28.243589 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.244256 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.244686 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m07:00:28.245075 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:00:28.252302 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.252730 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.253145 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m07:00:28.278978 [debug] [Thread-1  ]: SQL status: SELECT 14100 in 0.025 seconds
[0m07:00:28.282923 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.283415 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m07:00:28.284321 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.287604 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.288067 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m07:00:28.288992 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.290524 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:00:28.290968 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.291363 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:00:28.294939 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:00:28.297819 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m07:00:28.298576 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:00:28.299005 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m07:00:28.302224 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:00:28.303644 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m07:00:28.304344 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9815273700>]}
[0m07:00:28.305059 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 14100[0m in 0.07s]
[0m07:00:28.305739 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m07:00:28.306272 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m07:00:28.306924 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m07:00:28.307482 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m07:00:28.307932 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m07:00:28.312387 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.313048 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m07:00:28.317123 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.317826 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.318293 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m07:00:28.318715 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:00:28.326079 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.326552 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.327012 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m07:00:28.374764 [debug] [Thread-1  ]: SQL status: SELECT 8507 in 0.047 seconds
[0m07:00:28.378806 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.379324 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m07:00:28.380425 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:00:28.383945 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.384463 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m07:00:28.385320 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.386811 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:00:28.387277 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.387711 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:00:28.391709 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m07:00:28.394715 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m07:00:28.395420 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:00:28.395876 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m07:00:28.399044 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:00:28.400505 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m07:00:28.401185 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98152a2100>]}
[0m07:00:28.401927 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 8507[0m in 0.09s]
[0m07:00:28.402608 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m07:00:28.403142 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m07:00:28.403784 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m07:00:28.404417 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m07:00:28.404872 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m07:00:28.408527 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.409191 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m07:00:28.414230 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.414915 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.415369 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m07:00:28.415775 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:00:28.423036 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.423512 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.423961 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        la.ad_id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m07:00:28.433498 [debug] [Thread-1  ]: SQL status: SELECT 487 in 0.009 seconds
[0m07:00:28.437278 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.437777 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m07:00:28.438648 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.442084 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.442558 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m07:00:28.443320 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.444809 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:00:28.445280 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.445714 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:00:28.448682 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:00:28.451600 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m07:00:28.452333 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:00:28.452791 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m07:00:28.456003 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:00:28.457438 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m07:00:28.458135 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98152b0580>]}
[0m07:00:28.458853 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 487[0m in 0.05s]
[0m07:00:28.459523 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m07:00:28.460043 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:00:28.460739 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m07:00:28.461411 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m07:00:28.461876 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:00:28.471577 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.472277 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:00:28.502182 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.502780 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp070028495331"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m07:00:28.503226 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:00:28.520625 [debug] [Thread-1  ]: SQL status: SELECT 3240 in 0.017 seconds
[0m07:00:28.535693 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.536290 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m07:00:28.536969 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m07:00:28.537422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.537841 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp070028495331'
        
      order by ordinal_position

  
[0m07:00:28.550241 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m07:00:28.556345 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.556844 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:00:28.560795 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m07:00:28.569211 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.569696 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:00:28.573988 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m07:00:28.590660 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.591422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.591902 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp070028495331"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp070028495331"
    )
  
[0m07:00:28.599770 [debug] [Thread-1  ]: SQL status: INSERT 0 3240 in 0.007 seconds
[0m07:00:28.601237 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:00:28.601703 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:00:28.602110 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:00:28.605384 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:00:28.606262 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m07:00:28.606924 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98151d4880>]}
[0m07:00:28.607637 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 3240[0m in 0.15s]
[0m07:00:28.608333 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:00:28.608830 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m07:00:28.609470 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m07:00:28.610024 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m07:00:28.610456 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m07:00:28.613886 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m07:00:28.614532 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m07:00:28.618610 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m07:00:28.619261 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:00:28.619682 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m07:00:28.620070 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:00:28.627399 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.627854 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:00:28.628309 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m07:00:28.634077 [debug] [Thread-1  ]: SQL status: SELECT 487 in 0.005 seconds
[0m07:00:28.638892 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:00:28.639358 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m07:00:28.640220 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.643538 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:00:28.643986 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m07:00:28.644800 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:00:28.646348 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:00:28.646792 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:00:28.647183 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:00:28.648675 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:00:28.651412 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m07:00:28.652170 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:00:28.652612 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m07:00:28.655695 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:00:28.657094 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m07:00:28.657749 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7a52577-9bf7-438b-885e-221fd9c4cb06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98151d4880>]}
[0m07:00:28.658469 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 487[0m in 0.05s]
[0m07:00:28.659118 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m07:00:28.660412 [debug] [MainThread]: Using postgres connection "master"
[0m07:00:28.660824 [debug] [MainThread]: On master: BEGIN
[0m07:00:28.661166 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:00:28.668292 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m07:00:28.668703 [debug] [MainThread]: On master: COMMIT
[0m07:00:28.669061 [debug] [MainThread]: Using postgres connection "master"
[0m07:00:28.669395 [debug] [MainThread]: On master: COMMIT
[0m07:00:28.669823 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:00:28.670192 [debug] [MainThread]: On master: Close
[0m07:00:28.670677 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:00:28.671031 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m07:00:28.671469 [info ] [MainThread]: 
[0m07:00:28.671857 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.78 seconds (0.78s).
[0m07:00:28.673387 [debug] [MainThread]: Command end result
[0m07:00:28.708592 [info ] [MainThread]: 
[0m07:00:28.709186 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:00:28.709575 [info ] [MainThread]: 
[0m07:00:28.709957 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m07:00:28.710862 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.6319895, "process_user_time": 2.738322, "process_kernel_time": 0.678593, "process_mem_max_rss": "195576", "process_out_blocks": "2464", "process_in_blocks": "0"}
[0m07:00:28.711504 [debug] [MainThread]: Command `dbt run` succeeded at 07:00:28.711402 after 1.63 seconds
[0m07:00:28.711956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98012b45b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98157279a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f981578cf70>]}
[0m07:00:28.712490 [debug] [MainThread]: Flushing usage events
[0m07:28:58.726555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6583ddd0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6582553130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6582553160>]}


============================== 07:28:58.732152 | 69002f9c-bc5d-49ab-87e4-d8269de220dd ==============================
[0m07:28:58.732152 [info ] [MainThread]: Running with dbt=1.8.3
[0m07:28:58.732711 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m07:28:58.901136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6581f01b20>]}
[0m07:28:58.957786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6582a646a0>]}
[0m07:28:58.958709 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m07:28:58.978621 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m07:28:59.166447 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:28:59.167245 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m07:28:59.606536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6597a82c40>]}
[0m07:28:59.777041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65978d50d0>]}
[0m07:28:59.777705 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m07:28:59.778243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6597a8bb50>]}
[0m07:28:59.780000 [info ] [MainThread]: 
[0m07:28:59.780822 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m07:28:59.785350 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m07:28:59.819148 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m07:28:59.819628 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m07:28:59.820004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:28:59.829225 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m07:28:59.830626 [debug] [ThreadPool]: On list_scraping_db: Close
[0m07:28:59.832556 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m07:28:59.839076 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:28:59.839496 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m07:28:59.839861 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:28:59.847174 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m07:28:59.847589 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:28:59.847975 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m07:28:59.853001 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m07:28:59.854386 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m07:28:59.854886 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m07:28:59.855521 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m07:28:59.859477 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:28:59.859886 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m07:28:59.860241 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:28:59.867134 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m07:28:59.867526 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:28:59.867898 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m07:28:59.872972 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m07:28:59.874121 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m07:28:59.874601 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m07:28:59.880892 [debug] [MainThread]: Using postgres connection "master"
[0m07:28:59.881321 [debug] [MainThread]: On master: BEGIN
[0m07:28:59.881663 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:28:59.888746 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m07:28:59.889167 [debug] [MainThread]: Using postgres connection "master"
[0m07:28:59.889590 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:28:59.895692 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m07:28:59.896906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f658173b310>]}
[0m07:28:59.897430 [debug] [MainThread]: On master: ROLLBACK
[0m07:28:59.897954 [debug] [MainThread]: Using postgres connection "master"
[0m07:28:59.898335 [debug] [MainThread]: On master: BEGIN
[0m07:28:59.898889 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m07:28:59.899274 [debug] [MainThread]: On master: COMMIT
[0m07:28:59.899610 [debug] [MainThread]: Using postgres connection "master"
[0m07:28:59.899938 [debug] [MainThread]: On master: COMMIT
[0m07:28:59.900430 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:28:59.900805 [debug] [MainThread]: On master: Close
[0m07:28:59.901399 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:28:59.902058 [info ] [MainThread]: 
[0m07:28:59.909135 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m07:28:59.909789 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m07:28:59.910341 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m07:28:59.910764 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m07:28:59.919623 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m07:28:59.920291 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m07:28:59.960931 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m07:28:59.961684 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:28:59.962142 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m07:28:59.962534 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:28:59.969887 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:28:59.970363 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:28:59.970838 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m07:28:59.983804 [debug] [Thread-1  ]: SQL status: SELECT 1410 in 0.012 seconds
[0m07:28:59.990674 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:28:59.991145 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m07:28:59.992015 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:28:59.995279 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:28:59.995718 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m07:28:59.996512 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.016728 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:29:00.017248 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:29:00.017666 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:29:00.022136 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m07:29:00.028689 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m07:29:00.032980 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:29:00.033435 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m07:29:00.037301 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:29:00.039718 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m07:29:00.041959 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65816f1fd0>]}
[0m07:29:00.043086 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 1410[0m in 0.13s]
[0m07:29:00.044193 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m07:29:00.045021 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m07:29:00.046071 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m07:29:00.046876 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m07:29:00.047346 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m07:29:00.050780 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m07:29:00.051392 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m07:29:00.055329 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m07:29:00.055961 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:29:00.056426 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m07:29:00.056824 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:29:00.064043 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:29:00.064480 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:29:00.064889 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m07:29:00.070056 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m07:29:00.073700 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:29:00.074154 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m07:29:00.074976 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.078306 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:29:00.078759 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m07:29:00.079532 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.080986 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:29:00.081416 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:29:00.081806 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:29:00.083041 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:29:00.086663 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m07:29:00.087332 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:29:00.087780 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m07:29:00.090636 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m07:29:00.091949 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m07:29:00.092618 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65978d55b0>]}
[0m07:29:00.093306 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m07:29:00.093950 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m07:29:00.094420 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m07:29:00.095032 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m07:29:00.095538 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m07:29:00.095965 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m07:29:00.099245 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.099873 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m07:29:00.103747 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.104395 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.104840 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m07:29:00.105230 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:29:00.112461 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:29:00.112908 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.113316 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m07:29:00.139045 [debug] [Thread-1  ]: SQL status: SELECT 14100 in 0.025 seconds
[0m07:29:00.142872 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.143334 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m07:29:00.144192 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.147383 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.147831 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m07:29:00.148675 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.150171 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:29:00.150603 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.150991 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:29:00.154662 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:29:00.157423 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m07:29:00.158253 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:29:00.158696 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m07:29:00.161917 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:29:00.163210 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m07:29:00.163846 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f658135f340>]}
[0m07:29:00.164565 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 14100[0m in 0.07s]
[0m07:29:00.165229 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m07:29:00.165761 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m07:29:00.166407 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m07:29:00.166963 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m07:29:00.167399 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m07:29:00.171589 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.172249 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m07:29:00.176165 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.176822 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.177286 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m07:29:00.177705 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:29:00.185006 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:29:00.185471 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.185935 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m07:29:00.232003 [debug] [Thread-1  ]: SQL status: SELECT 8507 in 0.046 seconds
[0m07:29:00.236257 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.236771 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m07:29:00.237706 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.241105 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.241573 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m07:29:00.242377 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.243826 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:29:00.244328 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.244732 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:29:00.248743 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m07:29:00.251546 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m07:29:00.252225 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:29:00.252648 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m07:29:00.255827 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:29:00.257167 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m07:29:00.257819 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65983beb80>]}
[0m07:29:00.258506 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 8507[0m in 0.09s]
[0m07:29:00.259193 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m07:29:00.259738 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m07:29:00.260402 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m07:29:00.260938 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m07:29:00.261390 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m07:29:00.264804 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.265444 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m07:29:00.270343 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.271003 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.271463 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m07:29:00.271882 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:29:00.279209 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:29:00.279658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.280131 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        ad_id,
		updated_at
    FROM   
        duplicates
)
  );
  
[0m07:29:00.291090 [debug] [Thread-1  ]: SQL status: SELECT 923 in 0.010 seconds
[0m07:29:00.348228 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.348850 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m07:29:00.349870 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:29:00.353225 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.353697 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m07:29:00.354552 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.356070 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:29:00.356601 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.357033 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:29:00.361539 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m07:29:00.364287 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m07:29:00.365061 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:29:00.365516 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m07:29:00.369149 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:29:00.370544 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m07:29:00.371209 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65983beb80>]}
[0m07:29:00.371930 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 923[0m in 0.11s]
[0m07:29:00.372624 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m07:29:00.373177 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:29:00.373853 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m07:29:00.374530 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m07:29:00.374997 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:29:00.384727 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.385403 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:29:00.414943 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.415523 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp072900408033"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m07:29:00.416001 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:29:00.433635 [debug] [Thread-1  ]: SQL status: SELECT 3240 in 0.018 seconds
[0m07:29:00.448658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.449198 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m07:29:00.449872 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m07:29:00.450318 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.450760 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp072900408033'
        
      order by ordinal_position

  
[0m07:29:00.463159 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m07:29:00.468995 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.469474 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:29:00.473182 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m07:29:00.481380 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.481856 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:29:00.485425 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m07:29:00.501793 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.502478 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.502974 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp072900408033"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp072900408033"
    )
  
[0m07:29:00.511654 [debug] [Thread-1  ]: SQL status: INSERT 0 3240 in 0.008 seconds
[0m07:29:00.513051 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:29:00.513493 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:29:00.513894 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:29:00.517258 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:29:00.518112 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m07:29:00.518856 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f658132f8e0>]}
[0m07:29:00.519935 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 3240[0m in 0.14s]
[0m07:29:00.520939 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:29:00.521620 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m07:29:00.522601 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m07:29:00.523378 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m07:29:00.524000 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m07:29:00.527404 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m07:29:00.528013 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m07:29:00.532041 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m07:29:00.532698 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:29:00.533157 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m07:29:00.533546 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:29:00.540692 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:29:00.541110 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:29:00.541506 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m07:29:00.547588 [debug] [Thread-1  ]: SQL status: SELECT 923 in 0.006 seconds
[0m07:29:00.552407 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:29:00.552868 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m07:29:00.553770 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.556984 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:29:00.557455 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m07:29:00.558215 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:29:00.559706 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:29:00.560178 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:29:00.560588 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:29:00.562402 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:29:00.565083 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m07:29:00.565811 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:29:00.566234 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m07:29:00.569269 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:29:00.570578 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m07:29:00.571199 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '69002f9c-bc5d-49ab-87e4-d8269de220dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65813767f0>]}
[0m07:29:00.571880 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 923[0m in 0.05s]
[0m07:29:00.572540 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m07:29:00.573855 [debug] [MainThread]: Using postgres connection "master"
[0m07:29:00.574272 [debug] [MainThread]: On master: BEGIN
[0m07:29:00.574651 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:29:00.581758 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m07:29:00.582178 [debug] [MainThread]: On master: COMMIT
[0m07:29:00.582555 [debug] [MainThread]: Using postgres connection "master"
[0m07:29:00.582919 [debug] [MainThread]: On master: COMMIT
[0m07:29:00.583368 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:29:00.583745 [debug] [MainThread]: On master: Close
[0m07:29:00.584302 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:29:00.584662 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m07:29:00.585102 [info ] [MainThread]: 
[0m07:29:00.585488 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.80 seconds (0.80s).
[0m07:29:00.586956 [debug] [MainThread]: Command end result
[0m07:29:00.621840 [info ] [MainThread]: 
[0m07:29:00.622377 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:29:00.622764 [info ] [MainThread]: 
[0m07:29:00.623152 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m07:29:00.624003 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9474348, "process_user_time": 3.020633, "process_kernel_time": 0.726228, "process_mem_max_rss": "195560", "process_out_blocks": "3560", "process_in_blocks": "0"}
[0m07:29:00.624656 [debug] [MainThread]: Command `dbt run` succeeded at 07:29:00.624554 after 1.95 seconds
[0m07:29:00.625097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6582f899d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6583af4e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6583bd6040>]}
[0m07:29:00.625518 [debug] [MainThread]: Flushing usage events
[0m07:46:32.108639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdaeb2be610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae9a332e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae9a334f0>]}


============================== 07:46:32.114016 | 64a2e9dd-69b0-47c6-9a48-eab49db8dd3f ==============================
[0m07:46:32.114016 [info ] [MainThread]: Running with dbt=1.8.3
[0m07:46:32.114602 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:46:32.119306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7fac15b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7e4395e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7e74b9a0>]}


============================== 07:46:32.124716 | 4858340c-77a7-420c-8d97-d4622bf64d58 ==============================
[0m07:46:32.124716 [info ] [MainThread]: Running with dbt=1.8.3
[0m07:46:32.125267 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:46:32.123174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa20347a0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa201bf0af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa201bf0880>]}


============================== 07:46:32.128539 | 45168b48-c71a-4e63-a0c5-e20e29e86be4 ==============================
[0m07:46:32.128539 [info ] [MainThread]: Running with dbt=1.8.3
[0m07:46:32.129283 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m07:46:32.281510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae9143b20>]}
[0m07:46:32.286626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7d97aac0>]}
[0m07:46:32.306571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa200f91d30>]}
[0m07:46:32.345636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae91374f0>]}
[0m07:46:32.346554 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m07:46:32.348384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7d93c2b0>]}
[0m07:46:32.349405 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m07:46:32.366243 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m07:46:32.374012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa201bee400>]}
[0m07:46:32.374907 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m07:46:32.379319 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m07:46:32.405579 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m07:46:32.609501 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:46:32.610298 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m07:46:32.653954 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:46:32.654775 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m07:46:32.654707 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:46:32.655554 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m07:46:33.030921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdafee81ca0>]}
[0m07:46:33.075082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa21707fbe0>]}
[0m07:46:33.088761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb93682be0>]}
[0m07:46:33.196599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdafecd4130>]}
[0m07:46:33.197278 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m07:46:33.197754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdaff9ac520>]}
[0m07:46:33.199435 [info ] [MainThread]: 
[0m07:46:33.200154 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m07:46:33.204644 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m07:46:33.240336 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m07:46:33.240585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa216ed4100>]}
[0m07:46:33.240851 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m07:46:33.241221 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:46:33.241264 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m07:46:33.241692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2170994c0>]}
[0m07:46:33.243413 [info ] [MainThread]: 
[0m07:46:33.244091 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m07:46:33.248775 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m07:46:33.250622 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m07:46:33.252096 [debug] [ThreadPool]: On list_scraping_db: Close
[0m07:46:33.254523 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m07:46:33.256628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb934cafa0>]}
[0m07:46:33.257328 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m07:46:33.257796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb93698c40>]}
[0m07:46:33.259485 [info ] [MainThread]: 
[0m07:46:33.260179 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m07:46:33.261617 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:46:33.262036 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m07:46:33.262395 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:46:33.265204 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m07:46:33.269837 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.270268 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:46:33.270667 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m07:46:33.275609 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m07:46:33.276826 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m07:46:33.277333 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m07:46:33.277988 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m07:46:33.280615 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:46:33.281016 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m07:46:33.281365 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:46:33.283872 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m07:46:33.284414 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m07:46:33.284827 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:46:33.288666 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.289108 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:46:33.289482 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m07:46:33.294533 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.010 seconds
[0m07:46:33.295627 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m07:46:33.296296 [debug] [ThreadPool]: On list_scraping_db: Close
[0m07:46:33.297203 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m07:46:33.297782 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m07:46:33.299044 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m07:46:33.298882 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m07:46:33.299532 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m07:46:33.299939 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:46:33.308407 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.008 seconds
[0m07:46:33.309493 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.309745 [debug] [ThreadPool]: On list_scraping_db: Close
[0m07:46:33.309738 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:46:33.310192 [debug] [MainThread]: On master: BEGIN
[0m07:46:33.310421 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m07:46:33.310821 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:46:33.311038 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:46:33.311610 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m07:46:33.318333 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:46:33.318748 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m07:46:33.319103 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:46:33.321451 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m07:46:33.321966 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m07:46:33.322013 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.322655 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:46:33.322785 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:46:33.323332 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m07:46:33.326453 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.326856 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:46:33.327227 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m07:46:33.330345 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.007 seconds
[0m07:46:33.331348 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m07:46:33.331767 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m07:46:33.332515 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m07:46:33.332543 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m07:46:33.333321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdafecd40d0>]}
[0m07:46:33.333558 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m07:46:33.333883 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m07:46:33.334164 [debug] [MainThread]: On master: ROLLBACK
[0m07:46:33.334437 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m07:46:33.334935 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.335304 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m07:46:33.335551 [debug] [MainThread]: On master: BEGIN
[0m07:46:33.336359 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m07:46:33.336999 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.337624 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.338015 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:46:33.338247 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.338677 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m07:46:33.339141 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:46:33.338978 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:46:33.339287 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:46:33.339532 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m07:46:33.339601 [debug] [MainThread]: On master: Close
[0m07:46:33.339861 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:46:33.340467 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:46:33.340962 [info ] [MainThread]: 
[0m07:46:33.346905 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.347309 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m07:46:33.347714 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m07:46:33.349709 [debug] [ThreadPool]: SQL status: BEGIN in 0.010 seconds
[0m07:46:33.349833 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m07:46:33.350377 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m07:46:33.350846 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m07:46:33.351049 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m07:46:33.351717 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m07:46:33.352228 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m07:46:33.352843 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m07:46:33.353979 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m07:46:33.354470 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m07:46:33.356057 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m07:46:33.358434 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m07:46:33.359216 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m07:46:33.360474 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.360907 [debug] [MainThread]: On master: BEGIN
[0m07:46:33.361266 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:46:33.362824 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m07:46:33.363452 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m07:46:33.366900 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.367314 [debug] [MainThread]: On master: BEGIN
[0m07:46:33.367660 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:46:33.368359 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.368952 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.369461 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:46:33.375332 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m07:46:33.376539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7d1fa040>]}
[0m07:46:33.377093 [debug] [MainThread]: On master: ROLLBACK
[0m07:46:33.377605 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.378004 [debug] [MainThread]: On master: BEGIN
[0m07:46:33.378132 [debug] [MainThread]: SQL status: BEGIN in 0.010 seconds
[0m07:46:33.378562 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m07:46:33.378773 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.379009 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.379398 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.379765 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.379543 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:46:33.380248 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:46:33.380684 [debug] [MainThread]: On master: Close
[0m07:46:33.381241 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:46:33.381738 [info ] [MainThread]: 
[0m07:46:33.385938 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m07:46:33.387903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa216ed4340>]}
[0m07:46:33.388488 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m07:46:33.388770 [debug] [MainThread]: On master: ROLLBACK
[0m07:46:33.389130 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m07:46:33.389659 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m07:46:33.389571 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.390096 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m07:46:33.390216 [debug] [MainThread]: On master: BEGIN
[0m07:46:33.391035 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m07:46:33.391695 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.392349 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.392967 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.393696 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:46:33.394357 [debug] [MainThread]: On master: Close
[0m07:46:33.395233 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:46:33.395927 [info ] [MainThread]: 
[0m07:46:33.398667 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m07:46:33.399288 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m07:46:33.405604 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m07:46:33.406633 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m07:46:33.407522 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m07:46:33.408262 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m07:46:33.416178 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m07:46:33.416878 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m07:46:33.416921 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.417400 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m07:46:33.417474 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m07:46:33.417815 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.424914 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.425381 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.425846 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m07:46:33.437317 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m07:46:33.438034 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.438042 [debug] [Thread-1  ]: SQL status: SELECT 1142 in 0.012 seconds
[0m07:46:33.438477 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m07:46:33.438856 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.444804 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.445264 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m07:46:33.446012 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.446170 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.446527 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.447077 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m07:46:33.449530 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.449998 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m07:46:33.450804 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.455605 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m07:46:33.456310 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.456751 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m07:46:33.457144 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.464199 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.464656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.465120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m07:46:33.471368 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:46:33.471849 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.472320 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:46:33.476979 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m07:46:33.483451 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m07:46:33.485838 [debug] [Thread-1  ]: SQL status: SELECT 1142 in 0.038 seconds
[0m07:46:33.487854 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.488386 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m07:46:33.492872 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.493351 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m07:46:33.494520 [debug] [Thread-1  ]: Postgres adapter: Postgres error: relation "src_ads__dbt_backup" already exists

[0m07:46:33.494689 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.006 seconds
[0m07:46:33.494961 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m07:46:33.495610 [debug] [Thread-1  ]: Postgres adapter: Error running SQL: macro rename_relation
[0m07:46:33.496503 [debug] [Thread-1  ]: Postgres adapter: Rolling back transaction.
[0m07:46:33.496948 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m07:46:33.497456 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m07:46:33.499174 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae89abfd0>]}
[0m07:46:33.499321 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m07:46:33.499887 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 1142[0m in 0.15s]
[0m07:46:33.500757 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m07:46:33.501115 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7cd0f9a0>]}
[0m07:46:33.501261 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m07:46:33.501901 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.11s]
[0m07:46:33.501947 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m07:46:33.502720 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m07:46:33.502836 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m07:46:33.503197 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m07:46:33.502995 [debug] [Thread-1  ]: SQL status: SELECT 1142 in 0.037 seconds
[0m07:46:33.503675 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m07:46:33.504787 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m07:46:33.505872 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m07:46:33.506710 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m07:46:33.506609 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m07:46:33.507308 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m07:46:33.511281 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m07:46:33.511911 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.512380 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m07:46:33.512768 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.513877 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m07:46:33.514565 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.514818 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m07:46:33.515376 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m07:46:33.516610 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.519811 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.520283 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.520697 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m07:46:33.521338 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m07:46:33.522327 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.522389 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.523077 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m07:46:33.523160 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m07:46:33.523789 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.524299 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.525990 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m07:46:33.529521 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.529970 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m07:46:33.530856 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.534229 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.534171 [debug] [Thread-1  ]: SQL status: BEGIN in 0.010 seconds
[0m07:46:33.534666 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m07:46:33.534946 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.535493 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.535715 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m07:46:33.536947 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:46:33.537389 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.537788 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:46:33.541419 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:46:33.544487 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.008 seconds
[0m07:46:33.545208 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m07:46:33.545893 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.546333 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m07:46:33.549584 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:33.550905 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m07:46:33.550750 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.551383 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:46:33.551515 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m07:46:33.551645 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae89abfd0>]}
[0m07:46:33.552184 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.552691 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m07:46:33.552762 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.552876 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m07:46:33.553943 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m07:46:33.554035 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:46:33.554475 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.555140 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m07:46:33.555686 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m07:46:33.556166 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.558114 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.558875 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m07:46:33.559375 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.560040 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.560106 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.563998 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.564686 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.564788 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m07:46:33.565160 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m07:46:33.565580 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.572185 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m07:46:33.572599 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.573089 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.572975 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m07:46:33.573537 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m07:46:33.576240 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m07:46:33.580234 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m07:46:33.582917 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa200bf3250>]}
[0m07:46:33.584068 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 1142[0m in 0.17s]
[0m07:46:33.584815 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m07:46:33.585315 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m07:46:33.586174 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m07:46:33.586731 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m07:46:33.587159 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m07:46:33.589414 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:46:33.589890 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.590286 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:46:33.590514 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m07:46:33.591119 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m07:46:33.593429 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:46:33.595050 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m07:46:33.595666 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.596126 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m07:46:33.596553 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.597535 [debug] [Thread-1  ]: SQL status: SELECT 11420 in 0.023 seconds
[0m07:46:33.600244 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m07:46:33.601142 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.601587 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m07:46:33.602427 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.603864 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.604655 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.605074 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.605635 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.605429 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m07:46:33.605822 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m07:46:33.606083 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m07:46:33.606886 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.608399 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:46:33.608828 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.609204 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:46:33.611120 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m07:46:33.611332 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m07:46:33.611838 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m07:46:33.614103 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m07:46:33.614826 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.614680 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m07:46:33.615255 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m07:46:33.615701 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4858340c-77a7-420c-8d97-d4622bf64d58', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb934d5520>]}
[0m07:46:33.616820 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.11s]
[0m07:46:33.617883 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.617943 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m07:46:33.618396 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:33.618647 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m07:46:33.618781 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.619766 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m07:46:33.619582 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m07:46:33.619860 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.620500 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae8c70340>]}
[0m07:46:33.620422 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.621226 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m07:46:33.621347 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 11420[0m in 0.06s]
[0m07:46:33.622279 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.622107 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m07:46:33.622861 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m07:46:33.622940 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m07:46:33.623548 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m07:46:33.623721 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.624226 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m07:46:33.624694 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m07:46:33.624593 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m07:46:33.625416 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.625614 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.626226 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.626367 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m07:46:33.627077 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m07:46:33.627652 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:46:33.627853 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.628723 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m07:46:33.629134 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:46:33.629662 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.629571 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m07:46:33.630104 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m07:46:33.630082 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.630408 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m07:46:33.631021 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m07:46:33.631346 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:46:33.631854 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.632506 [debug] [MainThread]: On master: BEGIN
[0m07:46:33.632875 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:46:33.635225 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.635849 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.636327 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m07:46:33.636715 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.636750 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m07:46:33.637832 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m07:46:33.638513 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m07:46:33.640546 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m07:46:33.641013 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.641373 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:33.641704 [debug] [MainThread]: On master: COMMIT
[0m07:46:33.642351 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:46:33.642528 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:33.642778 [debug] [MainThread]: On master: Close
[0m07:46:33.643361 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:46:33.643777 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m07:46:33.644265 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m07:46:33.644403 [info ] [MainThread]: 
[0m07:46:33.645074 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2179bec10>]}
[0m07:46:33.644998 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.38 seconds (0.38s).
[0m07:46:33.645000 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m07:46:33.645705 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.645883 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.06s]
[0m07:46:33.646242 [debug] [MainThread]: Command end result
[0m07:46:33.646437 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m07:46:33.646710 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m07:46:33.647231 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.647860 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m07:46:33.648527 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m07:46:33.648988 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.652205 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.652801 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.656704 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.657320 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.657751 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m07:46:33.658135 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.665196 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.665752 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.666248 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m07:46:33.685910 [info ] [MainThread]: 
[0m07:46:33.686587 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:46:33.687140 [info ] [MainThread]: 
[0m07:46:33.687781 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  relation "src_ads__dbt_backup" already exists
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m07:46:33.688095 [debug] [Thread-1  ]: SQL status: SELECT 5928 in 0.041 seconds
[0m07:46:33.688340 [info ] [MainThread]: 
[0m07:46:33.689013 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m07:46:33.690024 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6204741, "process_user_time": 2.780018, "process_kernel_time": 0.462665, "process_mem_max_rss": "195496", "process_out_blocks": "3408", "command_success": false, "process_in_blocks": "0"}
[0m07:46:33.690635 [debug] [MainThread]: Command `dbt run` failed at 07:46:33.690532 after 1.62 seconds
[0m07:46:33.691094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7f7b1a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7ec6f880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb7f81a820>]}
[0m07:46:33.691531 [debug] [MainThread]: Flushing usage events
[0m07:46:33.692151 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.692658 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m07:46:33.693669 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:46:33.694497 [debug] [Thread-1  ]: SQL status: SELECT 11420 in 0.028 seconds
[0m07:46:33.697136 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.697596 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m07:46:33.698344 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.698403 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.698871 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m07:46:33.699692 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.699856 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:46:33.700336 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.700733 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:46:33.702991 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.703442 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m07:46:33.704238 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:46:33.704505 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:46:33.706012 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:46:33.706454 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.706835 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m07:46:33.707008 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m07:46:33.707662 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.707840 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:46:33.708138 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m07:46:33.710608 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m07:46:33.711199 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:33.711332 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m07:46:33.711760 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m07:46:33.712635 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m07:46:33.713310 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdaea4aa1c0>]}
[0m07:46:33.714022 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 5928[0m in 0.09s]
[0m07:46:33.714700 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m07:46:33.714722 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m07:46:33.715235 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.715906 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m07:46:33.716237 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m07:46:33.716528 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m07:46:33.716908 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa200b5bd30>]}
[0m07:46:33.717151 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.717601 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 11420[0m in 0.07s]
[0m07:46:33.718253 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m07:46:33.718727 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m07:46:33.719339 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m07:46:33.719836 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m07:46:33.720323 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m07:46:33.720693 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.721362 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.724714 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.725307 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m07:46:33.726327 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.727009 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.727456 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m07:46:33.727863 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.729371 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.729977 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.730424 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m07:46:33.730809 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.735131 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.735598 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.736054 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

id_duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        ad_id,
		updated_at
    FROM   
        id_duplicates
)
  );
  
[0m07:46:33.737862 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.738340 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.738814 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m07:46:33.746259 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.010 seconds
[0m07:46:33.788663 [debug] [Thread-1  ]: SQL status: SELECT 5928 in 0.049 seconds
[0m07:46:33.792636 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.793139 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m07:46:33.794103 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:46:33.797525 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.797985 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m07:46:33.798865 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.800333 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:46:33.800764 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.801179 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m07:46:33.805527 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m07:46:33.808383 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m07:46:33.808719 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.809052 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m07:46:33.809285 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m07:46:33.809476 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m07:46:33.810224 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.812463 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:33.813578 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.813788 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m07:46:33.814057 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m07:46:33.814539 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2007df370>]}
[0m07:46:33.814854 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.815615 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 5928[0m in 0.09s]
[0m07:46:33.816442 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:46:33.816585 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m07:46:33.816927 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.817250 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.817407 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:46:33.817902 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m07:46:33.818426 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m07:46:33.818465 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:46:33.818864 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.821200 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m07:46:33.821955 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.822252 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.822409 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m07:46:33.822848 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.825840 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:33.827186 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m07:46:33.827697 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.827922 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdaea4aa1c0>]}
[0m07:46:33.828332 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.828790 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m07:46:33.829178 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.829000 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 601[0m in 0.11s]
[0m07:46:33.829956 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.830607 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.831378 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m07:46:33.831941 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m07:46:33.832420 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.836469 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:33.836994 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.837437 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

id_duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        ad_id,
		updated_at
    FROM   
        id_duplicates
)
  );
  
[0m07:46:33.842052 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.842692 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.847425 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.010 seconds
[0m07:46:33.872217 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.872809 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp074633865314"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m07:46:33.873292 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.889507 [debug] [Thread-1  ]: SQL status: SELECT 2224 in 0.016 seconds
[0m07:46:33.898794 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.899309 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m07:46:33.900446 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:46:33.903662 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.904146 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m07:46:33.904632 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.904912 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:33.905159 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m07:46:33.905817 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m07:46:33.906281 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.906410 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:46:33.906724 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp074633865314'
        
      order by ordinal_position

  
[0m07:46:33.906853 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.907237 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m07:46:33.908352 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:46:33.911088 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m07:46:33.911821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m07:46:33.912317 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m07:46:33.915174 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m07:46:33.916522 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m07:46:33.917175 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2007df370>]}
[0m07:46:33.917883 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 601[0m in 0.10s]
[0m07:46:33.918549 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m07:46:33.919098 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.919751 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m07:46:33.919934 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m07:46:33.920484 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m07:46:33.920995 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.925873 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.926354 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:46:33.932073 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.005 seconds
[0m07:46:33.932663 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.933295 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:33.940097 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.940570 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:46:33.944198 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m07:46:33.960710 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.961361 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.961838 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp074633865314"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp074633865314"
    )
  
[0m07:46:33.962351 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.962844 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp074633955626"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m07:46:33.963277 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:33.968794 [debug] [Thread-1  ]: SQL status: INSERT 0 2224 in 0.006 seconds
[0m07:46:33.970242 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:46:33.970728 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.971192 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:46:33.979062 [debug] [Thread-1  ]: SQL status: SELECT 2224 in 0.016 seconds
[0m07:46:33.993509 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.993991 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m07:46:33.995356 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m07:46:33.995961 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:33.996569 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp074633955626'
        
      order by ordinal_position

  
[0m07:46:33.999079 [debug] [Thread-1  ]: SQL status: COMMIT in 0.027 seconds
[0m07:46:34.000239 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m07:46:34.000931 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae859d130>]}
[0m07:46:34.001670 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 2224[0m in 0.17s]
[0m07:46:34.002358 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:34.002884 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m07:46:34.003561 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m07:46:34.004149 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m07:46:34.004615 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m07:46:34.008134 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m07:46:34.008834 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m07:46:34.010044 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m07:46:34.013046 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m07:46:34.013790 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.014267 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m07:46:34.014697 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:34.016043 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:34.016566 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:46:34.020196 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m07:46:34.021990 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:34.022470 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.022932 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m07:46:34.028414 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:34.028738 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.005 seconds
[0m07:46:34.028912 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m07:46:34.032482 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m07:46:34.033562 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.034060 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m07:46:34.034888 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:34.038139 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.038582 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m07:46:34.039312 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m07:46:34.040836 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:46:34.041280 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.041665 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:46:34.043257 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:46:34.045964 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m07:46:34.046685 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.047118 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m07:46:34.048942 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:34.049609 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:34.050085 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp074633955626"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp074633955626"
    )
  
[0m07:46:34.050370 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:34.051651 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m07:46:34.052296 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64a2e9dd-69b0-47c6-9a48-eab49db8dd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae88ad4f0>]}
[0m07:46:34.052973 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 601[0m in 0.05s]
[0m07:46:34.053605 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m07:46:34.054961 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:34.055389 [debug] [MainThread]: On master: BEGIN
[0m07:46:34.055773 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:46:34.057266 [debug] [Thread-1  ]: SQL status: INSERT 0 2224 in 0.007 seconds
[0m07:46:34.058652 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:46:34.059111 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m07:46:34.059508 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m07:46:34.062562 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m07:46:34.063101 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m07:46:34.063427 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m07:46:34.063514 [debug] [MainThread]: On master: COMMIT
[0m07:46:34.063905 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:34.064071 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2179bec10>]}
[0m07:46:34.064296 [debug] [MainThread]: On master: COMMIT
[0m07:46:34.064811 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:46:34.064790 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 2224[0m in 0.14s]
[0m07:46:34.065191 [debug] [MainThread]: On master: Close
[0m07:46:34.065437 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m07:46:34.065692 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:46:34.065918 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m07:46:34.066067 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m07:46:34.066561 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m07:46:34.066552 [info ] [MainThread]: 
[0m07:46:34.067051 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m07:46:34.067119 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m07:46:34.067582 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m07:46:34.068712 [debug] [MainThread]: Command end result
[0m07:46:34.070833 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m07:46:34.071469 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m07:46:34.075504 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m07:46:34.076180 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.076627 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m07:46:34.077040 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m07:46:34.084157 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m07:46:34.084629 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.085096 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m07:46:34.091256 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.006 seconds
[0m07:46:34.096203 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.096688 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m07:46:34.097866 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:46:34.101441 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.101960 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m07:46:34.103001 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m07:46:34.104695 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:46:34.105226 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.105906 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m07:46:34.106140 [info ] [MainThread]: 
[0m07:46:34.106799 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:46:34.106946 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m07:46:34.107251 [info ] [MainThread]: 
[0m07:46:34.107656 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m07:46:34.108601 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.0495982, "process_user_time": 3.031165, "process_kernel_time": 0.398313, "process_mem_max_rss": "195488", "process_out_blocks": "3560", "process_in_blocks": "0"}
[0m07:46:34.109315 [debug] [MainThread]: Command `dbt run` succeeded at 07:46:34.109205 after 2.05 seconds
[0m07:46:34.109772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdaeb2be610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdaff74d3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdae91374f0>]}
[0m07:46:34.109901 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m07:46:34.110205 [debug] [MainThread]: Flushing usage events
[0m07:46:34.110704 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m07:46:34.111176 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m07:46:34.114998 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m07:46:34.116493 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m07:46:34.117331 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45168b48-c71a-4e63-a0c5-e20e29e86be4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa200a4f640>]}
[0m07:46:34.118170 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 601[0m in 0.05s]
[0m07:46:34.119121 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m07:46:34.120481 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:34.121082 [debug] [MainThread]: On master: BEGIN
[0m07:46:34.121483 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:46:34.130237 [debug] [MainThread]: SQL status: BEGIN in 0.009 seconds
[0m07:46:34.130687 [debug] [MainThread]: On master: COMMIT
[0m07:46:34.131050 [debug] [MainThread]: Using postgres connection "master"
[0m07:46:34.131389 [debug] [MainThread]: On master: COMMIT
[0m07:46:34.131831 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m07:46:34.132245 [debug] [MainThread]: On master: Close
[0m07:46:34.132755 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:46:34.133102 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m07:46:34.133551 [info ] [MainThread]: 
[0m07:46:34.133945 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.89 seconds (0.89s).
[0m07:46:34.135463 [debug] [MainThread]: Command end result
[0m07:46:34.172230 [info ] [MainThread]: 
[0m07:46:34.172830 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:46:34.173353 [info ] [MainThread]: 
[0m07:46:34.173848 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m07:46:34.174842 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1007519, "process_user_time": 3.12998, "process_kernel_time": 0.538276, "process_mem_max_rss": "195560", "process_out_blocks": "3576", "process_in_blocks": "0"}
[0m07:46:34.175505 [debug] [MainThread]: Command `dbt run` succeeded at 07:46:34.175395 after 2.10 seconds
[0m07:46:34.175982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2026299d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2020ac550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa203169e80>]}
[0m07:46:34.176488 [debug] [MainThread]: Flushing usage events
[0m08:18:05.718764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdca146ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdca06621f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc9fbe5790>]}


============================== 08:18:05.724348 | 979535e3-32ea-4a8b-88b2-9fe8c0a7e86d ==============================
[0m08:18:05.724348 [info ] [MainThread]: Running with dbt=1.8.3
[0m08:18:05.725084 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:18:05.886979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc9effaa60>]}
[0m08:18:05.943046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc9efceaf0>]}
[0m08:18:05.943975 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m08:18:05.963415 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m08:18:06.151348 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m08:18:06.152097 [debug] [MainThread]: Partial parsing: added file: scraping_dbt://seeds/mapping_commune_cp.csv
[0m08:18:06.153339 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/sources.yml
[0m08:18:06.868061 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m08:18:06.868663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb4d4ee50>]}
[0m08:18:07.109818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb2b05940>]}
[0m08:18:07.272063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb2a614c0>]}
[0m08:18:07.272753 [info ] [MainThread]: Found 2 seeds, 7 models, 1 snapshot, 4 data tests, 3 sources, 531 macros
[0m08:18:07.273176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb2b1a3a0>]}
[0m08:18:07.274838 [info ] [MainThread]: 
[0m08:18:07.275496 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:18:07.280453 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m08:18:07.375769 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m08:18:07.376360 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m08:18:07.376792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:18:07.386240 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.009 seconds
[0m08:18:07.387664 [debug] [ThreadPool]: On list_scraping_db: Close
[0m08:18:07.389668 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m08:18:07.396145 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m08:18:07.396566 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m08:18:07.396925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:18:07.404095 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.404504 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m08:18:07.404881 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m08:18:07.409887 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m08:18:07.411043 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m08:18:07.411539 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m08:18:07.412190 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m08:18:07.414706 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m08:18:07.415104 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m08:18:07.415443 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:18:07.422309 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.422702 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m08:18:07.423076 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:18:07.428144 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m08:18:07.429480 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m08:18:07.429984 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m08:18:07.437151 [debug] [MainThread]: Using postgres connection "master"
[0m08:18:07.437568 [debug] [MainThread]: On master: BEGIN
[0m08:18:07.437928 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:18:07.444885 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.445301 [debug] [MainThread]: Using postgres connection "master"
[0m08:18:07.445723 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:18:07.451701 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m08:18:07.452868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb2a61730>]}
[0m08:18:07.453381 [debug] [MainThread]: On master: ROLLBACK
[0m08:18:07.453853 [debug] [MainThread]: Using postgres connection "master"
[0m08:18:07.454223 [debug] [MainThread]: On master: BEGIN
[0m08:18:07.454777 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m08:18:07.455229 [debug] [MainThread]: On master: COMMIT
[0m08:18:07.455635 [debug] [MainThread]: Using postgres connection "master"
[0m08:18:07.456022 [debug] [MainThread]: On master: COMMIT
[0m08:18:07.456525 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m08:18:07.456925 [debug] [MainThread]: On master: Close
[0m08:18:07.457483 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:18:07.457940 [info ] [MainThread]: 
[0m08:18:07.464903 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m08:18:07.465597 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m08:18:07.466143 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m08:18:07.466563 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m08:18:07.475316 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m08:18:07.475962 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m08:18:07.514446 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m08:18:07.515171 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:18:07.515660 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m08:18:07.516049 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:18:07.523261 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.523704 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:18:07.524179 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m08:18:07.536060 [debug] [Thread-1  ]: SQL status: SELECT 1142 in 0.011 seconds
[0m08:18:07.542552 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:18:07.543006 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m08:18:07.543848 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.548194 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:18:07.548641 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m08:18:07.549414 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.568406 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m08:18:07.568860 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:18:07.569258 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m08:18:07.573418 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m08:18:07.579810 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m08:18:07.584063 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:18:07.584523 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m08:18:07.588093 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:18:07.590396 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m08:18:07.592005 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdca1253f10>]}
[0m08:18:07.592725 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 1142[0m in 0.12s]
[0m08:18:07.593374 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m08:18:07.593833 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m08:18:07.594476 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m08:18:07.595184 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m08:18:07.595601 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m08:18:07.598851 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m08:18:07.599452 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m08:18:07.603225 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m08:18:07.603838 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:18:07.604290 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m08:18:07.604666 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:18:07.611705 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.612153 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:18:07.612559 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m08:18:07.617864 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m08:18:07.621368 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:18:07.621812 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m08:18:07.622687 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.627017 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:18:07.627513 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m08:18:07.628362 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.629790 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m08:18:07.630269 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:18:07.630711 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m08:18:07.632041 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m08:18:07.634840 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m08:18:07.635508 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:18:07.635980 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m08:18:07.638834 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m08:18:07.640157 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m08:18:07.640794 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdca1253f10>]}
[0m08:18:07.641492 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m08:18:07.642196 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m08:18:07.642794 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m08:18:07.643421 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m08:18:07.643959 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m08:18:07.644516 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m08:18:07.647604 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.648309 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m08:18:07.652146 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.652872 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.653335 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m08:18:07.653757 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:18:07.660939 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.661407 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.661872 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m08:18:07.683882 [debug] [Thread-1  ]: SQL status: SELECT 11420 in 0.022 seconds
[0m08:18:07.687305 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.687809 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m08:18:07.688752 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.692029 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.692539 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m08:18:07.693301 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.694801 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m08:18:07.695291 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.695864 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m08:18:07.698853 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m08:18:07.701640 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m08:18:07.703266 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:18:07.703768 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m08:18:07.706837 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:18:07.708165 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m08:18:07.708813 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb4e8ef70>]}
[0m08:18:07.709513 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 11420[0m in 0.06s]
[0m08:18:07.710256 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m08:18:07.710763 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m08:18:07.711382 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m08:18:07.711960 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m08:18:07.712463 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m08:18:07.715596 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.716310 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m08:18:07.720195 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.720918 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.721386 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m08:18:07.721821 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:18:07.728938 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.729383 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.729804 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m08:18:07.767051 [debug] [Thread-1  ]: SQL status: SELECT 5928 in 0.037 seconds
[0m08:18:07.771192 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.771719 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m08:18:07.772768 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.776523 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.776973 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m08:18:07.777799 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.779236 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m08:18:07.779668 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.780055 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m08:18:07.782965 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m08:18:07.785820 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m08:18:07.786468 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:18:07.786887 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m08:18:07.790022 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:18:07.791529 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m08:18:07.792209 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb4eaa070>]}
[0m08:18:07.792899 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 5928[0m in 0.08s]
[0m08:18:07.793540 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m08:18:07.794031 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m08:18:07.794657 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m08:18:07.795177 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m08:18:07.795583 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m08:18:07.799044 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.799643 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m08:18:07.804517 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.805181 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.805595 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m08:18:07.805959 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:18:07.813002 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:18:07.813430 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.813832 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

id_duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        ad_id,
		updated_at
    FROM   
        id_duplicates
)
  );
  
[0m08:18:07.825164 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.011 seconds
[0m08:18:07.830963 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.831708 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m08:18:07.832820 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:18:07.836504 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.836951 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m08:18:07.837782 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:07.839217 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m08:18:07.839655 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.840052 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m08:18:07.843121 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m08:18:07.845908 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m08:18:07.846571 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:18:07.846987 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m08:18:07.850482 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:18:07.851794 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m08:18:07.852455 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc9efa4220>]}
[0m08:18:07.853181 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 601[0m in 0.06s]
[0m08:18:07.853827 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m08:18:07.854297 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:18:07.855094 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m08:18:07.855627 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m08:18:07.856159 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:18:07.862658 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:07.863287 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:18:07.897074 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:07.897631 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp081807891020"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m08:18:07.898083 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:18:07.915264 [debug] [Thread-1  ]: SQL status: SELECT 2224 in 0.017 seconds
[0m08:18:07.932535 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:07.933366 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m08:18:07.934092 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m08:18:07.934522 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:07.935034 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp081807891020'
        
      order by ordinal_position

  
[0m08:18:07.952415 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.017 seconds
[0m08:18:07.958554 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:07.959095 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m08:18:07.964571 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.005 seconds
[0m08:18:07.977081 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:07.977805 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m08:18:07.982315 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m08:18:08.007225 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:08.007982 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:08.008537 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp081807891020"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp081807891020"
    )
  
[0m08:18:08.016932 [debug] [Thread-1  ]: SQL status: INSERT 0 2224 in 0.008 seconds
[0m08:18:08.018392 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m08:18:08.018839 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:18:08.019235 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m08:18:08.023254 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m08:18:08.024273 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m08:18:08.024955 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc9efa4220>]}
[0m08:18:08.025728 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 2224[0m in 0.17s]
[0m08:18:08.026571 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:18:08.027166 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m08:18:08.027827 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m08:18:08.028506 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m08:18:08.028935 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m08:18:08.032506 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m08:18:08.033122 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m08:18:08.038217 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m08:18:08.039008 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:18:08.039463 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m08:18:08.039841 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:18:08.048155 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m08:18:08.048624 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:18:08.049044 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m08:18:08.055900 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.006 seconds
[0m08:18:08.059646 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:18:08.060115 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m08:18:08.060967 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:08.064290 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:18:08.064736 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m08:18:08.065465 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:18:08.066981 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m08:18:08.067422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:18:08.067807 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m08:18:08.069246 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m08:18:08.072123 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m08:18:08.072771 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:18:08.073212 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m08:18:08.076389 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:18:08.077697 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m08:18:08.078320 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '979535e3-32ea-4a8b-88b2-9fe8c0a7e86d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb4de6820>]}
[0m08:18:08.078991 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 601[0m in 0.05s]
[0m08:18:08.079816 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m08:18:08.081082 [debug] [MainThread]: Using postgres connection "master"
[0m08:18:08.081503 [debug] [MainThread]: On master: BEGIN
[0m08:18:08.081844 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:18:08.089054 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m08:18:08.089485 [debug] [MainThread]: On master: COMMIT
[0m08:18:08.089832 [debug] [MainThread]: Using postgres connection "master"
[0m08:18:08.090168 [debug] [MainThread]: On master: COMMIT
[0m08:18:08.090609 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m08:18:08.090978 [debug] [MainThread]: On master: Close
[0m08:18:08.091476 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:18:08.091832 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m08:18:08.092317 [info ] [MainThread]: 
[0m08:18:08.092726 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m08:18:08.094340 [debug] [MainThread]: Command end result
[0m08:18:08.130901 [info ] [MainThread]: 
[0m08:18:08.131505 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:18:08.131939 [info ] [MainThread]: 
[0m08:18:08.132394 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m08:18:08.133323 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4640343, "process_user_time": 3.523688, "process_kernel_time": 0.707121, "process_mem_max_rss": "195548", "process_out_blocks": "3584", "process_in_blocks": "0"}
[0m08:18:08.133968 [debug] [MainThread]: Command `dbt run` succeeded at 08:18:08.133861 after 2.46 seconds
[0m08:18:08.134433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdca146ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdcb4f87430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc9efceaf0>]}
[0m08:18:08.134886 [debug] [MainThread]: Flushing usage events
[0m08:19:31.689450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bf4b82700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bf32f7970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bf32f7520>]}


============================== 08:19:31.695369 | 2b67373d-24b1-4c36-8adb-2168df51bb26 ==============================
[0m08:19:31.695369 [info ] [MainThread]: Running with dbt=1.8.3
[0m08:19:31.695982 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m08:19:31.861373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bf2ca3f10>]}
[0m08:19:31.918172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bf32f6460>]}
[0m08:19:31.919040 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m08:19:31.938975 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m08:19:32.127062 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:19:32.127569 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:19:32.259854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c09197e80>]}
[0m08:19:32.433347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c090e6340>]}
[0m08:19:32.434048 [info ] [MainThread]: Found 2 seeds, 7 models, 1 snapshot, 4 data tests, 3 sources, 531 macros
[0m08:19:32.434522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c091a9ca0>]}
[0m08:19:32.436305 [info ] [MainThread]: 
[0m08:19:32.437040 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:19:32.441654 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m08:19:32.476537 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m08:19:32.476999 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m08:19:32.477368 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:19:32.492284 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.015 seconds
[0m08:19:32.493657 [debug] [ThreadPool]: On list_scraping_db: Close
[0m08:19:32.495607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m08:19:32.502140 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m08:19:32.502543 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m08:19:32.502887 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:19:32.510000 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m08:19:32.510426 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m08:19:32.510786 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:19:32.516005 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m08:19:32.517428 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m08:19:32.517951 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m08:19:32.518716 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m08:19:32.522797 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m08:19:32.523231 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m08:19:32.523573 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:19:32.530506 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m08:19:32.530880 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m08:19:32.531227 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m08:19:32.536031 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m08:19:32.537241 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m08:19:32.537762 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m08:19:32.543611 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:32.544020 [debug] [MainThread]: On master: BEGIN
[0m08:19:32.544380 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:19:32.551316 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m08:19:32.551741 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:32.552195 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:19:32.558376 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m08:19:32.559573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c091560d0>]}
[0m08:19:32.560126 [debug] [MainThread]: On master: ROLLBACK
[0m08:19:32.560605 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:32.560964 [debug] [MainThread]: On master: BEGIN
[0m08:19:32.561466 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m08:19:32.561837 [debug] [MainThread]: On master: COMMIT
[0m08:19:32.562176 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:32.562489 [debug] [MainThread]: On master: COMMIT
[0m08:19:32.562890 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m08:19:32.563232 [debug] [MainThread]: On master: Close
[0m08:19:32.563741 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:19:32.564173 [info ] [MainThread]: 
[0m08:19:32.570566 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m08:19:32.571248 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m08:19:32.571894 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m08:19:32.572364 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m08:19:32.581186 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m08:19:32.581815 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m08:19:32.621194 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m08:19:32.622025 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:19:32.622562 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m08:19:32.622963 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:32.630336 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:19:32.630800 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:19:32.631273 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    SPLIT_PART(lieu, '(', 1) AS ad_city,
    SPLIT_PART(SPLIT_PART(lieu, '(', 2), ')', 1) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    SUBSTRING(SPLIT_PART(url, '-', -2), 1, 2) AS ad_department,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(ROUND(CAST(REPLACE(prix_m2, ' ', '') AS NUMERIC)) AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    created_at,
    updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m08:19:32.643284 [debug] [Thread-1  ]: SQL status: SELECT 1142 in 0.012 seconds
[0m08:19:32.652059 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:19:32.652554 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m08:19:32.653392 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.657419 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:19:32.657874 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m08:19:32.658641 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.677844 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m08:19:32.678291 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:19:32.678673 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m08:19:32.683050 [debug] [Thread-1  ]: SQL status: COMMIT in 0.004 seconds
[0m08:19:32.689355 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m08:19:32.693590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m08:19:32.694032 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m08:19:32.697268 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:19:32.699615 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m08:19:32.701232 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08d1c460>]}
[0m08:19:32.701928 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 1142[0m in 0.13s]
[0m08:19:32.702620 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m08:19:32.703158 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m08:19:32.703831 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m08:19:32.704774 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m08:19:32.705230 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m08:19:32.708563 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m08:19:32.709202 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m08:19:32.713109 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m08:19:32.713718 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:19:32.714137 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m08:19:32.714500 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:32.721705 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:19:32.722206 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:19:32.722623 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m08:19:32.728061 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m08:19:32.731563 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:19:32.732012 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m08:19:32.732938 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.737118 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:19:32.737573 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m08:19:32.738444 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.739890 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m08:19:32.740348 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:19:32.740737 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m08:19:32.741962 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m08:19:32.744852 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m08:19:32.745487 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m08:19:32.745900 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m08:19:32.748835 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:19:32.750129 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m08:19:32.750850 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08d1c460>]}
[0m08:19:32.751878 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m08:19:32.752831 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m08:19:32.753454 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m08:19:32.754077 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m08:19:32.754582 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m08:19:32.754987 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m08:19:32.758171 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.758767 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m08:19:32.762700 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.763315 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.763759 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m08:19:32.764175 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:32.771889 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m08:19:32.772387 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.773059 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m08:19:32.796023 [debug] [Thread-1  ]: SQL status: SELECT 11420 in 0.022 seconds
[0m08:19:32.799643 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.800116 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m08:19:32.801071 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m08:19:32.804460 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.804898 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m08:19:32.805633 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.807154 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m08:19:32.807580 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.807955 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m08:19:32.810952 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m08:19:32.813976 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m08:19:32.815579 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m08:19:32.816061 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m08:19:32.819415 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:19:32.820762 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m08:19:32.821386 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08b57ac0>]}
[0m08:19:32.822058 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 11420[0m in 0.07s]
[0m08:19:32.822759 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m08:19:32.823316 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m08:19:32.823935 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m08:19:32.824544 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m08:19:32.824980 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m08:19:32.828254 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.828857 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m08:19:32.832778 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.833392 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.833799 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m08:19:32.834172 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:32.841472 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:19:32.841931 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.842373 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m08:19:32.877926 [debug] [Thread-1  ]: SQL status: SELECT 5928 in 0.035 seconds
[0m08:19:32.881569 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.882014 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m08:19:32.882863 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.886085 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.886508 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m08:19:32.887258 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.888657 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m08:19:32.889089 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.889460 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m08:19:32.892744 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m08:19:32.897087 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m08:19:32.898147 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m08:19:32.898815 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m08:19:32.901930 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:19:32.904009 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m08:19:32.904925 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08b41b80>]}
[0m08:19:32.905845 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 5928[0m in 0.08s]
[0m08:19:32.906552 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m08:19:32.907177 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m08:19:32.907835 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m08:19:32.908672 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m08:19:32.909117 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m08:19:32.912517 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.913120 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m08:19:32.917958 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.918558 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.919270 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m08:19:32.919916 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:32.927160 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:19:32.927576 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.927978 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

id_duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.ad_id = la.ad_id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.ad_id IS NULL
)

SELECT * FROM src_ads
WHERE (ad_id, updated_at) NOT IN (
    SELECT 
        ad_id,
		updated_at
    FROM   
        id_duplicates
)
  );
  
[0m08:19:32.937721 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.009 seconds
[0m08:19:32.941070 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.941497 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned" rename to "src_ads_cleaned__dbt_backup"
[0m08:19:32.942280 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.945419 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.945850 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
alter table "scraping_db"."public"."src_ads_cleaned__dbt_tmp" rename to "src_ads_cleaned"
[0m08:19:32.946544 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:32.947923 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m08:19:32.948359 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.948726 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: COMMIT
[0m08:19:32.951898 [debug] [Thread-1  ]: SQL status: COMMIT in 0.003 seconds
[0m08:19:32.954563 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads_cleaned__dbt_backup"
[0m08:19:32.955187 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m08:19:32.955587 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */
drop table if exists "scraping_db"."public"."src_ads_cleaned__dbt_backup" cascade
[0m08:19:32.958653 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:19:32.959924 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m08:19:32.960569 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08b2aac0>]}
[0m08:19:32.961252 [info ] [Thread-1  ]: 5 of 7 OK created sql table model public.src_ads_cleaned ....................... [[32mSELECT 601[0m in 0.05s]
[0m08:19:32.961992 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m08:19:32.962470 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:19:32.963207 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m08:19:32.963804 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m08:19:32.964267 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:19:32.973772 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:32.974363 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:19:33.003229 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.003782 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp081932997501"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m08:19:33.004225 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:33.020004 [debug] [Thread-1  ]: SQL status: SELECT 2224 in 0.016 seconds
[0m08:19:33.034684 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.035192 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m08:19:33.035789 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m08:19:33.036301 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.036729 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp081932997501'
        
      order by ordinal_position

  
[0m08:19:33.049222 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m08:19:33.055001 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.055501 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m08:19:33.059128 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m08:19:33.067269 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.067755 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m08:19:33.071294 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m08:19:33.087754 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.088486 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.088977 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp081932997501"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp081932997501"
    )
  
[0m08:19:33.095099 [debug] [Thread-1  ]: SQL status: INSERT 0 2224 in 0.006 seconds
[0m08:19:33.096431 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m08:19:33.096870 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m08:19:33.097247 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m08:19:33.099846 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m08:19:33.100692 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m08:19:33.101321 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08c39910>]}
[0m08:19:33.101999 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 2224[0m in 0.14s]
[0m08:19:33.102678 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m08:19:33.103167 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m08:19:33.103786 [info ] [Thread-1  ]: 7 of 7 START sql table model public.dim_ads_details ............................ [RUN]
[0m08:19:33.104437 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned_backup_incremental, now model.scraping_dbt.dim_ads_details)
[0m08:19:33.105057 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_details
[0m08:19:33.109225 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_details"
[0m08:19:33.109826 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_details
[0m08:19:33.114730 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_details"
[0m08:19:33.115347 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:19:33.115796 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: BEGIN
[0m08:19:33.116233 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:33.123328 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:19:33.123740 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:19:33.124169 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */

  
    

  create  table "scraping_db"."public"."dim_ads_details__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads_cleaned AS (
    SELECT * FROM "scraping_db"."public"."src_ads_cleaned"
)

SELECT 
    ad_id,
    ad_url,
    ad_city,
    ad_zipcode,
    ad_nb_bedrooms,
    ad_nb_rooms,
    ad_date_scraped AS ad_last_date_scraped,
    ad_published_on AS ad_last_published_on,
    created_at,
    updated_at
FROM
    src_ads_cleaned
  );
  
[0m08:19:33.129960 [debug] [Thread-1  ]: SQL status: SELECT 601 in 0.005 seconds
[0m08:19:33.133430 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:19:33.133891 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details" rename to "dim_ads_details__dbt_backup"
[0m08:19:33.134657 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:33.137865 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:19:33.138311 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
alter table "scraping_db"."public"."dim_ads_details__dbt_tmp" rename to "dim_ads_details"
[0m08:19:33.139035 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m08:19:33.140552 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m08:19:33.141018 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:19:33.141434 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: COMMIT
[0m08:19:33.142944 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m08:19:33.145672 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_details__dbt_backup"
[0m08:19:33.146392 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_details"
[0m08:19:33.146811 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_details"} */
drop table if exists "scraping_db"."public"."dim_ads_details__dbt_backup" cascade
[0m08:19:33.149796 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m08:19:33.151076 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_details: Close
[0m08:19:33.151794 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b67373d-24b1-4c36-8adb-2168df51bb26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c08b354f0>]}
[0m08:19:33.152842 [info ] [Thread-1  ]: 7 of 7 OK created sql table model public.dim_ads_details ....................... [[32mSELECT 601[0m in 0.05s]
[0m08:19:33.153766 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m08:19:33.155081 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:33.155487 [debug] [MainThread]: On master: BEGIN
[0m08:19:33.155833 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:19:33.163092 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m08:19:33.163514 [debug] [MainThread]: On master: COMMIT
[0m08:19:33.163856 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:33.164277 [debug] [MainThread]: On master: COMMIT
[0m08:19:33.164711 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m08:19:33.165081 [debug] [MainThread]: On master: Close
[0m08:19:33.165544 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:19:33.165888 [debug] [MainThread]: Connection 'model.scraping_dbt.dim_ads_details' was properly closed.
[0m08:19:33.166301 [info ] [MainThread]: 
[0m08:19:33.166719 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.73 seconds (0.73s).
[0m08:19:33.168339 [debug] [MainThread]: Command end result
[0m08:19:33.203888 [info ] [MainThread]: 
[0m08:19:33.204528 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:19:33.205028 [info ] [MainThread]: 
[0m08:19:33.205494 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m08:19:33.206434 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.5671585, "process_user_time": 2.65558, "process_kernel_time": 0.69276, "process_mem_max_rss": "136148", "process_out_blocks": "2472", "process_in_blocks": "0"}
[0m08:19:33.207044 [debug] [MainThread]: Command `dbt run` succeeded at 08:19:33.206942 after 1.57 seconds
[0m08:19:33.207483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bf4b82700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bf4879a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c090f26a0>]}
[0m08:19:33.207907 [debug] [MainThread]: Flushing usage events
[0m08:19:51.989876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b971517c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b95aaac40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b95905970>]}


============================== 08:19:51.995306 | bd5bcabb-337c-4030-ab2f-444e2c2a452d ==============================
[0m08:19:51.995306 [info ] [MainThread]: Running with dbt=1.8.3
[0m08:19:51.995920 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt seed --profiles-dir /opt/airflow/dbt_profiles', 'send_anonymous_usage_stats': 'True'}
[0m08:19:52.159410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b94ffab20>]}
[0m08:19:52.217808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b94fbc490>]}
[0m08:19:52.218724 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m08:19:52.238733 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m08:19:52.426978 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:19:52.427492 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:19:52.558924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bab58cdf0>]}
[0m08:19:52.726085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bab5ad3d0>]}
[0m08:19:52.726733 [info ] [MainThread]: Found 2 seeds, 7 models, 1 snapshot, 4 data tests, 3 sources, 531 macros
[0m08:19:52.727171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bab5ad400>]}
[0m08:19:52.728821 [info ] [MainThread]: 
[0m08:19:52.729499 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m08:19:52.733657 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m08:19:52.771227 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m08:19:52.771676 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m08:19:52.772035 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:19:52.787423 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.015 seconds
[0m08:19:52.788787 [debug] [ThreadPool]: On list_scraping_db: Close
[0m08:19:52.790687 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m08:19:52.797098 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m08:19:52.797499 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m08:19:52.797859 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:19:52.804909 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m08:19:52.805292 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m08:19:52.805645 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m08:19:52.810392 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m08:19:52.811505 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m08:19:52.811978 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m08:19:52.812617 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m08:19:52.815121 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m08:19:52.815497 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m08:19:52.815817 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:19:52.822599 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m08:19:52.822989 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m08:19:52.823356 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m08:19:52.828213 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.004 seconds
[0m08:19:52.829514 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m08:19:52.830001 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m08:19:52.836773 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:52.837177 [debug] [MainThread]: On master: BEGIN
[0m08:19:52.837526 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:19:52.844384 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m08:19:52.844801 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:52.845210 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m08:19:52.851137 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m08:19:52.852251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bab531550>]}
[0m08:19:52.852749 [debug] [MainThread]: On master: ROLLBACK
[0m08:19:52.853218 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:52.853581 [debug] [MainThread]: On master: BEGIN
[0m08:19:52.854109 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m08:19:52.854518 [debug] [MainThread]: On master: COMMIT
[0m08:19:52.854882 [debug] [MainThread]: Using postgres connection "master"
[0m08:19:52.855226 [debug] [MainThread]: On master: COMMIT
[0m08:19:52.855635 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m08:19:52.856001 [debug] [MainThread]: On master: Close
[0m08:19:52.856543 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:19:52.856988 [info ] [MainThread]: 
[0m08:19:52.863139 [debug] [Thread-1  ]: Began running node seed.scraping_dbt.mapping_commune_cp
[0m08:19:52.863748 [info ] [Thread-1  ]: 1 of 2 START seed file public.mapping_commune_cp ............................... [RUN]
[0m08:19:52.864364 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now seed.scraping_dbt.mapping_commune_cp)
[0m08:19:52.864785 [debug] [Thread-1  ]: Began compiling node seed.scraping_dbt.mapping_commune_cp
[0m08:19:52.865186 [debug] [Thread-1  ]: Began executing node seed.scraping_dbt.mapping_commune_cp
[0m08:19:53.683200 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.mapping_commune_cp"
[0m08:19:53.683803 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: BEGIN
[0m08:19:53.684231 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:19:53.691627 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:19:53.692162 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.mapping_commune_cp"
[0m08:19:53.692591 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "seed.scraping_dbt.mapping_commune_cp"} */

    create table "scraping_db"."public"."mapping_commune_cp" ("Code INSEE" text,"Code Postal" text,"Commune" text,"Superficie" integer,"Code Département" text,"Code Région" integer)
  
[0m08:19:53.697228 [debug] [Thread-1  ]: SQL status: CREATE TABLE in 0.004 seconds
[0m08:19:58.185467 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.mapping_commune_cp"
[0m08:19:58.186097 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: 
          insert into "scraping_db"."public"."mapping_commune_cp" ("Code INSEE", "Code Postal", "Commune", "Superficie", "Code Département", "Code Région") values
          (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
[0m08:19:58.287693 [debug] [Thread-1  ]: SQL status: INSERT 0 10000 in 0.101 seconds
[0m08:20:02.813066 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.mapping_commune_cp"
[0m08:20:02.813655 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: 
          insert into "scraping_db"."public"."mapping_commune_cp" ("Code INSEE", "Code Postal", "Commune", "Superficie", "Code Département", "Code Région") values
          (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
[0m08:20:02.917335 [debug] [Thread-1  ]: SQL status: INSERT 0 10000 in 0.103 seconds
[0m08:20:07.409015 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.mapping_commune_cp"
[0m08:20:07.409621 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: 
          insert into "scraping_db"."public"."mapping_commune_cp" ("Code INSEE", "Code Postal", "Commune", "Superficie", "Code Département", "Code Région") values
          (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
[0m08:20:07.509984 [debug] [Thread-1  ]: SQL status: INSERT 0 10000 in 0.100 seconds
[0m08:20:10.596880 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.mapping_commune_cp"
[0m08:20:10.597491 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: 
          insert into "scraping_db"."public"."mapping_commune_cp" ("Code INSEE", "Code Postal", "Commune", "Superficie", "Code Département", "Code Région") values
          (%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s...
[0m08:20:10.666940 [debug] [Thread-1  ]: SQL status: INSERT 0 6742 in 0.069 seconds
[0m08:20:10.673844 [debug] [Thread-1  ]: Writing runtime SQL for node "seed.scraping_dbt.mapping_commune_cp"
[0m08:20:10.692706 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: COMMIT
[0m08:20:10.693218 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.mapping_commune_cp"
[0m08:20:10.693624 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: COMMIT
[0m08:20:10.720244 [debug] [Thread-1  ]: SQL status: COMMIT in 0.026 seconds
[0m08:20:10.722324 [debug] [Thread-1  ]: On seed.scraping_dbt.mapping_commune_cp: Close
[0m08:20:10.724652 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bab173760>]}
[0m08:20:10.725532 [info ] [Thread-1  ]: 1 of 2 OK loaded seed file public.mapping_commune_cp ........................... [[32mINSERT 36742[0m in 17.86s]
[0m08:20:10.726323 [debug] [Thread-1  ]: Finished running node seed.scraping_dbt.mapping_commune_cp
[0m08:20:10.726819 [debug] [Thread-1  ]: Began running node seed.scraping_dbt.prix_m2_commune
[0m08:20:10.727484 [info ] [Thread-1  ]: 2 of 2 START seed file public.prix_m2_commune .................................. [RUN]
[0m08:20:10.728044 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly seed.scraping_dbt.mapping_commune_cp, now seed.scraping_dbt.prix_m2_commune)
[0m08:20:10.728507 [debug] [Thread-1  ]: Began compiling node seed.scraping_dbt.prix_m2_commune
[0m08:20:10.728899 [debug] [Thread-1  ]: Began executing node seed.scraping_dbt.prix_m2_commune
[0m08:20:10.745036 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m08:20:10.745495 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: BEGIN
[0m08:20:10.745872 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m08:20:10.753165 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m08:20:10.753597 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m08:20:10.753976 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "seed.scraping_dbt.prix_m2_commune"} */
truncate table "scraping_db"."public"."prix_m2_commune"
[0m08:20:10.757013 [debug] [Thread-1  ]: SQL status: TRUNCATE TABLE in 0.003 seconds
[0m08:20:10.831941 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m08:20:10.832491 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: 
          insert into "scraping_db"."public"."prix_m2_commune" ("zipcode", "city_name", "house_type", "prix_m2") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s...
[0m08:20:10.835435 [debug] [Thread-1  ]: SQL status: INSERT 0 246 in 0.002 seconds
[0m08:20:10.836145 [debug] [Thread-1  ]: Writing runtime SQL for node "seed.scraping_dbt.prix_m2_commune"
[0m08:20:10.837750 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: COMMIT
[0m08:20:10.838199 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m08:20:10.838582 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: COMMIT
[0m08:20:10.839906 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m08:20:10.840729 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: Close
[0m08:20:10.841359 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd5bcabb-337c-4030-ab2f-444e2c2a452d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bab1a5f40>]}
[0m08:20:10.841924 [info ] [Thread-1  ]: 2 of 2 OK loaded seed file public.prix_m2_commune .............................. [[32mINSERT 246[0m in 0.11s]
[0m08:20:10.842603 [debug] [Thread-1  ]: Finished running node seed.scraping_dbt.prix_m2_commune
[0m08:20:10.843801 [debug] [MainThread]: Using postgres connection "master"
[0m08:20:10.844279 [debug] [MainThread]: On master: BEGIN
[0m08:20:10.844663 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:20:10.851937 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m08:20:10.852436 [debug] [MainThread]: On master: COMMIT
[0m08:20:10.852824 [debug] [MainThread]: Using postgres connection "master"
[0m08:20:10.853207 [debug] [MainThread]: On master: COMMIT
[0m08:20:10.853645 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m08:20:10.854036 [debug] [MainThread]: On master: Close
[0m08:20:10.854545 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:20:10.854908 [debug] [MainThread]: Connection 'seed.scraping_dbt.prix_m2_commune' was properly closed.
[0m08:20:10.855347 [info ] [MainThread]: 
[0m08:20:10.855778 [info ] [MainThread]: Finished running 2 seeds in 0 hours 0 minutes and 18.13 seconds (18.13s).
[0m08:20:10.856697 [debug] [MainThread]: Command end result
[0m08:20:10.891617 [info ] [MainThread]: 
[0m08:20:10.892204 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:20:10.892615 [info ] [MainThread]: 
[0m08:20:10.893036 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:20:10.893908 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 18.95394, "process_user_time": 19.98396, "process_kernel_time": 0.675457, "process_mem_max_rss": "176232", "process_in_blocks": "16", "process_out_blocks": "2688"}
[0m08:20:10.894516 [debug] [MainThread]: Command `dbt seed` succeeded at 08:20:10.894418 after 18.95 seconds
[0m08:20:10.894936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b971517c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8bab5db0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8b94ffab20>]}
[0m08:20:10.895350 [debug] [MainThread]: Flushing usage events
