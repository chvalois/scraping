[0m09:46:30.699169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00ea4b9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e96b3250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e9144af0>]}


============================== 09:46:30.704917 | 997d11ed-c0e4-49dd-a8dd-85898630a558 ==============================
[0m09:46:30.704917 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:46:30.705582 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/airflow/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt init', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:46:30.712059 [error] [MainThread]: Encountered an error:
[ConfigFolderDirectory]: Unable to parse dict {'dir': PosixPath('/home/airflow/.dbt')}
[0m09:46:30.713389 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 608, in _ConvertFieldValuePair
    _ConvertScalarFieldValue(value, field,
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 779, in _ConvertScalarFieldValue
    if _UNPAIRED_SURROGATE_PATTERN.search(value):
TypeError: expected string or bytes-like object

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt_common/events/base_types.py", line 67, in __init__
    self.pb_msg = ParseDict(kwargs, msg_cls())
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 446, in ParseDict
    parser.ConvertMessage(js_dict, message, '')
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 487, in ConvertMessage
    self._ConvertFieldValuePair(value, message, path)
  File "/home/airflow/.local/lib/python3.8/site-packages/google/protobuf/json_format.py", line 622, in _ConvertFieldValuePair
    raise ParseError(
google.protobuf.json_format.ParseError: Failed to parse dir field: expected string or bytes-like object.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/main.py", line 470, in init
    results = task.run()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 301, in run
    self.create_profiles_dir(profiles_dir)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 69, in create_profiles_dir
    fire_event(ConfigFolderDirectory(dir=profiles_dir))
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt_common/events/base_types.py", line 76, in __init__
    raise Exception(error_msg)
Exception: [ConfigFolderDirectory]: Unable to parse dict {'dir': PosixPath('/home/airflow/.dbt')}

[0m09:46:30.714396 [debug] [MainThread]: Resource report: {"command_name": "init", "command_wall_clock_time": 0.06580117, "process_user_time": 1.431807, "process_kernel_time": 0.641706, "process_mem_max_rss": "124284", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m09:46:30.715174 [debug] [MainThread]: Command `dbt init` failed at 09:46:30.715038 after 0.07 seconds
[0m09:46:30.715677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00ea4b9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e8c34160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f00e8c34730>]}
[0m09:46:30.716145 [debug] [MainThread]: Flushing usage events
[0m09:46:45.055024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a2c285b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a39da3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a1394cd0>]}


============================== 09:46:45.060446 | adc123ad-5c3e-4edc-9763-e3e06c59841a ==============================
[0m09:46:45.060446 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:46:45.061072 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/profiles.yml', 'debug': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt init --profiles-dir /opt/airflow/dbt_profiles/profiles.yml --debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:46:45.069928 [info ] [MainThread]: Setting up your profile.
[0m09:47:29.023126 [error] [MainThread]: Encountered an error:
[Errno 20] Not a directory: '/opt/airflow/dbt_profiles/profiles.yml/profiles.yml'
[0m09:47:29.024439 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/main.py", line 470, in init
    results = task.run()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 321, in run
    self.setup_profile(profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 263, in setup_profile
    self.create_profile_from_target(adapter, profile_name=profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 180, in create_profile_from_target
    self.create_profile_from_profile_template(profile_template, profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 167, in create_profile_from_profile_template
    self.write_profile(profile, profile_name)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/task/init.py", line 157, in write_profile
    with open(profiles_filepath, "w") as f:
NotADirectoryError: [Errno 20] Not a directory: '/opt/airflow/dbt_profiles/profiles.yml/profiles.yml'

[0m09:47:29.025474 [debug] [MainThread]: Resource report: {"command_name": "init", "command_wall_clock_time": 44.02115, "process_user_time": 1.405183, "process_kernel_time": 0.685322, "process_mem_max_rss": "129996", "process_out_blocks": "8", "command_success": false, "process_in_blocks": "0"}
[0m09:47:29.026149 [debug] [MainThread]: Command `dbt init` failed at 09:47:29.026035 after 44.02 seconds
[0m09:47:29.026628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a2c285b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a12ba8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a12ba8e0>]}
[0m09:47:29.027142 [debug] [MainThread]: Flushing usage events
[0m09:47:37.754178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d88ef610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d70641f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d7064940>]}


============================== 09:47:37.759669 | dd0c9e22-0a3d-40ef-bb0f-2a642e2cf664 ==============================
[0m09:47:37.759669 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:47:37.760270 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/profiles.yml', 'debug': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt seed --profiles-dir /opt/airflow/dbt_profiles/profiles.yml --debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:47:37.762932 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'scraping_dbt'
[0m09:47:37.763891 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_wall_clock_time": 0.05947098, "process_user_time": 1.383783, "process_kernel_time": 0.661982, "process_mem_max_rss": "124060", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:47:37.764589 [debug] [MainThread]: Command `dbt seed` failed at 09:47:37.764475 after 0.06 seconds
[0m09:47:37.765069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d88ef610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d7247df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97d70599a0>]}
[0m09:47:37.765549 [debug] [MainThread]: Flushing usage events
[0m09:47:48.023349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016c6d17c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016b35a8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016ae856d0>]}


============================== 09:47:48.028734 | b1ad627d-a704-4b65-993c-b9465e0a09ed ==============================
[0m09:47:48.028734 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:47:48.029334 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt seed --profiles-dir /opt/airflow/dbt_profiles --debug', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:47:48.190182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1ad627d-a704-4b65-993c-b9465e0a09ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016a1e3850>]}
[0m09:47:48.247072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1ad627d-a704-4b65-993c-b9465e0a09ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016ae53580>]}
[0m09:47:48.248171 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:47:48.254349 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m09:47:48.255729 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_wall_clock_time": 0.28298178, "process_user_time": 1.591407, "process_kernel_time": 0.659754, "process_mem_max_rss": "132456", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m09:47:48.256537 [debug] [MainThread]: Command `dbt seed` failed at 09:47:48.256416 after 0.28 seconds
[0m09:47:48.257124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016c6d17c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016a16dd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f016a16d040>]}
[0m09:47:48.257680 [debug] [MainThread]: Flushing usage events
[0m09:47:58.419687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3de353610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dcac6ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dcac6a30>]}


============================== 09:47:58.424811 | a133aa06-2578-4949-9689-cf034e067419 ==============================
[0m09:47:58.424811 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:47:58.425390 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/airflow/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:47:58.549350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a133aa06-2578-4949-9689-cf034e067419', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dcb45df0>]}
[0m09:47:58.561115 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-8s_b0dcq'
[0m09:47:58.561692 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:47:58.637690 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:47:58.639170 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m09:47:58.696081 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m09:47:58.708665 [info ] [MainThread]: Updating lock file in file path: /opt/airflow/scraping_dbt/package-lock.yml
[0m09:47:58.710550 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-15j9w_54'
[0m09:47:58.714848 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m09:47:58.985281 [info ] [MainThread]: Installed from version 1.1.1
[0m09:47:58.985806 [info ] [MainThread]: Updated version available: 1.2.0
[0m09:47:58.986327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a133aa06-2578-4949-9689-cf034e067419', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3ddc55a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dc8b2d30>]}
[0m09:47:58.986763 [info ] [MainThread]: 
[0m09:47:58.987169 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m09:47:58.988252 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.6171804, "process_user_time": 1.668941, "process_kernel_time": 0.633321, "process_mem_max_rss": "130028", "process_out_blocks": "2232", "process_in_blocks": "0"}
[0m09:47:58.988834 [debug] [MainThread]: Command `dbt deps` succeeded at 09:47:58.988737 after 0.62 seconds
[0m09:47:58.989232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3de353610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dc89bd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3dc89bcd0>]}
[0m09:47:58.989635 [debug] [MainThread]: Flushing usage events
[0m09:49:02.114988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f13ddc0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f12553af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f12553880>]}


============================== 09:49:02.120376 | bbbc4f88-1f55-4475-b510-791e96cf06fe ==============================
[0m09:49:02.120376 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:49:02.121008 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt seed --profiles-dir /opt/airflow/dbt_profiles --debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:49:02.281473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11bd7d30>]}
[0m09:49:02.337172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f1255d400>]}
[0m09:49:02.338086 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:49:02.357668 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:49:02.358647 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m09:49:02.359159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11b7e370>]}
[0m09:49:04.096824 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m09:49:04.097428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f12a10940>]}
[0m09:49:04.372020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f2851f430>]}
[0m09:49:04.535490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f28371ca0>]}
[0m09:49:04.536213 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:49:04.536663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11f01ee0>]}
[0m09:49:04.538241 [info ] [MainThread]: 
[0m09:49:04.538918 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:49:04.540048 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:49:04.573352 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:49:04.573914 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:49:04.574388 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:49:04.583792 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:49:04.585174 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:49:04.590309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:49:04.596702 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:04.597157 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:49:04.597555 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:04.606004 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m09:49:04.606556 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:04.607167 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:49:04.612435 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m09:49:04.613754 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:49:04.614366 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:49:04.615300 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:49:04.618328 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:04.618832 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:49:04.619334 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:04.626406 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.626911 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:04.627427 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:49:04.632444 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:49:04.633742 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:49:04.634373 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:49:04.640124 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.640641 [debug] [MainThread]: On master: BEGIN
[0m09:49:04.641087 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:49:04.648150 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.648601 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.649160 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:49:04.654479 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:49:04.655798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f113835e0>]}
[0m09:49:04.656388 [debug] [MainThread]: On master: ROLLBACK
[0m09:49:04.656963 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.657420 [debug] [MainThread]: On master: BEGIN
[0m09:49:04.658092 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:49:04.658562 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.658988 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.659521 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.660096 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:04.660532 [debug] [MainThread]: On master: Close
[0m09:49:04.661199 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:49:04.661648 [info ] [MainThread]: 
[0m09:49:04.668458 [debug] [Thread-1  ]: Began running node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.669172 [info ] [Thread-1  ]: 1 of 1 START seed file public.prix_m2_commune .................................. [RUN]
[0m09:49:04.669871 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now seed.scraping_dbt.prix_m2_commune)
[0m09:49:04.670402 [debug] [Thread-1  ]: Began compiling node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.670904 [debug] [Thread-1  ]: Began executing node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.703181 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.703757 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: BEGIN
[0m09:49:04.704245 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:49:04.711636 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.712204 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.712700 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "seed.scraping_dbt.prix_m2_commune"} */

    create table "scraping_db"."public"."prix_m2_commune" ("zipcode" integer,"city_name" text,"house_type" text,"prix_m2" float8)
  
[0m09:49:04.717390 [debug] [Thread-1  ]: SQL status: CREATE TABLE in 0.004 seconds
[0m09:49:04.809028 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.809840 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: 
          insert into "scraping_db"."public"."prix_m2_commune" ("zipcode", "city_name", "house_type", "prix_m2") values
          (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s...
[0m09:49:04.813064 [debug] [Thread-1  ]: SQL status: INSERT 0 246 in 0.003 seconds
[0m09:49:04.819290 [debug] [Thread-1  ]: Writing runtime SQL for node "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.837694 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: COMMIT
[0m09:49:04.838248 [debug] [Thread-1  ]: Using postgres connection "seed.scraping_dbt.prix_m2_commune"
[0m09:49:04.838777 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: COMMIT
[0m09:49:04.840245 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:49:04.843166 [debug] [Thread-1  ]: On seed.scraping_dbt.prix_m2_commune: Close
[0m09:49:04.844911 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bbbc4f88-1f55-4475-b510-791e96cf06fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f11370e50>]}
[0m09:49:04.845623 [info ] [Thread-1  ]: 1 of 1 OK loaded seed file public.prix_m2_commune .............................. [[32mINSERT 246[0m in 0.17s]
[0m09:49:04.846310 [debug] [Thread-1  ]: Finished running node seed.scraping_dbt.prix_m2_commune
[0m09:49:04.847613 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.848091 [debug] [MainThread]: On master: BEGIN
[0m09:49:04.848517 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:49:04.855884 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:04.856366 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.856819 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:04.857244 [debug] [MainThread]: On master: COMMIT
[0m09:49:04.857756 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:04.858177 [debug] [MainThread]: On master: Close
[0m09:49:04.858736 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:49:04.859188 [debug] [MainThread]: Connection 'seed.scraping_dbt.prix_m2_commune' was properly closed.
[0m09:49:04.859665 [info ] [MainThread]: 
[0m09:49:04.860134 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m09:49:04.860937 [debug] [MainThread]: Command end result
[0m09:49:04.894803 [info ] [MainThread]: 
[0m09:49:04.895425 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:49:04.895885 [info ] [MainThread]: 
[0m09:49:04.896366 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:49:04.897305 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 2.8314161, "process_user_time": 4.11064, "process_kernel_time": 0.659781, "process_mem_max_rss": "145692", "process_out_blocks": "3352", "process_in_blocks": "0"}
[0m09:49:04.897983 [debug] [MainThread]: Command `dbt seed` succeeded at 09:49:04.897878 after 2.83 seconds
[0m09:49:04.898514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f13ddc0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f2778a040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f10ee63d0>]}
[0m09:49:04.899035 [debug] [MainThread]: Flushing usage events
[0m09:49:16.644364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f33706007c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336ef59c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336edb4ee0>]}


============================== 09:49:16.649593 | 75c5ea38-51de-4b49-a27d-289652385b90 ==============================
[0m09:49:16.649593 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:49:16.650240 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles/profiles.yml', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/profiles.yml', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:49:16.653913 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'scraping_dbt'
[0m09:49:16.654940 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.059664976, "process_user_time": 1.3717, "process_kernel_time": 0.665912, "process_mem_max_rss": "126152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:49:16.655569 [debug] [MainThread]: Command `dbt run` failed at 09:49:16.655463 after 0.06 seconds
[0m09:49:16.655961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f33706007c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336ed80f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f336ed14850>]}
[0m09:49:16.656357 [debug] [MainThread]: Flushing usage events
[0m09:49:22.170863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba6790d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8df0af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8df0880>]}


============================== 09:49:22.176665 | 55bd937b-b623-4844-966c-eb3cd5ad3daa ==============================
[0m09:49:22.176665 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:49:22.177385 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:49:22.337803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba4715b0>]}
[0m09:49:22.394715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8dff400>]}
[0m09:49:22.395598 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:49:22.414240 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:49:22.604128 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:49:22.604646 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:49:22.736039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dcebe7790>]}
[0m09:49:22.902028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dceb96a30>]}
[0m09:49:22.902674 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:49:22.903173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dceb45250>]}
[0m09:49:22.904834 [info ] [MainThread]: 
[0m09:49:22.905550 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:49:22.910113 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:49:22.945382 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:49:22.945823 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:49:22.946185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:49:22.955556 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:49:22.956862 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:49:22.958769 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:49:22.965172 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:22.965582 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:49:22.965925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:22.972990 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:49:22.973408 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:49:22.973774 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:49:22.978630 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:49:22.979766 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:49:22.980251 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:49:22.980840 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:49:22.983278 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:22.983658 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:49:22.983980 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:22.990734 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:49:22.991142 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:49:22.991541 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:49:22.996610 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m09:49:22.997798 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:49:22.998283 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:49:23.004314 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.004711 [debug] [MainThread]: On master: BEGIN
[0m09:49:23.005045 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:49:23.011992 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.012440 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.012925 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:49:23.018331 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:49:23.019582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dceb96ee0>]}
[0m09:49:23.020130 [debug] [MainThread]: On master: ROLLBACK
[0m09:49:23.020651 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.021043 [debug] [MainThread]: On master: BEGIN
[0m09:49:23.021591 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:49:23.021984 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.022379 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.022744 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.023214 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:23.023612 [debug] [MainThread]: On master: Close
[0m09:49:23.024151 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:49:23.024594 [info ] [MainThread]: 
[0m09:49:23.030914 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:49:23.031653 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:49:23.032265 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:49:23.032714 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:49:23.041546 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:49:23.042257 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:49:23.080777 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:49:23.081525 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:49:23.081958 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:49:23.082347 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:49:23.089782 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.090276 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:49:23.090724 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
    SPLIT_PART(ad_url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:49:23.091716 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column "ad_url" does not exist
LINE 24:     INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
                                ^
HINT:  Perhaps you meant to reference the column "raw_ads.url".

[0m09:49:23.092152 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: ROLLBACK
[0m09:49:23.092728 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:49:23.094774 [debug] [Thread-1  ]: Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_url" does not exist
  LINE 24:     INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
                                  ^
  HINT:  Perhaps you meant to reference the column "raw_ads.url".
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m09:49:23.096388 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dce699b80>]}
[0m09:49:23.097090 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model public.src_ads ........................... [[31mERROR[0m in 0.06s]
[0m09:49:23.097883 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:49:23.098419 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:49:23.099397 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:49:23.100290 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:49:23.100729 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:49:23.104220 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:49:23.104760 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:49:23.109441 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:49:23.110069 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.110490 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:49:23.110851 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:49:23.118140 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.118543 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.118932 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:49:23.124768 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:49:23.130989 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.131506 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:49:23.132283 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:49:23.149763 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:49:23.150253 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.150673 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:49:23.151894 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:49:23.158190 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:49:23.162274 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:49:23.162734 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:49:23.163398 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:49:23.165700 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:49:23.166347 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55bd937b-b623-4844-966c-eb3cd5ad3daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dce788220>]}
[0m09:49:23.167035 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.07s]
[0m09:49:23.167827 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:49:23.168335 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:49:23.168892 [info ] [Thread-1  ]: 3 of 7 SKIP relation public.dim_ads_images_url ................................. [[33mSKIP[0m]
[0m09:49:23.169453 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:49:23.170112 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:49:23.170627 [info ] [Thread-1  ]: 4 of 7 SKIP relation public.dim_ads_tags ....................................... [[33mSKIP[0m]
[0m09:49:23.171391 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:49:23.172184 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:49:23.172712 [info ] [Thread-1  ]: 5 of 7 SKIP relation public.src_ads_cleaned .................................... [[33mSKIP[0m]
[0m09:49:23.173264 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:49:23.173748 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:49:23.174295 [info ] [Thread-1  ]: 6 of 7 SKIP relation public.src_ads_cleaned_backup_incremental ................. [[33mSKIP[0m]
[0m09:49:23.174915 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:49:23.175436 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:49:23.175878 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:49:23.176442 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:49:23.177626 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.178081 [debug] [MainThread]: On master: BEGIN
[0m09:49:23.178433 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:49:23.185555 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:49:23.185978 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.186535 [debug] [MainThread]: Using postgres connection "master"
[0m09:49:23.186946 [debug] [MainThread]: On master: COMMIT
[0m09:49:23.187460 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:49:23.187851 [debug] [MainThread]: On master: Close
[0m09:49:23.188339 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:49:23.188686 [debug] [MainThread]: Connection 'model.scraping_dbt.src_prix_m2' was properly closed.
[0m09:49:23.189118 [info ] [MainThread]: 
[0m09:49:23.189569 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m09:49:23.191408 [debug] [MainThread]: Command end result
[0m09:49:23.225649 [info ] [MainThread]: 
[0m09:49:23.226198 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:49:23.226606 [info ] [MainThread]: 
[0m09:49:23.227095 [error] [MainThread]:   Database Error in model src_ads (models/src/src_ads.sql)
  column "ad_url" does not exist
  LINE 24:     INITCAP(SPLIT_PART(ad_url, '-', -3)) AS ad_city,
                                  ^
  HINT:  Perhaps you meant to reference the column "raw_ads.url".
  compiled Code at target/run/scraping_dbt/models/src/src_ads.sql
[0m09:49:23.227530 [info ] [MainThread]: 
[0m09:49:23.227966 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=5 TOTAL=7
[0m09:49:23.228878 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1075735, "process_user_time": 2.380419, "process_kernel_time": 0.659008, "process_mem_max_rss": "135548", "process_out_blocks": "2304", "command_success": false, "process_in_blocks": "0"}
[0m09:49:23.229488 [debug] [MainThread]: Command `dbt run` failed at 09:49:23.229388 after 1.11 seconds
[0m09:49:23.229938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba6790d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7db8dff400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7dba367e80>]}
[0m09:49:23.230368 [debug] [MainThread]: Flushing usage events
[0m09:50:24.773488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6342757c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7c70>]}


============================== 09:50:24.779119 | 1123a1d0-3958-4eda-a9d2-36fe18732a7f ==============================
[0m09:50:24.779119 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:50:24.779741 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:50:24.949259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7670>]}
[0m09:50:25.005616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329e96d0>]}
[0m09:50:25.006478 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:50:25.025484 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:50:25.213168 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:50:25.213896 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads.sql
[0m09:50:25.540089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647eda760>]}
[0m09:50:25.702745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647d89c40>]}
[0m09:50:25.703415 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:50:25.703880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647ec0e80>]}
[0m09:50:25.705534 [info ] [MainThread]: 
[0m09:50:25.706213 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:50:25.710701 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:50:25.744557 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:50:25.744975 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:50:25.745328 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:50:25.754562 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:50:25.755827 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:50:25.757664 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:50:25.763898 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:50:25.764304 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:50:25.764637 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:50:25.771788 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.772199 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:50:25.772602 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:50:25.777624 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:25.778804 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:50:25.779516 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:50:25.780224 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:50:25.782720 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:50:25.783115 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:50:25.783576 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:50:25.790883 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.791306 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:50:25.791704 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:50:25.796902 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.005 seconds
[0m09:50:25.798448 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:50:25.798971 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:50:25.804660 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.805053 [debug] [MainThread]: On master: BEGIN
[0m09:50:25.805390 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:50:25.812290 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.812669 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.813092 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:50:25.818758 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:25.819885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7160>]}
[0m09:50:25.820389 [debug] [MainThread]: On master: ROLLBACK
[0m09:50:25.820860 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.821204 [debug] [MainThread]: On master: BEGIN
[0m09:50:25.821717 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:50:25.822071 [debug] [MainThread]: On master: COMMIT
[0m09:50:25.822400 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:25.822708 [debug] [MainThread]: On master: COMMIT
[0m09:50:25.823109 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:50:25.823510 [debug] [MainThread]: On master: Close
[0m09:50:25.824004 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:50:25.824443 [info ] [MainThread]: 
[0m09:50:25.830898 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:50:25.831622 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:50:25.832218 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:50:25.832703 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:50:25.841912 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:50:25.842548 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:50:25.886952 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:50:25.887660 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.888106 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:50:25.888510 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:25.895734 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.896199 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.896670 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:50:25.902264 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:25.908588 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.909057 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:50:25.909788 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:25.926988 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:50:25.927500 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.927916 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:50:25.929174 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:25.935634 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:50:25.939823 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:50:25.940294 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:50:25.940919 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:50:25.943284 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:50:25.944898 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff631907a00>]}
[0m09:50:25.945611 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:50:25.946317 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:50:25.946822 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:50:25.947684 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:50:25.948330 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:50:25.948795 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:50:25.952859 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:50:25.953466 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:50:25.957153 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:50:25.957790 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.958255 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:50:25.958686 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:25.965855 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:25.966344 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.966768 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:50:25.971938 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:50:25.975272 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.975706 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:50:25.976441 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:25.979634 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.980068 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:50:25.980738 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:25.983979 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:50:25.984410 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.984778 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:50:25.985896 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:25.988609 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:50:25.989227 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:50:25.989628 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:50:25.992646 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:50:25.993886 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:50:25.994466 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff631c5e880>]}
[0m09:50:25.995106 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:50:25.995903 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:50:25.996574 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:50:25.997383 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:50:25.998113 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:50:25.998714 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:50:26.002351 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.002989 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:50:26.007424 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.008016 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.008420 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:50:26.008775 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.015820 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.016288 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.016702 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:50:26.022393 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:26.025584 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.026018 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:50:26.026710 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:26.028018 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:50:26.028432 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.028805 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:50:26.029922 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:26.032561 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:50:26.033168 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:50:26.033572 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:50:26.034136 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:50:26.035389 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:50:26.035967 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff647272850>]}
[0m09:50:26.036600 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:50:26.037346 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:50:26.037807 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:50:26.038394 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:50:26.038980 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:50:26.039620 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:50:26.043660 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.044188 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:50:26.047785 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.048336 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.048735 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:50:26.049106 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.056154 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.056590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.057013 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:50:26.062595 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:26.065746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.066182 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:50:26.066867 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:50:26.068161 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:50:26.068578 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.068947 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:50:26.069962 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:26.073375 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:50:26.073974 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:50:26.074378 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:50:26.074919 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.000 seconds
[0m09:50:26.076168 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:50:26.076740 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6318c18e0>]}
[0m09:50:26.077372 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:50:26.078035 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:50:26.078497 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.079091 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:50:26.079716 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:50:26.080326 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.084692 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.085242 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.088914 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.089503 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.089919 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:50:26.090283 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.097178 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.097595 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:50:26.098053 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

WITH latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:50:26.098716 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "WITH"
LINE 16: WITH latest_ads AS (
         ^

[0m09:50:26.099149 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:50:26.099918 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:50:26.101902 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "WITH"
  LINE 16: WITH latest_ads AS (
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:50:26.102384 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff631c49f10>]}
[0m09:50:26.103025 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:50:26.103739 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:50:26.104198 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.104931 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:50:26.105548 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:50:26.106164 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.115132 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.115733 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.144024 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.144611 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.145027 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:50:26.145405 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:50:26.152486 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.152974 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.153448 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
  
    

  create  table "scraping_db"."public"."src_ads_cleaned_backup_incremental"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE False
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT False           
    OR ad_id IS NULL */
  );
  
  
[0m09:50:26.158750 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:50:26.160149 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:50:26.160596 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:50:26.160980 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:50:26.162085 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:50:26.162859 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:50:26.163447 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1123a1d0-3958-4eda-a9d2-36fe18732a7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6318c18e0>]}
[0m09:50:26.164083 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mSELECT 0[0m in 0.06s]
[0m09:50:26.164746 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:50:26.165225 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:50:26.165746 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:50:26.166248 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:50:26.167405 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:26.167787 [debug] [MainThread]: On master: BEGIN
[0m09:50:26.168118 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:50:26.175152 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:50:26.175609 [debug] [MainThread]: On master: COMMIT
[0m09:50:26.176029 [debug] [MainThread]: Using postgres connection "master"
[0m09:50:26.176411 [debug] [MainThread]: On master: COMMIT
[0m09:50:26.176926 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:50:26.177426 [debug] [MainThread]: On master: Close
[0m09:50:26.177969 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:50:26.178375 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:50:26.178865 [info ] [MainThread]: 
[0m09:50:26.179386 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m09:50:26.180914 [debug] [MainThread]: Command end result
[0m09:50:26.219869 [info ] [MainThread]: 
[0m09:50:26.220464 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:50:26.220907 [info ] [MainThread]: 
[0m09:50:26.221422 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "WITH"
  LINE 16: WITH latest_ads AS (
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:50:26.221873 [info ] [MainThread]: 
[0m09:50:26.222338 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:50:26.223321 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4993196, "process_user_time": 2.703178, "process_kernel_time": 0.700823, "process_mem_max_rss": "142920", "process_out_blocks": "3512", "command_success": false, "process_in_blocks": "0"}
[0m09:50:26.223957 [debug] [MainThread]: Command `dbt run` failed at 09:50:26.223850 after 1.50 seconds
[0m09:50:26.224420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6342757c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6329f7670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6318e3dc0>]}
[0m09:50:26.224862 [debug] [MainThread]: Flushing usage events
[0m09:51:04.259400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1effba2fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff5daca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efe325880>]}


============================== 09:51:04.264708 | eb8060bc-4f70-4562-9aed-0bd362496480 ==============================
[0m09:51:04.264708 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:51:04.265321 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:51:04.426764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff9a9520>]}
[0m09:51:04.483281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efdcd3b50>]}
[0m09:51:04.484129 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:51:04.502616 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:51:04.691212 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:51:04.691939 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:51:05.087895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f13880b20>]}
[0m09:51:05.254919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f136c8f70>]}
[0m09:51:05.255557 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:51:05.255997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f138947c0>]}
[0m09:51:05.257612 [info ] [MainThread]: 
[0m09:51:05.258285 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:51:05.262699 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:51:05.295944 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:51:05.296374 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:51:05.296717 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:51:05.306169 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:51:05.307546 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:51:05.309379 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:51:05.315712 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:51:05.316112 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:51:05.316456 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:05.323570 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.323938 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:51:05.324289 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:51:05.329643 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:51:05.330955 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:51:05.331492 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:51:05.332133 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:51:05.335814 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:51:05.336217 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:51:05.336562 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:05.343333 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.343710 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:51:05.344058 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:51:05.349123 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.350235 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:51:05.350733 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:51:05.356335 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.356731 [debug] [MainThread]: On master: BEGIN
[0m09:51:05.357074 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:51:05.364103 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.364510 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.364925 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:51:05.370677 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.371814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efd53c040>]}
[0m09:51:05.372322 [debug] [MainThread]: On master: ROLLBACK
[0m09:51:05.372900 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.373344 [debug] [MainThread]: On master: BEGIN
[0m09:51:05.373918 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:51:05.374350 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.374696 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.375033 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.375455 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:51:05.375797 [debug] [MainThread]: On master: Close
[0m09:51:05.376330 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:51:05.376706 [info ] [MainThread]: 
[0m09:51:05.383385 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:51:05.384000 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:51:05.384600 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:51:05.385031 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:51:05.393531 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:51:05.394129 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:51:05.431819 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:51:05.432454 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.432862 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:51:05.433225 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.440355 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.440789 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.441230 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:51:05.446154 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.004 seconds
[0m09:51:05.452544 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.452979 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:51:05.453710 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.456934 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.457368 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:51:05.458085 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.477703 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:51:05.478142 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.478530 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:51:05.479529 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.485696 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:51:05.489935 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:51:05.490378 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:51:05.493178 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:51:05.495483 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:51:05.497095 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efd53f040>]}
[0m09:51:05.497788 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:51:05.498595 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:51:05.499100 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:51:05.499918 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:51:05.500532 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:51:05.500961 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:51:05.504193 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:51:05.504814 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:51:05.508526 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:51:05.509112 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.509531 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:51:05.509906 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.517142 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.517555 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.517943 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:51:05.523216 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:51:05.526530 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.526958 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:51:05.527722 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.530954 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.531410 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:51:05.532098 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.533451 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:51:05.533883 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.534254 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:51:05.535416 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.538914 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:51:05.539556 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:51:05.539969 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:51:05.542748 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:51:05.544015 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:51:05.544608 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f141bca90>]}
[0m09:51:05.545237 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:51:05.545972 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:51:05.546477 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.547073 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:51:05.547684 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:51:05.548104 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.551167 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.551797 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.555590 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.556178 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.556598 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:51:05.556958 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.563956 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.564403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.564819 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:51:05.570200 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.573472 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.573904 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:51:05.574680 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.577783 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.578210 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:51:05.578929 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.580379 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:51:05.580792 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.581170 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:51:05.582267 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.584914 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:51:05.585600 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:51:05.586016 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:51:05.588972 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:51:05.590239 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:51:05.590812 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f1372a100>]}
[0m09:51:05.591503 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:51:05.592188 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:51:05.592640 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:51:05.593218 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:51:05.593777 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:51:05.594396 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:51:05.599592 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.600157 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:51:05.603891 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.604476 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.604880 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:51:05.605249 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.612265 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.612697 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.613117 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:51:05.618737 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:51:05.621898 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.622332 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:51:05.623082 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.626288 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.626714 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:51:05.627431 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:51:05.628777 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:51:05.629196 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.629592 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:51:05.630743 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:51:05.633384 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:51:05.633981 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:51:05.634385 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:51:05.637043 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:51:05.638252 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:51:05.638818 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f141b37f0>]}
[0m09:51:05.639485 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:51:05.640232 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:51:05.640697 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.641291 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:51:05.641857 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:51:05.642481 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.646930 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.647528 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.652057 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.652626 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.653032 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:51:05.653388 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.660332 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.660745 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:51:05.661151 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:51:05.661771 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE FROM src_ads
         ^

[0m09:51:05.662208 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:51:05.662748 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:51:05.664703 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:51:05.665200 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1f141b37f0>]}
[0m09:51:05.665810 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:51:05.666480 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:51:05.666950 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.667615 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:51:05.668302 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:51:05.668858 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.725481 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.726203 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.754076 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.754575 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095105748359"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:51:05.755001 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:51:05.766126 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:51:05.780855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.781329 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:51:05.781926 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:51:05.782381 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.782769 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095105748359'
        
      order by ordinal_position

  
[0m09:51:05.796101 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m09:51:05.801625 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.802085 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:51:05.805655 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:51:05.814374 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.814822 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:51:05.818357 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:51:05.834704 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.835382 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:51:05.835829 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095105748359"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095105748359"
    )
  
[0m09:51:05.837592 [debug] [Thread-1  ]: Postgres adapter: Postgres error: cannot delete from table "src_ads_cleaned_backup_incremental" because it does not have a replica identity and publishes deletes
HINT:  To enable deleting from the table, set REPLICA IDENTITY using ALTER TABLE.

[0m09:51:05.838050 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: ROLLBACK
[0m09:51:05.838692 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:51:05.839788 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned_backup_incremental (models/src/src_ads_cleaned_backup_incremental.sql)
  cannot delete from table "src_ads_cleaned_backup_incremental" because it does not have a replica identity and publishes deletes
  HINT:  To enable deleting from the table, set REPLICA IDENTITY using ALTER TABLE.
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned_backup_incremental.sql
[0m09:51:05.840323 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb8060bc-4f70-4562-9aed-0bd362496480', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1efd04e850>]}
[0m09:51:05.840970 [error] [Thread-1  ]: 6 of 7 ERROR creating sql incremental model public.src_ads_cleaned_backup_incremental  [[31mERROR[0m in 0.17s]
[0m09:51:05.841732 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:51:05.842224 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:51:05.842776 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:51:05.843355 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:51:05.844504 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.844909 [debug] [MainThread]: On master: BEGIN
[0m09:51:05.845258 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:51:05.852678 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:51:05.853121 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.853459 [debug] [MainThread]: Using postgres connection "master"
[0m09:51:05.853788 [debug] [MainThread]: On master: COMMIT
[0m09:51:05.854243 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:51:05.854604 [debug] [MainThread]: On master: Close
[0m09:51:05.855077 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:51:05.855452 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:51:05.855863 [info ] [MainThread]: 
[0m09:51:05.856261 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:51:05.857920 [debug] [MainThread]: Command end result
[0m09:51:05.892181 [info ] [MainThread]: 
[0m09:51:05.892720 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m09:51:05.893129 [info ] [MainThread]: 
[0m09:51:05.893648 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:51:05.894059 [info ] [MainThread]: 
[0m09:51:05.894567 [error] [MainThread]:   Database Error in model src_ads_cleaned_backup_incremental (models/src/src_ads_cleaned_backup_incremental.sql)
  cannot delete from table "src_ads_cleaned_backup_incremental" because it does not have a replica identity and publishes deletes
  HINT:  To enable deleting from the table, set REPLICA IDENTITY using ALTER TABLE.
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned_backup_incremental.sql
[0m09:51:05.894989 [info ] [MainThread]: 
[0m09:51:05.895443 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=1 TOTAL=7
[0m09:51:05.896351 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6867139, "process_user_time": 2.841768, "process_kernel_time": 0.728555, "process_mem_max_rss": "142904", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:51:05.896942 [debug] [MainThread]: Command `dbt run` failed at 09:51:05.896844 after 1.69 seconds
[0m09:51:05.897373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1effba2fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff9a9520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eff8ff7f0>]}
[0m09:51:05.897776 [debug] [MainThread]: Flushing usage events
[0m09:53:52.965477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa559eecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa54165910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa54165ac0>]}


============================== 09:53:52.970915 | 83369f66-9368-4b4f-8198-ab889c0075e6 ==============================
[0m09:53:52.970915 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:53:52.971520 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:53:53.130592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa552f16a0>]}
[0m09:53:53.186000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa53ad5610>]}
[0m09:53:53.186803 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:53:53.205596 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:53:53.396261 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:53:53.396730 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:53:53.524026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69ffc730>]}
[0m09:53:53.689760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69f979d0>]}
[0m09:53:53.690402 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:53:53.690853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69feafd0>]}
[0m09:53:53.692535 [info ] [MainThread]: 
[0m09:53:53.693207 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:53:53.697637 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:53:53.732647 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:53:53.733102 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:53:53.733460 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:53:53.742262 [debug] [ThreadPool]: SQL status: SELECT 4 in 0.009 seconds
[0m09:53:53.743570 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:53:53.745335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:53:53.751625 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:53:53.752021 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:53:53.752362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:53:53.759496 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.759932 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:53:53.760309 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:53:53.765421 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:53.766560 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:53:53.767077 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:53:53.767750 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:53:53.770221 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:53:53.770591 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:53:53.770912 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:53:53.777779 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.778162 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:53:53.778516 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:53:53.783491 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:53:53.784819 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:53:53.785303 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:53:53.791847 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.792249 [debug] [MainThread]: On master: BEGIN
[0m09:53:53.792609 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:53:53.799467 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.799850 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.800306 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:53:53.806276 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m09:53:53.807396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69f97d00>]}
[0m09:53:53.807893 [debug] [MainThread]: On master: ROLLBACK
[0m09:53:53.808366 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.808723 [debug] [MainThread]: On master: BEGIN
[0m09:53:53.809231 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:53:53.809600 [debug] [MainThread]: On master: COMMIT
[0m09:53:53.809960 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:53.810305 [debug] [MainThread]: On master: COMMIT
[0m09:53:53.810731 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:53:53.811084 [debug] [MainThread]: On master: Close
[0m09:53:53.811625 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:53:53.812051 [info ] [MainThread]: 
[0m09:53:53.818315 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:53:53.818903 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:53:53.819491 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:53:53.819899 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:53:53.828267 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:53:53.828854 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:53:53.866832 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:53:53.867475 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.867903 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:53:53.868294 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:53.875557 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.875964 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.876395 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:53:53.881911 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:53.888329 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.888759 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:53:53.889472 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.892768 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.893193 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:53:53.893864 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.913594 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:53:53.914026 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.914436 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:53:53.915630 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:53.922012 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:53:53.926268 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:53:53.926701 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:53:53.929544 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:53:53.931845 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:53:53.933417 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69b006a0>]}
[0m09:53:53.934080 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:53:53.934783 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:53:53.935290 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:53:53.935918 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:53:53.936633 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:53:53.937071 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:53:53.940276 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:53:53.940870 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:53:53.944655 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:53:53.945238 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.945636 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:53:53.945995 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:53.952837 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.953247 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.953629 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:53:53.958594 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:53:53.961901 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.962334 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:53:53.963046 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.966344 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.966769 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:53:53.967451 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:53.968804 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:53:53.969209 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.969578 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:53:53.970669 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:53.974202 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:53:53.974829 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:53:53.975265 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:53:53.978018 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:53:53.979274 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:53:53.979894 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69a733d0>]}
[0m09:53:53.980545 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:53:53.981303 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:53:53.981765 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:53:53.982352 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:53:53.982906 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:53:53.983357 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:53:53.986335 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.986890 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:53:53.990700 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.991308 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.991722 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:53:53.992085 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:53.998879 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:53.999342 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:53.999770 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:53:54.005659 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:54.009016 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.009471 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:53:54.010242 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.013469 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.013915 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:53:54.014643 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.016117 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:53:54.016562 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.016957 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:53:54.018283 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:54.021204 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:53:54.021918 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:53:54.022367 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:53:54.025312 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:53:54.026619 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:53:54.027254 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69c250a0>]}
[0m09:53:54.027906 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:53:54.028658 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:53:54.029127 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:53:54.029713 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:53:54.030280 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:53:54.030696 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:53:54.035172 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.035786 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:53:54.039522 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.040127 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.040559 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:53:54.040949 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:54.048247 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:54.048692 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.049133 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:53:54.055059 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:53:54.058307 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.058752 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:53:54.059515 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.062656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.063103 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:53:54.063938 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:53:54.065285 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:53:54.065716 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.066117 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:53:54.067159 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:54.069908 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:53:54.070540 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:53:54.070964 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:53:54.073718 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:53:54.074957 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:53:54.075614 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa537ca880>]}
[0m09:53:54.076288 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:53:54.077022 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:53:54.077492 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.078078 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:53:54.078649 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:53:54.079072 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.082308 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.082872 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.087501 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.088094 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.088522 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:53:54.088911 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:54.095884 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:53:54.096319 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:53:54.096746 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:53:54.097391 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE FROM src_ads
         ^

[0m09:53:54.097834 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:53:54.098397 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:53:54.100362 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:53:54.100859 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69a0aa60>]}
[0m09:53:54.101499 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:53:54.102192 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:53:54.102663 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.103178 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:53:54.103879 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:53:54.104404 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.113817 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.114382 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.142594 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.143146 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095354136993"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:53:54.143607 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:53:54.153951 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.010 seconds
[0m09:53:54.168022 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.168472 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:53:54.169030 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:53:54.169442 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.169841 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095354136993'
        
      order by ordinal_position

  
[0m09:53:54.182302 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:53:54.187743 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.188217 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:53:54.191783 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:53:54.200446 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.200900 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:53:54.204454 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:53:54.220607 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.221251 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.221714 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095354136993"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095354136993"
    )
  
[0m09:53:54.223048 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:53:54.224372 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:53:54.224817 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:53:54.225226 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:53:54.226262 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:53:54.227054 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:53:54.227701 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83369f66-9368-4b4f-8198-ab889c0075e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa69a77d60>]}
[0m09:53:54.228364 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.12s]
[0m09:53:54.229096 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:53:54.229598 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:53:54.230060 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:53:54.230708 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:53:54.231884 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:54.232300 [debug] [MainThread]: On master: BEGIN
[0m09:53:54.232635 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:53:54.239981 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:53:54.240444 [debug] [MainThread]: On master: COMMIT
[0m09:53:54.240790 [debug] [MainThread]: Using postgres connection "master"
[0m09:53:54.241112 [debug] [MainThread]: On master: COMMIT
[0m09:53:54.241535 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:53:54.241885 [debug] [MainThread]: On master: Close
[0m09:53:54.242399 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:53:54.242754 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:53:54.243276 [info ] [MainThread]: 
[0m09:53:54.243750 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.55 seconds (0.55s).
[0m09:53:54.245282 [debug] [MainThread]: Command end result
[0m09:53:54.281293 [info ] [MainThread]: 
[0m09:53:54.281884 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:53:54.282299 [info ] [MainThread]: 
[0m09:53:54.282893 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:53:54.283335 [info ] [MainThread]: 
[0m09:53:54.283878 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:53:54.285340 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3681413, "process_user_time": 2.524403, "process_kernel_time": 0.716114, "process_mem_max_rss": "136804", "process_out_blocks": "2432", "command_success": false, "process_in_blocks": "0"}
[0m09:53:54.286295 [debug] [MainThread]: Command `dbt run` failed at 09:53:54.286143 after 1.37 seconds
[0m09:53:54.286948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa559eecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa552f16a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa556eadf0>]}
[0m09:53:54.287456 [debug] [MainThread]: Flushing usage events
[0m09:54:18.765507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19adaf9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ad52bca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ac276880>]}


============================== 09:54:18.771060 | a44132dc-35d5-4a11-a6e6-ece49bcd9ce8 ==============================
[0m09:54:18.771060 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:54:18.771786 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:54:18.932891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ad9bd520>]}
[0m09:54:18.989434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab9b9b50>]}
[0m09:54:18.990336 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:54:19.009376 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:54:19.197932 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:54:19.198707 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:54:19.594353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c167ebb0>]}
[0m09:54:19.756831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c14c5f70>]}
[0m09:54:19.757489 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:54:19.757937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1693970>]}
[0m09:54:19.759631 [info ] [MainThread]: 
[0m09:54:19.760325 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:54:19.764712 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:54:19.797981 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:54:19.798406 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:54:19.798751 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:19.807985 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:54:19.809235 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:54:19.811046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:54:19.817163 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:19.817569 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:54:19.817903 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:19.824924 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.825347 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:19.825697 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:54:19.830453 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:54:19.831610 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:54:19.832103 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:54:19.832707 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:54:19.835132 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:19.835531 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:54:19.835925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:19.843254 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.843666 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:19.844027 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:54:19.849194 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:54:19.850660 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:54:19.851174 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:54:19.857804 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.858279 [debug] [MainThread]: On master: BEGIN
[0m09:54:19.858616 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:54:19.865450 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.865836 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.866263 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:54:19.872132 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:19.873211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1539700>]}
[0m09:54:19.873705 [debug] [MainThread]: On master: ROLLBACK
[0m09:54:19.874174 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.874535 [debug] [MainThread]: On master: BEGIN
[0m09:54:19.875038 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:54:19.875445 [debug] [MainThread]: On master: COMMIT
[0m09:54:19.875770 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:19.876077 [debug] [MainThread]: On master: COMMIT
[0m09:54:19.876472 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:19.876811 [debug] [MainThread]: On master: Close
[0m09:54:19.877323 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:54:19.877862 [info ] [MainThread]: 
[0m09:54:19.884819 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:54:19.885423 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:54:19.886001 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:54:19.886426 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:54:19.894764 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:54:19.895389 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:54:19.933203 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:54:19.933821 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.934263 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:54:19.934634 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:19.941570 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:19.942031 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.942485 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:54:19.948369 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:19.954746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.955190 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:54:19.956002 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:19.959181 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.959664 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:54:19.960348 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:19.980311 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:19.980755 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.981135 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:19.982274 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:19.988750 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:54:19.993069 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:19.993515 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:54:19.996302 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:19.998729 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:54:20.000364 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab474100>]}
[0m09:54:20.001039 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:54:20.001766 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:54:20.002259 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:54:20.002886 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:54:20.003748 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:54:20.004205 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:54:20.007402 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:54:20.007999 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:54:20.011789 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:54:20.012379 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.012831 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:54:20.013191 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.020135 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.020566 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.020961 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:54:20.025871 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:54:20.029237 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.029672 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:54:20.030446 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.033719 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.034149 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:54:20.034853 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.036271 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:20.036687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.037054 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:20.038110 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.041654 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:54:20.042275 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:20.042683 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:54:20.045518 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:20.046772 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:54:20.047392 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c152d0d0>]}
[0m09:54:20.048043 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:54:20.048752 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:54:20.049437 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.050288 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:54:20.051008 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:54:20.051623 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.055048 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.055658 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.059428 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.060029 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.060444 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:54:20.060850 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.067866 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.068339 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.068745 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:54:20.073956 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:20.077434 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.077886 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:54:20.078600 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.081851 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.082290 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:54:20.082959 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.084427 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:20.084855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.085232 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:20.086252 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.088944 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:54:20.089672 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:20.090113 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:54:20.092727 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:20.094303 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:54:20.094887 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1fbce20>]}
[0m09:54:20.095545 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:20.096307 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:54:20.096781 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:54:20.097388 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:54:20.097920 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:54:20.098536 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:54:20.103737 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.104307 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:54:20.108113 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.108690 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.109129 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:54:20.109497 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.116450 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.116886 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.117319 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:54:20.122840 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:20.126071 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.126497 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:54:20.127235 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.130375 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.130798 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:54:20.131564 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:20.132911 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:20.133324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.133689 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:20.134697 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.137359 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:54:20.137975 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:20.138420 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:54:20.141140 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:20.142372 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:54:20.142948 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab0e9c10>]}
[0m09:54:20.143605 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:54:20.144324 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:54:20.144793 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.145378 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:54:20.145905 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:54:20.146327 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.149494 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.150076 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.154775 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.155384 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.155802 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:54:20.156165 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.163034 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.163488 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:20.163885 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE * FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:54:20.164510 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE * FROM src_ads
         ^

[0m09:54:20.164939 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:54:20.165494 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:54:20.167486 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:20.167971 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ab0c5280>]}
[0m09:54:20.168594 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:54:20.169302 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:54:20.169764 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.170420 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:54:20.171097 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:54:20.171562 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.228990 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.229668 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.257925 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.258425 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095420252237"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:54:20.258841 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:20.269681 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:54:20.284071 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.284517 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:54:20.285071 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:54:20.285468 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.285848 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095420252237'
        
      order by ordinal_position

  
[0m09:54:20.298105 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:54:20.303620 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.304083 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:20.307598 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:20.316206 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.316660 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:20.320233 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:20.336547 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.337175 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.337635 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095420252237"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095420252237"
    )
  
[0m09:54:20.338955 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:54:20.340277 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:20.340698 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:20.341080 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:20.342186 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:20.343051 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:54:20.343687 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a44132dc-35d5-4a11-a6e6-ece49bcd9ce8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c1539700>]}
[0m09:54:20.344344 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:54:20.345063 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:20.345566 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:54:20.346112 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:54:20.346651 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:54:20.347909 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:20.348332 [debug] [MainThread]: On master: BEGIN
[0m09:54:20.348663 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:54:20.355735 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:20.356152 [debug] [MainThread]: On master: COMMIT
[0m09:54:20.356526 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:20.356874 [debug] [MainThread]: On master: COMMIT
[0m09:54:20.357339 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:20.357717 [debug] [MainThread]: On master: Close
[0m09:54:20.358198 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:54:20.358543 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:54:20.358983 [info ] [MainThread]: 
[0m09:54:20.359453 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:54:20.360886 [debug] [MainThread]: Command end result
[0m09:54:20.396027 [info ] [MainThread]: 
[0m09:54:20.396534 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:54:20.396933 [info ] [MainThread]: 
[0m09:54:20.397438 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:20.397840 [info ] [MainThread]: 
[0m09:54:20.398265 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:54:20.399137 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6831464, "process_user_time": 2.809303, "process_kernel_time": 0.749414, "process_mem_max_rss": "142972", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:54:20.399757 [debug] [MainThread]: Command `dbt run` failed at 09:54:20.399659 after 1.68 seconds
[0m09:54:20.400176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19adaf9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19ad9bd520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f19c14c5f70>]}
[0m09:54:20.400580 [debug] [MainThread]: Flushing usage events
[0m09:54:30.683674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb266a2e7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb265387c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb2651e5970>]}


============================== 09:54:30.689381 | b2f1640f-e4c5-4021-829c-d0d96d9ae4a6 ==============================
[0m09:54:30.689381 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:54:30.690036 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:54:30.850773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb26453cd30>]}
[0m09:54:30.907114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb26457c490>]}
[0m09:54:30.907961 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:54:30.926398 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:54:31.112691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:54:31.113459 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:54:31.511648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a682c40>]}
[0m09:54:31.675475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a4d40d0>]}
[0m09:54:31.676154 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:54:31.676644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a697d30>]}
[0m09:54:31.678321 [info ] [MainThread]: 
[0m09:54:31.679020 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:54:31.683569 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:54:31.716501 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:54:31.716943 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:54:31.717296 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:31.726453 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:54:31.727913 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:54:31.729815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:54:31.736286 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:31.736687 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:54:31.737022 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:31.744171 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.744560 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:31.744909 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:54:31.749724 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:54:31.751015 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:54:31.751525 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:54:31.752119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:54:31.755654 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:31.756043 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:54:31.756377 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:31.763145 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.763543 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:31.763894 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:54:31.768426 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:54:31.769512 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:54:31.770009 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:54:31.775794 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.776214 [debug] [MainThread]: On master: BEGIN
[0m09:54:31.776585 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:54:31.783556 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.783994 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.784486 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:54:31.790209 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:31.791415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263dff2e0>]}
[0m09:54:31.791951 [debug] [MainThread]: On master: ROLLBACK
[0m09:54:31.792451 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.792833 [debug] [MainThread]: On master: BEGIN
[0m09:54:31.793381 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:54:31.793774 [debug] [MainThread]: On master: COMMIT
[0m09:54:31.794149 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:31.794528 [debug] [MainThread]: On master: COMMIT
[0m09:54:31.794972 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:31.795420 [debug] [MainThread]: On master: Close
[0m09:54:31.795991 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:54:31.796435 [info ] [MainThread]: 
[0m09:54:31.803230 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:54:31.803856 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:54:31.804466 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:54:31.804928 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:54:31.813377 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:54:31.814000 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:54:31.851759 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:54:31.852426 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.852892 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:54:31.853325 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:31.860551 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.861052 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.861562 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:54:31.867335 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:31.873939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.874431 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:54:31.875230 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.878397 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.878872 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:54:31.879584 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.899213 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:31.899701 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.900134 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:31.901297 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:31.907544 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:54:31.911780 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:31.912211 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:54:31.914860 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:31.917131 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:54:31.918731 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb2641301c0>]}
[0m09:54:31.919427 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:54:31.920147 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:54:31.920650 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:54:31.921312 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:54:31.922071 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:54:31.922545 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:54:31.925971 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:54:31.926577 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:54:31.930300 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:54:31.930919 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.931388 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:54:31.931803 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:31.938834 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.939319 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.939782 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:54:31.944611 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:54:31.947937 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.948439 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:54:31.949173 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.952529 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.953020 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:54:31.953759 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.955162 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:31.955650 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.956075 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:31.957121 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:31.960630 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:54:31.961287 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:31.961742 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:54:31.964605 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:31.965868 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:54:31.966476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb265c17220>]}
[0m09:54:31.967131 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:54:31.967883 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:54:31.968376 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:54:31.968990 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:54:31.969569 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:54:31.970019 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:54:31.973149 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.973833 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:54:31.977555 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.978150 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.978560 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:54:31.978918 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:31.986001 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:31.986411 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.986796 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:54:31.991877 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:31.995125 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.995597 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:54:31.996329 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:31.999411 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:31.999840 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:54:32.000565 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:32.001989 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:32.002414 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:32.002784 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:32.003817 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:32.006616 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:54:32.007351 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:32.007771 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:54:32.010312 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:32.011637 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:54:32.012234 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263dff2e0>]}
[0m09:54:32.012878 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:32.013610 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:54:32.014112 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:54:32.014735 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:54:32.015348 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:54:32.015803 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:54:32.019763 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.020366 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:54:32.024188 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.024818 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.025278 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:54:32.025700 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:32.032663 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:32.033141 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.033636 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:54:32.039380 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:32.042628 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.043106 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:54:32.043880 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:32.046980 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.047488 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:54:32.048195 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:32.049564 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:32.050037 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.050474 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:32.051602 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:32.054287 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:54:32.054932 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:32.055429 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:54:32.057979 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:32.059271 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:54:32.059870 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263d56640>]}
[0m09:54:32.060535 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:32.061313 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:54:32.061806 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.062363 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:54:32.063032 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:54:32.063515 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.066688 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.067317 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.072082 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.072689 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.073133 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:54:32.073549 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:32.080405 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:32.080863 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:32.081321 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE * FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:54:32.081939 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "*"
LINE 40: DELETE * FROM src_ads
                ^

[0m09:54:32.082384 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:54:32.082960 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:54:32.084968 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:32.085485 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb263d8d970>]}
[0m09:54:32.086145 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:54:32.086869 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:54:32.087370 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.088113 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:54:32.088710 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:54:32.089170 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.143491 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.144212 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.172420 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.172969 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095432166712"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:54:32.173457 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:32.184547 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:54:32.198893 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.199410 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:54:32.199999 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:54:32.200447 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.200887 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095432166712'
        
      order by ordinal_position

  
[0m09:54:32.212965 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:54:32.218521 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.219030 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:32.222716 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:32.231517 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.232023 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:32.235625 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:32.252014 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.252687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.253190 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095432166712"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095432166712"
    )
  
[0m09:54:32.254575 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:54:32.255925 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:32.256403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:32.256839 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:32.257876 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:32.258692 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:54:32.259355 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2f1640f-e4c5-4021-829c-d0d96d9ae4a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27a6bdf70>]}
[0m09:54:32.260041 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:54:32.260810 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:32.261346 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:54:32.261894 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:54:32.262429 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:54:32.263780 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:32.264213 [debug] [MainThread]: On master: BEGIN
[0m09:54:32.264554 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:54:32.271796 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:32.272241 [debug] [MainThread]: On master: COMMIT
[0m09:54:32.272629 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:32.273001 [debug] [MainThread]: On master: COMMIT
[0m09:54:32.273472 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:32.273862 [debug] [MainThread]: On master: Close
[0m09:54:32.274396 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:54:32.274752 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:54:32.275256 [info ] [MainThread]: 
[0m09:54:32.275717 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:54:32.277195 [debug] [MainThread]: Command end result
[0m09:54:32.311853 [info ] [MainThread]: 
[0m09:54:32.312424 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:54:32.313072 [info ] [MainThread]: 
[0m09:54:32.313643 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:32.314127 [info ] [MainThread]: 
[0m09:54:32.314589 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:54:32.315586 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6805463, "process_user_time": 2.888993, "process_kernel_time": 0.67811, "process_mem_max_rss": "142904", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:54:32.316216 [debug] [MainThread]: Command `dbt run` failed at 09:54:32.316111 after 1.68 seconds
[0m09:54:32.316636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb27af47340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb26457c490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb264088790>]}
[0m09:54:32.317053 [debug] [MainThread]: Flushing usage events
[0m09:54:39.207399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6605751cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603ec8910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603ec8ac0>]}


============================== 09:54:39.212777 | cacdbde0-0500-4ab4-87cd-7cef13e77152 ==============================
[0m09:54:39.212777 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:54:39.213416 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:54:39.376868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66050556a0>]}
[0m09:54:39.433146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66035b8610>]}
[0m09:54:39.433995 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:54:39.452906 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:54:39.642072 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:54:39.642838 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:54:40.041817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6619282c10>]}
[0m09:54:40.206423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66190d30a0>]}
[0m09:54:40.207051 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:54:40.207524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f661929ad00>]}
[0m09:54:40.209169 [info ] [MainThread]: 
[0m09:54:40.209848 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:54:40.214402 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:54:40.248919 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:54:40.249516 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:54:40.249889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:54:40.260233 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m09:54:40.261506 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:54:40.263370 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:54:40.269568 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:40.269978 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:54:40.270317 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:40.277161 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.277563 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:54:40.277977 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:54:40.282732 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:54:40.284061 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:54:40.284556 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:54:40.285203 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:54:40.289183 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:40.289568 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:54:40.289927 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:54:40.296834 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.297249 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:54:40.297646 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:54:40.302778 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.303929 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:54:40.304408 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:54:40.309958 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.310360 [debug] [MainThread]: On master: BEGIN
[0m09:54:40.310687 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:54:40.317502 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.317895 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.318361 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:54:40.324364 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m09:54:40.325466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66030be040>]}
[0m09:54:40.325950 [debug] [MainThread]: On master: ROLLBACK
[0m09:54:40.326445 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.326803 [debug] [MainThread]: On master: BEGIN
[0m09:54:40.327368 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:54:40.327754 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.328087 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.328401 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.328834 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:40.329190 [debug] [MainThread]: On master: Close
[0m09:54:40.329742 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:54:40.330404 [info ] [MainThread]: 
[0m09:54:40.337124 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:54:40.337771 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:54:40.338360 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:54:40.338788 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:54:40.347364 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:54:40.347972 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:54:40.385659 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:54:40.386289 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.386699 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:54:40.387065 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.394168 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.394634 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.395094 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:54:40.400747 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.407452 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.407897 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:54:40.408669 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.411986 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.412442 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:54:40.413209 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.432906 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:40.433378 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.433812 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:54:40.434888 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.441323 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:54:40.445566 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:54:40.446035 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:54:40.448890 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.451300 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:54:40.452916 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66030ba190>]}
[0m09:54:40.453637 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:54:40.454349 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:54:40.454845 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:54:40.455533 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:54:40.456252 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:54:40.456674 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:54:40.459844 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:54:40.460459 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:54:40.464235 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:54:40.464844 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.465298 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:54:40.465703 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.472843 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.473291 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.473710 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:54:40.478759 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:54:40.482155 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.482611 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:54:40.483459 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.486779 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.487270 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:54:40.488203 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.489685 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:40.490152 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.490564 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:54:40.491727 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.495351 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:54:40.496009 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:54:40.496452 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:54:40.499338 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.500625 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:54:40.501268 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6619bb58e0>]}
[0m09:54:40.501935 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:54:40.502688 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:54:40.503164 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.503815 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:54:40.504388 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:54:40.504826 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.507953 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.508550 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.512415 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.513038 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.513505 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:54:40.513910 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.521169 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.521645 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.522107 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:54:40.527533 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.530889 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.531382 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:54:40.532151 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.535319 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.535773 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:54:40.536503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.537971 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:40.538424 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.538829 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:54:40.539864 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.542569 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:54:40.543322 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:54:40.543765 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:54:40.546651 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.547978 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:54:40.548586 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6602cd5940>]}
[0m09:54:40.549269 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:40.549987 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:54:40.550468 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:54:40.551078 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:54:40.551688 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:54:40.552127 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:54:40.556121 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.556698 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:54:40.560467 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.561085 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.561546 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:54:40.561940 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.569254 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.569718 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.570201 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:54:40.575891 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:54:40.579302 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.579761 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:54:40.580499 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.583686 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.584145 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:54:40.584842 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:54:40.586216 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:40.586656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.587069 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:54:40.588144 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.590872 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:54:40.591534 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:54:40.591965 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:54:40.594626 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:54:40.595911 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:54:40.596527 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603079e20>]}
[0m09:54:40.597193 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:54:40.597882 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:54:40.598355 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.598870 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:54:40.599523 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:54:40.599933 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.603460 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.604064 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.608639 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.609239 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.609652 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:54:40.610034 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.617059 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:54:40.617481 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:54:40.617872 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE FROM src_ads
USING duplicates
WHERE src_ads.id = duplicates.id
AND your_table_name.updated_at = duplicates.updated_at;
  );
  
[0m09:54:40.618499 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "FROM"
LINE 40: DELETE FROM src_ads
                ^

[0m09:54:40.618898 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:54:40.619462 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:54:40.621406 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:40.621915 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6603079e20>]}
[0m09:54:40.622571 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:54:40.623306 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:54:40.623774 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.624425 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:54:40.625115 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:54:40.625538 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.682561 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.683271 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.711107 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.711651 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095440705411"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:54:40.712078 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:54:40.724300 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.012 seconds
[0m09:54:40.739441 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.739917 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:54:40.740628 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:54:40.741095 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.741516 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095440705411'
        
      order by ordinal_position

  
[0m09:54:40.754277 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:54:40.760021 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.760495 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:40.764170 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:40.773061 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.773531 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:54:40.777333 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:54:40.794141 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.794840 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.795355 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095440705411"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095440705411"
    )
  
[0m09:54:40.796810 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:54:40.798161 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:40.798642 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:54:40.799033 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:54:40.800045 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:54:40.800861 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:54:40.801507 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cacdbde0-0500-4ab4-87cd-7cef13e77152', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6619b97100>]}
[0m09:54:40.802224 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:54:40.803044 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:54:40.803784 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:54:40.804493 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:54:40.805065 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:54:40.806380 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.806761 [debug] [MainThread]: On master: BEGIN
[0m09:54:40.807092 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:54:40.814657 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m09:54:40.815101 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.815496 [debug] [MainThread]: Using postgres connection "master"
[0m09:54:40.815823 [debug] [MainThread]: On master: COMMIT
[0m09:54:40.816244 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:54:40.816596 [debug] [MainThread]: On master: Close
[0m09:54:40.817069 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:54:40.817420 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:54:40.817851 [info ] [MainThread]: 
[0m09:54:40.818252 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m09:54:40.819777 [debug] [MainThread]: Command end result
[0m09:54:40.854308 [info ] [MainThread]: 
[0m09:54:40.854855 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:54:40.855291 [info ] [MainThread]: 
[0m09:54:40.855769 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:54:40.856191 [info ] [MainThread]: 
[0m09:54:40.856606 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:54:40.857508 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6998187, "process_user_time": 2.86084, "process_kernel_time": 0.714207, "process_mem_max_rss": "142660", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:54:40.858100 [debug] [MainThread]: Command `dbt run` failed at 09:54:40.858005 after 1.70 seconds
[0m09:54:40.858522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6605751cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66035b8610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f66190d3ac0>]}
[0m09:54:40.858920 [debug] [MainThread]: Flushing usage events
[0m09:56:45.375586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4d7f9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4bf76910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4bf76ac0>]}


============================== 09:56:45.381179 | 8eff6e81-532f-4b40-8d8f-26edf2660a75 ==============================
[0m09:56:45.381179 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:56:45.381864 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:56:45.544447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4d1036a0>]}
[0m09:56:45.600510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4b8e6610>]}
[0m09:56:45.601395 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:56:45.620687 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:56:45.815811 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:56:45.816603 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:56:46.215857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb6147db80>]}
[0m09:56:46.379499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb612d10a0>]}
[0m09:56:46.380129 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:56:46.380558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb6149bd00>]}
[0m09:56:46.382215 [info ] [MainThread]: 
[0m09:56:46.382877 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:56:46.387302 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:56:46.421133 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:56:46.421551 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:56:46.421888 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:56:46.430810 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:56:46.432077 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:56:46.433878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:56:46.440102 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:56:46.440506 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:56:46.440867 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:56:46.447932 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.448330 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:56:46.448686 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:56:46.453561 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:56:46.454705 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:56:46.455243 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:56:46.455856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:56:46.458274 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:56:46.458661 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:56:46.458989 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:56:46.465792 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.466193 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:56:46.466834 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:56:46.471732 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:56:46.473003 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:56:46.473475 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:56:46.479908 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.480312 [debug] [MainThread]: On master: BEGIN
[0m09:56:46.480643 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:56:46.487262 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.487649 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.488061 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:56:46.493700 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.494803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61302f70>]}
[0m09:56:46.495364 [debug] [MainThread]: On master: ROLLBACK
[0m09:56:46.495884 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.496272 [debug] [MainThread]: On master: BEGIN
[0m09:56:46.496823 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:56:46.497252 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.497630 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.497998 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.498446 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:56:46.498818 [debug] [MainThread]: On master: Close
[0m09:56:46.499372 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:56:46.499777 [info ] [MainThread]: 
[0m09:56:46.506164 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:56:46.506804 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:56:46.507416 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:56:46.507850 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:56:46.516190 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:56:46.516805 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:56:46.555246 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:56:46.555883 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.556302 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:56:46.556665 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.564207 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.564648 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.565098 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:56:46.570430 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.576832 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.577279 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:56:46.578150 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.581352 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.581787 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:56:46.582461 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.602274 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:56:46.602713 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.603096 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:56:46.604226 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.610493 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:56:46.614837 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:56:46.615313 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:56:46.618031 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.620339 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:56:46.621951 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4b1af250>]}
[0m09:56:46.622684 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:56:46.623377 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:56:46.623866 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:56:46.624521 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:56:46.625461 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:56:46.626096 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:56:46.629263 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:56:46.629858 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:56:46.633662 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:56:46.634275 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.634699 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:56:46.635089 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.642151 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.642594 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.643030 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:56:46.648017 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:56:46.651372 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.651817 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:56:46.652611 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.655851 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.656289 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:56:46.657060 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.658416 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:56:46.658832 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.659232 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:56:46.660413 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.663968 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:56:46.664580 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:56:46.664996 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:56:46.667850 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.669096 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:56:46.669767 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4bf76190>]}
[0m09:56:46.670775 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:56:46.671747 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:56:46.672300 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.672884 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:56:46.673434 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:56:46.673835 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.676797 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.677354 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.681067 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.681648 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.682062 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:56:46.682425 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.689457 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.689915 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.690410 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:56:46.695510 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.698794 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.699275 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:56:46.700036 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.703134 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.703623 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:56:46.704312 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.705756 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:56:46.706343 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.706790 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:56:46.707982 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.710699 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:56:46.711450 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:56:46.711894 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:56:46.714609 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.715922 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:56:46.716520 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61337a90>]}
[0m09:56:46.717200 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:56:46.718042 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:56:46.718550 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:56:46.719088 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:56:46.719798 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:56:46.720255 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:56:46.724250 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.724837 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:56:46.728615 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.729232 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.729658 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:56:46.730062 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.736925 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.737388 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.737837 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:56:46.743650 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:56:46.746854 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.747312 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:56:46.748073 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.751141 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.751577 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:56:46.752245 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:56:46.753560 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:56:46.753973 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.754334 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:56:46.755345 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.758007 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:56:46.758603 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:56:46.759001 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:56:46.761581 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:56:46.762799 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:56:46.763393 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4ad9a040>]}
[0m09:56:46.764032 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:56:46.764719 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:56:46.765225 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.765819 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:56:46.766363 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:56:46.766782 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.769927 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.770483 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.774979 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.775569 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.776018 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:56:46.776392 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.783140 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.783581 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:56:46.783983 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:56:46.784582 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "FROM"
LINE 40: DELETE FROM src_ads
                ^

[0m09:56:46.784985 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:56:46.785511 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:56:46.787460 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:56:46.787945 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61337a90>]}
[0m09:56:46.788577 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:56:46.789290 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:56:46.789737 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.790476 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:56:46.791057 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:56:46.791515 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.847010 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.847753 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.875820 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.876631 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095646869948"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:56:46.877124 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:56:46.888920 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.012 seconds
[0m09:56:46.903422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.903874 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:56:46.904450 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:56:46.904855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.905246 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095646869948'
        
      order by ordinal_position

  
[0m09:56:46.918673 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m09:56:46.924262 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.924718 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:56:46.928497 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:56:46.937321 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.937775 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:56:46.941491 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:56:46.957984 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.958623 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.959097 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095646869948"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095646869948"
    )
  
[0m09:56:46.960570 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:56:46.961855 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:56:46.962284 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:56:46.962655 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:56:46.963664 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:56:46.964458 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:56:46.965069 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8eff6e81-532f-4b40-8d8f-26edf2660a75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4adcc370>]}
[0m09:56:46.965723 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:56:46.966477 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:56:46.966993 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:56:46.967587 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:56:46.968128 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:56:46.969386 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.969794 [debug] [MainThread]: On master: BEGIN
[0m09:56:46.970155 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:56:46.977679 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:56:46.978109 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.978479 [debug] [MainThread]: Using postgres connection "master"
[0m09:56:46.978830 [debug] [MainThread]: On master: COMMIT
[0m09:56:46.979357 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:56:46.979716 [debug] [MainThread]: On master: Close
[0m09:56:46.980222 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:56:46.980561 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:56:46.981007 [info ] [MainThread]: 
[0m09:56:46.981467 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:56:46.982963 [debug] [MainThread]: Command end result
[0m09:56:47.017195 [info ] [MainThread]: 
[0m09:56:47.017744 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:56:47.018165 [info ] [MainThread]: 
[0m09:56:47.018721 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:56:47.019149 [info ] [MainThread]: 
[0m09:56:47.019673 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:56:47.020843 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6971246, "process_user_time": 2.840771, "process_kernel_time": 0.721149, "process_mem_max_rss": "142956", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:56:47.021472 [debug] [MainThread]: Command `dbt run` failed at 09:56:47.021367 after 1.70 seconds
[0m09:56:47.021908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4d7f9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb4b8e6610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdb61db8550>]}
[0m09:56:47.022343 [debug] [MainThread]: Flushing usage events
[0m09:57:01.443600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28cb19c7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c9af5c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c9953970>]}


============================== 09:57:01.448732 | d12946ad-0073-482a-b1c8-479784a7f052 ==============================
[0m09:57:01.448732 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:57:01.449324 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:57:01.607402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8fbcd30>]}
[0m09:57:01.662682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8ffc490>]}
[0m09:57:01.663519 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:57:01.682660 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:57:01.870410 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:57:01.871256 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:57:02.264004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28dee80bb0>]}
[0m09:57:02.425698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28decd20d0>]}
[0m09:57:02.426347 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:57:02.426832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28dee99d30>]}
[0m09:57:02.428625 [info ] [MainThread]: 
[0m09:57:02.429369 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:57:02.435173 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:57:02.469884 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:57:02.470311 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:57:02.470654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:02.479935 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:57:02.481181 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:57:02.483464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:57:02.490096 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:02.490506 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:57:02.490846 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:02.498025 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.498433 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:02.498801 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:57:02.503816 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:57:02.505141 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:57:02.505635 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:57:02.506247 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:57:02.509789 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:02.510332 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:57:02.510679 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:02.517579 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.517980 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:02.518336 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:57:02.523162 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:57:02.524284 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:57:02.524750 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:57:02.530261 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.530660 [debug] [MainThread]: On master: BEGIN
[0m09:57:02.531027 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:57:02.537908 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.538326 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.538786 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:57:02.544577 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.545721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c87be2e0>]}
[0m09:57:02.546233 [debug] [MainThread]: On master: ROLLBACK
[0m09:57:02.546707 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.547066 [debug] [MainThread]: On master: BEGIN
[0m09:57:02.547613 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:57:02.547965 [debug] [MainThread]: On master: COMMIT
[0m09:57:02.548316 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:02.548647 [debug] [MainThread]: On master: COMMIT
[0m09:57:02.549062 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:02.549440 [debug] [MainThread]: On master: Close
[0m09:57:02.549963 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:57:02.550390 [info ] [MainThread]: 
[0m09:57:02.557070 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:57:02.557723 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:57:02.558285 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:57:02.558704 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:57:02.567092 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:57:02.567717 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:57:02.605580 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:57:02.606207 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.606634 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:57:02.607014 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.614096 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.614513 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.614950 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:57:02.620339 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.626677 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.627134 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:57:02.627924 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.631057 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.631520 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:57:02.632253 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.651916 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:02.652358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.652738 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:02.653828 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.660064 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:57:02.664316 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:02.664747 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:57:02.667621 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.669867 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:57:02.671449 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8ad01c0>]}
[0m09:57:02.672118 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:57:02.672814 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:57:02.673293 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:57:02.673910 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:57:02.674643 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:57:02.675063 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:57:02.678174 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:57:02.678733 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:57:02.682391 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:57:02.682972 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.683399 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:57:02.683761 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.690667 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.691092 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.691500 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:57:02.696298 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:57:02.699598 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.700037 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:57:02.700763 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.704011 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.704438 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:57:02.705119 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.706494 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:02.706912 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.707299 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:02.708443 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.712008 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:57:02.712640 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:02.713041 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:57:02.715769 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.717049 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:57:02.717634 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28ca385220>]}
[0m09:57:02.718279 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:57:02.718981 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:57:02.719517 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.720146 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:57:02.720711 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:57:02.721136 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.724132 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.724710 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.728475 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.729083 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.729513 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:57:02.729917 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.736863 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.737310 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.737734 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:57:02.742917 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.746335 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.746799 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:57:02.747609 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.750749 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.751215 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:57:02.751949 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.753412 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:02.753851 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.754262 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:02.755216 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.757861 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:57:02.758589 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:02.759029 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:57:02.761664 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.762932 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:57:02.763563 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c87be2e0>]}
[0m09:57:02.764213 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:02.764927 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:57:02.765414 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:57:02.765993 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:57:02.766548 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:57:02.766948 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:57:02.770818 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.771432 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:57:02.775155 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.775784 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.776203 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:57:02.776568 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.784279 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m09:57:02.784710 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.785148 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:57:02.790831 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:02.794073 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.794501 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:57:02.795283 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.798403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.798824 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:57:02.799526 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:02.800867 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:02.801290 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.801654 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:02.802740 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:02.805422 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:57:02.806038 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:02.806441 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:57:02.809124 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:02.810362 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:57:02.810938 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8715670>]}
[0m09:57:02.811592 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:02.812290 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:57:02.812751 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.813329 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:57:02.813890 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:57:02.814317 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.817496 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.818061 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.822618 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.823226 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.823645 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:57:02.824008 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.831011 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:02.831443 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:02.831840 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:57:02.832558 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "*"
LINE 40: DELETE * FROM src_ads
                ^

[0m09:57:02.832966 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:57:02.833517 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:57:02.835475 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:02.835975 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8745dc0>]}
[0m09:57:02.836598 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:57:02.837325 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:57:02.837785 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:02.838526 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:57:02.839087 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:57:02.839539 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:02.894899 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.895623 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:02.923464 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.923977 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095702917797"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:57:02.924397 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:02.935142 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:57:02.949308 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.949761 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:57:02.950359 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:57:02.950767 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.951167 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095702917797'
        
      order by ordinal_position

  
[0m09:57:02.963483 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:57:02.968870 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.969333 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:02.972968 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:02.981519 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:02.981986 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:02.985550 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:03.001871 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:03.002519 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:03.002976 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095702917797"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095702917797"
    )
  
[0m09:57:03.004426 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:57:03.005700 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:03.006184 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:03.006571 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:03.007612 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:03.008490 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:57:03.009138 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd12946ad-0073-482a-b1c8-479784a7f052', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8752fd0>]}
[0m09:57:03.009845 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:57:03.010551 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:03.011086 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:57:03.011672 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:57:03.012198 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:57:03.013382 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:03.013750 [debug] [MainThread]: On master: BEGIN
[0m09:57:03.014073 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:57:03.021197 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:03.021624 [debug] [MainThread]: On master: COMMIT
[0m09:57:03.021981 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:03.022326 [debug] [MainThread]: On master: COMMIT
[0m09:57:03.022744 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:03.023127 [debug] [MainThread]: On master: Close
[0m09:57:03.023645 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:57:03.023987 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:57:03.024408 [info ] [MainThread]: 
[0m09:57:03.024834 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:57:03.026297 [debug] [MainThread]: Command end result
[0m09:57:03.060693 [info ] [MainThread]: 
[0m09:57:03.061238 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:57:03.061670 [info ] [MainThread]: 
[0m09:57:03.062152 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "*"
  LINE 40: DELETE * FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:03.062574 [info ] [MainThread]: 
[0m09:57:03.062999 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:57:03.063911 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.668959, "process_user_time": 2.815342, "process_kernel_time": 0.722804, "process_mem_max_rss": "142860", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:57:03.064521 [debug] [MainThread]: Command `dbt run` failed at 09:57:03.064424 after 1.67 seconds
[0m09:57:03.064943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28df74b340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8ffc490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f28c8715130>]}
[0m09:57:03.065339 [debug] [MainThread]: Flushing usage events
[0m09:57:13.680397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ecb237c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96eb47cc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96eb2d9970>]}


============================== 09:57:13.686315 | 8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d ==============================
[0m09:57:13.686315 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:57:13.687242 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:57:13.850073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea93cd30>]}
[0m09:57:13.906282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea96d490>]}
[0m09:57:13.907190 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:57:13.927097 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:57:14.117413 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:57:14.118199 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:57:14.516334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9700681bb0>]}
[0m09:57:14.677360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97004d10d0>]}
[0m09:57:14.677980 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:57:14.678394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9700696d30>]}
[0m09:57:14.680041 [info ] [MainThread]: 
[0m09:57:14.680706 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:57:14.685148 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:57:14.719039 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:57:14.719526 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:57:14.719919 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:14.729326 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:57:14.730645 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:57:14.732565 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:57:14.738958 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:14.739395 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:57:14.739734 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:14.746982 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.747492 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:14.747860 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:57:14.752898 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:57:14.754208 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:57:14.754695 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:57:14.755353 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:57:14.758978 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:14.759384 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:57:14.759719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:14.766570 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.767001 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:14.767417 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:57:14.772370 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:14.773513 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:57:14.774000 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:57:14.779916 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.780336 [debug] [MainThread]: On master: BEGIN
[0m09:57:14.780714 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:57:14.788176 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.788577 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.789029 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:57:14.795008 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m09:57:14.796237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea13e2e0>]}
[0m09:57:14.796765 [debug] [MainThread]: On master: ROLLBACK
[0m09:57:14.797268 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.797624 [debug] [MainThread]: On master: BEGIN
[0m09:57:14.798152 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:57:14.798535 [debug] [MainThread]: On master: COMMIT
[0m09:57:14.798863 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:14.799178 [debug] [MainThread]: On master: COMMIT
[0m09:57:14.799633 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:14.799980 [debug] [MainThread]: On master: Close
[0m09:57:14.800475 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:57:14.800952 [info ] [MainThread]: 
[0m09:57:14.809021 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:57:14.809919 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:57:14.810674 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:57:14.811349 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:57:14.820052 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:57:14.820673 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:57:14.858781 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:57:14.859504 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.859942 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:57:14.860330 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:14.867629 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.868060 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.868500 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:57:14.874550 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m09:57:14.881194 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.881639 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:57:14.882404 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.885687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.886126 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:57:14.886845 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.906792 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:14.907291 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.907694 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:14.909429 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:14.915797 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:57:14.920088 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:14.920527 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:57:14.923526 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:57:14.925838 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:57:14.927490 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea4741c0>]}
[0m09:57:14.928191 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.12s]
[0m09:57:14.928907 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:57:14.929395 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:57:14.929919 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:57:14.930610 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:57:14.931232 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:57:14.934537 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:57:14.935155 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:57:14.938935 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:57:14.939590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.940053 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:57:14.940476 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:14.947660 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.948133 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.948637 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:57:14.955091 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m09:57:14.958799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.959308 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:57:14.960127 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.963539 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.964019 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:57:14.964800 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:14.966246 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:14.966727 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.967165 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:14.968441 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:14.972277 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:57:14.972963 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:14.973436 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:57:14.976188 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:14.977538 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:57:14.978213 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ebd0c220>]}
[0m09:57:14.978919 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:57:14.979709 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:57:14.980236 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:57:14.980873 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:57:14.981483 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:57:14.981954 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:57:14.985132 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.985765 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:57:14.989683 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.990358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.990842 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:57:14.991303 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:14.998612 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:14.999074 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:14.999506 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:57:15.004959 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:15.008429 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.008867 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:57:15.009632 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.012853 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.013288 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:57:15.013996 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.015505 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:15.015932 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.016318 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:15.017401 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:15.020180 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:57:15.020892 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:15.021326 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:57:15.024438 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:57:15.025728 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:57:15.026362 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea13e2e0>]}
[0m09:57:15.027030 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:15.027709 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:57:15.028251 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:57:15.028898 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:57:15.029480 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:57:15.029920 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:57:15.034287 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.034932 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:57:15.038785 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.039426 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.039860 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:57:15.040271 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:15.047753 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:15.048211 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.048663 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:57:15.054724 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m09:57:15.058250 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.058710 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:57:15.059512 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.062799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.063289 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:57:15.064028 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:15.065433 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:15.065866 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.066272 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:15.067343 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:15.070115 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:57:15.070762 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:15.071221 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:57:15.073979 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:15.075335 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:57:15.075981 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea095670>]}
[0m09:57:15.076664 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.05s]
[0m09:57:15.077388 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:57:15.077903 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.078445 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:57:15.079017 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:57:15.079554 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.084014 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.084648 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.089367 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.089980 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.090390 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:57:15.090760 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:15.098191 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:15.098621 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:15.099021 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

DELETE FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:57:15.099747 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "FROM"
LINE 40: DELETE FROM src_ads
                ^

[0m09:57:15.100168 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:57:15.100728 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:57:15.102777 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:15.103332 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ebd0c220>]}
[0m09:57:15.104001 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:57:15.104761 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:57:15.105257 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.105932 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:57:15.106629 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:57:15.107305 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.164840 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.165648 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.194562 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.195120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095715188415"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:57:15.195637 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:15.207797 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.012 seconds
[0m09:57:15.222642 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.223131 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:57:15.223825 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:57:15.224308 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.224727 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095715188415'
        
      order by ordinal_position

  
[0m09:57:15.236831 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:57:15.242907 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.243446 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:15.247337 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:15.256887 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.257438 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:15.261729 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m09:57:15.278549 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.279343 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.279846 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095715188415"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095715188415"
    )
  
[0m09:57:15.281466 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:57:15.282838 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:15.283304 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:15.283695 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:15.284876 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:15.285737 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:57:15.286361 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8f58ab40-25c8-4804-a3a7-bbb3bf93fb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea1f9f10>]}
[0m09:57:15.287038 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:57:15.287814 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:15.288348 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:57:15.288836 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:57:15.289378 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:57:15.290968 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:15.291426 [debug] [MainThread]: On master: BEGIN
[0m09:57:15.291773 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:57:15.299063 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:15.299487 [debug] [MainThread]: On master: COMMIT
[0m09:57:15.299849 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:15.300209 [debug] [MainThread]: On master: COMMIT
[0m09:57:15.300695 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:15.301063 [debug] [MainThread]: On master: Close
[0m09:57:15.301557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:57:15.301894 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:57:15.302353 [info ] [MainThread]: 
[0m09:57:15.302750 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m09:57:15.304252 [debug] [MainThread]: Command end result
[0m09:57:15.338778 [info ] [MainThread]: 
[0m09:57:15.339326 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:57:15.339746 [info ] [MainThread]: 
[0m09:57:15.340274 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "FROM"
  LINE 40: DELETE FROM src_ads
                  ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:15.340702 [info ] [MainThread]: 
[0m09:57:15.341118 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:57:15.342064 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.714028, "process_user_time": 2.893061, "process_kernel_time": 0.676506, "process_mem_max_rss": "145032", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:57:15.342687 [debug] [MainThread]: Command `dbt run` failed at 09:57:15.342583 after 1.71 seconds
[0m09:57:15.343129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96eb2e9880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea93cd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96ea4a4bb0>]}
[0m09:57:15.343600 [debug] [MainThread]: Flushing usage events
[0m09:57:52.794326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7d23c700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7b9b7970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7b9b7520>]}


============================== 09:57:52.799577 | e7860276-64e4-4ede-a055-2cc700ae1fd7 ==============================
[0m09:57:52.799577 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:57:52.800175 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'send_anonymous_usage_stats': 'True'}
[0m09:57:52.961965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7adf8bb0>]}
[0m09:57:53.017245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7b9ba460>]}
[0m09:57:53.018120 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:57:53.036819 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:57:53.223056 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:57:53.223858 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:57:53.621230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd90e80cd0>]}
[0m09:57:53.786734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd90cd1160>]}
[0m09:57:53.787395 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:57:53.787852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd90e8f3d0>]}
[0m09:57:53.789471 [info ] [MainThread]: 
[0m09:57:53.790136 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:57:53.794650 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:57:53.827841 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:57:53.828253 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:57:53.828589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:57:53.844540 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.016 seconds
[0m09:57:53.845800 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:57:53.847558 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:57:53.853741 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:53.854141 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:57:53.854469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:53.861410 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.861832 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:57:53.862206 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:57:53.867029 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:57:53.868385 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:57:53.868884 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:57:53.869497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:57:53.873211 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:53.873619 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:57:53.873958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:57:53.880818 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.881238 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:57:53.881591 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:57:53.886212 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:57:53.887324 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:57:53.887806 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:57:53.893297 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.893712 [debug] [MainThread]: On master: BEGIN
[0m09:57:53.894091 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:57:53.900920 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.901344 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.901814 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:57:53.907439 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:53.908564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a87e1c0>]}
[0m09:57:53.909091 [debug] [MainThread]: On master: ROLLBACK
[0m09:57:53.909644 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.910033 [debug] [MainThread]: On master: BEGIN
[0m09:57:53.910613 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:57:53.911007 [debug] [MainThread]: On master: COMMIT
[0m09:57:53.911411 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:53.911780 [debug] [MainThread]: On master: COMMIT
[0m09:57:53.912250 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:53.912621 [debug] [MainThread]: On master: Close
[0m09:57:53.913149 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:57:53.913557 [info ] [MainThread]: 
[0m09:57:53.920988 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:57:53.921605 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:57:53.922179 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:57:53.922606 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:57:53.931086 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:57:53.931724 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:57:53.969588 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:57:53.970228 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.970644 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:57:53.971014 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:53.978050 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:53.978496 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.978997 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:57:53.984612 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:53.991026 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.991529 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:57:53.992306 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:53.995503 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:53.995939 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:57:53.996633 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.016890 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:54.017352 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:54.017737 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:57:54.018861 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.025417 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:57:54.029662 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:57:54.030120 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:57:54.033497 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:57:54.036013 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:57:54.037633 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a87c5b0>]}
[0m09:57:54.038327 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:57:54.039004 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:57:54.039513 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:57:54.040169 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:57:54.040901 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:57:54.041331 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:57:54.044529 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:57:54.045112 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:57:54.048765 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:57:54.049357 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.049755 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:57:54.050137 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.057276 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.057714 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.058124 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:57:54.063112 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:57:54.066461 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.066898 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:57:54.067655 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.070886 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.071351 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:57:54.072043 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.073425 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:54.073848 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.074226 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:57:54.075320 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.078821 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:57:54.079462 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:57:54.079867 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:57:54.082503 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:54.083775 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:57:54.084359 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9178d280>]}
[0m09:57:54.084995 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:57:54.085647 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:57:54.086115 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.086688 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:57:54.087225 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:57:54.087634 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.090545 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.091113 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.094819 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.095443 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.095856 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:57:54.096225 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.103058 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.103527 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.103929 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:57:54.109061 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:54.112410 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.112845 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:57:54.113580 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.116734 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.117171 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:57:54.117859 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.119318 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:54.119746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.120123 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:57:54.121049 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.123720 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:57:54.124402 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:57:54.124822 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:57:54.127484 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:54.128710 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:57:54.129301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a595730>]}
[0m09:57:54.129944 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:54.130753 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:57:54.131342 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:57:54.131941 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:57:54.132495 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:57:54.132921 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:57:54.136799 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.137388 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:57:54.141087 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.141668 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.142087 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:57:54.142453 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.149392 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.149834 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.150259 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:57:54.155781 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:57:54.158962 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.159435 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:57:54.160160 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.163277 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.163695 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:57:54.164468 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:57:54.165810 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:54.166221 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.166582 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:57:54.167531 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.170181 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:57:54.170782 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:57:54.171190 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:57:54.173794 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:57:54.175043 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:57:54.175648 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a87e3d0>]}
[0m09:57:54.176283 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:57:54.176942 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:57:54.177421 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.178011 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:57:54.178535 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:57:54.178941 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.182180 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.182733 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.187271 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.187850 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.188285 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:57:54.188649 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.195488 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.195900 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:57:54.196298 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

DELETE FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:57:54.196873 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "DELETE"
LINE 40: DELETE FROM src_ads
         ^

[0m09:57:54.197275 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:57:54.197808 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:57:54.199779 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:54.200272 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a48e9a0>]}
[0m09:57:54.200901 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:57:54.201589 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:57:54.202048 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.202764 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:57:54.203409 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:57:54.203825 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.268129 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.268903 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.297258 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.297811 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095754291504"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:57:54.298244 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:57:54.309094 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:57:54.323687 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.324167 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:57:54.324756 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:57:54.325180 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.325563 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095754291504'
        
      order by ordinal_position

  
[0m09:57:54.338056 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:57:54.343728 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.344190 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:54.347866 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:54.356770 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.357230 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:57:54.360793 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:57:54.377415 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.378134 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.378865 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095754291504"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095754291504"
    )
  
[0m09:57:54.380302 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:57:54.381709 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:54.382230 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:57:54.382623 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:57:54.383769 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:57:54.384601 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:57:54.385209 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7860276-64e4-4ede-a055-2cc700ae1fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a48e9a0>]}
[0m09:57:54.385876 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:57:54.386587 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:57:54.387085 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:57:54.387710 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:57:54.388278 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:57:54.389520 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:54.389940 [debug] [MainThread]: On master: BEGIN
[0m09:57:54.390370 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:57:54.397800 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:57:54.398199 [debug] [MainThread]: On master: COMMIT
[0m09:57:54.398541 [debug] [MainThread]: Using postgres connection "master"
[0m09:57:54.398855 [debug] [MainThread]: On master: COMMIT
[0m09:57:54.399294 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:57:54.399661 [debug] [MainThread]: On master: Close
[0m09:57:54.400127 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:57:54.400461 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:57:54.400873 [info ] [MainThread]: 
[0m09:57:54.401395 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m09:57:54.403079 [debug] [MainThread]: Command end result
[0m09:57:54.442388 [info ] [MainThread]: 
[0m09:57:54.442952 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:57:54.443381 [info ] [MainThread]: 
[0m09:57:54.443879 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "DELETE"
  LINE 40: DELETE FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:57:54.444269 [info ] [MainThread]: 
[0m09:57:54.444682 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:57:54.445574 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7011199, "process_user_time": 2.898506, "process_kernel_time": 0.703637, "process_mem_max_rss": "144852", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:57:54.446206 [debug] [MainThread]: Command `dbt run` failed at 09:57:54.446102 after 1.70 seconds
[0m09:57:54.446664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7d23c700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd91745370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7a5ddc40>]}
[0m09:57:54.447114 [debug] [MainThread]: Flushing usage events
[0m09:58:58.256891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcf6115b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcdf895e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabce29c9a0>]}


============================== 09:58:58.262895 | 3e302050-cf2a-477a-acba-622ec6aa95cb ==============================
[0m09:58:58.262895 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:58:58.263588 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:58:58.424703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcd736e20>]}
[0m09:58:58.480822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcd6f82b0>]}
[0m09:58:58.481621 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:58:58.500985 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:58:58.692666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:58:58.693397 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:58:59.096638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3282be0>]}
[0m09:58:59.259754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe30c8fa0>]}
[0m09:58:59.260408 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:58:59.260918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3297c40>]}
[0m09:58:59.262571 [info ] [MainThread]: 
[0m09:58:59.263280 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:58:59.267662 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:58:59.300518 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:58:59.300928 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:58:59.301273 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:58:59.317384 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.016 seconds
[0m09:58:59.318636 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:58:59.320437 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:58:59.326635 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:58:59.327041 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:58:59.327398 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:58:59.334489 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.334868 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:58:59.335246 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:58:59.340064 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.004 seconds
[0m09:58:59.341347 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:58:59.341825 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:58:59.342422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:58:59.345990 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:58:59.346381 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:58:59.346706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:58:59.353412 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.353801 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:58:59.354181 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:58:59.358816 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:58:59.359916 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:58:59.360405 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:58:59.365969 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.366381 [debug] [MainThread]: On master: BEGIN
[0m09:58:59.366718 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:58:59.373488 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.373900 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.374326 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:58:59.379979 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.381062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabccf7f040>]}
[0m09:58:59.381558 [debug] [MainThread]: On master: ROLLBACK
[0m09:58:59.382037 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.382399 [debug] [MainThread]: On master: BEGIN
[0m09:58:59.382916 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:58:59.383333 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.383680 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.384002 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.384408 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:58:59.384747 [debug] [MainThread]: On master: Close
[0m09:58:59.385241 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:58:59.385693 [info ] [MainThread]: 
[0m09:58:59.392405 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:58:59.393095 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:58:59.393652 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:58:59.394090 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:58:59.402726 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:58:59.403348 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:58:59.440988 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:58:59.441613 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.442030 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:58:59.442398 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.449395 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.449826 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.450291 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:58:59.456135 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.462574 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.463021 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:58:59.463805 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.466939 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.467401 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:58:59.468113 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.487796 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:58:59.488235 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.488706 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:58:59.489980 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.496285 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:58:59.500484 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:58:59.500920 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:58:59.503909 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:58:59.506212 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:58:59.507844 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabccf50190>]}
[0m09:58:59.508536 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:58:59.509238 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:58:59.509738 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:58:59.510542 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:58:59.511116 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:58:59.511555 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:58:59.514760 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:58:59.515369 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:58:59.519068 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:58:59.519692 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.520105 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:58:59.520464 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.527858 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.528281 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.528669 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:58:59.533522 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.004 seconds
[0m09:58:59.536814 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.537255 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:58:59.537994 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.541230 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.541689 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:58:59.542419 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.543815 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:58:59.544275 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.544654 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:58:59.545817 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.549383 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:58:59.550017 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:58:59.550428 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:58:59.553275 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:58:59.554516 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:58:59.555109 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3bbdb20>]}
[0m09:58:59.555768 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:58:59.556434 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:58:59.556913 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.557529 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:58:59.558074 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:58:59.558486 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.561474 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.562050 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.565932 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.566533 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.566941 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:58:59.567331 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.574270 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.574700 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.575115 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:58:59.580471 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.583760 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.584201 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:58:59.584943 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.588055 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.588486 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:58:59.589232 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.590685 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:58:59.591112 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.591506 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:58:59.592630 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.595642 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:58:59.596343 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:58:59.596765 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:58:59.599957 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:58:59.601227 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:58:59.601819 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcd3fc220>]}
[0m09:58:59.602467 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:58:59.603223 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:58:59.603727 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:58:59.604341 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:58:59.604882 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:58:59.605295 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:58:59.609556 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.610155 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:58:59.613878 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.614475 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.614884 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:58:59.615269 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.622361 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.622802 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.623253 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:58:59.629059 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:58:59.632252 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.632686 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:58:59.633446 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.636563 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.636994 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:58:59.637710 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:58:59.639063 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:58:59.639495 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.639854 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:58:59.640817 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.643520 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:58:59.644143 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:58:59.644546 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:58:59.647144 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:58:59.648388 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:58:59.648956 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3bbda30>]}
[0m09:58:59.649614 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:58:59.650345 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:58:59.650825 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.651452 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:58:59.652029 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:58:59.652455 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.655733 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.656300 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.661151 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.661727 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.662142 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:58:59.662500 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.669445 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.669878 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:58:59.670285 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
),

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:58:59.670963 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "SELECT"
LINE 40: SELECT * FROM src_ads
         ^

[0m09:58:59.671393 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:58:59.671993 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:58:59.673970 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "SELECT"
  LINE 40: SELECT * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:58:59.674498 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe3bbda30>]}
[0m09:58:59.675139 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:58:59.675830 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:58:59.676314 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.677073 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:58:59.677632 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:58:59.678064 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.734819 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.735533 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.764015 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.764514 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095859758254"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:58:59.764942 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:58:59.776013 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:58:59.790219 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.790675 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:58:59.791293 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:58:59.791714 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.792140 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095859758254'
        
      order by ordinal_position

  
[0m09:58:59.804566 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:58:59.810104 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.810559 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:58:59.814256 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:58:59.823058 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.823560 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:58:59.827290 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:58:59.844025 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.844683 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.845144 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095859758254"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095859758254"
    )
  
[0m09:58:59.846530 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:58:59.847872 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:58:59.848326 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:58:59.848715 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:58:59.849804 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:58:59.850631 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:58:59.851261 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3e302050-cf2a-477a-acba-622ec6aa95cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabe30d4460>]}
[0m09:58:59.851920 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.17s]
[0m09:58:59.852602 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:58:59.853108 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:58:59.853650 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:58:59.854204 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:58:59.855669 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.856098 [debug] [MainThread]: On master: BEGIN
[0m09:58:59.856452 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:58:59.863733 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:58:59.864148 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.864534 [debug] [MainThread]: Using postgres connection "master"
[0m09:58:59.864899 [debug] [MainThread]: On master: COMMIT
[0m09:58:59.865372 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:58:59.865738 [debug] [MainThread]: On master: Close
[0m09:58:59.866190 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:58:59.866547 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:58:59.866965 [info ] [MainThread]: 
[0m09:58:59.867431 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:58:59.868902 [debug] [MainThread]: Command end result
[0m09:58:59.907230 [info ] [MainThread]: 
[0m09:58:59.907996 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:58:59.908495 [info ] [MainThread]: 
[0m09:58:59.909222 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near "SELECT"
  LINE 40: SELECT * FROM src_ads
           ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:58:59.909892 [info ] [MainThread]: 
[0m09:58:59.910562 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:58:59.911712 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7043417, "process_user_time": 2.838913, "process_kernel_time": 0.747501, "process_mem_max_rss": "142796", "process_out_blocks": "3528", "command_success": false, "process_in_blocks": "0"}
[0m09:58:59.912357 [debug] [MainThread]: Command `dbt run` failed at 09:58:59.912229 after 1.71 seconds
[0m09:58:59.912926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcf6115b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabcf362820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fabccbec790>]}
[0m09:58:59.913365 [debug] [MainThread]: Flushing usage events
[0m09:59:07.836296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815f964610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815e0d92e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815e0d94f0>]}


============================== 09:59:07.841552 | 72a67bd6-bf35-41d8-af56-15a083b2c98b ==============================
[0m09:59:07.841552 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:59:07.842174 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:59:08.003136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d7a0250>]}
[0m09:59:08.059681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d7bc4f0>]}
[0m09:59:08.060589 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:59:08.080002 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:59:08.268483 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:59:08.269259 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:59:08.664730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8173482ca0>]}
[0m09:59:08.827697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f81732d3130>]}
[0m09:59:08.828318 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:59:08.828788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d3ae520>]}
[0m09:59:08.830448 [info ] [MainThread]: 
[0m09:59:08.831118 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:59:08.835632 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:59:08.869056 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:59:08.869491 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:59:08.869839 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:08.879066 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m09:59:08.880417 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:59:08.882193 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m09:59:08.888501 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:08.888937 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:59:08.889338 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:08.898022 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m09:59:08.898456 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:08.898882 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:59:08.903921 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:59:08.905287 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:59:08.905788 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:59:08.906434 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m09:59:08.909998 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:08.910423 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:59:08.910814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:08.917866 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:59:08.918295 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:08.918721 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:59:08.923612 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:59:08.924805 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:59:08.925310 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:59:08.931155 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.931614 [debug] [MainThread]: On master: BEGIN
[0m09:59:08.931959 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:59:08.938905 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:08.939350 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.939765 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:59:08.945572 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:08.946685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf7e190>]}
[0m09:59:08.947229 [debug] [MainThread]: On master: ROLLBACK
[0m09:59:08.947895 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.948268 [debug] [MainThread]: On master: BEGIN
[0m09:59:08.948819 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:59:08.949229 [debug] [MainThread]: On master: COMMIT
[0m09:59:08.949583 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:08.949932 [debug] [MainThread]: On master: COMMIT
[0m09:59:08.950359 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:08.950716 [debug] [MainThread]: On master: Close
[0m09:59:08.951257 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:59:08.951717 [info ] [MainThread]: 
[0m09:59:08.958235 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:59:08.958860 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:59:08.959509 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m09:59:08.959947 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:59:08.968578 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:59:08.969182 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:59:09.007186 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:59:09.007837 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.008272 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:59:09.008650 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.015933 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.016387 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.016828 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:59:09.022983 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.006 seconds
[0m09:59:09.029414 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.029875 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:59:09.030642 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.033815 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.034249 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:59:09.035010 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.054860 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:09.055317 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.055700 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:09.056923 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.063152 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:59:09.067454 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:09.067893 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:59:09.070722 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:09.073059 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:59:09.074690 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf7f0a0>]}
[0m09:59:09.075390 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:59:09.076146 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:59:09.076695 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:59:09.077712 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:59:09.078495 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:59:09.079014 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:59:09.082192 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:59:09.082775 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:59:09.086449 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:59:09.087034 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.087473 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:59:09.087844 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.095165 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.095658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.096071 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:59:09.101102 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:59:09.104499 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.104933 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:59:09.105811 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.109056 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.109500 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:59:09.110228 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.111674 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:09.112094 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.112477 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:09.113621 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.117380 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:59:09.118027 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:09.118444 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:59:09.121389 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:59:09.122702 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:59:09.123356 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf7e3a0>]}
[0m09:59:09.124021 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.04s]
[0m09:59:09.124716 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:59:09.125252 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.125881 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:59:09.126437 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:59:09.126858 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.130918 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.131562 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.135429 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.136040 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.136488 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:59:09.136869 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.144311 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.144749 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.145185 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:59:09.150832 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:09.154339 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.154779 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:59:09.155647 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.158863 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.159364 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:59:09.160178 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.161657 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:09.162080 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.162468 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:09.163537 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.166214 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:59:09.166926 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:09.167364 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:59:09.170306 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m09:59:09.171639 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:59:09.172245 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d37cd60>]}
[0m09:59:09.172921 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.05s]
[0m09:59:09.173604 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:59:09.174152 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:59:09.174764 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:59:09.175333 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:59:09.175764 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:59:09.179983 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.180572 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:59:09.184307 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.184908 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.185325 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:59:09.185690 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.192758 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.193189 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.193612 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:59:09.199461 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:09.202708 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.203141 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:59:09.203880 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.206996 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.207454 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:59:09.208144 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:09.209551 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:09.209982 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.210367 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:09.211401 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.214040 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:59:09.214663 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:09.215065 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:59:09.217900 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:09.219161 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:59:09.219800 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f817332f310>]}
[0m09:59:09.220462 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:59:09.221133 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:59:09.221619 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.222227 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:59:09.222839 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:59:09.223480 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.227757 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.228348 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.233108 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.233720 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.234125 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:59:09.234496 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.241829 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.242325 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:09.242751 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
);
  );
  
[0m09:59:09.243495 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 47: );
          ^

[0m09:59:09.243948 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:59:09.244572 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:59:09.246734 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near ";"
  LINE 47: );
            ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:09.247324 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d37cd60>]}
[0m09:59:09.248070 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:59:09.248827 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:59:09.249330 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.250062 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:59:09.250830 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:59:09.251296 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.314309 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.315061 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.343508 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.344046 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095909337783"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:59:09.344527 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:09.355284 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:59:09.369957 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.370443 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:59:09.371023 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:59:09.371507 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.371934 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095909337783'
        
      order by ordinal_position

  
[0m09:59:09.384079 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:59:09.389586 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.390091 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:09.393742 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:59:09.402358 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.402839 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:09.406484 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:59:09.422945 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.423629 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.424113 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095909337783"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095909337783"
    )
  
[0m09:59:09.425484 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:59:09.426803 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:09.427283 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:09.427706 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:09.428814 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:09.429685 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:59:09.430329 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a67bd6-bf35-41d8-af56-15a083b2c98b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815cf13430>]}
[0m09:59:09.430993 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:59:09.431778 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:09.432488 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:59:09.433270 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:59:09.433930 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:59:09.435299 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:09.435723 [debug] [MainThread]: On master: BEGIN
[0m09:59:09.436066 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:59:09.443083 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:09.443517 [debug] [MainThread]: On master: COMMIT
[0m09:59:09.443850 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:09.444172 [debug] [MainThread]: On master: COMMIT
[0m09:59:09.444601 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:09.444951 [debug] [MainThread]: On master: Close
[0m09:59:09.445410 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:09.445739 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:59:09.446143 [info ] [MainThread]: 
[0m09:59:09.446556 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m09:59:09.448094 [debug] [MainThread]: Command end result
[0m09:59:09.482043 [info ] [MainThread]: 
[0m09:59:09.482575 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:59:09.482981 [info ] [MainThread]: 
[0m09:59:09.483458 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  syntax error at or near ";"
  LINE 47: );
            ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:09.483866 [info ] [MainThread]: 
[0m09:59:09.484272 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:59:09.485173 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6980072, "process_user_time": 2.914906, "process_kernel_time": 0.651755, "process_mem_max_rss": "142816", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:59:09.485770 [debug] [MainThread]: Command `dbt run` failed at 09:59:09.485671 after 1.70 seconds
[0m09:59:09.486196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815f964610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815d7bc4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f815f650a00>]}
[0m09:59:09.486606 [debug] [MainThread]: Flushing usage events
[0m09:59:20.258129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e29d77c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e133bc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e1196970>]}


============================== 09:59:20.263418 | 8d9b0423-924a-4e0e-b55b-2b7e9d491f8e ==============================
[0m09:59:20.263418 [info ] [MainThread]: Running with dbt=1.8.3
[0m09:59:20.264130 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles/', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles/', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:59:20.424180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e07fcd30>]}
[0m09:59:20.479917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e0ac9490>]}
[0m09:59:20.480708 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m09:59:20.499945 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m09:59:20.687536 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:59:20.688286 [debug] [MainThread]: Partial parsing: updated file: scraping_dbt://models/src/src_ads_cleaned.sql
[0m09:59:21.079419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6681bb0>]}
[0m09:59:21.241320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f64d20d0>]}
[0m09:59:21.241979 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m09:59:21.242451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6693d30>]}
[0m09:59:21.244177 [info ] [MainThread]: 
[0m09:59:21.244910 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:59:21.249608 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m09:59:21.283934 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m09:59:21.284447 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m09:59:21.284796 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:21.294565 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m09:59:21.295938 [debug] [ThreadPool]: On list_scraping_db: Close
[0m09:59:21.297836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m09:59:21.304283 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:21.304686 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m09:59:21.305015 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:21.312119 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.312522 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m09:59:21.312883 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m09:59:21.317733 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m09:59:21.318846 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m09:59:21.319360 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m09:59:21.319983 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m09:59:21.322485 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:21.322861 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m09:59:21.323182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:21.329983 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.330375 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m09:59:21.330720 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m09:59:21.335843 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m09:59:21.337103 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m09:59:21.337574 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m09:59:21.344460 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.344875 [debug] [MainThread]: On master: BEGIN
[0m09:59:21.345218 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:59:21.352068 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.352446 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.352841 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:59:21.358382 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.359520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e1159190>]}
[0m09:59:21.360025 [debug] [MainThread]: On master: ROLLBACK
[0m09:59:21.360506 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.360856 [debug] [MainThread]: On master: BEGIN
[0m09:59:21.361361 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m09:59:21.361716 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.362039 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.362351 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.362732 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:21.363079 [debug] [MainThread]: On master: Close
[0m09:59:21.363576 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:59:21.363975 [info ] [MainThread]: 
[0m09:59:21.371824 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m09:59:21.372427 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m09:59:21.372966 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m09:59:21.373394 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m09:59:21.381855 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m09:59:21.382454 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m09:59:21.420525 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m09:59:21.421160 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.421585 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m09:59:21.421948 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.428957 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.429403 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.429851 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m09:59:21.435332 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.441656 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.442099 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m09:59:21.442884 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.446036 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.446452 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m09:59:21.447217 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.466936 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:21.467412 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.467797 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m09:59:21.468840 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.475028 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m09:59:21.479290 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m09:59:21.479737 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m09:59:21.482521 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.484797 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m09:59:21.486388 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e033e1f0>]}
[0m09:59:21.487063 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 0[0m in 0.11s]
[0m09:59:21.487821 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m09:59:21.488288 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m09:59:21.488891 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m09:59:21.489661 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m09:59:21.490297 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m09:59:21.494671 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m09:59:21.495280 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m09:59:21.498957 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m09:59:21.499604 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.500015 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m09:59:21.500370 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.507343 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.507758 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.508153 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m09:59:21.513102 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m09:59:21.516562 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.516992 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m09:59:21.517852 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.521065 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.521485 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m09:59:21.522186 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.523539 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:21.523953 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.524330 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m09:59:21.525393 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.528850 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m09:59:21.529491 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m09:59:21.530156 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m09:59:21.533256 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.534540 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m09:59:21.535174 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e0761670>]}
[0m09:59:21.535855 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m09:59:21.536623 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m09:59:21.537100 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.537682 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m09:59:21.538234 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m09:59:21.538650 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.542166 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.542720 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.546445 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.547029 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.547469 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m09:59:21.547854 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.554733 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.555152 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.555598 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m09:59:21.560768 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.564042 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.564474 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m09:59:21.565236 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.568355 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.568777 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m09:59:21.569483 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.570921 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:21.571370 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.571738 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m09:59:21.572723 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.575461 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m09:59:21.576163 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m09:59:21.576577 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m09:59:21.579419 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.580661 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m09:59:21.581239 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39dff557f0>]}
[0m09:59:21.581867 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 0[0m in 0.04s]
[0m09:59:21.582576 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m09:59:21.583060 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m09:59:21.583679 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m09:59:21.584219 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m09:59:21.584619 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m09:59:21.588487 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.589042 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m09:59:21.592766 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.593352 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.593786 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m09:59:21.594156 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.601101 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.601521 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.601923 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m09:59:21.607703 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.005 seconds
[0m09:59:21.610906 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.611373 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m09:59:21.612197 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.615282 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.615707 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m09:59:21.616439 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m09:59:21.617766 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:21.618183 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.618549 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m09:59:21.619554 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.622187 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m09:59:21.622783 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m09:59:21.623185 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m09:59:21.625900 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m09:59:21.627136 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m09:59:21.627743 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39dff9d0a0>]}
[0m09:59:21.628379 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 0[0m in 0.04s]
[0m09:59:21.629086 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m09:59:21.629544 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.630138 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m09:59:21.630738 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m09:59:21.631374 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.635820 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.636393 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.641004 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.641590 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.642030 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m09:59:21.642398 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.649225 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.649643 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m09:59:21.650055 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m09:59:21.651677 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m09:59:21.652133 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m09:59:21.652774 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m09:59:21.654777 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:21.655301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6fbee50>]}
[0m09:59:21.655944 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m09:59:21.656641 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m09:59:21.657101 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.657593 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m09:59:21.658441 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m09:59:21.658915 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.716378 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.717240 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.746080 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.746592 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp095921740200"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m09:59:21.747023 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m09:59:21.758327 [debug] [Thread-1  ]: SQL status: SELECT 0 in 0.011 seconds
[0m09:59:21.772854 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.773315 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m09:59:21.773874 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m09:59:21.774296 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.774680 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp095921740200'
        
      order by ordinal_position

  
[0m09:59:21.787286 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m09:59:21.792856 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.793336 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:21.797177 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m09:59:21.806055 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.806515 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m09:59:21.810441 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m09:59:21.826847 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.827575 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.828036 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp095921740200"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp095921740200"
    )
  
[0m09:59:21.829399 [debug] [Thread-1  ]: SQL status: INSERT 0 0 in 0.001 seconds
[0m09:59:21.830714 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:21.831167 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m09:59:21.831574 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m09:59:21.832831 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m09:59:21.833659 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m09:59:21.834336 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d9b0423-924a-4e0e-b55b-2b7e9d491f8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6fa5e20>]}
[0m09:59:21.834984 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 0[0m in 0.18s]
[0m09:59:21.835667 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m09:59:21.836151 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m09:59:21.836720 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m09:59:21.837247 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m09:59:21.838501 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.838902 [debug] [MainThread]: On master: BEGIN
[0m09:59:21.839265 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:59:21.846423 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m09:59:21.846786 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.847103 [debug] [MainThread]: Using postgres connection "master"
[0m09:59:21.847467 [debug] [MainThread]: On master: COMMIT
[0m09:59:21.847867 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m09:59:21.848205 [debug] [MainThread]: On master: Close
[0m09:59:21.848656 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:21.848999 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m09:59:21.849409 [info ] [MainThread]: 
[0m09:59:21.849810 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m09:59:21.851235 [debug] [MainThread]: Command end result
[0m09:59:21.885253 [info ] [MainThread]: 
[0m09:59:21.885749 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:59:21.886133 [info ] [MainThread]: 
[0m09:59:21.886610 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m09:59:21.887021 [info ] [MainThread]: 
[0m09:59:21.887460 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m09:59:21.888358 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6799556, "process_user_time": 2.815097, "process_kernel_time": 0.746699, "process_mem_max_rss": "142884", "process_out_blocks": "3520", "command_success": false, "process_in_blocks": "0"}
[0m09:59:21.888945 [debug] [MainThread]: Command `dbt run` failed at 09:59:21.888842 after 1.68 seconds
[0m09:59:21.889386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39f6f871c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e07fcd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f39e02e2af0>]}
[0m09:59:21.889803 [debug] [MainThread]: Flushing usage events
[0m10:06:47.205057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb96740d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7deaaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7dea880>]}


============================== 10:06:47.210558 | 1331e1f0-cfb9-4b34-8e94-67515bca4dca ==============================
[0m10:06:47.210558 [info ] [MainThread]: Running with dbt=1.8.3
[0m10:06:47.211110 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:06:47.382506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb946d610>]}
[0m10:06:47.438745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7df7400>]}
[0m10:06:47.439687 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m10:06:47.460766 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m10:06:47.651353 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:06:47.651849 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:06:47.782101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdbea790>]}
[0m10:06:47.949969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdb95a30>]}
[0m10:06:47.950659 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m10:06:47.951094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdb43220>]}
[0m10:06:47.952699 [info ] [MainThread]: 
[0m10:06:47.953338 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:06:47.957786 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m10:06:47.991912 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m10:06:47.992346 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m10:06:47.992703 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:06:48.001717 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.009 seconds
[0m10:06:48.002967 [debug] [ThreadPool]: On list_scraping_db: Close
[0m10:06:48.004770 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m10:06:48.010968 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m10:06:48.011403 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m10:06:48.011748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:06:48.018826 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.019263 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m10:06:48.019647 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m10:06:48.024628 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m10:06:48.025766 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m10:06:48.026298 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m10:06:48.026910 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m10:06:48.029370 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m10:06:48.029763 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m10:06:48.030103 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:06:48.037104 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.037510 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m10:06:48.037868 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m10:06:48.043137 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m10:06:48.044437 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m10:06:48.044963 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m10:06:48.051821 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.052237 [debug] [MainThread]: On master: BEGIN
[0m10:06:48.052617 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:06:48.059730 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.060143 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.060610 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:06:48.066427 [debug] [MainThread]: SQL status: SELECT 0 in 0.005 seconds
[0m10:06:48.067609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcdb95ee0>]}
[0m10:06:48.068134 [debug] [MainThread]: On master: ROLLBACK
[0m10:06:48.068642 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.069015 [debug] [MainThread]: On master: BEGIN
[0m10:06:48.069565 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m10:06:48.069944 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.070321 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.070665 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.071096 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:06:48.071501 [debug] [MainThread]: On master: Close
[0m10:06:48.072025 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:06:48.072420 [info ] [MainThread]: 
[0m10:06:48.079110 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m10:06:48.079746 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m10:06:48.080277 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m10:06:48.080697 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m10:06:48.089175 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m10:06:48.089768 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m10:06:48.127872 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m10:06:48.128486 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.128901 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m10:06:48.129283 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.136377 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.136828 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.137268 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m10:06:48.143864 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.006 seconds
[0m10:06:48.150398 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.150859 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m10:06:48.151711 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.154998 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.155481 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m10:06:48.156218 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.175845 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m10:06:48.176289 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.176685 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m10:06:48.178945 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m10:06:48.185366 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m10:06:48.189555 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m10:06:48.189997 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m10:06:48.192947 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m10:06:48.195267 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m10:06:48.196870 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd8362e0>]}
[0m10:06:48.197575 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 195[0m in 0.12s]
[0m10:06:48.198215 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m10:06:48.198697 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m10:06:48.199364 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m10:06:48.200066 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m10:06:48.200506 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m10:06:48.203669 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m10:06:48.204242 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m10:06:48.207922 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m10:06:48.208693 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.209112 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m10:06:48.209492 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.216776 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.217212 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.217707 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m10:06:48.223016 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.005 seconds
[0m10:06:48.226330 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.226773 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m10:06:48.227559 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.230855 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.231315 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m10:06:48.232022 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.233395 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m10:06:48.233822 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.234199 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m10:06:48.235360 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.238999 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m10:06:48.239674 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m10:06:48.240094 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m10:06:48.243315 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m10:06:48.244651 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m10:06:48.245292 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd672430>]}
[0m10:06:48.245964 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m10:06:48.246633 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m10:06:48.247122 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.247787 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m10:06:48.248308 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m10:06:48.248716 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.251997 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.252624 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.256563 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.257234 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.257681 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m10:06:48.258087 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.265424 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.265879 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.266328 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m10:06:48.275971 [debug] [Thread-1  ]: SQL status: SELECT 1950 in 0.009 seconds
[0m10:06:48.279570 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.280041 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m10:06:48.280824 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.284136 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.284616 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m10:06:48.285354 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.286827 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m10:06:48.287298 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.287722 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m10:06:48.289313 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.292097 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m10:06:48.292834 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m10:06:48.293288 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m10:06:48.295970 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m10:06:48.297298 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m10:06:48.297915 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd827280>]}
[0m10:06:48.298607 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 1950[0m in 0.05s]
[0m10:06:48.299286 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m10:06:48.299777 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m10:06:48.300388 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m10:06:48.300884 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m10:06:48.301302 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m10:06:48.305342 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.305920 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m10:06:48.309655 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.310268 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.310691 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m10:06:48.311067 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.318177 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.318613 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.319036 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m10:06:48.332070 [debug] [Thread-1  ]: SQL status: SELECT 1928 in 0.013 seconds
[0m10:06:48.335324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.335796 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m10:06:48.336598 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.339778 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.340248 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m10:06:48.340982 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m10:06:48.342366 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m10:06:48.342814 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.343253 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m10:06:48.344994 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.347711 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m10:06:48.348363 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m10:06:48.348799 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m10:06:48.351444 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.002 seconds
[0m10:06:48.352717 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m10:06:48.353320 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd836280>]}
[0m10:06:48.353991 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 1928[0m in 0.05s]
[0m10:06:48.354641 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m10:06:48.355121 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.355762 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m10:06:48.356267 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m10:06:48.356676 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.359926 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.360498 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.365013 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.365610 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.366014 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m10:06:48.366382 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.373306 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.373731 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m10:06:48.374130 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m10:06:48.375807 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m10:06:48.376233 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m10:06:48.376822 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m10:06:48.379123 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m10:06:48.379880 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb885c250>]}
[0m10:06:48.380801 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.02s]
[0m10:06:48.381463 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m10:06:48.381927 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.382767 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m10:06:48.383328 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m10:06:48.383760 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.393830 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.394422 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.422646 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.423127 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp100648417044"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m10:06:48.423600 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m10:06:48.435881 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.012 seconds
[0m10:06:48.453357 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.453836 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m10:06:48.454408 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m10:06:48.454830 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.455260 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp100648417044'
        
      order by ordinal_position

  
[0m10:06:48.468451 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.013 seconds
[0m10:06:48.474055 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.474868 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m10:06:48.478732 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m10:06:48.487613 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.488088 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m10:06:48.491921 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m10:06:48.508054 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.508693 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.509155 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp100648417044"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp100648417044"
    )
  
[0m10:06:48.510904 [debug] [Thread-1  ]: SQL status: INSERT 0 195 in 0.001 seconds
[0m10:06:48.512195 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m10:06:48.512639 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m10:06:48.513026 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m10:06:48.514148 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m10:06:48.514967 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m10:06:48.515599 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1331e1f0-cfb9-4b34-8e94-67515bca4dca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fcd676490>]}
[0m10:06:48.516264 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 195[0m in 0.13s]
[0m10:06:48.516900 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m10:06:48.517376 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m10:06:48.517922 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m10:06:48.518407 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m10:06:48.519566 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.519940 [debug] [MainThread]: On master: BEGIN
[0m10:06:48.520262 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:06:48.527325 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m10:06:48.527786 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.528200 [debug] [MainThread]: Using postgres connection "master"
[0m10:06:48.528602 [debug] [MainThread]: On master: COMMIT
[0m10:06:48.529089 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m10:06:48.529493 [debug] [MainThread]: On master: Close
[0m10:06:48.530000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:06:48.530378 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m10:06:48.530876 [info ] [MainThread]: 
[0m10:06:48.531338 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m10:06:48.532865 [debug] [MainThread]: Command end result
[0m10:06:48.570412 [info ] [MainThread]: 
[0m10:06:48.570948 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:06:48.571391 [info ] [MainThread]: 
[0m10:06:48.571897 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m10:06:48.572305 [info ] [MainThread]: 
[0m10:06:48.572733 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m10:06:48.573618 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4192814, "process_user_time": 2.591219, "process_kernel_time": 0.694718, "process_mem_max_rss": "198000", "process_in_blocks": "1848", "process_out_blocks": "2432", "command_success": false}
[0m10:06:48.574326 [debug] [MainThread]: Command `dbt run` failed at 10:06:48.574216 after 1.42 seconds
[0m10:06:48.574796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb96740d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb7df7400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fb9365e80>]}
[0m10:06:48.575268 [debug] [MainThread]: Flushing usage events
[0m11:59:11.381393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd91a685b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd903e05e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd906f29a0>]}


============================== 11:59:11.389565 | 0d99b441-4216-4692-9e5f-de8a9b129dec ==============================
[0m11:59:11.389565 [info ] [MainThread]: Running with dbt=1.8.3
[0m11:59:11.390165 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/scraping_dbt/logs', 'profiles_dir': '/opt/airflow/dbt_profiles', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:59:11.598880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f5faac0>]}
[0m11:59:11.656426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f5bb2b0>]}
[0m11:59:11.657878 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:59:11.679253 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m11:59:11.923797 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:59:11.924356 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:59:12.066681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5fd4700>]}
[0m11:59:12.257920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5f289a0>]}
[0m11:59:12.258701 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m11:59:12.259299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5fe5fa0>]}
[0m11:59:12.261108 [info ] [MainThread]: 
[0m11:59:12.261903 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:59:12.266490 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m11:59:12.307744 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m11:59:12.308313 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m11:59:12.308745 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:12.318361 [debug] [ThreadPool]: SQL status: SELECT 6 in 0.010 seconds
[0m11:59:12.319888 [debug] [ThreadPool]: On list_scraping_db: Close
[0m11:59:12.322096 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_public)
[0m11:59:12.329130 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m11:59:12.329629 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m11:59:12.330028 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:59:12.337477 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.337919 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m11:59:12.338291 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m11:59:12.344042 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m11:59:12.345560 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m11:59:12.346112 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m11:59:12.346808 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_public, now list_scraping_db_scraping_ads)
[0m11:59:12.350545 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m11:59:12.350965 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m11:59:12.351376 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:59:12.359298 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.359789 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m11:59:12.360199 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m11:59:12.365019 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m11:59:12.366341 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m11:59:12.366895 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m11:59:12.373018 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.373492 [debug] [MainThread]: On master: BEGIN
[0m11:59:12.373858 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:59:12.381438 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.381878 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.382297 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:59:12.390660 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:59:12.391941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5f28df0>]}
[0m11:59:12.392487 [debug] [MainThread]: On master: ROLLBACK
[0m11:59:12.393019 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.393425 [debug] [MainThread]: On master: BEGIN
[0m11:59:12.393983 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:59:12.394363 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.394697 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.395017 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.395429 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:59:12.395799 [debug] [MainThread]: On master: Close
[0m11:59:12.396358 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:59:12.396750 [info ] [MainThread]: 
[0m11:59:12.403140 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m11:59:12.403804 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m11:59:12.404398 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now model.scraping_dbt.src_ads)
[0m11:59:12.404820 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m11:59:12.413662 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m11:59:12.414336 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m11:59:12.453133 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m11:59:12.453968 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.454453 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m11:59:12.454836 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.463748 [debug] [Thread-1  ]: SQL status: BEGIN in 0.009 seconds
[0m11:59:12.464302 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.464774 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m11:59:12.478740 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.013 seconds
[0m11:59:12.486247 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.486770 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m11:59:12.487780 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:59:12.491428 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.491903 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m11:59:12.492737 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.513182 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m11:59:12.513792 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.514208 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m11:59:12.516902 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m11:59:12.523613 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m11:59:12.527944 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m11:59:12.528421 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m11:59:12.533918 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.005 seconds
[0m11:59:12.536413 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m11:59:12.538404 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5c27730>]}
[0m11:59:12.539136 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 195[0m in 0.13s]
[0m11:59:12.539809 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m11:59:12.540293 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m11:59:12.540835 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m11:59:12.541535 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m11:59:12.541991 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m11:59:12.545715 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m11:59:12.546375 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m11:59:12.550270 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m11:59:12.550949 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.551422 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m11:59:12.551810 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.559664 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.560152 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.560605 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m11:59:12.567208 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m11:59:12.571174 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.571641 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m11:59:12.572588 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m11:59:12.576080 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.576546 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m11:59:12.577465 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.578979 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m11:59:12.579422 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.579813 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m11:59:12.581197 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m11:59:12.585214 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m11:59:12.585930 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m11:59:12.586376 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m11:59:12.589547 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m11:59:12.590956 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m11:59:12.591609 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f49c7f0>]}
[0m11:59:12.592309 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m11:59:12.592962 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m11:59:12.593457 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.594129 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m11:59:12.594737 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m11:59:12.595194 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.598621 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.599295 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.603646 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.609393 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.609945 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m11:59:12.610420 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.618300 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m11:59:12.618878 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.619363 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m11:59:12.630861 [debug] [Thread-1  ]: SQL status: SELECT 1950 in 0.011 seconds
[0m11:59:12.634868 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.635376 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m11:59:12.636265 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.639799 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.640267 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m11:59:12.641099 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.642707 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m11:59:12.643156 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.643541 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m11:59:12.645470 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m11:59:12.648647 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m11:59:12.649539 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m11:59:12.650004 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m11:59:12.653920 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m11:59:12.655921 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m11:59:12.656651 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5f851f0>]}
[0m11:59:12.657429 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 1950[0m in 0.06s]
[0m11:59:12.658169 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m11:59:12.658722 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m11:59:12.659407 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m11:59:12.659929 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m11:59:12.660351 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m11:59:12.664932 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.665641 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m11:59:12.669658 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.670315 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.670751 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m11:59:12.671140 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.678508 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.679009 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.679446 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m11:59:12.693804 [debug] [Thread-1  ]: SQL status: SELECT 1928 in 0.014 seconds
[0m11:59:12.697897 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.698431 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m11:59:12.699327 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.702965 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.703449 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m11:59:12.704336 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:12.705880 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m11:59:12.706324 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.706702 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m11:59:12.708685 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m11:59:12.711855 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m11:59:12.712528 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m11:59:12.712946 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m11:59:12.716240 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m11:59:12.717732 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m11:59:12.718397 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5ab65b0>]}
[0m11:59:12.719110 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 1928[0m in 0.06s]
[0m11:59:12.719762 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m11:59:12.720245 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.720884 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m11:59:12.721433 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m11:59:12.721887 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.725572 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.726211 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.731270 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.731993 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.732438 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m11:59:12.732812 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.740265 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.740767 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m11:59:12.741192 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m11:59:12.743726 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m11:59:12.744197 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m11:59:12.744817 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m11:59:12.752682 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m11:59:12.753353 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5aa60a0>]}
[0m11:59:12.754155 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.03s]
[0m11:59:12.754833 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m11:59:12.755326 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.756160 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m11:59:12.756726 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m11:59:12.757156 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.767330 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.768077 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.797578 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.798217 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp115912791682"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m11:59:12.798718 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m11:59:12.811538 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.013 seconds
[0m11:59:12.826754 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.827344 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m11:59:12.828071 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m11:59:12.828559 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.828994 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp115912791682'
        
      order by ordinal_position

  
[0m11:59:12.848280 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.019 seconds
[0m11:59:12.854632 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.855214 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m11:59:12.859269 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m11:59:12.868844 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.869402 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m11:59:12.873363 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m11:59:12.890248 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.891098 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.891641 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp115912791682"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp115912791682"
    )
  
[0m11:59:12.896473 [debug] [Thread-1  ]: SQL status: INSERT 0 195 in 0.004 seconds
[0m11:59:12.897978 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m11:59:12.898458 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m11:59:12.898879 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m11:59:12.900585 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m11:59:12.901503 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m11:59:12.902180 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d99b441-4216-4692-9e5f-de8a9b129dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda5a48df0>]}
[0m11:59:12.902914 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 195[0m in 0.15s]
[0m11:59:12.903606 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m11:59:12.904127 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m11:59:12.904605 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m11:59:12.905248 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m11:59:12.906493 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.906880 [debug] [MainThread]: On master: BEGIN
[0m11:59:12.907226 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:59:12.914555 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m11:59:12.915010 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.915381 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:12.915718 [debug] [MainThread]: On master: COMMIT
[0m11:59:12.916204 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:59:12.916590 [debug] [MainThread]: On master: Close
[0m11:59:12.917170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:12.917777 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m11:59:12.918521 [info ] [MainThread]: 
[0m11:59:12.919155 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m11:59:12.920726 [debug] [MainThread]: Command end result
[0m11:59:12.955821 [info ] [MainThread]: 
[0m11:59:12.956421 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:59:12.956794 [info ] [MainThread]: 
[0m11:59:12.957238 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m11:59:12.957666 [info ] [MainThread]: 
[0m11:59:12.958038 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m11:59:12.958926 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6302475, "process_user_time": 2.787194, "process_kernel_time": 0.716937, "process_mem_max_rss": "197776", "process_in_blocks": "35944", "process_out_blocks": "2432", "command_success": false}
[0m11:59:12.959556 [debug] [MainThread]: Command `dbt run` failed at 11:59:12.959457 after 1.63 seconds
[0m11:59:12.959998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd91a685b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd8f5bb2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efda59f1f10>]}
[0m11:59:12.960426 [debug] [MainThread]: Flushing usage events
[0m12:49:19.991118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f027a18d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0278ae5c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0278941970>]}


============================== 12:49:19.996988 | b8abe735-ae49-49fe-ba83-0509d0e4a1ee ==============================
[0m12:49:19.996988 [info ] [MainThread]: Running with dbt=1.8.3
[0m12:49:19.997795 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_profiles', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/scraping_dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt_profiles', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:49:20.182186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02782b0b20>]}
[0m12:49:20.240501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0277ffb490>]}
[0m12:49:20.241479 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:49:20.262586 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m12:49:20.454580 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:49:20.455128 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:49:20.602641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e7d5760>]}
[0m12:49:20.774497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e728a00>]}
[0m12:49:20.775241 [info ] [MainThread]: Found 7 models, 1 snapshot, 4 data tests, 1 seed, 2 sources, 531 macros
[0m12:49:20.775798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e7f1fd0>]}
[0m12:49:20.777633 [info ] [MainThread]: 
[0m12:49:20.778455 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:49:20.783127 [debug] [ThreadPool]: Acquiring new postgres connection 'list_scraping_db'
[0m12:49:20.819610 [debug] [ThreadPool]: Using postgres connection "list_scraping_db"
[0m12:49:20.820182 [debug] [ThreadPool]: On list_scraping_db: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db"} */

    select distinct nspname from pg_namespace
  
[0m12:49:20.820565 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:49:20.830756 [debug] [ThreadPool]: SQL status: SELECT 8 in 0.010 seconds
[0m12:49:20.832259 [debug] [ThreadPool]: On list_scraping_db: Close
[0m12:49:20.834314 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db, now list_scraping_db_scraping_ads)
[0m12:49:20.841074 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m12:49:20.841569 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: BEGIN
[0m12:49:20.841926 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:49:20.849328 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m12:49:20.849964 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_scraping_ads"
[0m12:49:20.850347 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_scraping_ads"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'scraping_ads'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'scraping_ads'
  
[0m12:49:20.855422 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.005 seconds
[0m12:49:20.856706 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: ROLLBACK
[0m12:49:20.857238 [debug] [ThreadPool]: On list_scraping_db_scraping_ads: Close
[0m12:49:20.857962 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_scraping_db_scraping_ads, now list_scraping_db_public)
[0m12:49:20.860767 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m12:49:20.861181 [debug] [ThreadPool]: On list_scraping_db_public: BEGIN
[0m12:49:20.861546 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:49:20.868998 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m12:49:20.869499 [debug] [ThreadPool]: Using postgres connection "list_scraping_db_public"
[0m12:49:20.869886 [debug] [ThreadPool]: On list_scraping_db_public: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "list_scraping_db_public"} */
select
      'scraping_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'scraping_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:49:20.875508 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.005 seconds
[0m12:49:20.877053 [debug] [ThreadPool]: On list_scraping_db_public: ROLLBACK
[0m12:49:20.877633 [debug] [ThreadPool]: On list_scraping_db_public: Close
[0m12:49:20.885118 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.885670 [debug] [MainThread]: On master: BEGIN
[0m12:49:20.886058 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:49:20.893540 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:49:20.894029 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.894465 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:49:20.900627 [debug] [MainThread]: SQL status: SELECT 0 in 0.006 seconds
[0m12:49:20.901998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e728bb0>]}
[0m12:49:20.902553 [debug] [MainThread]: On master: ROLLBACK
[0m12:49:20.903083 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.903459 [debug] [MainThread]: On master: BEGIN
[0m12:49:20.903970 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:49:20.904338 [debug] [MainThread]: On master: COMMIT
[0m12:49:20.904667 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:20.905049 [debug] [MainThread]: On master: COMMIT
[0m12:49:20.905598 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:49:20.906063 [debug] [MainThread]: On master: Close
[0m12:49:20.906657 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:49:20.907175 [info ] [MainThread]: 
[0m12:49:20.914002 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads
[0m12:49:20.914667 [info ] [Thread-1  ]: 1 of 7 START sql table model public.src_ads .................................... [RUN]
[0m12:49:20.915238 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_scraping_db_public, now model.scraping_dbt.src_ads)
[0m12:49:20.915682 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads
[0m12:49:20.925211 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads"
[0m12:49:20.926014 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads
[0m12:49:20.966096 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads"
[0m12:49:20.966941 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.967421 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: BEGIN
[0m12:49:20.967806 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:20.976072 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:20.976601 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.977070 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */

  
    

  create  table "scraping_db"."public"."src_ads__dbt_tmp"
  
  
    as
  
  (
    WITH raw_ads AS (
    SELECT * FROM "scraping_db"."public"."ads"
    )

SELECT 
    RIGHT(url, 6) AS ad_id,
    url AS ad_url,
    lieu AS ad_location,
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '^([^(]+)') END AS ad_city, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_SUBSTR(lieu, '\(([^)]+)\)') END AS ad_zipcode, /* Old Method */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'^([^(]+)') END AS ad_city, /* For GCP */ */
    /* CASE WHEN lieu = '-' THEN NULL ELSE REGEXP_EXTRACT(lieu, r'\(([^)]+)\)') END AS ad_zipcode, /* For GCP */ */
    INITCAP(SPLIT_PART(url, '-', -3)) AS ad_city,
    SPLIT_PART(url, '-', -2) AS ad_zipcode,
    surface AS ad_surface,
    COALESCE(nb_chambres, 0) AS ad_nb_bedrooms,
    /* IFNULL(nb_chambres, 0) AS ad_nb_bedrooms, /* For GCP */ */
    nb_pieces AS ad_nb_rooms,
    CAST(REPLACE(price, ' ', '') AS INTEGER) AS ad_price,
    CAST(REPLACE(prix_m2, ' ', '') AS INTEGER) AS ad_price_sqm,
    /* CAST(REPLACE(price, ' ', '') AS INT64) AS ad_price, /* For GCP */ */
    /* CAST(REPLACE(prix_m2, ' ', '') AS INT64) AS ad_price_sqm, /* For GCP */ */
    tags AS ad_tags,
    tag_1 AS ad_tag_1,
    tag_2 AS ad_tag_2,
    tag_3 AS ad_tag_3,
    images_url AS ad_images_url,
    date_scraped AS ad_date_scraped,
    TO_DATE(date_publication, 'DD/mm/YYYY') AS ad_published_on,
    /* PARSE_DATE("%d/%m/%Y", date_publication) AS ad_published_on, /* For GCP */ */
    CURRENT_TIMESTAMP AS created_at,
    CURRENT_TIMESTAMP AS updated_at 
    /* CURRENT_TIMESTAMP() AS created_at,  /* For GCP */ */
    /* CURRENT_TIMESTAMP() AS updated_at  /* For GCP */ */
FROM
    raw_ads
  );
  
[0m12:49:20.985478 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.008 seconds
[0m12:49:20.993038 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.993621 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads" rename to "src_ads__dbt_backup"
[0m12:49:20.994597 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:20.998306 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:20.998767 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
alter table "scraping_db"."public"."src_ads__dbt_tmp" rename to "src_ads"
[0m12:49:20.999615 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.020566 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m12:49:21.021154 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:21.021618 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: COMMIT
[0m12:49:21.023823 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:49:21.030824 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_ads__dbt_backup"
[0m12:49:21.035293 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads"
[0m12:49:21.035783 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads"} */
drop table if exists "scraping_db"."public"."src_ads__dbt_backup" cascade
[0m12:49:21.039598 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m12:49:21.042224 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads: Close
[0m12:49:21.043902 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e300c70>]}
[0m12:49:21.044647 [info ] [Thread-1  ]: 1 of 7 OK created sql table model public.src_ads ............................... [[32mSELECT 195[0m in 0.13s]
[0m12:49:21.045308 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads
[0m12:49:21.045819 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_prix_m2
[0m12:49:21.046529 [info ] [Thread-1  ]: 2 of 7 START sql table model public.src_prix_m2 ................................ [RUN]
[0m12:49:21.047235 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads, now model.scraping_dbt.src_prix_m2)
[0m12:49:21.047711 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_prix_m2
[0m12:49:21.051390 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_prix_m2"
[0m12:49:21.052093 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_prix_m2
[0m12:49:21.056224 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_prix_m2"
[0m12:49:21.056958 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.057455 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: BEGIN
[0m12:49:21.057926 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.065572 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:21.066087 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.066536 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */

  
    

  create  table "scraping_db"."public"."src_prix_m2__dbt_tmp"
  
  
    as
  
  (
    WITH raw_prix_m2 AS (
    SELECT * FROM "scraping_db"."public"."prix_m2_commune"
    )

SELECT 
    CASE 
        WHEN LENGTH(CAST(zipcode AS TEXT)) = 4 THEN CONCAT('0', CAST(zipcode AS TEXT))
        ELSE CAST(zipcode AS TEXT)
        /* WHEN LENGTH(CAST(zipcode AS STRING)) = 4 THEN CONCAT("0", CAST(zipcode AS STRING))
        ELSE CAST(zipcode AS STRING) /* For GCP */ */
        END
        AS zipcode,
    city_name,
    house_type,
    CAST(prix_m2 AS INTEGER) AS prix_m2
FROM
    raw_prix_m2
  );
  
[0m12:49:21.073003 [debug] [Thread-1  ]: SQL status: SELECT 246 in 0.006 seconds
[0m12:49:21.077214 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.077786 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2" rename to "src_prix_m2__dbt_backup"
[0m12:49:21.078754 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:21.082571 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.083102 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
alter table "scraping_db"."public"."src_prix_m2__dbt_tmp" rename to "src_prix_m2"
[0m12:49:21.084027 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.085583 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m12:49:21.086024 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.086416 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: COMMIT
[0m12:49:21.087787 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:49:21.091876 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."src_prix_m2__dbt_backup"
[0m12:49:21.092558 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_prix_m2"
[0m12:49:21.092984 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_prix_m2"} */
drop table if exists "scraping_db"."public"."src_prix_m2__dbt_backup" cascade
[0m12:49:21.097167 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m12:49:21.098622 [debug] [Thread-1  ]: On model.scraping_dbt.src_prix_m2: Close
[0m12:49:21.099302 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0277b868e0>]}
[0m12:49:21.100015 [info ] [Thread-1  ]: 2 of 7 OK created sql table model public.src_prix_m2 ........................... [[32mSELECT 246[0m in 0.05s]
[0m12:49:21.100655 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_prix_m2
[0m12:49:21.101141 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.101801 [info ] [Thread-1  ]: 3 of 7 START sql table model public.dim_ads_images_url ......................... [RUN]
[0m12:49:21.102318 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_prix_m2, now model.scraping_dbt.dim_ads_images_url)
[0m12:49:21.102723 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.106105 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.106763 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.110974 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.111661 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.112144 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: BEGIN
[0m12:49:21.112543 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.120007 [debug] [Thread-1  ]: SQL status: BEGIN in 0.007 seconds
[0m12:49:21.120476 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.120880 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */

  
    

  create  table "scraping_db"."public"."dim_ads_images_url__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    )

SELECT 
    ad_id, 
    CASE WHEN ad_image_url = 'None' THEN ad_image_url ELSE REPLACE(ad_image_url, CHR(39), '') END AS ad_image_url    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_images_url, '^\[|\]$', ''), ', ')) AS ad_image_url
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_images_url, r'^\[|\]$', ''), ', ')) AS ad_image_url /* For GCP */ */
  );
  
[0m12:49:21.133262 [debug] [Thread-1  ]: SQL status: SELECT 1950 in 0.012 seconds
[0m12:49:21.137470 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.137986 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url" rename to "dim_ads_images_url__dbt_backup"
[0m12:49:21.139020 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:21.142683 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.143166 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
alter table "scraping_db"."public"."dim_ads_images_url__dbt_tmp" rename to "dim_ads_images_url"
[0m12:49:21.144339 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:49:21.146031 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m12:49:21.146491 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.147027 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: COMMIT
[0m12:49:21.149280 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:49:21.152537 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_images_url__dbt_backup"
[0m12:49:21.153327 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_images_url"
[0m12:49:21.153867 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_images_url"} */
drop table if exists "scraping_db"."public"."dim_ads_images_url__dbt_backup" cascade
[0m12:49:21.157881 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.004 seconds
[0m12:49:21.159417 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_images_url: Close
[0m12:49:21.160103 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e425250>]}
[0m12:49:21.161002 [info ] [Thread-1  ]: 3 of 7 OK created sql table model public.dim_ads_images_url .................... [[32mSELECT 1950[0m in 0.06s]
[0m12:49:21.161775 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_images_url
[0m12:49:21.162311 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_tags
[0m12:49:21.163002 [info ] [Thread-1  ]: 4 of 7 START sql table model public.dim_ads_tags ............................... [RUN]
[0m12:49:21.163579 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_images_url, now model.scraping_dbt.dim_ads_tags)
[0m12:49:21.164044 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.dim_ads_tags
[0m12:49:21.168737 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.169745 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.dim_ads_tags
[0m12:49:21.174535 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.175460 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.176314 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: BEGIN
[0m12:49:21.176758 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.184777 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:21.185456 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.185938 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */

  
    

  create  table "scraping_db"."public"."dim_ads_tags__dbt_tmp"
  
  
    as
  
  (
    WITH 
src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    ),

temp_tags AS (
SELECT DISTINCT
    ad_id, 
    CASE WHEN ad_tag = 'None' THEN ad_tag ELSE REPLACE(ad_tag, CHR(39), '') END AS ad_tag    /* CHR(39) is ' */
FROM
    src_ads,
    UNNEST(STRING_TO_ARRAY(REGEXP_REPLACE(ad_tags, '^\[|\]$', ''), ', ')) AS ad_tag
    /* UNNEST(SPLIT(REGEXP_REPLACE(ad_tags, r'^\[|\]$', ''), ', ')) AS ad_tag /* For GCP */ */

WHERE 
    ad_tag != 'None' AND ad_tag != ' '

UNION ALL
SELECT ad_id, ad_tag_1 AS ad_tag FROM src_ads WHERE ad_tag_1 IS NOT NULL AND ad_tag_1 != 'None'

UNION ALL
SELECT ad_id, ad_tag_2 AS ad_tag FROM src_ads WHERE ad_tag_2 IS NOT NULL AND ad_tag_2 != 'None'

UNION ALL
SELECT ad_id, ad_tag_3 AS ad_tag FROM src_ads WHERE ad_tag_3 IS NOT NULL AND ad_tag_3 != 'None'
)

SELECT DISTINCT 
    ad_id, 
    ad_tag
FROM
    temp_tags
ORDER BY 
    ad_id, 
    ad_tag
  );
  
[0m12:49:21.199576 [debug] [Thread-1  ]: SQL status: SELECT 1928 in 0.013 seconds
[0m12:49:21.203640 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.204147 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags" rename to "dim_ads_tags__dbt_backup"
[0m12:49:21.205055 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.208658 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.209142 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
alter table "scraping_db"."public"."dim_ads_tags__dbt_tmp" rename to "dim_ads_tags"
[0m12:49:21.210068 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:49:21.211576 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m12:49:21.212035 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.212463 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: COMMIT
[0m12:49:21.214526 [debug] [Thread-1  ]: SQL status: COMMIT in 0.002 seconds
[0m12:49:21.217699 [debug] [Thread-1  ]: Applying DROP to: "scraping_db"."public"."dim_ads_tags__dbt_backup"
[0m12:49:21.218395 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.dim_ads_tags"
[0m12:49:21.218849 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.dim_ads_tags"} */
drop table if exists "scraping_db"."public"."dim_ads_tags__dbt_backup" cascade
[0m12:49:21.222234 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.003 seconds
[0m12:49:21.223709 [debug] [Thread-1  ]: On model.scraping_dbt.dim_ads_tags: Close
[0m12:49:21.224385 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e300610>]}
[0m12:49:21.225125 [info ] [Thread-1  ]: 4 of 7 OK created sql table model public.dim_ads_tags .......................... [[32mSELECT 1928[0m in 0.06s]
[0m12:49:21.225842 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_tags
[0m12:49:21.226353 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.227015 [info ] [Thread-1  ]: 5 of 7 START sql table model public.src_ads_cleaned ............................ [RUN]
[0m12:49:21.227561 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.dim_ads_tags, now model.scraping_dbt.src_ads_cleaned)
[0m12:49:21.228012 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.231762 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.232440 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.237539 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.238258 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.238710 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: BEGIN
[0m12:49:21.239126 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.246779 [debug] [Thread-1  ]: SQL status: BEGIN in 0.008 seconds
[0m12:49:21.247278 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned"
[0m12:49:21.247739 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned"} */

  
    

  create  table "scraping_db"."public"."src_ads_cleaned__dbt_tmp"
  
  
    as
  
  (
    WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

latest_ads AS (
    SELECT
        ad_id,
        MAX(updated_at) AS latest_updated_at
    FROM
        src_ads
    GROUP BY
        ad_id
),

duplicates AS (
    SELECT
        s.*
    FROM
        src_ads s
    LEFT JOIN
        latest_ads la
    ON
        s.id = la.id
        AND s.updated_at = la.latest_updated_at
    WHERE
        la.id IS NULL
)

SELECT * FROM src_ads
WHERE (id, updated_at) NOT IN (
    SELECT 
        la.id,
        la.latest_updated_at
    FROM   
        latest_ads la
)
  );
  
[0m12:49:21.249447 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column s.id does not exist
LINE 34:         s.id = la.id
                 ^

[0m12:49:21.249934 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: ROLLBACK
[0m12:49:21.250626 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned: Close
[0m12:49:21.252889 [debug] [Thread-1  ]: Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m12:49:21.253504 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e274400>]}
[0m12:49:21.254294 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model public.src_ads_cleaned ................... [[31mERROR[0m in 0.03s]
[0m12:49:21.254994 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned
[0m12:49:21.255511 [debug] [Thread-1  ]: Began running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.256271 [info ] [Thread-1  ]: 6 of 7 START sql incremental model public.src_ads_cleaned_backup_incremental ... [RUN]
[0m12:49:21.257036 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.scraping_dbt.src_ads_cleaned, now model.scraping_dbt.src_ads_cleaned_backup_incremental)
[0m12:49:21.257622 [debug] [Thread-1  ]: Began compiling node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.267852 [debug] [Thread-1  ]: Writing injected SQL for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.268690 [debug] [Thread-1  ]: Began executing node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.302384 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.302989 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

    
  
    

  create temporary table "src_ads_cleaned_backup_incremental__dbt_tmp124921295062"
  
  
    as
  
  (
    

WITH src_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
),

existing_ads AS (
    SELECT * FROM "scraping_db"."public"."src_ads"
    WHERE True
),

new_or_updated_ads AS (
    SELECT
        s.ad_id, 
        s.ad_url,
        s.ad_city,
        s.ad_zipcode,
        s.ad_surface,
        s.ad_nb_bedrooms,
        s.ad_nb_rooms,
        s.ad_price,
        s.ad_price_sqm,
        s.ad_date_scraped,
        s.ad_published_on,
        COALESCE(e.created_at, s.updated_at) AS created_at,
        s.updated_at
    FROM src_ads s
    LEFT JOIN existing_ads e ON s.ad_id = e.ad_id
    )

SELECT * 
FROM new_or_updated_ads
/*WHERE 
    NOT True           
    OR ad_id IS NULL */
  );
  
  
[0m12:49:21.303502 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:49:21.315066 [debug] [Thread-1  ]: SQL status: SELECT 195 in 0.011 seconds
[0m12:49:21.330746 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.331347 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: BEGIN
[0m12:49:21.332046 [debug] [Thread-1  ]: SQL status: BEGIN in 0.000 seconds
[0m12:49:21.332529 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.332972 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental__dbt_tmp124921295062'
        
      order by ordinal_position

  
[0m12:49:21.345986 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.012 seconds
[0m12:49:21.352375 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.352929 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m12:49:21.356817 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.003 seconds
[0m12:49:21.366597 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.367160 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "scraping_db".INFORMATION_SCHEMA.columns
      where table_name = 'src_ads_cleaned_backup_incremental'
        
        and table_schema = 'public'
        
      order by ordinal_position

  
[0m12:49:21.371254 [debug] [Thread-1  ]: SQL status: SELECT 13 in 0.004 seconds
[0m12:49:21.388321 [debug] [Thread-1  ]: Writing runtime sql for node "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.389190 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.389758 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "scraping_dbt", "target_name": "dev", "node_id": "model.scraping_dbt.src_ads_cleaned_backup_incremental"} */

      
        
            delete from "scraping_db"."public"."src_ads_cleaned_backup_incremental"
            where (
                ad_id) in (
                select (ad_id)
                from "src_ads_cleaned_backup_incremental__dbt_tmp124921295062"
            );

        
    

    insert into "scraping_db"."public"."src_ads_cleaned_backup_incremental" ("ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at")
    (
        select "ad_id", "ad_url", "ad_city", "ad_zipcode", "ad_surface", "ad_nb_bedrooms", "ad_nb_rooms", "ad_price", "ad_price_sqm", "ad_date_scraped", "ad_published_on", "created_at", "updated_at"
        from "src_ads_cleaned_backup_incremental__dbt_tmp124921295062"
    )
  
[0m12:49:21.391754 [debug] [Thread-1  ]: SQL status: INSERT 0 195 in 0.002 seconds
[0m12:49:21.393226 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m12:49:21.393734 [debug] [Thread-1  ]: Using postgres connection "model.scraping_dbt.src_ads_cleaned_backup_incremental"
[0m12:49:21.394149 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: COMMIT
[0m12:49:21.395903 [debug] [Thread-1  ]: SQL status: COMMIT in 0.001 seconds
[0m12:49:21.396778 [debug] [Thread-1  ]: On model.scraping_dbt.src_ads_cleaned_backup_incremental: Close
[0m12:49:21.397575 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8abe735-ae49-49fe-ba83-0509d0e4a1ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f028e2798b0>]}
[0m12:49:21.398667 [info ] [Thread-1  ]: 6 of 7 OK created sql incremental model public.src_ads_cleaned_backup_incremental  [[32mINSERT 0 195[0m in 0.14s]
[0m12:49:21.399737 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.src_ads_cleaned_backup_incremental
[0m12:49:21.400392 [debug] [Thread-1  ]: Began running node model.scraping_dbt.dim_ads_details
[0m12:49:21.401252 [info ] [Thread-1  ]: 7 of 7 SKIP relation public.dim_ads_details .................................... [[33mSKIP[0m]
[0m12:49:21.402073 [debug] [Thread-1  ]: Finished running node model.scraping_dbt.dim_ads_details
[0m12:49:21.403579 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:21.404013 [debug] [MainThread]: On master: BEGIN
[0m12:49:21.404371 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:49:21.411858 [debug] [MainThread]: SQL status: BEGIN in 0.007 seconds
[0m12:49:21.412344 [debug] [MainThread]: On master: COMMIT
[0m12:49:21.412703 [debug] [MainThread]: Using postgres connection "master"
[0m12:49:21.413041 [debug] [MainThread]: On master: COMMIT
[0m12:49:21.413524 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:49:21.413903 [debug] [MainThread]: On master: Close
[0m12:49:21.414424 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:49:21.414774 [debug] [MainThread]: Connection 'model.scraping_dbt.src_ads_cleaned_backup_incremental' was properly closed.
[0m12:49:21.415240 [info ] [MainThread]: 
[0m12:49:21.415651 [info ] [MainThread]: Finished running 6 table models, 1 incremental model in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m12:49:21.417115 [debug] [MainThread]: Command end result
[0m12:49:21.452479 [info ] [MainThread]: 
[0m12:49:21.453050 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:49:21.453460 [info ] [MainThread]: 
[0m12:49:21.453908 [error] [MainThread]:   Database Error in model src_ads_cleaned (models/src/src_ads_cleaned.sql)
  column s.id does not exist
  LINE 34:         s.id = la.id
                   ^
  compiled Code at target/run/scraping_dbt/models/src/src_ads_cleaned.sql
[0m12:49:21.454283 [info ] [MainThread]: 
[0m12:49:21.454650 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m12:49:21.456081 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.5148588, "process_user_time": 2.705952, "process_kernel_time": 0.701249, "process_mem_max_rss": "197772", "process_in_blocks": "11008", "process_out_blocks": "2424", "command_success": false}
[0m12:49:21.456796 [debug] [MainThread]: Command `dbt run` failed at 12:49:21.456678 after 1.52 seconds
[0m12:49:21.457342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f027a18d7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0277ffb490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0279e8fe50>]}
[0m12:49:21.457824 [debug] [MainThread]: Flushing usage events
